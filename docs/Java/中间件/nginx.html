<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Java/中间件/nginx">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">1.nginx | SUITABLE</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://october-x.github.io/docs/Java/中间件/nginx"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="keywords" content="frontend, react, javascript, css, react, vue, typescript, docusaurus, blog, personal blog, personal website,html"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="1.nginx | SUITABLE"><meta data-rh="true" name="description" content="第一章 基础及安装"><meta data-rh="true" property="og:description" content="第一章 基础及安装"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://october-x.github.io/docs/Java/中间件/nginx"><link data-rh="true" rel="alternate" href="https://october-x.github.io/docs/Java/中间件/nginx" hreflang="zh"><link data-rh="true" rel="alternate" href="https://october-x.github.io/docs/Java/中间件/nginx" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://8YE83IQFLA-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="SUITABLE RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="SUITABLE Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="SUITABLE" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.12e922a4.css">
<link rel="preload" href="/assets/js/runtime~main.730de416.js" as="script">
<link rel="preload" href="/assets/js/main.887d1c07.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">SUITABLE</b></a><a class="navbar__item navbar__link" href="/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/docs/Interview">Study</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Skill</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/html">HTML</a></li><li><a class="dropdown__link" href="/docs/css">CSS</a></li><li><a class="dropdown__link" href="/docs/js">JavaScript</a></li><li><a class="dropdown__link" href="/docs/vue">Vue</a></li><li><a class="dropdown__link" href="/docs/vue3">Vue3</a></li><li><a class="dropdown__link" href="/docs/ts">TypeSript</a></li><li><a class="dropdown__link" href="/docs/react">React</a></li><li><a class="dropdown__link" href="/docs/nodejs">NodeJS</a></li><li><a class="dropdown__link" href="/docs/webpack">WebPack</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Java">Java</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><b>SUITABLE</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docs/Java">Java</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Java/JavaSE/计算机基础和java环境搭建">JavaSE</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Java">目录</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Java/其他/GIT入门">其他</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Java/mysql学习/mysql入门">mysql学习</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Java/web/CSS">web</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Java/基础知识/日志框架">基础知识</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Java/框架/MyBatis">框架</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/Java/中间件/nginx">中间件</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Java/中间件/nginx">1.nginx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Java/中间件/2.1 ELK入门">2.1 ELK入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Java/中间件/2.2 ELK进阶">2.2 ELK进阶</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Java/中间件/3.1 RabbitMQ入门">3.1 RabbitMQ入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Java/中间件/3.2 RocketMQ基础篇">3.2 RocketMQ基础篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Java/中间件/3.3 Kafka入门">3.3 Kafka入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Java/中间件/3.4 kafka高级">3.4 kafka高级</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Java/框架扩展/SpringCloud">框架扩展</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Java/Docker">9. Docker</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/Java/项目/短信调度">项目</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Java/数据结构与算法-基础">11. 数据结构与算法-基础</a></li></ul></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/Java"><span itemprop="name">Java</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">中间件</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">1.nginx</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>1.nginx</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第一章-基础及安装">第一章 基础及安装<a href="#第一章-基础及安装" class="hash-link" aria-label="第一章 基础及安装的直接链接" title="第一章 基础及安装的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一nginx-功能介绍">一、nginx 功能介绍<a href="#一nginx-功能介绍" class="hash-link" aria-label="一、nginx 功能介绍的直接链接" title="一、nginx 功能介绍的直接链接">​</a></h3><p>Nginx (&quot;engine x&quot;) 是一款开源的，支持高性能、高并发的 Web 服务和代理服务软件。它是由俄罗斯人 Igor Sysoev 开发的，最初被应用在俄罗斯的大型网站 <a href="http://www.rambler.ru/" target="_blank" rel="noopener noreferrer">www.rambler.ruopen in new window</a> 上。后来作者将源代码以类 BSD 许可的形式开源出来供全球使用。因为它的<code>稳定性</code>、<code>丰富的模块库</code>、<code>灵活的配置</code>和<code>低系统资源</code>的消耗而闻名。</p><p>目前，市场上还有很多的同类竞品，如大名鼎鼎的apache，Lighttpd。目前，Nginx的市场份额和域数量双双稳居世界第一，并以 4.12 亿的总数遥遥领先其它竞争对手。</p><p><strong>小知识：</strong></p><blockquote><p>BSD许可证的条款</p></blockquote><p>使用BSD协议，需要遵守以下规则</p><ol><li>如果再发布的产品中包含源代码，则在源代码中必须带有原来代码中的BSD协议；</li><li>如果再发布的只是二进制类库/软件，则需要在类库/软件的文档和版权声明中包含原来代码中的BSD协议；</li><li>不可以用开源代码的“作者/机构的名字”或“原来产品的名字”做市场推广。</li></ol><p>现今存在的开源协议很多，而经过Open Source Initiative（开放源代码倡议）通过批准的开源协议目前有60多种（<a href="http://www.opensource.org/licenses/alphabetical" target="_blank" rel="noopener noreferrer">http://www.opensource.org/licenses/alphabeticalopen in new window</a> ）。我们在常见的开源协议如BSD, GPL, LGPL,MIT等都是OSI批准的协议。</p><p>我们可以在这网网站，</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657530052574-7ce836ab.png" alt="1657530052574" class="img_ev3q">1657530052574</p><p>我们摘取几个和大家分享一下：</p><ul><li>Apache License 2.0：它是对商业应用友好的许可。使用者也可以在需要的时候修改代码来满足需要并作为开源或商业产品发布/销售。</li><li>BSD开源协议（Berkerley Software Distribution）：商业软件可以使用，也可以修改使用BSD协议的代码。</li><li>MIT ( MIT license )：商业软件可以使用，也可以修改MIT协议的代码，甚至可以出售MIT协议的代码。</li><li>MPL ( Mozilla Public License 1.1 )：商业软件可以使用，也可以修改MPL协议的代码，但修改后的代码版权归软件的发起者。</li><li>CDDL (Common Development and Distribution License )：商业软件可以使用，也可以修改CDDL协议的代码。</li><li>EPL (Eclipse Public License 1.0 )：商业软件可以使用，也可以修改EPL协议的代码，但要承担代码产生的侵权责任。</li><li>GPL ( GNU General Public License )：商业软件不能使用GPL协议的代码。</li><li>LGPL ( GNU Library or “Lesser” General Public License )：商业软件可以使用，但不能修改LGPL协议的代码。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="二nginx可以提供的服务">二、nginx可以提供的服务<a href="#二nginx可以提供的服务" class="hash-link" aria-label="二、nginx可以提供的服务的直接链接" title="二、nginx可以提供的服务的直接链接">​</a></h3><ol><li>web 服务</li><li>负载均衡 （反向代理）</li><li>web cache（web 缓存）</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="三nginx-的优点">三、nginx 的优点<a href="#三nginx-的优点" class="hash-link" aria-label="三、nginx 的优点的直接链接" title="三、nginx 的优点的直接链接">​</a></h3><ol><li>比其他服务器响应更快。</li><li>高扩展，nginx的设计极具扩展性，他是由多个功能不同且耦合性极低的模块组成。</li><li>单机支持并发极高，理论上支持10万的并发连接，nginx支持的并发连接和内存相关，超过10万也是可以的。</li><li>低内存消耗，10000个非活跃的http keep-alive链接在nginx中仅仅消耗2.5M的内存。</li><li>支持热部署，如不用停止服务就能重新加载配置文件。</li><li>极具自由的BSD许可协议。我们不仅可以直接阅读nginx的源代码、还能用来修改升级。</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="四nginx应用场合">四、nginx应用场合<a href="#四nginx应用场合" class="hash-link" aria-label="四、nginx应用场合的直接链接" title="四、nginx应用场合的直接链接">​</a></h3><ol><li>静态服务器。用来存放我们的静态资源，如图片、静态页面、js、css等。</li><li>反向代理，负载均衡。日pv2000W以下，都可以直接用nginx做代理。</li><li>缓存服务。</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="五nginx实战">五、nginx实战<a href="#五nginx实战" class="hash-link" aria-label="五、nginx实战的直接链接" title="五、nginx实战的直接链接">​</a></h3><p>我们的nginx测试都是在linux环境中进行的，所有首先你需要一个linux系统，可以是云服务器，也可以是自己的vmware。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1下载nginx安装包">1、下载nginx安装包<a href="#1下载nginx安装包" class="hash-link" aria-label="1、下载nginx安装包的直接链接" title="1、下载nginx安装包的直接链接">​</a></h4><p>进入nginx官网（<a href="http://nginx.org/en/%EF%BC%89%EF%BC%9A" target="_blank" rel="noopener noreferrer">http://nginx.org/en/）：open in new window</a></p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657531156233-a7274079.png" alt="1657531156233" class="img_ev3q">1657531156233</p><p>Nginx官网提供了三个类型的版本</p><ul><li>Mainline version：Mainline 是 Nginx 目前主力在做的版本，可以说是开发版</li><li>Stable version：最新稳定版，生产环境上建议使用的版本</li><li>Legacy versions：遗留的老版本的稳定版</li></ul><p>我们下载这个最新的稳定版本：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657531361055-acd562a3.png" alt="1657531361055" class="img_ev3q">1657531361055</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2安装依赖包">2、安装依赖包<a href="#2安装依赖包" class="hash-link" aria-label="2、安装依赖包的直接链接" title="2、安装依赖包的直接链接">​</a></h4><p>nginx安装依赖GCC、openssl-devel、pcre-devel和zlib-devel软件库，他们的作用如下：</p><ul><li>zlib库用于对HTTP包的内容做gzip格式的压缩，并指定对于某些类型（content-type）的HTTP响应使用gzip来进行压缩以减少网络传输量，则在编译时就必须把zlib编译进Nginx。</li><li>Pcre全称（Perl Compatible Regular Expressions），Perl库，包括 <a href="https://baike.baidu.com/item/perl/851577" target="_blank" rel="noopener noreferrer">perlopen in new window</a> 兼容的<a href="https://baike.baidu.com/item/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F" target="_blank" rel="noopener noreferrer">正则表达式open in new window</a>库，如果我们在nginx中使用了正则表达式，那么在编译Nginx时就必须把PCRE库编译进Nginx。</li><li>如果服务器不只是要支持HTTP，还需要在更安全的SSL协议上传输HTTP，那么需要拥有OpenSSL。另外，如果我们想使用MD5、SHA1等散列函数，那么也需要安装它。可以这样安装：</li></ul><p>我们使用一下的命令进行安装：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">yum </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> gcc zlib-devel  pcre pcre-devel openssl openssl-devel -y </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>小知识：</p><p>devel 包主要是供开发用，至少包括以下2个东西头文件和链接，有的还含有开发文档或演示代码。</p><p>以 glib 和 glib-devel 为例:</p><ul><li>如果你安装基于 glib 开发的程序，只需要安装 glib 包就行了。</li><li>但是如果你要编译使用了 glib 的源代码，则需要安装 glib-devel。</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3编译安装">3、编译安装<a href="#3编译安装" class="hash-link" aria-label="3、编译安装的直接链接" title="3、编译安装的直接链接">​</a></h4><p>下载nginx</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">wget</span><span class="token plain"> http://nginx.org/download/nginx-1.22.0.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657535839648-dbb22e94.png" alt="1657535839648" class="img_ev3q">1657535839648</p><p>解压：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">tar</span><span class="token plain"> -zvxf nginx-1.22.0.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>nginx最简单的编译安装方式，就是进入目录后，使用以下命令：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">./configure</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">make</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">make</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>./configure</code>命令做了很多幕后工作，包括检测操作系统内核和已经安装的软件，参数的解析，中间目录的生成，以及根据参数生成c源码文件和makefile文件等。</li><li>make命令根据，configure命令生成的makefile文件编译nginx工程，并生成目标文件、最终的二进制文件。</li><li>make install命令负责将nginx安装到指定的安装目录，包括相关目录的建立和二进制文件、位置文件的复制。</li></ul><p>以上命令会将nginx按照默认配置（默认模块、默认安装路径）进行安装，如果需要自定义一些配置，则需要使用如下的方式。</p><p>具体的命令如下：</p><ul><li>使用<code>./configure --help</code>查看各个模块的使用情况。</li><li>使用<code>--without-http_ssi_module</code>的方式关闭不需要的模块。</li><li>可以使用<code>--with-http_perl_modules</code>方式安装需要的模块。</li></ul><blockquote><p>编译命令</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">tar</span><span class="token plain"> -zxf nginx-1.22.0.tar.gz </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 139)">cd</span><span class="token plain"> nginx-1.22.0</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> /data/nginx -p</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">/data/nginx --user</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">nginx --group</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain">nginx  --with-http_ssl_module  --with-http_stub_status_module</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># -M ： 不创建主目录  -s ： 不允许登录 /sbin/nologin是一个有一个特殊的shell，不需要登陆</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">useradd</span><span class="token plain"> nginx -M -s /sbin/nologin </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">make</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">make</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">--with-http_ssl_module  安装该模块，该模块是nginx支持ssl协议，提供https服务。</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">--with-http_stub_status_module  #是一个监视模块，可以查看目前的连接数等一些信息，因为是非核心模块，所以我们使用nginx -V默认是没有安装的</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657540449988-903f8df3.png" alt="1657540449988" class="img_ev3q">1657540449988</p><blockquote><p>测试nginx配置文件是否正常</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">/data/nginx/sbin/nginx -t </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">nginx: the configuration </span><span class="token function" style="color:rgb(130, 170, 255)">file</span><span class="token plain"> /data/nginx-1.10.1/conf/nginx.conf syntax is ok</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">nginx: configuration </span><span class="token function" style="color:rgb(130, 170, 255)">file</span><span class="token plain"> /data/nginx-1.10.1/conf/nginx.conf </span><span class="token builtin class-name" style="color:rgb(255, 203, 139)">test</span><span class="token plain"> is successful</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>启动nginx服务器</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">/data/nginx/sbin/nginx  -t      </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">## 检查配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">/data/nginx/sbin/nginx          </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">## 确定nginx服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">netstat</span><span class="token plain"> -lntup </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> nginx      </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">## 检查进程是否正常</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> http://localhost           </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">## 确认结果</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>nginx其他命令</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">nginx -s signal</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">signal：</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">stop — 立马关闭</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">quit — 优雅关闭，处理完没处理好的请求后关闭</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">reload — 重新加载配置文件</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">reopen — reopening the log files</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">用来打开日志文件，这样nginx会把新日志信息写入这个新的文件中</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装net-tools来查看端口使用情况：</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">yum -y install net-tools</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>net-tools工具箱包括<a href="https://so.csdn.net/so/search?q=arp&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">arpopen in new window</a>, hostname, ifconfig, netstat, rarp, route, plipconfig, slattach, mii-tool and iptunnel and ipmaddr等命令。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">netstat</span><span class="token plain"> -nplt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657540929779-ca292d0c.png" alt="1657540929779" class="img_ev3q">1657540929779</p><p>在浏览器输入服务器地址：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220706172230504-4c7d5b14.png" alt="image-20220706172230504" class="img_ev3q">image-20220706172230504</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="六nginx配置文件">六、nginx配置文件<a href="#六nginx配置文件" class="hash-link" aria-label="六、nginx配置文件的直接链接" title="六、nginx配置文件的直接链接">​</a></h3><p>nginx安装目录，如下：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657541074372-2b553dab.png" alt="1657541074372" class="img_ev3q">1657541074372</p><blockquote><p>配置基础配置文件</p></blockquote><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">worker_processes  1;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">events {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    worker_connections  1024;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    include       mime.types;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    default_type  application/octet-stream;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    sendfile        on;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    keepalive_timeout  65;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        listen       80;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        server_name  localhost;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        location / {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            root   html;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            index  index.html index.htm;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        error_page   500 502 503 504  /50x.html;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        location = /50x.html {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            root   html;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">### 测试配置文件是否正常</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">shell&gt; /data/nginx/sbin/nginx -t </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">nginx: the configuration file /data/nginx-1.10.3/conf/nginx.conf syntax is ok</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">nginx: configuration file /data/nginx-1.10.3/conf/nginx.conf test is successful</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">shell&gt; curl -I http://localhost      # -I代表只显示头信息</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">HTTP/1.1 200 OK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们不妨先思考一个问题，我们看到的网页是在哪里呢，我们通过<code>root html</code>配置结合安装目录中有html目录，大概能猜出来，首页的文件就在html文件夹：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657542245510-9ccd3363.png" alt="1657542245510" class="img_ev3q">1657542245510</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657542307377-b2f65d2b.png" alt="1657542307377" class="img_ev3q">1657542307377</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="七配置文件解读">七、配置文件解读<a href="#七配置文件解读" class="hash-link" aria-label="七、配置文件解读的直接链接" title="七、配置文件解读的直接链接">​</a></h3><p>nginx配置文件主要分为四个部分：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">main{ #（全局设置）</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    http{ #服务器配置</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        upstream{} #（负载均衡服务器设置）</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        server{ #（主机设置：主要用于指定主机和端口）</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            location{} #（URL匹配的设置）</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>server继承自main，location继承自server，upstream即不会继承其他设置也不会被继承。 <img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220606171640915-d0d40614.png" alt="image-20220606171640915" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1main-全局配置">1、main 全局配置<a href="#1main-全局配置" class="hash-link" aria-label="1、main 全局配置的直接链接" title="1、main 全局配置的直接链接">​</a></h4><p>nginx在运行时与具体业务功能无关的一些参数，比如工作进程数，运行的身份等。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">user ydlclass;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">worker_processes 4;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">worker_cpu_affinity 0001 0010 0100 1000;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">error_log  /data/nginx/logs/error.log  crit;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">pid        /data/nginx/logs/nginx.pid;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">worker_rlimit_nofile 65535;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>user nginx;</code>: 指定nginx进程使用什么用户启动</li><li><code>worker_processes 4;</code> : 指定启动多少进程来处理请求，一般情况下设置成CPU的核数，如果开启了ssl和gzip应该设置成与逻辑CPU数量一样甚至为2倍，可以减少I/O操作。使用<code>grep ^processor /proc/cpuinfo | wc -l</code>查看CPU核数。</li><li><code>worker_cpu_affinity 0001 0010 0100 1000;</code>: 在高并发情况下，通过设置将CPU和具体的进程绑定来降低由于多核CPU切换造成的寄存器等现场重建带来的性能损耗。如worker_cpu_affinity 0001 0010 0100 1000; （四核）。</li><li><code>error_log logs/error.log;</code>: error_log是个主模块指令，用来定义全局错误日志文件。日志输出级别有debug、info、notice、warn、error、crit可供选择，其中，debug输出日志最为最详细，而crit输出日志最少。</li><li><code>pid logs/nginx.pid;</code>: 指定进程pid文件的位置。</li></ul><p>我们可以使用<code>ps -ef | grep nginx</code>查看master和worker的进程，这里有一个master和四个worker：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713182916582-7d761cef.png" alt="image-20220713182916582" class="img_ev3q">image-20220713182916582</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2events模块">2、events模块<a href="#2events模块" class="hash-link" aria-label="2、events模块的直接链接" title="2、events模块的直接链接">​</a></h4><p>events 模块主要是nginx 和用户交互网络连接优化的配置内容，我们主要看一下两个配置：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">events{</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  use epoll;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  worker_connections  65536;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>use epoll;</code>是使用事件模块指令，用来指定Nginx的工作模式。Nginx支持的工作模式有select、poll、kqueue、epoll、rtsig和/dev/poll。其中select和poll都是标准的工作模式，kqueue和epoll是高效的工作模式，不同的是epoll用在Linux平台上，而kqueue用在BSD系统中。对于Linux系统，epoll工作模式是首选。在操作系统不支持这些高效模型时才使用select。</li><li><code>worker_connections 65536;</code>每一个worker进程能并发处理（发起）的最大连接数。</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3http服务器">3、http服务器<a href="#3http服务器" class="hash-link" aria-label="3、http服务器的直接链接" title="3、http服务器的直接链接">​</a></h4><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">http{</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  include       mime.types;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  default_type  application/octet-stream;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  #charset  gb2312;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  sendfile        on;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  keepalive_timeout  60s;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>include是个主模块指令，实现对配置文件所包含的文件的设定，可以减少主配置文件的复杂度。该文件也在conf目录中。</li><li>default_type属于HTTP核心模块指令，这里设定默认类型为二进制流，也就是当文件类型未定义时使用这种方式。</li><li>charset gb2312; 指定客户端编码格式。</li><li>sendfile实际上是 Linux2.0+以后的推出的一个系统调用，web服务器可以通过调整自身的配置来决定是否利用 sendfile这个系统调用。sendfile是个比 read 和 write 更高性能的系统接口。 当 Nginx 是一个静态文件服务器的时候，开启 SENDFILE 配置项能大大提高 Nginx 的性能。 但是当 Nginx 是作为一个反向代理来使用的时候，SENDFILE 则没什么用。</li><li>Nginx 使用 keepalive_timeout 来指定 KeepAlive 的超时时间（timeout）。指定每个 TCP 连接最多可以保持多长时间。Nginx 的默认值是 75 秒，有些浏览器最多只保持 60 秒，所以可以设定为 60 秒。若将它设置为 0，就禁止了 keepalive 连接。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="第二章-实战-部署前后分离项目">第二章 实战-部署前后分离项目<a href="#第二章-实战-部署前后分离项目" class="hash-link" aria-label="第二章 实战-部署前后分离项目的直接链接" title="第二章 实战-部署前后分离项目的直接链接">​</a></h2><p>本章节我们会演示日常的工作中，我们是怎么利用nginx部署项目的。我们以部署一套前后分离的项目为本次讲述的内容。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一搭建后端项目">一、搭建后端项目<a href="#一搭建后端项目" class="hash-link" aria-label="一、搭建后端项目的直接链接" title="一、搭建后端项目的直接链接">​</a></h3><p>创建一个最简单的springboot项目：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657507807889-8ffd6220.png" alt="1657507807889" class="img_ev3q">1657507807889</p><p>只需要依赖一个web模块即可：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713092526231-f68f20ca.png" alt="image-20220713092526231" class="img_ev3q">image-20220713092526231</p><p>提供一个api接口，可以获取服务端的主机地址和服务端口：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">NginxController</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">ApplicationListener</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 139)">WebServerInitializedEvent</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">int</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">onApplicationEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">WebServerInitializedEvent</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">port </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getWebServer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@GetMapping</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;host&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getHost</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">HttpServletRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 139)">InetAddress</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            address </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">InetAddress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getLocalHost</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain">  address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getHostAddress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">UnknownHostException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">            e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;error：Network card information is not available！&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试接口：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713094617222-f5e63e7a.png" alt="image-20220713094617222" class="img_ev3q">image-20220713094617222</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="二搭建前端项目">二、搭建前端项目<a href="#二搭建前端项目" class="hash-link" aria-label="二、搭建前端项目的直接链接" title="二、搭建前端项目的直接链接">​</a></h3><p>搭建前端工程，使用vue官方提供的脚手架搭建一个基础工程：</p><div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">https://cli.vuejs.org/guide/creating-a-project.html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用<code>vue ui</code>搭建脚手架，选择安装vue-router：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657507661343-1264f023.png" alt="1657507661343" class="img_ev3q">1657507661343</p><p>启动项目，打开项目：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657509039232-85fa6931.png" alt="1657509039232" class="img_ev3q">1657509039232</p><p>安装axios：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> axios</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用axios访问后端的api接口，修改app.vue如下：</p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">&lt;template&gt;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &lt;img alt=&quot;Vue logo&quot; src=&quot;./assets/logo.png&quot;&gt;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  &lt;br&gt;服务器的ip和端口是：{{ host }}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">&lt;/template&gt;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">import axios from &#x27;axios&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">export default {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  name: &#x27;App&#x27;,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  data(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    return {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      host: &quot;&quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  mounted(){</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    var ip_addr = document.location.hostname</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    axios.get(&#x27;http://&#x27;+ip_addr+&#x27;:8080/host&#x27;).then(res=&gt;{</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      this.host = res.data</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">&lt;/script&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>浏览器访问，发生了跨域问题：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657509682419-d88211fc.png" alt="1657509682419" class="img_ev3q">1657509682419</p><p>添加配置项，新建<code>vue.config.js</code>位置文件，配置代理如下:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">devServer</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">port</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">proxy</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;http://127.0.0.1:8080&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同时修改axiso的请求地址：</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">mounted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">var</span><span class="token plain"> ip_addr </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(214, 222, 235)">document</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    axios</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;http://&#x27;</span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token plain">ip_addr</span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;/host&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">res</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">host</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再次访问前端工程，发现跨域问题解决：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/1657510276751-45fc20bd.png" alt="1657510276751" class="img_ev3q">1657510276751</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="三nginx做静态服务器">三、nginx做静态服务器<a href="#三nginx做静态服务器" class="hash-link" aria-label="三、nginx做静态服务器的直接链接" title="三、nginx做静态服务器的直接链接">​</a></h3><p>我们都知道，nginx的安装目录中有这样一个文件夹：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220712152343632-b6290bdc.png" alt="image-20220712152343632" class="img_ev3q">image-20220712152343632</p><p>我们再结合nginx的基础配置文件中的以下内容：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    listen       80;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server_name  localhost;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        root   html;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        index  index.html index.htm;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们不妨猜想一下当url为<code>/</code>时（当然这是错的），会去html目录寻找index.html文件作为首页。</p><p>我们不妨修改一下index.html文件看看，修改是否可以生效。</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220712153302770-534eec67.png" alt="image-20220712153302770" class="img_ev3q">image-20220712153302770</p><p>确实可以生效，于是我们可以得出，结论只需要将我们的q前端文件放在html目录即可（事实上放在哪里都可以）。</p><p>我们尝试将构建的结果放入html文件夹：</p><p>前端工程产物如下：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713131449954-a4979cf4.png" alt="image-20220713131449954" class="img_ev3q">image-20220713131449954</p><p>上传至nginx：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713132032861-981fcea7.png" alt="image-20220713132032861" class="img_ev3q">image-20220713132032861</p><p>他真的可以访问了，但是，此时却出现了问题，ngixn无法判断哪些是静态资源，哪些是需要访问api接口的：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713132138381-ec54fad9.png" alt="image-20220713132138381" class="img_ev3q">image-20220713132138381</p><p>问题如下，此问题按下不表，后续处理：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713132219959-7fb714a1.png" alt="image-20220713132219959" class="img_ev3q">image-20220713132219959</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="四虚拟主机配置详解">四、虚拟主机配置详解<a href="#四虚拟主机配置详解" class="hash-link" aria-label="四、虚拟主机配置详解的直接链接" title="四、虚拟主机配置详解的直接链接">​</a></h3><p>http服务上支持【若干虚拟主机】。每个虚拟主机对应一个server配置项，配置项里面包含该虚拟主机相关的配置。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">server{</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    listen 80 default;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server_name www.ydlclass.com;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    index index.html index.htm index.php;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    root /data/www;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)${</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        expires      30d;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    location ~ .*\.(js|css)?${</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        expires      1h;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>listen 80;</code> 监听端口，默认80，小于1024的要以root启动。可以为listen :80、listen 127.0.0.1:80等形式。</li><li><code>server_name www.ydlclass.com</code> 用于设置虚拟主机服务名称，如：127.0.0.1 、 localhost 、域名[<a href="http://www.baidu.com/" target="_blank" rel="noopener noreferrer">www.baidu.comopen in new window</a> | <a href="http://www.jd.com/" target="_blank" rel="noopener noreferrer">www.jd.comopen in new window</a>]，也可以进行正则匹配。</li><li><code>root /data/www</code> 定义服务器的默认网站根目录位置。可以是linux的绝对路径（/xxx/xx），也可以是nginx安装目录的相对路径（html）。</li><li><code>index index.jsp index.html index.htm</code> ：定义路径下默认访问的文件名，一般跟着root放。</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1location-常见的配置项">1、location 常见的配置项：<a href="#1location-常见的配置项" class="hash-link" aria-label="1、location 常见的配置项：的直接链接" title="1、location 常见的配置项：的直接链接">​</a></h4><p>location通常用来匹配uri，其基本语法如下：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location [=|~|~*|^~] /uri/ {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>（1）=表示匹配uri时必须做到完全匹配，如</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location = /index {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>（2）~表示匹配URI时是字母大小写敏感的，可以使用正则表达式。</p><p>（3）~*表示匹配URI时是忽略字母大小敏感的，可以使用正则表达式。</p><p>（4）^~表示匹配uri时只需满足前缀匹配即可</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain"># 所有 /./img/开头的uri会全部匹配</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">location ^~ /./img/ {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>（5）uri参数中是可以使用正则表达式的，如匹配以 .gif .jpg和.jpeg结尾的uri，如下:</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location ~* \.(gif|jpg|jpeg)$ {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>（6）以下方式可以匹配所有的uri</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location / {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>（7）<code>@</code> 指定一个命名的location，一般用于内部重定义请求：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location @name {…}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>结果总结： 匹配的优先顺序，<code>=</code>&gt;<code>^~</code>（匹配固定字符串，忽略正则）&gt;<code>~*</code>&gt;<code>/</code> ，工作中尽量将‘=’放在前面。</p><p><a href="http://192.168.111.201/1.png" target="_blank" rel="noopener noreferrer">http://192.168.111.201/1.pngopen in new window</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2文件路径的定义">2、文件路径的定义<a href="#2文件路径的定义" class="hash-link" aria-label="2、文件路径的定义的直接链接" title="2、文件路径的定义的直接链接">​</a></h4><p>（1）以root方式设置资源路径</p><p>语法 root path ，默认 root html，可以在http、server、location模块中配置。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location ^~ /backend {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    root /data/www/backend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果url为<code> /backend/index/test.html</code>则会返回/data/www/backend/backend/index/test.html这个文件。</p><p>（2）以alias方式设置资源路径</p><p>alias也是用来设置文件资源的，它和root不同点在于如何解读紧跟location后面的uri参数，可以在location中配置：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location ^~ /backend {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    alias /data/www/backend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果url为 <code>/backend/index/test.html</code>则会返回/data/www/backend/index/test.html文件。</p><p>alias会将location后的url部分丢弃掉，而root不会。</p><p>（3）访问首页</p><p>可以在http、server、location中配置。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">index index.html index.htm index.php</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>nginx会依次访问index中定义的文件，知道访问成功为止。</p><p>（4）根据http返回码重定向页面</p><p>可以在http、server、location中配置。</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">error_page 404 /404.html</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">error_page 502 503 504 /50x.html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>（5）try_files</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">try_files path1 path2 ... uri</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该配置项可以配置在server、location模块。</p><p>try_files后边会跟若干路径，nginx会尝试按照顺序访问每一个path，如果可以有效的读取，就直接访问当下path资源，否则继续向下访问，如果都读取不到就重定向到uri参数上</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">try_files /a/b.html $uri $uri/index.html $uri.html @other;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">location @other {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    proxy_pass http://backend</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3解决前端的路由问题">3、解决前端的路由问题<a href="#3解决前端的路由问题" class="hash-link" aria-label="3、解决前端的路由问题的直接链接" title="3、解决前端的路由问题的直接链接">​</a></h4><p>我们在前端直接点击路由的按钮可以访问，因为这种情况并未再次向nginx发送请求，仅仅是前端的路由切换：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220714164105074-a93f281a.png" alt="image-20220714164105074" class="img_ev3q">image-20220714164105074</p><p>但是，如果直接访问<code>/about</code>就GG了，这个url直接访问nginx时，nginx会认为你要查找about这个资源，当然是404了：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220714164156365-6b100278.png" alt="image-20220714164156365" class="img_ev3q">image-20220714164156365</p><p>所以我们要通过一些配置来解决这个问题，vue工程都是单页面的，所以无论哪个路由都应该使用唯一的index.html，所以我们可以做如下的配置，该配置的意思就是将其他的所有请求，都强制使用/index.html：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location / {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    root /data/www/ui;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    try_files /index.html;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但是这个有问题的，比如下边的请求，也会强制使用index.html，我明明需要js，你却给我一个HTML：</p><div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">http://192.168.111.201/js/app.aa11d15b.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>所以配置要改成下边的内容，$uri是一个变量，他就是具体的url，对一<code>/js/app.aa11d15b.js</code>这个请求，首先会访问<code>/data/www/ui/js/app.aa11d15b.js</code>这个资源，当然存在，就直接返回了，而其他的路由资源会使用index.html：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location / {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    root /data/www/ui;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    try_files $uri $uri/ $uri/index.html $uri.html /index.html;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4对图片开启gzip压缩">4、对图片开启gzip压缩<a href="#4对图片开启gzip压缩" class="hash-link" aria-label="4、对图片开启gzip压缩的直接链接" title="4、对图片开启gzip压缩的直接链接">​</a></h4><p>在http模块中添加如下内容：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">gzip on;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">gzip_min_length 1k;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">gzip_buffers    4 16k;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">gzip_http_version 1.1;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">gzip_comp_level 5;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">gzip_types image/png;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">gzip_vary on;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>解释如下：</p><ul><li>gzip on;使用&quot;gzip on;&quot;参数来启用压缩，默认是关闭的。</li><li>gzip_min_length 1k;gzip压缩的最小文件，小于设置值的文件将不会压缩#指定Nginx服务需要向服务器申请的缓存空间的个数*大小，默认32 4k|16 8k;</li><li>gzip_buffers 4 16k;设置压缩缓冲区大小，此处设置为4个16K内存作为压缩结果流缓存</li><li>gzip_http_version 1.1;启用压缩功能时，协议的最小版本，默认HTTP/1.1</li><li>gzip_comp_level 5;压缩比例由低到高从1到9，默认为1。但需要注意的是压缩比设置的越高就会越消耗CPU的资源，因此在生产环境中我们会设置该参数的值在3~5之间，最好不要超过5，因为随着压缩比的增大的确会降低传输的带宽成本但发送数据前会占用更多的CPU时间分片。</li><li>gzip_types image/png;指明仅对哪些类型的资源执行压缩操作；默认为gzip_types text/html，不用显示指定，否则出错。</li><li>gzip_vary on;该指令用于设置在使用Gzip功能时是否发送带有“Vary: Accept-Encoding”头域的响应头部。该头域的主要功能是告诉接收方发送的数据经过了压缩处理。开启后的效果是在响应头部添加了Accept-Encoding: gzip，这对于本身不支持Gzip压缩的客户端浏览器是有用的。</li></ul><p>这一次没有设置图片压缩：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713153150102-ca095497.png" alt="image-20220713153150102" class="img_ev3q">image-20220713153150102</p><p>设置图片压缩后，响应多了如下的首部信息：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713153422776-1dce8c84.png" alt="image-20220713153422776" class="img_ev3q">image-20220713153422776</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="五反向代理解决跨域">五、反向代理解决跨域<a href="#五反向代理解决跨域" class="hash-link" aria-label="五、反向代理解决跨域的直接链接" title="五、反向代理解决跨域的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1配置nginx反向代理">1、配置nginx反向代理<a href="#1配置nginx反向代理" class="hash-link" aria-label="1、配置nginx反向代理的直接链接" title="1、配置nginx反向代理的直接链接">​</a></h4><p>我们可以通过proxy_pass参数设置反向代理的服务器，语法如下：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location / {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    proxy_pass http://ydl.com;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713160342661-a6e6f2fa.png" alt="image-20220713160342661" class="img_ev3q">image-20220713160342661</p><p>我们的实现逻辑很简单，就是将以<code>/api</code>为前缀的uri全部反向代理到真正的后端服务即可。</p><p>安装java环境：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713161110581-785e07ad.png" alt="image-20220713161110581" class="img_ev3q">image-20220713161110581</p><p>后台启动成功：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713161557596-d7964e5e.png" alt="image-20220713161557596" class="img_ev3q">image-20220713161557596</p><p>我们为了区分前端页面和api接口，将所有访问后端api的url统一加上前缀 /api</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">mounted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">var</span><span class="token plain"> ip_addr </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(214, 222, 235)">document</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  axios</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;http://&#x27;</span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token plain">ip_addr</span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;/api/host&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">res</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">   </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">host</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>现在我们想的是将前端发送的以api打头的url全部代理到，后端8080端口：</p><p>前端访问的接口：<a href="http://192.168.111.200/api/host" target="_blank" rel="noopener noreferrer">http://192.168.111.200:80/api/hostopen in new window</a></p><p>后端的接口：<a href="http://192.168.111.200:8080/host" target="_blank" rel="noopener noreferrer">http://192.168.111.200:8080/hostopen in new window</a></p><p>在实现代理的过程中，我们需要将/api这个前缀删除掉，有以下两种方法，一种是重写url，如下：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location ^~ /api/ {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    rewrite ^/api(.*)$ $1 break;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    proxy_pass http://127.0.0.1:8080;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更简单的做法是，在代理地址的后边加<code>/</code>，这样做也会去掉前缀，但不如以上方式灵活：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location ^~ /api/ {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    proxy_pass http://127.0.0.1:8080/;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>小知识：location中的rewirte：</p><ol><li>rewrite break：url重写后，直接使用当前资源，不再执行location里余下的语句，完成本次请求，地址栏url不变</li><li>rewrite last：url重写后，马上发起一个新的请求，再次进入server块，重试location匹配，超过10次匹配不到报500错误，地址栏url不变</li><li>rewrite redirect：返回302临时重定向，地址栏显示重定向后的url。</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="六为后端工程做负载均衡">六、为后端工程做负载均衡<a href="#六为后端工程做负载均衡" class="hash-link" aria-label="六、为后端工程做负载均衡的直接链接" title="六、为后端工程做负载均衡的直接链接">​</a></h3><p>有时候，我们的后端工程压力太大，可能需要将后端工程部署在多台服务器上，此时就需要使用负载均衡了，在学习负载均衡的时候我们不妨先了解一下upstream模块。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1upstream模块解读">1、upstream模块解读<a href="#1upstream模块解读" class="hash-link" aria-label="1、upstream模块解读的直接链接" title="1、upstream模块解读的直接链接">​</a></h4><p>nginx 的负载均衡功能依赖于 ngx_http_upstream_module模块。upstream 模块应该放于http{}标签内。</p><p>模块写法如下：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">upstream backend {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ip_hash; </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server backend1.example.com;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server backend2.example.com:8080;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server 127.0.0.1:8080;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server backup2.example.com:8080;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后在location处使用如下写法：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location / {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    proxy_pass http://backend;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上写法的意思就是，将来同一个url访问我们的服务时，服务可以由backend中的服务器按照某种特定规则轮流提供。</p><blockquote><p>ngixn负载均衡的五种算法</p></blockquote><p>（1）round robin 轮询 （默认） 按时间顺序依次将请求分配到各个后台服务器中，挂掉的服务器自动从列表中剔除</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">upstream bakend {  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">   server 192.168.0.1 down;    </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">   server 192.168.0.2;  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>（2）weight 轮询权重 weight的值越大分配到的访问概率越高，主要用于后端每台服务器性能不均衡的情况下，或在主从的情况下设置不同的权值，达到合理有效的地利用主机资源。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">upstream bakend {  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server 192.168.0.1 weight=20;  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server 192.168.0.2 weight=10;  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>（3）ip_hash：每个请求按访问IP的哈希结果分配，使来自同一个IP的访客固定访问一台后端服务器，并且可以有效解决动态网页存在的session共享问题。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">upstream bakend {  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    ip_hash;  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server 192.168.0.1:88;  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server 192.168.0.2:80;  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">} </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>（4）url_hash：按访问的URL的哈希结果来分配请求，使每个URL定向到同一台后端服务器，可以进一步提高后端服务器缓存的效率。Nginx本身不支持url_hash，需要安装Nginx的hash软件包。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">upstream backend {  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server 192.168.0.1:88;     //使用hash语句时，不能在使用weight等其他参数</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server 192.168.0.2:80;  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    hash $request_uri;  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    hash_method crc32;    //使用hash算法</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>（5）fair算法：可以根据页面大小和加载时间长短智能地进行负载均衡，根据后端服务器的响应时间来分配请求，响应时间短的优先分配。Nginx本身不支持fair，要安装upstream_fair模块才能使用。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">upstream backend {  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server 192.168.0.1:88;  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server 192.168.0.2:80;  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    fair;  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2项目配置">2、项目配置<a href="#2项目配置" class="hash-link" aria-label="2、项目配置的直接链接" title="2、项目配置的直接链接">​</a></h4><p>首先我们需要将我们的后端项目在服务器中启动两份或多份，可以是同一台服务器，也可以是多台服务器，只要可以互联互通即可。</p><p>同一台服务器可以使用如下命令，重新指定一个端口即可：</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">java -jar ydl-nginx.jar --server.port=8081</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们需要定义一个upstream，将都有的后端服务配置在其中：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">upstream ydlclass {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server 127.0.0.1:8080 weight 10;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    server 127.0.0.1:8081 weight 20;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改location的proxy_pass：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location ^~ /api/ {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    proxy_pass http://ydlclass/;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在浏览器中不停的刷新，发现端口在不停的变化，说明我们的多次请求确实落在了不同服务上。</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713171258079-eee6d3ab.png" alt="image-20220713171258079" class="img_ev3q">image-20220713171258079</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713171229793-48f7dfb3.png" alt="image-20220713171229793" class="img_ev3q">image-20220713171229793</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="七其他的跨域问题">七、其他的跨域问题<a href="#七其他的跨域问题" class="hash-link" aria-label="七、其他的跨域问题的直接链接" title="七、其他的跨域问题的直接链接">​</a></h3><p>如果现在本机的前端项目（也就是其他服务器的前端项目）也想要访问虚拟机中ngixn代理的api接口。这是一个典型的不同的项目之间进行访问的问题，这必然存在跨域问题，如下图：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713175913937-3a1a0718.png" alt="image-20220713175913937" class="img_ev3q">image-20220713175913937</p><p>我们将本地的vue工程进行如下修改：</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">mounted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    axios</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;http://192.168.111.200/api/host&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">res</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">host</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时，确实发生了跨域问题：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713172639758-500766cd.png" alt="image-20220713172639758" class="img_ev3q">image-20220713172639758</p><p>根据我们学习过的知识要解决跨域问题。其实，只需要在客户端发送【预检请求】时指定对应的响应头即可，nginx可以很方便的给响应增加一些首部信息，方法如下，在：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location ^~ /api/ {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    add_header &#x27;Access-Control-Allow_Credentials&#x27; &#x27;true&#x27;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    add_header &#x27;Access-Control-Allow-Headers&#x27; &#x27;Authorization,Accept,Origin,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Content-Range,Range&#x27;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET,POST,OPTIONS,PUT,DELETE,PATCH&#x27;;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    proxy_pass http://ydlclass/;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>访问本地地址，本次访问跨域的问题被解决了：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713172843173-7a1457c5.png" alt="image-20220713172843173" class="img_ev3q">image-20220713172843173</p><p>我们也能看到对应的响应首部信息，多了如下内容：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220713180106546-01b1e3a2.png" alt="image-20220713180106546" class="img_ev3q">image-20220713180106546</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="八nginx监控">八、nginx监控<a href="#八nginx监控" class="hash-link" aria-label="八、nginx监控的直接链接" title="八、nginx监控的直接链接">​</a></h3><p>开启nginx的监控服务</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1开启状态页">1、开启状态页<a href="#1开启状态页" class="hash-link" aria-label="1、开启状态页的直接链接" title="1、开启状态页的直接链接">​</a></h4><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">#设定查看Nginx状态的地址   </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">location = /status {  </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  stub_status on;       #表示开启stubStatus的工作状态统计功能。</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2访问url">2、访问URL<a href="#2访问url" class="hash-link" aria-label="2、访问URL的直接链接" title="2、访问URL的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> http://127.0.0.1/status</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Active connections:  </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">server accepts handled requests</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">18</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">Reading: </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> Writing: </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> Waiting: </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># active connections – 活跃的连接数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># server accepts handled reque</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以访问/status查看当前nginx的状态：</p><p><img loading="lazy" src="https://www.ydlclass.com/doc21xnv/assets/image-20220706172922752-f43db494.png" alt="image-20220706172922752" class="img_ev3q">image-20220706172922752</p><table><thead><tr><th>状态码</th><th>表示的意义</th></tr></thead><tbody><tr><td>Active connections</td><td>当前所有处于打开状态的连接数</td></tr><tr><td>accepts</td><td>总共处理了多少个连接</td></tr><tr><td>handled</td><td>成功创建多少握手</td></tr><tr><td>requests</td><td>总共处理了多少个请求</td></tr><tr><td>Reading</td><td>表示正处于接收请求状态的连接数</td></tr><tr><td>Writing</td><td>表示请求已经接收完成，且正处于处理请求或发送响应的过程中的连接数</td></tr><tr><td>Waiting</td><td>开启keep-alive的情况下，这个值等于active - (reading + writing)，意思就是Nginx已处理完正在等候下一次请求指令的驻留连接</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="五其它nginx配置">五、其它nginx配置<a href="#五其它nginx配置" class="hash-link" aria-label="五、其它nginx配置的直接链接" title="五、其它nginx配置的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1访问控制-allowdeny">1、访问控制 allow/deny<a href="#1访问控制-allowdeny" class="hash-link" aria-label="1、访问控制 allow/deny的直接链接" title="1、访问控制 allow/deny的直接链接">​</a></h4><p>Nginx 的访问控制模块默认就会安装，而且写法也非常简单，可以分别有多个allow,deny，允许或禁止某个ip或ip段访问，依次满足任何一个规则就停止往下匹配。如：</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location /status {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  stub_status on;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  access_log off;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  allow 192.168.10.100;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  allow 172.29.73.0/24;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  deny all;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2列出目录-autoindex">2、列出目录 autoindex<a href="#2列出目录-autoindex" class="hash-link" aria-label="2、列出目录 autoindex的直接链接" title="2、列出目录 autoindex的直接链接">​</a></h4><p>Nginx默认是不允许列出整个目录的。如需此功能，打开nginx.conf文件，在location，server 或 http段中加入如下参数：这个功能我们可以做一个资源下载站。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d6deeb"><span class="token plain">location ^~ /file {</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    root   /data/www;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    autoindex on;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    autoindex_exact_size off;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    autoindex_localtime on;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    charset utf-8,gbk;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>autoindex on;</code>运行列出目录内容。另外两个参数最好也加上去。</li><li><code>autoindex_exact_size off;</code> 默认为on，显示出文件的确切大小，单位是bytes。改为off后，显示出文件的大概大小，单位是kB或者MB或者GB。</li><li><code>autoindex_localtime on;</code> 默认为off，显示的文件时间为GMT时间。改为on后，显示的文件时间为文件的服务器时间。</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Java/7.中间件/1.nginx.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Java/框架/SPRING-DATA-JPA"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">9.SPRING-DATA-JPA</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Java/中间件/2.1 ELK入门"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">2.1 ELK入门</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#第一章-基础及安装" class="table-of-contents__link toc-highlight">第一章 基础及安装</a><ul><li><a href="#一nginx-功能介绍" class="table-of-contents__link toc-highlight">一、nginx 功能介绍</a></li><li><a href="#二nginx可以提供的服务" class="table-of-contents__link toc-highlight">二、nginx可以提供的服务</a></li><li><a href="#三nginx-的优点" class="table-of-contents__link toc-highlight">三、nginx 的优点</a></li><li><a href="#四nginx应用场合" class="table-of-contents__link toc-highlight">四、nginx应用场合</a></li><li><a href="#五nginx实战" class="table-of-contents__link toc-highlight">五、nginx实战</a></li><li><a href="#六nginx配置文件" class="table-of-contents__link toc-highlight">六、nginx配置文件</a></li><li><a href="#七配置文件解读" class="table-of-contents__link toc-highlight">七、配置文件解读</a></li></ul></li><li><a href="#第二章-实战-部署前后分离项目" class="table-of-contents__link toc-highlight">第二章 实战-部署前后分离项目</a><ul><li><a href="#一搭建后端项目" class="table-of-contents__link toc-highlight">一、搭建后端项目</a></li><li><a href="#二搭建前端项目" class="table-of-contents__link toc-highlight">二、搭建前端项目</a></li><li><a href="#三nginx做静态服务器" class="table-of-contents__link toc-highlight">三、nginx做静态服务器</a></li><li><a href="#四虚拟主机配置详解" class="table-of-contents__link toc-highlight">四、虚拟主机配置详解</a></li><li><a href="#五反向代理解决跨域" class="table-of-contents__link toc-highlight">五、反向代理解决跨域</a></li><li><a href="#六为后端工程做负载均衡" class="table-of-contents__link toc-highlight">六、为后端工程做负载均衡</a></li><li><a href="#七其他的跨域问题" class="table-of-contents__link toc-highlight">七、其他的跨域问题</a></li><li><a href="#八nginx监控" class="table-of-contents__link toc-highlight">八、nginx监控</a></li><li><a href="#五其它nginx配置" class="table-of-contents__link toc-highlight">五、其它nginx配置</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.730de416.js"></script>
<script src="/assets/js/main.887d1c07.js"></script>
</body>
</html>