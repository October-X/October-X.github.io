"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9497],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>k});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var p=a.createContext({}),o=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=o(e.components);return a.createElement(p.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,p=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),c=o(n),u=l,k=c["".concat(p,".").concat(u)]||c[u]||m[u]||r;return n?a.createElement(k,s(s({ref:t},d),{},{components:n})):a.createElement(k,s({ref:t},d))}));function k(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,s=new Array(r);s[0]=u;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[c]="string"==typeof e?e:l,s[1]=i;for(var o=2;o<r;o++)s[o]=n[o];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},763:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>i,toc:()=>o});var a=n(7462),l=(n(7294),n(3905));const r={},s="2.3 \u4e8c\u5962\u4ea4\u6613",i={unversionedId:"Java/\u9879\u76ee/2.3 \u4e8c\u5962\u4ea4\u6613",id:"Java/\u9879\u76ee/2.3 \u4e8c\u5962\u4ea4\u6613",title:"2.3 \u4e8c\u5962\u4ea4\u6613",description:"\u89d2\u8272\uff1a \u8ba2\u5355\u6a21\u5757\uff0c\u540e\u7aef\u5f00\u53d1\u5de5\u7a0b\u5e08\u3002",source:"@site/docs/Java/10.\u9879\u76ee/2.3 \u4e8c\u5962\u4ea4\u6613.md",sourceDirName:"Java/10.\u9879\u76ee",slug:"/Java/\u9879\u76ee/2.3 \u4e8c\u5962\u4ea4\u6613",permalink:"/docs/Java/\u9879\u76ee/2.3 \u4e8c\u5962\u4ea4\u6613",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Java/10.\u9879\u76ee/2.3 \u4e8c\u5962\u4ea4\u6613.md",tags:[],version:"current",frontMatter:{},sidebar:"Java",previous:{title:"2.2 \u4e8c\u5962\u4ea4\u6613",permalink:"/docs/Java/\u9879\u76ee/2.2 \u4e8c\u5962\u4ea4\u6613"},next:{title:"11. \u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5-\u57fa\u7840",permalink:"/docs/Java/\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5-\u57fa\u7840"}},p={},o=[{value:"#\u8bfe\u7a0b\u5185\u5bb9",id:"\u8bfe\u7a0b\u5185\u5bb9",level:2},{value:"#1 \u8ba2\u5355\u7ed3\u7b97\u9875",id:"1-\u8ba2\u5355\u7ed3\u7b97\u9875",level:2},{value:"#1.1 \u6536\u4ef6\u5730\u5740\u5206\u6790",id:"11-\u6536\u4ef6\u5730\u5740\u5206\u6790",level:3},{value:"#1.2 \u5b9e\u73b0\u7528\u6237\u6536\u4ef6\u5730\u5740\u67e5\u8be2",id:"12-\u5b9e\u73b0\u7528\u6237\u6536\u4ef6\u5730\u5740\u67e5\u8be2",level:3},{value:"#1.2.1 \u4ee3\u7801\u5b9e\u73b0 ydles-service-user",id:"121-\u4ee3\u7801\u5b9e\u73b0-ydles-service-user",level:4},{value:"#1.3 \u9875\u9762\u6a21\u677f\u6e32\u67d3",id:"13-\u9875\u9762\u6a21\u677f\u6e32\u67d3",level:3},{value:"#1.3.1 \u51c6\u5907\u5de5\u4f5c",id:"131-\u51c6\u5907\u5de5\u4f5c",level:4},{value:"#1.3.2 \u4fe1\u606f\u67e5\u8be2-\u91cd\u70b9",id:"132-\u4fe1\u606f\u67e5\u8be2-\u91cd\u70b9",level:4},{value:"#1.3.3 \u8bb0\u5f55\u9009\u4e2d\u6536\u4ef6\u4eba-\u4e86\u89e3",id:"133-\u8bb0\u5f55\u9009\u4e2d\u6536\u4ef6\u4eba-\u4e86\u89e3",level:4},{value:"#2 \u4e0b\u5355-\u91cd\u70b9",id:"2-\u4e0b\u5355-\u91cd\u70b9",level:2},{value:"#2.1 \u4e1a\u52a1\u5206\u6790",id:"21-\u4e1a\u52a1\u5206\u6790",level:3},{value:"#2.2 \u4e0b\u5355\u5b9e\u73b0",id:"22-\u4e0b\u5355\u5b9e\u73b0",level:3},{value:"#2.2.1 \u4ee3\u7801\u5b9e\u73b0",id:"221-\u4ee3\u7801\u5b9e\u73b0",level:4},{value:"#2.2.2 \u6e32\u67d3\u670d\u52a1\u5bf9\u63a5",id:"222-\u6e32\u67d3\u670d\u52a1\u5bf9\u63a5",level:4},{value:"#2.3 \u5e93\u5b58\u53d8\u66f4",id:"23-\u5e93\u5b58\u53d8\u66f4",level:3},{value:"#2.3.1 \u4e1a\u52a1\u5206\u6790",id:"231-\u4e1a\u52a1\u5206\u6790",level:4},{value:"#2.3.2 \u4ee3\u7801\u5b9e\u73b0",id:"232-\u4ee3\u7801\u5b9e\u73b0",level:4},{value:"#2.3.3 \u8c03\u7528\u5e93\u5b58\u9012\u51cf",id:"233-\u8c03\u7528\u5e93\u5b58\u9012\u51cf",level:4},{value:"#\u6d4b\u8bd5",id:"\u6d4b\u8bd5",level:4},{value:"#2.4 \u589e\u52a0\u79ef\u5206(\u5b66\u5458\u7ec3\u4e60)",id:"24-\u589e\u52a0\u79ef\u5206\u5b66\u5458\u7ec3\u4e60",level:3},{value:"#4.4.2 \u589e\u52a0\u79ef\u5206\u8c03\u7528",id:"442-\u589e\u52a0\u79ef\u5206\u8c03\u7528",level:4},{value:"#\u5b66\u4e60\u76ee\u6807\uff1a",id:"\u5b66\u4e60\u76ee\u6807",level:2},{value:"#1.\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848",id:"1\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848",level:2},{value:"#1.1 \u672c\u5730\u4e8b\u52a1\u4e0e\u5206\u5e03\u5f0f\u4e8b\u52a1",id:"11-\u672c\u5730\u4e8b\u52a1\u4e0e\u5206\u5e03\u5f0f\u4e8b\u52a1",level:3},{value:"#1.1.1 \u4e8b\u52a1",id:"111-\u4e8b\u52a1",level:4},{value:"#1.1.2 \u672c\u5730\u4e8b\u52a1",id:"112-\u672c\u5730\u4e8b\u52a1",level:4},{value:"#1.1.3 \u5206\u5e03\u5f0f\u4e8b\u52a1",id:"113-\u5206\u5e03\u5f0f\u4e8b\u52a1",level:4},{value:"#1.2 \u5206\u5e03\u5f0f\u4e8b\u52a1\u76f8\u5173\u7406\u8bba",id:"12-\u5206\u5e03\u5f0f\u4e8b\u52a1\u76f8\u5173\u7406\u8bba",level:3},{value:"#1.2.1 CAP\u5b9a\u7406-\u91cd\u70b9",id:"121-cap\u5b9a\u7406-\u91cd\u70b9",level:4},{value:"#\u5206\u533a\u5bb9\u9519 Partition tolerance",id:"\u5206\u533a\u5bb9\u9519-partition-tolerance",level:5},{value:"#\u53ef\u7528\u6027 Availability",id:"\u53ef\u7528\u6027-availability",level:5},{value:"#\u4e00\u81f4\u6027 Consistency",id:"\u4e00\u81f4\u6027-consistency",level:5},{value:"#\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u7684\u77db\u76fe",id:"\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u7684\u77db\u76fe",level:5},{value:"#1.2.2 BASE\u7406\u8bba",id:"122-base\u7406\u8bba",level:4},{value:"#Basically Available(\u57fa\u672c\u53ef\u7528)",id:"basically-available\u57fa\u672c\u53ef\u7528",level:5},{value:"#Soft state\uff08\u8f6f\u72b6\u6001\uff09",id:"soft-state\u8f6f\u72b6\u6001",level:5},{value:"#Eventually consistent\uff08\u6700\u7ec8\u4e00\u81f4\u6027\uff09",id:"eventually-consistent\u6700\u7ec8\u4e00\u81f4\u6027",level:5},{value:"#1.3 \u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848-\u9762\u8bd5",id:"13-\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848-\u9762\u8bd5",level:3},{value:"#1.3.1 \u57fa\u4e8eXA\u534f\u8bae\u7684\u4e24\u9636\u6bb5\u63d0\u4ea4 2pc",id:"131-\u57fa\u4e8exa\u534f\u8bae\u7684\u4e24\u9636\u6bb5\u63d0\u4ea4-2pc",level:4},{value:"#1.3.2 TCC\u8865\u507f\u673a\u5236",id:"132-tcc\u8865\u507f\u673a\u5236",level:4},{value:"#1.3.3 \u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027-\u91cd\u70b9",id:"133-\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027-\u91cd\u70b9",level:4},{value:"#2. \u5206\u5e03\u5f0f\u4e8b\u52a1\u6846\u67b6seata",id:"2-\u5206\u5e03\u5f0f\u4e8b\u52a1\u6846\u67b6seata",level:2},{value:"#2.1 seata\u7b80\u4ecb",id:"21-seata\u7b80\u4ecb",level:3},{value:"#2.2 \u5b9e\u73b0\u539f\u7406",id:"22-\u5b9e\u73b0\u539f\u7406",level:3},{value:"#2.3 Fescar\u6a21\u5f0f",id:"23-fescar\u6a21\u5f0f",level:3},{value:"#2.3.1 AT\u6a21\u5f0f",id:"231-at\u6a21\u5f0f",level:4},{value:"#2.3.3 TCC\u6a21\u5f0f",id:"233-tcc\u6a21\u5f0f",level:4},{value:"#2.3.3 Saga\u6a21\u5f0f",id:"233-saga\u6a21\u5f0f",level:4},{value:"#3 Seata\u6848\u4f8b",id:"3-seata\u6848\u4f8b",level:2},{value:"#3.1\u51c6\u5907\u5de5\u4f5c",id:"31\u51c6\u5907\u5de5\u4f5c",level:3},{value:"#3.2\u5206\u5e03\u5f0f\u4e8b\u52a1\u9519\u8bef\u6f14\u793a",id:"32\u5206\u5e03\u5f0f\u4e8b\u52a1\u9519\u8bef\u6f14\u793a",level:3},{value:"#3.3 \u5206\u5e03\u5f0f\u4e8b\u52a1\u6b63\u786e\u6f14\u793a",id:"33-\u5206\u5e03\u5f0f\u4e8b\u52a1\u6b63\u786e\u6f14\u793a",level:3},{value:"#4\u6d88\u606f\u961f\u5217\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1---\u6574\u4e2a\u9879\u76ee\u7684\u91cd\u70b9",id:"4\u6d88\u606f\u961f\u5217\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1---\u6574\u4e2a\u9879\u76ee\u7684\u91cd\u70b9",level:2},{value:"#1\u4e1a\u52a1\u6d41\u7a0b-\u91cd\u70b9",id:"1\u4e1a\u52a1\u6d41\u7a0b-\u91cd\u70b9",level:4},{value:"#2\u4ee3\u7801\u5b9e\u73b0",id:"2\u4ee3\u7801\u5b9e\u73b0",level:4},{value:"#2.1\u51c6\u5907",id:"21\u51c6\u5907",level:5},{value:"#1order\u4e2d\u6dfb\u52a0\u4e24\u5f20\u8868",id:"1order\u4e2d\u6dfb\u52a0\u4e24\u5f20\u8868",level:6},{value:"#2order-api\u4e2d\u6dfb\u52a0\u5bf9\u5e94\u7684\u5b9e\u4f53\u7c7b",id:"2order-api\u4e2d\u6dfb\u52a0\u5bf9\u5e94\u7684\u5b9e\u4f53\u7c7b",level:6},{value:"#3 ydles_user\u65b0\u589e\u79ef\u5206\u65e5\u5fd7\u8868",id:"3-ydles_user\u65b0\u589e\u79ef\u5206\u65e5\u5fd7\u8868",level:6},{value:"#4 ydles_service_user_api\u6dfb\u52a0\u5b9e\u4f53\u7c7b PointLog",id:"4-ydles_service_user_api\u6dfb\u52a0\u5b9e\u4f53\u7c7b-pointlog",level:6},{value:"#5rabbitMQ",id:"5rabbitmq",level:6},{value:"#2.2 \u8ba2\u5355\u670d\u52a1\u903b\u8f91",id:"22-\u8ba2\u5355\u670d\u52a1\u903b\u8f91",level:5},{value:"#1dao\u5c42 \u589e\u52a0mapper",id:"1dao\u5c42-\u589e\u52a0mapper",level:6},{value:"#2\u4e0b\u5355\u903b\u8f91\u4e2d\u589e\u52a0\u4efb\u52a1",id:"2\u4e0b\u5355\u903b\u8f91\u4e2d\u589e\u52a0\u4efb\u52a1",level:6},{value:"#3\u5b9a\u65f6\u4efb\u52a1\uff0c\u5b9a\u65f6\u53d1\u9001\u4efb\u52a1\u8868\u4fe1\u606f\u5230mq",id:"3\u5b9a\u65f6\u4efb\u52a1\u5b9a\u65f6\u53d1\u9001\u4efb\u52a1\u8868\u4fe1\u606f\u5230mq",level:6},{value:"#2.3 \u7528\u6237\u670d\u52a1\u903b\u8f91",id:"23-\u7528\u6237\u670d\u52a1\u903b\u8f91",level:5},{value:"#1\u914d\u7f6e\u6587\u4ef6\u589e\u52a0redis rabbitMQ\u914d\u7f6e",id:"1\u914d\u7f6e\u6587\u4ef6\u589e\u52a0redis-rabbitmq\u914d\u7f6e",level:6},{value:"#2\u5bfc\u5165mq\u4f9d\u8d56",id:"2\u5bfc\u5165mq\u4f9d\u8d56",level:6},{value:"#3mq\u914d\u7f6e\u7c7b",id:"3mq\u914d\u7f6e\u7c7b",level:6},{value:"#4\u6dfb\u52a0\u4f9d\u8d56",id:"4\u6dfb\u52a0\u4f9d\u8d56",level:6},{value:"#4\u76d1\u542cmq\u961f\u5217",id:"4\u76d1\u542cmq\u961f\u5217",level:6},{value:"#5\u66f4\u65b0\u79ef\u5206\u65b9\u6cd5\u5b9e\u73b0",id:"5\u66f4\u65b0\u79ef\u5206\u65b9\u6cd5\u5b9e\u73b0",level:6},{value:"#2.4\u8ba2\u5355\u670d\u52a1\u6536\u5c3e",id:"24\u8ba2\u5355\u670d\u52a1\u6536\u5c3e",level:5},{value:"#2.5\u6548\u679c\u6d4b\u8bd5",id:"25\u6548\u679c\u6d4b\u8bd5",level:5},{value:"#\u5b66\u4e60\u76ee\u6807\uff1a",id:"\u5b66\u4e60\u76ee\u6807-1",level:2},{value:"#1. \u5fae\u4fe1\u652f\u4ed8\u5feb\u901f\u5165\u95e8",id:"1-\u5fae\u4fe1\u652f\u4ed8\u5feb\u901f\u5165\u95e8",level:2},{value:"#1.1 \u5fae\u4fe1\u652f\u4ed8\u7533\u8bf7\uff08\u4e86\u89e3\uff09",id:"11-\u5fae\u4fe1\u652f\u4ed8\u7533\u8bf7\u4e86\u89e3",level:3},{value:"#1.2 \u5fae\u4fe1\u652f\u4ed8\u5f00\u53d1\u6587\u6863\u4e0eSDK",id:"12-\u5fae\u4fe1\u652f\u4ed8\u5f00\u53d1\u6587\u6863\u4e0esdk",level:3},{value:"#2. \u5fae\u4fe1\u652f\u4ed8\u4e8c\u7ef4\u7801",id:"2-\u5fae\u4fe1\u652f\u4ed8\u4e8c\u7ef4\u7801",level:2},{value:"#2.1 \u9700\u6c42\u5206\u6790",id:"21-\u9700\u6c42\u5206\u6790",level:3},{value:"#2.2 \u5b9e\u73b0\u601d\u8def",id:"22-\u5b9e\u73b0\u601d\u8def",level:3},{value:"#2.3 \u4ee3\u7801\u5b9e\u73b0",id:"23-\u4ee3\u7801\u5b9e\u73b0",level:3},{value:"#2.3.1 \u63d0\u4ea4\u8ba2\u5355\u8df3\u8f6c\u652f\u4ed8\u9875",id:"231-\u63d0\u4ea4\u8ba2\u5355\u8df3\u8f6c\u652f\u4ed8\u9875",level:4},{value:"#2.3.2 \u652f\u4ed8\u5fae\u670d\u52a1\u6743\u9650\u96c6\u6210",id:"232-\u652f\u4ed8\u5fae\u670d\u52a1\u6743\u9650\u96c6\u6210",level:4},{value:"#2.3.3 \u652f\u4ed8\u5fae\u670d\u52a1-\u4e0b\u5355",id:"233-\u652f\u4ed8\u5fae\u670d\u52a1-\u4e0b\u5355",level:4},{value:"#2.3.3 \u652f\u4ed8\u6e32\u67d3\u9875\u9762\u5fae\u670d\u52a1",id:"233-\u652f\u4ed8\u6e32\u67d3\u9875\u9762\u5fae\u670d\u52a1",level:4},{value:"#3. \u652f\u4ed8\u56de\u8c03\u903b\u8f91\u5904\u7406",id:"3-\u652f\u4ed8\u56de\u8c03\u903b\u8f91\u5904\u7406",level:2},{value:"#3.1 \u9700\u6c42\u5206\u6790",id:"31-\u9700\u6c42\u5206\u6790",level:3},{value:"#3.2 \u5b9e\u73b0\u601d\u8def",id:"32-\u5b9e\u73b0\u601d\u8def",level:3},{value:"#3.3 \u4ee3\u7801\u5b9e\u73b0",id:"33-\u4ee3\u7801\u5b9e\u73b0",level:3},{value:"#3.3.1 \u5185\u7f51\u7a7f\u900f\u5de5\u5177",id:"331-\u5185\u7f51\u7a7f\u900f\u5de5\u5177",level:4},{value:"#3.3.2\u4e0b\u8f7d\u914d\u7f6e\u6587\u4ef6\u548c\u5ba2\u6237\u7aef",id:"332\u4e0b\u8f7d\u914d\u7f6e\u6587\u4ef6\u548c\u5ba2\u6237\u7aef",level:4},{value:"#<strong>3.3.3 \u542f\u52a8</strong>",id:"333-\u542f\u52a8",level:4},{value:"#<strong>3.3.4 \u6d4b\u8bd5</strong>",id:"334-\u6d4b\u8bd5",level:4},{value:"#3.3.5 \u63a5\u6536\u56de\u8c03\u4fe1\u606f",id:"335-\u63a5\u6536\u56de\u8c03\u4fe1\u606f",level:4},{value:"#3.3.6 \u5904\u7406\u56de\u8c03\u901a\u77e5-\u91cd\u70b9",id:"336-\u5904\u7406\u56de\u8c03\u901a\u77e5-\u91cd\u70b9",level:4},{value:"#3.3.7 \u6536\u5230\u5fae\u4fe1\u901a\u77e5\u540e\u7684\u903b\u8f91",id:"337-\u6536\u5230\u5fae\u4fe1\u901a\u77e5\u540e\u7684\u903b\u8f91",level:4},{value:"#3.3.8 \u8ba2\u5355\u670d\u52a1\u4fee\u6539\u8ba2\u5355\u72b6\u6001",id:"338-\u8ba2\u5355\u670d\u52a1\u4fee\u6539\u8ba2\u5355\u72b6\u6001",level:4},{value:"#3.3.9 \u6574\u4e2a\u6d41\u7a0b\u6d4b\u8bd5",id:"339-\u6574\u4e2a\u6d41\u7a0b\u6d4b\u8bd5",level:4},{value:"#4. \u63a8\u9001\u652f\u4ed8\u901a\u77e5",id:"4-\u63a8\u9001\u652f\u4ed8\u901a\u77e5",level:2},{value:"#4.1 \u9700\u6c42\u5206\u6790",id:"41-\u9700\u6c42\u5206\u6790",level:3},{value:"#4.2 \u670d\u52a1\u7aef\u63a8\u9001\u65b9\u6848",id:"42-\u670d\u52a1\u7aef\u63a8\u9001\u65b9\u6848",level:3},{value:"#4.3 RabbitMQ Web STOMP \u63d2\u4ef6",id:"43-rabbitmq-web-stomp-\u63d2\u4ef6",level:3},{value:"#4.3.1 STOMP\u534f\u8bae",id:"431-stomp\u534f\u8bae",level:4},{value:"#4.3.2 \u63d2\u4ef6\u5b89\u88c5",id:"432-\u63d2\u4ef6\u5b89\u88c5",level:4},{value:"#4.3.3 \u6d88\u606f\u63a8\u9001\u6d4b\u8bd5",id:"433-\u6d88\u606f\u63a8\u9001\u6d4b\u8bd5",level:4},{value:"#4.4 \u4ee3\u7801\u5b9e\u73b0",id:"44-\u4ee3\u7801\u5b9e\u73b0",level:3},{value:"#5. \u6d4b\u8bd5\u8bbf\u95ee\u8def\u5f84",id:"5-\u6d4b\u8bd5\u8bbf\u95ee\u8def\u5f84",level:2},{value:"#\u8bfe\u7a0b\u5185\u5bb9\uff1a",id:"\u8bfe\u7a0b\u5185\u5bb9-1",level:2},{value:"#1. \u8d85\u65f6\u672a\u652f\u4ed8\u8ba2\u5355\u5904\u7406-\u91cd\u70b9",id:"1-\u8d85\u65f6\u672a\u652f\u4ed8\u8ba2\u5355\u5904\u7406-\u91cd\u70b9",level:2},{value:"#1.1 \u9700\u6c42\u5206\u6790",id:"11-\u9700\u6c42\u5206\u6790",level:3},{value:"#1.2 \u5b9e\u73b0\u601d\u8def",id:"12-\u5b9e\u73b0\u601d\u8def",level:3},{value:"#1.3 rabbitmq\u5ef6\u8fdf\u6d88\u606f",id:"13-rabbitmq\u5ef6\u8fdf\u6d88\u606f",level:3},{value:"#1.3.1 \u6d88\u606f\u7684TTL\uff08Time To Live\uff09",id:"131-\u6d88\u606f\u7684ttltime-to-live",level:4},{value:"#1.3.2 \u6b7b\u4fe1\u4ea4\u6362\u5668 Dead Letter Exchanges",id:"132-\u6b7b\u4fe1\u4ea4\u6362\u5668-dead-letter-exchanges",level:4},{value:"#1.4 \u4ee3\u7801\u5b9e\u73b0",id:"14-\u4ee3\u7801\u5b9e\u73b0",level:3},{value:"#1.4.1 \u5fae\u4fe1\u652f\u4ed8-\u5173\u95ed\u8ba2\u5355",id:"141-\u5fae\u4fe1\u652f\u4ed8-\u5173\u95ed\u8ba2\u5355",level:4},{value:"#1.4.2 \u5fae\u4fe1\u652f\u4ed8-\u67e5\u8be2\u8ba2\u5355",id:"142-\u5fae\u4fe1\u652f\u4ed8-\u67e5\u8be2\u8ba2\u5355",level:4},{value:"#1.4.3 \u8ba2\u5355\u5173\u95ed\u903b\u8f91",id:"143-\u8ba2\u5355\u5173\u95ed\u903b\u8f91",level:4},{value:"#1.4.4 \u5ef6\u8fdf\u6d88\u606f\u5904\u7406",id:"144-\u5ef6\u8fdf\u6d88\u606f\u5904\u7406",level:4},{value:"#2. \u8ba2\u5355\u6279\u91cf\u53d1\u8d27",id:"2-\u8ba2\u5355\u6279\u91cf\u53d1\u8d27",level:2},{value:"#2.1 \u6279\u91cf\u53d1\u8d27\u4e1a\u52a1\u903b\u8f91",id:"21-\u6279\u91cf\u53d1\u8d27\u4e1a\u52a1\u903b\u8f91",level:3},{value:"#2.1.1 \u9700\u6c42\u5206\u6790",id:"211-\u9700\u6c42\u5206\u6790",level:4},{value:"#2.1.2 \u4ee3\u7801\u5b9e\u73b0",id:"212-\u4ee3\u7801\u5b9e\u73b0",level:4},{value:"#2.2 \u5bf9\u63a5\u7b2c\u4e09\u65b9\u7269\u6d41\uff08\u4e86\u89e3\uff09",id:"22-\u5bf9\u63a5\u7b2c\u4e09\u65b9\u7269\u6d41\u4e86\u89e3",level:3},{value:"#3. \u786e\u8ba4\u6536\u8d27\u4e0e\u81ea\u52a8\u6536\u8d27",id:"3-\u786e\u8ba4\u6536\u8d27\u4e0e\u81ea\u52a8\u6536\u8d27",level:2},{value:"#3.1 \u786e\u8ba4\u6536\u8d27",id:"31-\u786e\u8ba4\u6536\u8d27",level:3},{value:"#3.1.1 \u9700\u6c42\u5206\u6790\u4e0e\u5b9e\u73b0\u601d\u8def",id:"311-\u9700\u6c42\u5206\u6790\u4e0e\u5b9e\u73b0\u601d\u8def",level:4},{value:"#3.1.2 \u4ee3\u7801\u5b9e\u73b0",id:"312-\u4ee3\u7801\u5b9e\u73b0",level:4},{value:"#3.2 \u81ea\u52a8\u6536\u8d27\u5904\u7406",id:"32-\u81ea\u52a8\u6536\u8d27\u5904\u7406",level:3},{value:"#3.2.1 \u9700\u6c42\u5206\u6790",id:"321-\u9700\u6c42\u5206\u6790",level:4},{value:"#3.2.2 Cron\u8868\u8fbe\u5f0f",id:"322-cron\u8868\u8fbe\u5f0f",level:4},{value:"#3.2.3 \u4ee3\u7801\u5b9e\u73b0",id:"323-\u4ee3\u7801\u5b9e\u73b0",level:4},{value:"#3.2.3.1 \u53d1\u9001\u6d88\u606f",id:"3231-\u53d1\u9001\u6d88\u606f",level:5},{value:"#3.2.3.2 \u63a5\u6536\u6d88\u606f",id:"3232-\u63a5\u6536\u6d88\u606f",level:5},{value:"#\u8bfe\u7a0b\u5185\u5bb9:",id:"\u8bfe\u7a0b\u5185\u5bb9-2",level:2},{value:"#1 \u79d2\u6740\u4e1a\u52a1\u5206\u6790",id:"1-\u79d2\u6740\u4e1a\u52a1\u5206\u6790",level:2},{value:"#1.1 \u9700\u6c42\u5206\u6790",id:"11-\u9700\u6c42\u5206\u6790-1",level:4},{value:"#1.2 \u8868\u7ed3\u6784\u8bf4\u660e",id:"12-\u8868\u7ed3\u6784\u8bf4\u660e",level:4},{value:"#1.3 \u79d2\u6740\u9700\u6c42\u5206\u6790==\u62d3\u5c55\u5185\u5bb9",id:"13-\u79d2\u6740\u9700\u6c42\u5206\u6790\u62d3\u5c55\u5185\u5bb9",level:4},{value:"#2 \u79d2\u6740\u5546\u54c1\u5b58\u5165\u7f13\u5b58-\u91cd\u70b9",id:"2-\u79d2\u6740\u5546\u54c1\u5b58\u5165\u7f13\u5b58-\u91cd\u70b9",level:2},{value:"#2.1 \u79d2\u6740\u670d\u52a1\u642d\u5efa",id:"21-\u79d2\u6740\u670d\u52a1\u642d\u5efa",level:3},{value:"#2.2 \u65f6\u95f4\u64cd\u4f5c",id:"22-\u65f6\u95f4\u64cd\u4f5c",level:3},{value:"#2.2.1 \u79d2\u6740\u5546\u54c1\u65f6\u95f4\u6bb5\u5206\u6790",id:"221-\u79d2\u6740\u5546\u54c1\u65f6\u95f4\u6bb5\u5206\u6790",level:4},{value:"#2.2.2 \u79d2\u6740\u5546\u54c1\u65f6\u95f4\u6bb5\u8ba1\u7b97",id:"222-\u79d2\u6740\u5546\u54c1\u65f6\u95f4\u6bb5\u8ba1\u7b97",level:4},{value:"#2.2.3 \u5f53\u524d\u4e1a\u52a1\u6574\u4f53\u6d41\u7a0b\u5206\u6790",id:"223-\u5f53\u524d\u4e1a\u52a1\u6574\u4f53\u6d41\u7a0b\u5206\u6790",level:4},{value:"#2.3 \u4ee3\u7801\u5b9e\u73b0",id:"23-\u4ee3\u7801\u5b9e\u73b0-1",level:3},{value:"#2.3.1 \u66f4\u6539\u542f\u52a8\u7c7b\uff0c\u6dfb\u52a0\u5f00\u542f\u5b9a\u65f6\u4efb\u52a1\u6ce8\u89e3",id:"231-\u66f4\u6539\u542f\u52a8\u7c7b\u6dfb\u52a0\u5f00\u542f\u5b9a\u65f6\u4efb\u52a1\u6ce8\u89e3",level:4},{value:"#2.3.2 \u65f6\u95f4\u83dc\u5355\u5206\u6790",id:"232-\u65f6\u95f4\u83dc\u5355\u5206\u6790",level:4},{value:"#2.3.2 \u5b9a\u4e49\u5b9a\u65f6\u4efb\u52a1\u7c7b",id:"232-\u5b9a\u4e49\u5b9a\u65f6\u4efb\u52a1\u7c7b",level:4},{value:"#3 \u79d2\u6740\u5546\u54c1-\u9996\u9875-\u4e86\u89e3",id:"3-\u79d2\u6740\u5546\u54c1-\u9996\u9875-\u4e86\u89e3",level:2},{value:"#3.1 \u79d2\u6740\u9996\u9875\u5b9e\u73b0\u5206\u6790",id:"31-\u79d2\u6740\u9996\u9875\u5b9e\u73b0\u5206\u6790",level:3},{value:"#3.1.1 \u52a0\u8f7d\u65f6\u95f4\u83dc\u5355\u5206\u6790",id:"311-\u52a0\u8f7d\u65f6\u95f4\u83dc\u5355\u5206\u6790",level:4},{value:"#3.1.2 \u52a0\u8f7d\u5bf9\u5e94\u79d2\u6740\u5546\u54c1\u5206\u6790",id:"312-\u52a0\u8f7d\u5bf9\u5e94\u79d2\u6740\u5546\u54c1\u5206\u6790",level:4},{value:"#3.2 \u79d2\u6740\u6e32\u67d3\u670d\u52a1 - \u6e32\u67d3\u79d2\u6740\u9996\u9875",id:"32-\u79d2\u6740\u6e32\u67d3\u670d\u52a1---\u6e32\u67d3\u79d2\u6740\u9996\u9875",level:3},{value:"#3.2.1 \u65b0\u5efa\u79d2\u6740\u6e32\u67d3\u670d\u52a1",id:"321-\u65b0\u5efa\u79d2\u6740\u6e32\u67d3\u670d\u52a1",level:4},{value:"#3.3 \u65f6\u95f4\u83dc\u5355\u5b9e\u73b0",id:"33-\u65f6\u95f4\u83dc\u5355\u5b9e\u73b0",level:3},{value:"#3.3.1 \u65f6\u95f4\u83dc\u5355\u83b7\u53d6",id:"331-\u65f6\u95f4\u83dc\u5355\u83b7\u53d6",level:4},{value:"#3.3.2 \u9875\u9762\u52a0\u8f7d\u65f6\u95f4\u83dc\u5355",id:"332-\u9875\u9762\u52a0\u8f7d\u65f6\u95f4\u83dc\u5355",level:4},{value:"#3.3.3 \u65f6\u95f4\u683c\u5f0f\u5316",id:"333-\u65f6\u95f4\u683c\u5f0f\u5316",level:4},{value:"#3.3.4 \u9009\u4e2d\u5b9e\u73b0 -\u4e86\u89e3",id:"334-\u9009\u4e2d\u5b9e\u73b0--\u4e86\u89e3",level:4},{value:"#3.3.4.1 \u601d\u8def\u5206\u6790",id:"3341-\u601d\u8def\u5206\u6790",level:5},{value:"#3.3.4.2 \u4ee3\u7801\u5b9e\u73b0",id:"3342-\u4ee3\u7801\u5b9e\u73b0",level:5},{value:"#3.3.5 \u5012\u8ba1\u65f6\u5b9e\u73b0",id:"335-\u5012\u8ba1\u65f6\u5b9e\u73b0",level:4},{value:"#3.3.5.1 \u5012\u8ba1\u65f6\u5b9e\u73b0",id:"3351-\u5012\u8ba1\u65f6\u5b9e\u73b0",level:5},{value:"#3.3.5.1.1 \u57fa\u7840\u6570\u636e\u663e\u793a",id:"33511-\u57fa\u7840\u6570\u636e\u663e\u793a",level:6},{value:"#3.3.5.1.2 \u6bcf\u4e2a\u65f6\u95f4\u5dee\u5012\u8ba1\u65f6\u5b9e\u73b0",id:"33512-\u6bcf\u4e2a\u65f6\u95f4\u5dee\u5012\u8ba1\u65f6\u5b9e\u73b0",level:6},{value:"#3.3.5.1.3 \u5012\u8ba1\u65f6\u65f6\u95f4\u683c\u5f0f\u5316",id:"33513-\u5012\u8ba1\u65f6\u65f6\u95f4\u683c\u5f0f\u5316",level:6},{value:"#3.3.5.1.4 \u6b63\u786e\u5012\u8ba1\u65f6\u65f6\u95f4\u663e\u793a",id:"33514-\u6b63\u786e\u5012\u8ba1\u65f6\u65f6\u95f4\u663e\u793a",level:6},{value:"#3.4 \u52a0\u8f7d\u79d2\u6740\u5546\u54c1\u5b9e\u73b0",id:"34-\u52a0\u8f7d\u79d2\u6740\u5546\u54c1\u5b9e\u73b0",level:3},{value:"#3.4.1 \u79d2\u6740\u670d\u52a1-\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868",id:"341-\u79d2\u6740\u670d\u52a1-\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868",level:4},{value:"#3.4.1.1 \u79d2\u6740\u670d\u52a1- service",id:"3411-\u79d2\u6740\u670d\u52a1--service",level:5},{value:"#3.4.1.2 \u79d2\u6740\u670d\u52a1-controller",id:"3412-\u79d2\u6740\u670d\u52a1-controller",level:5},{value:"#3.4.1.3 \u6740\u670d\u52a1Api- feign\u63a5\u53e3\u5b9a\u4e49",id:"3413-\u6740\u670d\u52a1api--feign\u63a5\u53e3\u5b9a\u4e49",level:5},{value:"#3.4.1.4 \u67e5\u8be2\u79d2\u6740\u5546\u54c1\u653e\u884c-\u60f3\u60f3\u4e3a\u4ec0\u4e48",id:"3414-\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u653e\u884c-\u60f3\u60f3\u4e3a\u4ec0\u4e48",level:5},{value:"#3.4.2 \u79d2\u6740\u6e32\u67d3\u670d\u52a1-\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868",id:"342-\u79d2\u6740\u6e32\u67d3\u670d\u52a1-\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868",level:4},{value:"#3.4.2.1 \u66f4\u65b0ydles_web_seckill\u7684\u542f\u52a8\u7c7b",id:"3421-\u66f4\u65b0ydles_web_seckill\u7684\u542f\u52a8\u7c7b",level:5},{value:"#3.4.2.2 \u66f4\u65b0ydles_web_seckill\u7684SecKillGoodsController",id:"3422-\u66f4\u65b0ydles_web_seckill\u7684seckillgoodscontroller",level:5},{value:"#3.4.2.3 \u66f4\u65b0secKill-index.html\u3002\u6dfb\u52a0\u6309\u7167\u65f6\u95f4\u67e5\u8be2\u65b9\u6cd5",id:"3423-\u66f4\u65b0seckill-indexhtml\u6dfb\u52a0\u6309\u7167\u65f6\u95f4\u67e5\u8be2\u65b9\u6cd5",level:5},{value:"#3.4.2.4 \u66f4\u65b0secKill-index.html\u3002 \u52a0\u8f7d\u9875\u9762\u65f6\uff0c\u9ed8\u8ba4\u5f53\u524d\u65f6\u95f4\u67e5\u8be2",id:"3424-\u66f4\u65b0seckill-indexhtml-\u52a0\u8f7d\u9875\u9762\u65f6\u9ed8\u8ba4\u5f53\u524d\u65f6\u95f4\u67e5\u8be2",level:5},{value:"#3.4.2.5 \u66f4\u65b0secKill-index.html\u3002\u5207\u6362\u65f6\u95f4\u83dc\u5355,\u67e5\u8be2\u79d2\u6740\u5546\u54c1",id:"3425-\u66f4\u65b0seckill-indexhtml\u5207\u6362\u65f6\u95f4\u83dc\u5355\u67e5\u8be2\u79d2\u6740\u5546\u54c1",level:5},{value:"#3.5 \u62a2\u8d2d\u6309\u94ae",id:"35-\u62a2\u8d2d\u6309\u94ae",level:3},{value:"#3.5.1 js\u5b9a\u4e49",id:"351-js\u5b9a\u4e49",level:4},{value:"#3.5.2 \u8c03\u7528\u4e0b\u5355\u65b9\u6cd5",id:"352-\u8c03\u7528\u4e0b\u5355\u65b9\u6cd5",level:4},{value:"#3.5.3 \u79d2\u6740web\u9875\u9762 \u65b0\u589eController",id:"353-\u79d2\u6740web\u9875\u9762-\u65b0\u589econtroller",level:4},{value:"#1 \u79d2\u6740\u5f02\u6b65\u4e0b\u5355-\u91cd\u70b9-\u96be\u70b9",id:"1-\u79d2\u6740\u5f02\u6b65\u4e0b\u5355-\u91cd\u70b9-\u96be\u70b9",level:2},{value:"#1.1 \u79d2\u6740\u670d\u52a1-\u4e0b\u5355\u5b9e\u73b0",id:"11-\u79d2\u6740\u670d\u52a1-\u4e0b\u5355\u5b9e\u73b0",level:3},{value:"#1.2 \u751f\u4ea7\u8005\u4fdd\u8bc1\u6d88\u606f\u4e0d\u4e22\u5931--\u9762\u8bd5\u5e38\u95ee\u95ee\u9898-\u91cd\u70b9",id:"12-\u751f\u4ea7\u8005\u4fdd\u8bc1\u6d88\u606f\u4e0d\u4e22\u5931--\u9762\u8bd5\u5e38\u95ee\u95ee\u9898-\u91cd\u70b9",level:3},{value:"#1.2.1 \u5f00\u542fconfirm\u673a\u5236",id:"121-\u5f00\u542fconfirm\u673a\u5236",level:4},{value:"#<strong>1.2.2\u53d1\u9001\u6d88\u606f</strong>",id:"122\u53d1\u9001\u6d88\u606f",level:4},{value:"#1.3 \u79d2\u6740\u4e0b\u5355\u670d\u52a1-\u66f4\u65b0\u5e93\u5b58\u5e93",id:"13-\u79d2\u6740\u4e0b\u5355\u670d\u52a1-\u66f4\u65b0\u5e93\u5b58\u5e93",level:3},{value:"#1.3.1 \u5f02\u6b65\u4e0b\u5355\u670d\u52a1ydles_service_consume",id:"131-\u5f02\u6b65\u4e0b\u5355\u670d\u52a1ydles_service_consume",level:4},{value:"#1.3.2 \u6d88\u8d39\u8005\u624b\u52a8ACK\u4e0b\u5355\u5b9e\u73b0--\u9762\u8bd5\u91cd\u70b9-\u8ba4\u771f\u542c",id:"132-\u6d88\u8d39\u8005\u624b\u52a8ack\u4e0b\u5355\u5b9e\u73b0--\u9762\u8bd5\u91cd\u70b9-\u8ba4\u771f\u542c",level:4},{value:"#1.5 \u6d41\u91cf\u524a\u5cf0",id:"15-\u6d41\u91cf\u524a\u5cf0",level:3},{value:"#1.6 \u79d2\u6740\u6e32\u67d3\u670d\u52a1-\u4e0b\u5355\u5b9e\u73b0",id:"16-\u79d2\u6740\u6e32\u67d3\u670d\u52a1-\u4e0b\u5355\u5b9e\u73b0",level:3},{value:"#1.7\u79d2\u6740\u5546\u54c1\u771f\u5b9e\u6570\u91cf\u83b7\u53d6",id:"17\u79d2\u6740\u5546\u54c1\u771f\u5b9e\u6570\u91cf\u83b7\u53d6",level:3},{value:"#2 \u9632\u6b62\u6076\u610f\u5237\u5355\u89e3\u51b3",id:"2-\u9632\u6b62\u6076\u610f\u5237\u5355\u89e3\u51b3",level:2},{value:"#2.1 \u66f4\u65b0\u79d2\u6740\u670d\u52a1\u4e0b\u5355",id:"21-\u66f4\u65b0\u79d2\u6740\u670d\u52a1\u4e0b\u5355",level:3},{value:"#2.2 \u9632\u91cd\u65b9\u6cd5\u5b9e\u73b0",id:"22-\u9632\u91cd\u65b9\u6cd5\u5b9e\u73b0",level:3},{value:"#3 \u9632\u6b62\u76f8\u540c\u5546\u54c1\u91cd\u590d\u79d2\u6740",id:"3-\u9632\u6b62\u76f8\u540c\u5546\u54c1\u91cd\u590d\u79d2\u6740",level:2},{value:"#3.1 \u4fee\u6539\u4e0b\u5355\u4e1a\u52a1\u5c42\u5b9e\u73b0",id:"31-\u4fee\u6539\u4e0b\u5355\u4e1a\u52a1\u5c42\u5b9e\u73b0",level:3},{value:"#3.2 dao\u5c42\u65b0\u589e\u67e5\u8be2\u65b9\u6cd5",id:"32-dao\u5c42\u65b0\u589e\u67e5\u8be2\u65b9\u6cd5",level:3},{value:"#4 \u79d2\u6740\u4e0b\u5355\u63a5\u53e3\u9690\u85cf",id:"4-\u79d2\u6740\u4e0b\u5355\u63a5\u53e3\u9690\u85cf",level:2},{value:"#4.1 \u5c06\u968f\u673a\u6570\u5de5\u5177\u7c7b\u653e\u5165common\u5de5\u7a0b\u4e2d",id:"41-\u5c06\u968f\u673a\u6570\u5de5\u5177\u7c7b\u653e\u5165common\u5de5\u7a0b\u4e2d",level:3},{value:"#4.2 \u79d2\u6740\u6e32\u67d3\u670d\u52a1\u5b9a\u4e49\u968f\u673a\u6570\u63a5\u53e3",id:"42-\u79d2\u6740\u6e32\u67d3\u670d\u52a1\u5b9a\u4e49\u968f\u673a\u6570\u63a5\u53e3",level:3},{value:"#4.3 js\u4fee\u6539",id:"43-js\u4fee\u6539",level:3},{value:"#4.4 \u79d2\u6740\u6e32\u67d3\u670d\u52a1\u66f4\u6539",id:"44-\u79d2\u6740\u6e32\u67d3\u670d\u52a1\u66f4\u6539",level:3},{value:"#5\u79d2\u6740\u4e0b\u5355\u63a5\u53e3\u9650\u6d41-\u96be\u70b9-\u4e0d\u662f\u91cd\u70b9",id:"5\u79d2\u6740\u4e0b\u5355\u63a5\u53e3\u9650\u6d41-\u96be\u70b9-\u4e0d\u662f\u91cd\u70b9",level:2},{value:"#1\u6dfb\u52a0\u4f9d\u8d56",id:"1\u6dfb\u52a0\u4f9d\u8d56",level:3},{value:"#2\u81ea\u5b9a\u4e49\u9650\u6d41\u6ce8\u89e3",id:"2\u81ea\u5b9a\u4e49\u9650\u6d41\u6ce8\u89e3",level:3},{value:"#3\u81ea\u5b9a\u4e49\u5207\u9762\u7c7b",id:"3\u81ea\u5b9a\u4e49\u5207\u9762\u7c7b",level:3},{value:"#4\u4f7f\u7528\u81ea\u5b9a\u4e49\u9650\u6d41\u6ce8\u89e3",id:"4\u4f7f\u7528\u81ea\u5b9a\u4e49\u9650\u6d41\u6ce8\u89e3",level:3}],d={toc:o};function c(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"23-\u4e8c\u5962\u4ea4\u6613"},"2.3 \u4e8c\u5962\u4ea4\u6613"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u89d2\u8272"),"\uff1a \u8ba2\u5355\u6a21\u5757\uff0c\u540e\u7aef\u5f00\u53d1\u5de5\u7a0b\u5e08\u3002"),(0,l.kt)("h2",{id:"\u8bfe\u7a0b\u5185\u5bb9"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9"},"#"),"\u8bfe\u7a0b\u5185\u5bb9"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5b8c\u6210\u8ba2\u5355\u7ed3\u7b97\u9875\u6e32\u67d3"),(0,l.kt)("li",{parentName:"ol"},"\u5b8c\u6210\u7528\u6237\u4e0b\u5355\u5b9e\u73b0"),(0,l.kt)("li",{parentName:"ol"},"\u5b8c\u6210\u5e93\u5b58\u53d8\u66f4\u5b9e\u73b0")),(0,l.kt)("h2",{id:"1-\u8ba2\u5355\u7ed3\u7b97\u9875"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-%E8%AE%A2%E5%8D%95%E7%BB%93%E7%AE%97%E9%A1%B5"},"#"),"1 \u8ba2\u5355\u7ed3\u7b97\u9875"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211205120105277-7d63c456.png",alt:"image-20211205120105277"}),"image-20211205120105277"),(0,l.kt)("h3",{id:"11-\u6536\u4ef6\u5730\u5740\u5206\u6790"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-1-%E6%94%B6%E4%BB%B6%E5%9C%B0%E5%9D%80%E5%88%86%E6%9E%90"},"#"),"1.1 \u6536\u4ef6\u5730\u5740\u5206\u6790"),(0,l.kt)("p",null,"1\u5c55\u793a \u6253\u5f00\u524d\u53f0 order.html"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211205115918039-116ade03.png",alt:"image-20211205115918039"}),"image-20211205115918039"),(0,l.kt)("p",null,"\u6536\u4ef6\u5730\u5740\u5206\u6790 td_address\u8868\u3002\u8868\u7ed3\u6784\u5206\u6790\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211205120007359-1be8e26e.png",alt:"image-20211205120007359"}),"image-20211205120007359"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE `tb_address` (\n    `id` int(11) NOT NULL AUTO_INCREMENT,\n    `username` varchar(50) DEFAULT NULL COMMENT '\u7528\u6237\u540d',\n    `provinceid` varchar(20) DEFAULT NULL COMMENT '\u7701',\n    `cityid` varchar(20) DEFAULT NULL COMMENT '\u5e02',\n    `areaid` varchar(20) DEFAULT NULL COMMENT '\u53bf/\u533a',\n    `phone` varchar(20) DEFAULT NULL COMMENT '\u7535\u8bdd',\n    `address` varchar(200) DEFAULT NULL COMMENT '\u8be6\u7ec6\u5730\u5740',\n    `contact` varchar(50) DEFAULT NULL COMMENT '\u8054\u7cfb\u4eba',\n    `is_default` varchar(1) DEFAULT NULL COMMENT '\u662f\u5426\u662f\u9ed8\u8ba4 1\u9ed8\u8ba4 0\u5426',\n    `alias` varchar(50) DEFAULT NULL COMMENT '\u522b\u540d',\n    PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=66 DEFAULT CHARSET=utf8;\n")),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u7528\u6237\u767b\u5f55\u540d\u53bbtb_address\u8868\u4e2d\u67e5\u8be2\u5bf9\u5e94\u7684\u6570\u636e\u3002"),(0,l.kt)("h3",{id:"12-\u5b9e\u73b0\u7528\u6237\u6536\u4ef6\u5730\u5740\u67e5\u8be2"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-2-%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E6%94%B6%E4%BB%B6%E5%9C%B0%E5%9D%80%E6%9F%A5%E8%AF%A2"},"#"),"1.2 \u5b9e\u73b0\u7528\u6237\u6536\u4ef6\u5730\u5740\u67e5\u8be2"),(0,l.kt)("h4",{id:"121-\u4ee3\u7801\u5b9e\u73b0-ydles-service-user"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-2-1-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-ydles-service-user"},"#"),"1.2.1 \u4ee3\u7801\u5b9e\u73b0 ydles-service-user"),(0,l.kt)("p",null,"1\u9700\u6539com.ydles.user.service.AddressService\u63a5\u53e3\uff0c\u6dfb\u52a0\u6839\u636e\u7528\u6237\u540d\u5b57\u67e5\u8be2\u7528\u6237\u6536\u4ef6\u5730\u5740\u4fe1\u606f\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"//\u6839\u636eusername \u67e5\u8be2\npublic List<Address> list(String username);\n")),(0,l.kt)("p",null,"2\u4e1a\u52a1\u5c42\u63a5\u53e3\u5b9e\u73b0\u7c7b"),(0,l.kt)("p",null,"\u4fee\u6539com.ydles.user.service.impl.AddressServiceImpl\u7c7b\uff0c\u6dfb\u52a0\u6839\u636e\u7528\u6237\u67e5\u8be2\u7528\u6237\u6536\u4ef6\u5730\u5740\u4fe1\u606f\u5b9e\u73b0\u65b9\u6cd5\uff0c\u5982\u4e0b\u4ee3\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Override\npublic List<Address> list(String username) {\n    Address address=new Address();\n    address.setUsername(username);\n\n    List<Address> addressList = addressMapper.select(address);\n\n    return addressList;\n}\n")),(0,l.kt)("p",null,"3\u63a7\u5236\u5c42"),(0,l.kt)("p",null,"\u4fee\u6539com.ydles.user.controller.AddressController\uff0c\u6dfb\u52a0\u6839\u636e\u7528\u6237\u540d\u67e5\u8be2\u7528\u6237\u6536\u4ef6\u4fe1\u606f\u65b9\u6cd5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Autowired\nTokenDecode tokenDecode;\n\n//\u6839\u636eusername \u67e5\u8be2 lsit<Address>\n@GetMapping("/list")\npublic List<Address> list(){\n    //\u5f53\u524d\u767b\u5f55\u4eba\n    String username = tokenDecode.getUserInfo().get("username");\n\n    List<Address> addressList = addressService.list(username);\n\n    return addressList;\n}\n')),(0,l.kt)("p",null,"4\u521b\u5efaTokenDecode"),(0,l.kt)("p",null,"com.ydles.UserApplication\u4e2d\u521b\u5efaTokenDecode,\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Bean\npublic TokenDecode tokenDecode(){\n    return  new TokenDecode();\n}\n")),(0,l.kt)("p",null,"\u6d4b\u8bd5\uff1a\u901a\u8fc7\u7f51\u5173\u8bbf\u95ee\uff0c\u4fee\u6539\u7f51\u5173\u914d\u7f6e\u4fe1\u606f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"      routes:\n        - id: ydles_goods_route\n          uri: lb://goods\n          predicates:\n            - Path=/api/album/**,/api/brand/**,/api/cache/**,/api/categoryBrand/**,/api/category/**,/api/para/**,/api/pref/**,/api/sku/**,/api/spec/**,/api/spu/**,/api/stockBack/**,/api/template/**\n          filters:\n            #- PrefixPath=/brand\n            - StripPrefix=1\n          #\u7528\u6237\u5fae\u670d\u52a1\n        - id: ydles_user_route\n          uri: lb://user\n          predicates:\n            - Path=/api/user/**,/api/address/**,/api/areas/**,/api/cities/**,/api/provinces/**\n          filters:\n            - StripPrefix=1\n          #\u8ba4\u8bc1\u5fae\u670d\u52a1\n        - id: ydles_oauth_user\n          uri: lb://user-auth\n          predicates:\n            - Path=/api/oauth/**\n          filters:\n            - StripPrefix=1\n        #\u8ba2\u5355\u5fae\u670d\u52a1\n        - id: ydles_order_route\n          uri: lb://order\n          predicates:\n            - Path=/api/cart/**,/api/categoryReport/**,/api/orderConfig/**,/api/order/**,/api/orderItem/**,/api/orderLog/**,/api/preferential/**,/api/returnCause/**,/api/returnOrder/**,/api/returnOrderItem/**\n          filters:\n            - StripPrefix=1\n        #\u8d2d\u7269\u8f66\u8ba2\u5355\u6e32\u67d3\u5fae\u670d\u52a1\n        - id: ydles_order_web_route\n          uri: lb://order-web\n          predicates:\n            - Path=/api/wcart/**,/api/worder/**\n          filters:\n            - StripPrefix=1\n")),(0,l.kt)("p",null,"\u5148\u767b\u5f55 Postman\u8bbf\u95ee ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/oauth/login"},"http://localhost:8001/api/oauth/loginopen in new window")),(0,l.kt)("p",null,"\u518d\u8bf7\u6c42\u6570\u636e Postman\u8bbf\u95ee ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/address/list"},"http://localhost:8001/api/address/listopen in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211205121817519-09881489.png",alt:"image-20211205121817519"}),"image-20211205121817519"),(0,l.kt)("h3",{id:"13-\u9875\u9762\u6a21\u677f\u6e32\u67d3"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-%E9%A1%B5%E9%9D%A2%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93"},"#"),"1.3 \u9875\u9762\u6a21\u677f\u6e32\u67d3"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211205120105277-7d63c456.png",alt:"image-20211205120105277"}),"image-20211205120105277"),(0,l.kt)("p",null,"\u8d2d\u7269\u8f66\u8fd9\u5757\u4e5f\u4f7f\u7528\u7684\u662f\u6a21\u677f\u6e32\u67d3\uff0c\u7528\u6237\u5148\u8bf7\u6c42\u7ecf\u8fc7\u5fae\u670d\u52a1\u7f51\u5173\uff0c\u5fae\u670d\u52a1\u7f51\u5173\u8f6c\u53d1\u5230\u8ba2\u5355\u8d2d\u7269\u8f66\u6a21\u677f\u6e32\u67d3\u670d\u52a1\uff0c\u6a21\u677f\u6e32\u67d3\u670d\u52a1\u6761\u7528\u7528\u6237\u5fae\u670d\u52a1\u548c\u8ba2\u5355\u8d2d\u7269\u8f66\u5fae\u670d\u52a1\u67e5\u8be2\u7528\u6237\u6536\u4ef6\u5730\u5740\u548c\u8d2d\u7269\u8f66\u6e05\u5355\uff0c\u7136\u540e\u5230\u9875\u9762\u663e\u793a\u3002"),(0,l.kt)("h4",{id:"131-\u51c6\u5907\u5de5\u4f5c"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"},"#"),"1.3.1 \u51c6\u5907\u5de5\u4f5c"),(0,l.kt)("p",null,"(1)\u9759\u6001\u8d44\u6e90\u5bfc\u5165"),(0,l.kt)("p",null,"\u5c06\u8d44\u6599\u4e2d\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"order.html"),"\u62f7\u8d1d\u5230",(0,l.kt)("inlineCode",{parentName:"p"},"ydles-web-order"),"\u5de5\u7a0b\u7684templates\u4e2d\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206091251118-74887e4a.png",alt:"image-20211206091251118"}),"image-20211206091251118"),(0,l.kt)("p",null,"(2)\u9875\u9762\u8df3\u8f6c\u5b9e\u73b0"),(0,l.kt)("p",null,"\u5728ydles-web-order\u4e2d\u521b\u5efa",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.order.controller.OrderController"),"\u5b9e\u73b0\u9875\u9762\u8df3\u8f6c\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Controller\n@RequestMapping("/worder")\npublic class OrderController {\n    @RequestMapping("/ready/order")\n    public String readyOrder(Model model) {\n        return "order";\n    }\n}\n')),(0,l.kt)("p",null,"(3)\u7f51\u5173\u914d\u7f6e"),(0,l.kt)("p",null,"\u4fee\u6539ydles-gateway-web\u7684application.yml\u6587\u4ef6\uff0c\u5c06\u8ba2\u5355\u7684\u8def\u7531\u8fc7\u6ee4\u5730\u5740\u6dfb\u52a0\u4e0a\u53bb\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206091646934-6c1ed852.png",alt:"image-20211206091646934"}),"image-20211206091646934"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"        #\u8d2d\u7269\u8f66\u8ba2\u5355\u6e32\u67d3\u5fae\u670d\u52a1\n        - id: ydles_order_web_route\n          uri: lb://order-web\n          predicates:\n            - Path=/api/wcart/**,/api/worder/**\n          filters:\n            - StripPrefix=1\n")),(0,l.kt)("p",null,"\u540c\u65f6\u4e0d\u8981\u5fd8\u4e86\u628a\u8be5\u5730\u5740\u6dfb\u52a0\u5230\u767b\u5f55\u8fc7\u6ee4\u5730\u5740\u4e2d\uff0c\u4fee\u6539",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.filter.URLFilter"),"\uff0c\u5728orderFilterPath\u91cc\u6dfb\u52a0",(0,l.kt)("inlineCode",{parentName:"p"},"/api/worder/**"),"\u8fc7\u6ee4\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206091746759-f00abe96.png",alt:"image-20211206091746759"}),"image-20211206091746759"),(0,l.kt)("h4",{id:"132-\u4fe1\u606f\u67e5\u8be2-\u91cd\u70b9"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-2-%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2-%E9%87%8D%E7%82%B9"},"#"),"1.3.2 \u4fe1\u606f\u67e5\u8be2-\u91cd\u70b9"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a"),(0,l.kt)("p",null,"\u56e0\u4e3a\u4e00\u4f1a\u513f\u8981\u8c03\u7528ydles-service-user\u67e5\u8be2\u7528\u6237\u7684\u6536\u4ef6\u5730\u5740\u4fe1\u606f\uff0c\u8c03\u7528ydles-service-order\u67e5\u8be2\u8d2d\u7269\u8f66\u6e05\u5355\u4fe1\u606f\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u521b\u5efaFeign\u3002\u8d2d\u7269\u8f66\u7684Feign\u4e4b\u524d\u5df2\u7ecf\u521b\u5efa\u8fc7\u4e86\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u521b\u5efa\u7528\u6237\u5730\u5740\u76f8\u5173\u7684\u5373\u53ef\u3002"),(0,l.kt)("p",null,"(1)\u7528\u6237\u5730\u5740\u4fe1\u606f\u67e5\u8be2"),(0,l.kt)("p",null,"\u5728ydles-service-user-api\u4e2d\u521b\u5efaAddressFeign\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@FeignClient(name="user")\npublic interface AddressFeign {\n\n    /***\n     * \u67e5\u8be2\u7528\u6237\u7684\u6536\u4ef6\u5730\u5740\u4fe1\u606f\n     * @return\n     */\n    @GetMapping(value = "/list")\n    public Result<List<Address>> list();\n}\n')),(0,l.kt)("p",null,"(2) ydles_web_order\u9879\u76ee\u542f\u52a8\u7c7bOrderWebApplication\u52a0\u5165\u8c03\u7528\u7684feign\u5305"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>com.ydles</groupId>\n    <artifactId>ydles_service_user_api</artifactId>\n    <version>1.0-SNAPSHOT</version>\n</dependency>\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@SpringBootApplication\n@EnableEurekaClient\n@EnableFeignClients(basePackages = {"com.ydles.order.feign","com.ydles.user.feign"})\npublic class OrderWebApplication {\n')),(0,l.kt)("p",null,"(3)\u67e5\u8be2\u8d2d\u7269\u8f66\u548c\u7528\u6237\u6536\u4ef6\u5730\u5740\u4fe1\u606f"),(0,l.kt)("p",null,"\u4fee\u6539ydles-web-order\u4e2d\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.order.controller.OrderController"),"\u7684readyOrder\u65b9\u6cd5\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\uff0c\u4f7f\u7528feign\u8c03\u7528\u67e5\u8be2\u6536\u4ef6\u5730\u5740\u4fe1\u606f\u548c\u7528\u6237\u8d2d\u7269\u8f66\u4fe1\u606f\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Controller\n@RequestMapping("/worder")\npublic class OrderController {\n\n    @Autowired\n    private AddressFeign addressFeign;\n\n    @Autowired\n    private CartFeign cartFeign;\n\n    @RequestMapping("/ready/order")\n    public String readyOrder(Model model) {\n         //1\u6536\u4ef6\u4eba\u7684\u5730\u5740\u4fe1\u606f\n        List<Address> addressList = addressFeign.list().getData();\n        model.addAttribute("address",addressList);\n\n        //2\u8d2d\u7269\u8f66\u4fe1\u606f\n        Map map = cartFeign.list();\n        List<OrderItem> orderItemList = (List<OrderItem>) map.get("orderItemList");\n        Integer totalMoney = (Integer) map.get("totalMoney");\n        Integer totalNum = (Integer) map.get("totalNum");\n\n        model.addAttribute("carts",orderItemList);\n        model.addAttribute("totalMoney",totalMoney);\n        model.addAttribute("totalNum",totalNum);\n        return "order";\n    }\n}\n')),(0,l.kt)("p",null,"(3)\u6570\u636e\u56de\u663e-\u4e86\u89e3"),(0,l.kt)("p",null,"\u4fee\u6539order.html\uff0c\u4e0e\u9759\u6001\u539f\u578b\u4e2d\u7684order.html\u6253\u5f00\u5bf9\u6bd4\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<html xmlns:th="http://www.thymeleaf.org">\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div class="cart py-container" id="app">\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div class="choose-address" th:each="addr:${address}">\n    <div class="con name " th:@click="|chooseAddr(\'${addr.contact}\',\'${addr.phone}\',\'${addr.address}\')|" th:classappend="${addr.isDefault}==1?\'selected\':\'\'"><a href="javascript:;" ><em th:text="${addr.contact}"></em> <span title="\u70b9\u51fb\u53d6\u6d88\u9009\u62e9"></span></a></div>\n    <div class="con address">\n        <span class="place"><em th:text="${addr.address}"></em> </span>\n        <span class="phone"><em th:text="${addr.phone}"></em> </span>\n        <span class="base" th:if="${addr.isDefault}==1">\u9ed8\u8ba4\u5730\u5740</span>\n    </div>\n    <div class="clearfix"></div>\n</div>\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<ul class="payType">\n    <li class="selected" th:@click="|order.payType=1|">\u5728\u7ebf\u652f\u4ed8<span title="\u70b9\u51fb\u53d6\u6d88\u9009\u62e9"></span></li>\n    <li th:@click="|order.payType=0|">\u8d27\u5230\u4ed8\u6b3e<span title="\u70b9\u51fb\u53d6\u6d88\u9009\u62e9"></span></li>\n</ul>\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<ul class="yui3-g" th:each="cart,cartsList:${carts}">\n    <li class="yui3-u-1-9">\n        <span><img th:src="${cart.image}"/></span>\n    </li>\n    <li class="yui3-u-5-12">\n        <div class="desc" th:text="${cart.name}"></div>\n        <div class="seven">7\u5929\u65e0\u7406\u7531\u9000\u8d27</div>\n    </li>\n    <li class="yui3-u-1-12">\n        <div class="price" th:text="${cart.price}"></div>\n    </li>\n    <li class="yui3-u-1-12">\n        <div class="num" th:text="${cart.num}"></div>\n    </li>\n    <li class="yui3-u-1-12">\n        <div class="num" th:text="${cart.num}*${cart.price}"></div>\n    </li>\n    <li class="yui3-u-1-12">\n        <div class="exit">\u6709\u8d27</div>\n    </li>\n</ul>\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div class="fc-receiverInfo">\n    \u5bc4\u9001\u81f3:\n    <span id="receive-address">{{order.receiveAddress}}</span>\n    \u6536\u8d27\u4eba\uff1a<span id="receive-name">{{order.receiveContact}}</span>\n    <span id="receive-phone">{{order.receiveMobile}}</span>\n</div>\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div class="list">\n    <span><i class="number"><em th:text="${totalNum}"></em></i>\u4ef6\u5546\u54c1\uff0c\u5546\u54c1\u603b\u91d1\u989d</span>\n    <em class="allprice">\xa5<em th:text="${totalMoney}"></em></em>\n</div>\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div class="clearfix trade">\n    <div class="fc-price">\u5e94\u4ed8\u91d1\u989d:\u3000<span class="final-price">\xa5<em th:text="${totalMoney}"></em></span></div>\n</div>\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<script th:inline=\"javascript\">\n    var app = new Vue({\n        el:\"#app\",\n        data:{\n            order:{\n                'receiveContact': [[${deAddr.contact}]],\n                'receiveMobile': [[${deAddr.phone}]],\n        'receiveAddress': [[${deAddr.address}]],\n        'payType':1\n    }\n    },\n        methods:{\n            chooseAddr: function (contact,mobile,address){\n                app.$set(app.order,'receiveContact',contact);\n                app.$set(app.order,'receiveMobile',mobile);\n                app.$set(app.order,'receiveAddress',address);\n            }\n        }\n    })\n<\/script>\n")),(0,l.kt)("p",null,"\u6d4b\u8bd5\uff1a\u5148\u767b\u5f55\uff0c\u518d\u8bbf\u95ee"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/worder/ready/order"},"http://localhost:8001/api/worder/ready/orderopen in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206114046064-3cc7aec8.png",alt:"image-20211206114046064"}),"image-20211206114046064"),(0,l.kt)("h4",{id:"133-\u8bb0\u5f55\u9009\u4e2d\u6536\u4ef6\u4eba-\u4e86\u89e3"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-3-%E8%AE%B0%E5%BD%95%E9%80%89%E4%B8%AD%E6%94%B6%E4%BB%B6%E4%BA%BA-%E4%BA%86%E8%A7%A3"},"#"),"1.3.3 \u8bb0\u5f55\u9009\u4e2d\u6536\u4ef6\u4eba-\u4e86\u89e3"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6536\u4ef6\u4eba\u52a8\u6001\u5c55\u793a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'73 <div class="cart py-container" id="app">\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<script th:inline=\"javascript\">\n    var app = new Vue({\n        el:\"#app\",\n        data:{\n            order:{'receiveContact':[[${deAddr.contact}]],'receiveMobile':[[${deAddr.phone}]],'receiveAddress':[[${deAddr.address}]],'payType':1}\n    },\n        methods:{\n            chooseAddr:function (contact,mobile,address) {\n                app.$set(app.order,'receiveContact',contact);\n                app.$set(app.order,'receiveMobile',mobile);\n                app.$set(app.order,'receiveAddress',address);\n            },\n                add:function () {\n                    axios.post('/api/worder/add',this.order).then(function (response) {\n                        if (response.data.flag){\n                            //\u6dfb\u52a0\u8ba2\u5355\u6210\u529f\n                            alert(\"\u6dfb\u52a0\u8ba2\u5355\u6210\u529f\");\n                        } else{\n                            alert(\"\u6dfb\u52a0\u8ba2\u5355\u5931\u8d25\");\n                        }\n                    })\n                }\n        }\n    })\n<\/script>\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div class="clearfix trade">\n    <div class="fc-price">\u5e94\u4ed8\u91d1\u989d:\u3000<span class="price">\xa5<em th:text="${totalMoney}"></em></span></div>\n    <div class="fc-receiverInfo">\n        \u5bc4\u9001\u81f3:\n        <span id="receive-address">{{order.receiveAddress}}</span>\n        \u6536\u8d27\u4eba\uff1a<span id="receive-name">{{order.receiveContact}}</span>\n        <span id="receive-phone">{{order.receiveMobile}}</span>\n    </div>\n</div>\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u540e\u7aef\u8bbe\u7f6e\u9ed8\u8ba4\u6536\u4ef6\u4eba")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'//\u9ed8\u8ba4\u6536\u4ef6\u4eba\u4fe1\u606f\nfor (Address address : addressList) {\n    if ("1".equals(address.getIsDefault())){\n        //\u9ed8\u8ba4\u6536\u4ef6\u4eba\n        model.addAttribute("deAddr",address);\n        break;\n    }\n}\n')),(0,l.kt)("p",null,"\u524d\u7aef\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"order:{'receiveContact':[[${deAddr.contact}]],'receiveMobile':[[${deAddr.phone}]],'receiveAddress':[[${deAddr.address}]],'payType':1}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u652f\u4ed8\u65b9\u5f0f")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div class="step-cont">\n    <ul class="payType">\n        <li class="selected" th:@click="|order.payType=1|">\u5728\u7ebf\u652f\u4ed8<span title="\u70b9\u51fb\u53d6\u6d88\u9009\u62e9"></span></li>\n        <li th:@click="|order.payType=0|">\u8d27\u5230\u4ed8\u6b3e<span title="\u70b9\u51fb\u53d6\u6d88\u9009\u62e9"></span></li>\n    </ul>\n</div>\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u8d2d\u7269\u8f66\u8df3\u8f6c\u7ed3\u7b97\u9875\u9762")),(0,l.kt)("p",null,"cart.html"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<a class="sum-btn" href="/api/worder/ready/order" target="_blank">\u7ed3\u7b97</a>\n')),(0,l.kt)("h2",{id:"2-\u4e0b\u5355-\u91cd\u70b9"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-%E4%B8%8B%E5%8D%95-%E9%87%8D%E7%82%B9"},"#"),"2 \u4e0b\u5355-\u91cd\u70b9"),(0,l.kt)("h3",{id:"21-\u4e1a\u52a1\u5206\u6790"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-1-%E4%B8%9A%E5%8A%A1%E5%88%86%E6%9E%90"},"#"),"2.1 \u4e1a\u52a1\u5206\u6790"),(0,l.kt)("p",null,"\u70b9\u51fb\u63d0\u4ea4\u8ba2\u5355\u7684\u65f6\u5019\uff0c\u4f1a\u7acb\u5373\u521b\u5efa\u8ba2\u5355\u6570\u636e\uff0c\u521b\u5efa\u8ba2\u5355\u6570\u636e\u4f1a\u5c06\u6570\u636e\u5b58\u5165\u52302\u5f20\u8868\u4e2d\uff0c\u5206\u522b\u662f\u8ba2\u5355\u8868\u548c\u8ba2\u5355\u660e\u7ec6\u8868\uff0c\u6b64\u5904\u8fd8\u9700\u8981\u4fee\u6539\u5546\u54c1\u5bf9\u5e94\u7684\u5e93\u5b58\u6570\u91cf\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206121803107-65dbc923.png",alt:"image-20211206121803107"}),"image-20211206121803107"),(0,l.kt)("p",null,"\u8ba2\u5355\u8868\u7ed3\u6784\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE `tb_order` (\n    `id` varchar(50) COLLATE utf8_bin NOT NULL COMMENT '\u8ba2\u5355id',\n    `total_num` int(11) DEFAULT NULL COMMENT '\u6570\u91cf\u5408\u8ba1',\n    `total_money` int(11) DEFAULT NULL COMMENT '\u91d1\u989d\u5408\u8ba1',\n    `pre_money` int(11) DEFAULT NULL COMMENT '\u4f18\u60e0\u91d1\u989d',\n    `post_fee` int(11) DEFAULT NULL COMMENT '\u90ae\u8d39',\n    `pay_money` int(11) DEFAULT NULL COMMENT '\u5b9e\u4ed8\u91d1\u989d',\n    `pay_type` varchar(1) COLLATE utf8_bin DEFAULT NULL COMMENT '\u652f\u4ed8\u7c7b\u578b\uff0c1\u3001\u5728\u7ebf\u652f\u4ed8\u30010 \u8d27\u5230\u4ed8\u6b3e',\n    `create_time` datetime DEFAULT NULL COMMENT '\u8ba2\u5355\u521b\u5efa\u65f6\u95f4',\n    `update_time` datetime DEFAULT NULL COMMENT '\u8ba2\u5355\u66f4\u65b0\u65f6\u95f4',\n    `pay_time` datetime DEFAULT NULL COMMENT '\u4ed8\u6b3e\u65f6\u95f4',\n    `consign_time` datetime DEFAULT NULL COMMENT '\u53d1\u8d27\u65f6\u95f4',\n    `end_time` datetime DEFAULT NULL COMMENT '\u4ea4\u6613\u5b8c\u6210\u65f6\u95f4',\n    `close_time` datetime DEFAULT NULL COMMENT '\u4ea4\u6613\u5173\u95ed\u65f6\u95f4',\n    `shipping_name` varchar(20) COLLATE utf8_bin DEFAULT NULL COMMENT '\u7269\u6d41\u540d\u79f0',\n    `shipping_code` varchar(20) COLLATE utf8_bin DEFAULT NULL COMMENT '\u7269\u6d41\u5355\u53f7',\n    `username` varchar(50) COLLATE utf8_bin DEFAULT NULL COMMENT '\u7528\u6237\u540d\u79f0',\n    `buyer_message` varchar(1000) COLLATE utf8_bin DEFAULT NULL COMMENT '\u4e70\u5bb6\u7559\u8a00',\n    `buyer_rate` char(1) COLLATE utf8_bin DEFAULT NULL COMMENT '\u662f\u5426\u8bc4\u4ef7',\n    `receiver_contact` varchar(50) COLLATE utf8_bin DEFAULT NULL COMMENT '\u6536\u8d27\u4eba',\n    `receiver_mobile` varchar(12) COLLATE utf8_bin DEFAULT NULL COMMENT '\u6536\u8d27\u4eba\u624b\u673a',\n    `receiver_address` varchar(200) COLLATE utf8_bin DEFAULT NULL COMMENT '\u6536\u8d27\u4eba\u5730\u5740',\n    `source_type` char(1) COLLATE utf8_bin DEFAULT NULL COMMENT '\u8ba2\u5355\u6765\u6e90\uff1a1:web\uff0c2\uff1aapp\uff0c3\uff1a\u5fae\u4fe1\u516c\u4f17\u53f7\uff0c4\uff1a\u5fae\u4fe1\u5c0f\u7a0b\u5e8f  5 H5\u624b\u673a\u9875\u9762',\n    `transaction_id` varchar(30) COLLATE utf8_bin DEFAULT NULL COMMENT '\u4ea4\u6613\u6d41\u6c34\u53f7',\n    `order_status` char(1) COLLATE utf8_bin DEFAULT NULL COMMENT '\u8ba2\u5355\u72b6\u6001,0:\u672a\u5b8c\u6210,1:\u5df2\u5b8c\u6210\uff0c2\uff1a\u5df2\u9000\u8d27',\n    `pay_status` char(1) COLLATE utf8_bin DEFAULT NULL COMMENT '\u652f\u4ed8\u72b6\u6001,0:\u672a\u652f\u4ed8\uff0c1\uff1a\u5df2\u652f\u4ed8\uff0c2\uff1a\u652f\u4ed8\u5931\u8d25',\n    `consign_status` char(1) COLLATE utf8_bin DEFAULT NULL COMMENT '\u53d1\u8d27\u72b6\u6001,0:\u672a\u53d1\u8d27\uff0c1\uff1a\u5df2\u53d1\u8d27\uff0c2\uff1a\u5df2\u6536\u8d27',\n    `is_delete` char(1) COLLATE utf8_bin DEFAULT NULL COMMENT '\u662f\u5426\u5220\u9664',\n    PRIMARY KEY (`id`),\n    KEY `create_time` (`create_time`),\n    KEY `status` (`order_status`),\n    KEY `payment_type` (`pay_type`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;\n")),(0,l.kt)("p",null,"\u8ba2\u5355\u660e\u7ec6\u8868\u7ed3\u6784\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE `tb_order_item` (\n    `id` varchar(50) COLLATE utf8_bin NOT NULL COMMENT 'ID',\n    `category_id1` int(11) DEFAULT NULL COMMENT '1\u7ea7\u5206\u7c7b',\n    `category_id2` int(11) DEFAULT NULL COMMENT '2\u7ea7\u5206\u7c7b',\n    `category_id3` int(11) DEFAULT NULL COMMENT '3\u7ea7\u5206\u7c7b',\n    `spu_id` varchar(20) COLLATE utf8_bin DEFAULT NULL COMMENT 'SPU_ID',\n    `sku_id` bigint(20) NOT NULL COMMENT 'SKU_ID',\n    `order_id` bigint(20) NOT NULL COMMENT '\u8ba2\u5355ID',\n    `name` varchar(200) COLLATE utf8_bin DEFAULT NULL COMMENT '\u5546\u54c1\u540d\u79f0',\n    `price` int(20) DEFAULT NULL COMMENT '\u5355\u4ef7',\n    `num` int(10) DEFAULT NULL COMMENT '\u6570\u91cf',\n    `money` int(20) DEFAULT NULL COMMENT '\u603b\u91d1\u989d',\n    `pay_money` int(11) DEFAULT NULL COMMENT '\u5b9e\u4ed8\u91d1\u989d',\n    `image` varchar(200) COLLATE utf8_bin DEFAULT NULL COMMENT '\u56fe\u7247\u5730\u5740',\n    `weight` int(11) DEFAULT NULL COMMENT '\u91cd\u91cf',\n    `post_fee` int(11) DEFAULT NULL COMMENT '\u8fd0\u8d39',\n    `is_return` char(1) COLLATE utf8_bin DEFAULT NULL COMMENT '\u662f\u5426\u9000\u8d27,0:\u672a\u9000\u8d27\uff0c1\uff1a\u5df2\u9000\u8d27',\n    PRIMARY KEY (`id`),\n    KEY `item_id` (`sku_id`),\n    KEY `order_id` (`order_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;\n")),(0,l.kt)("h3",{id:"22-\u4e0b\u5355\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-%E4%B8%8B%E5%8D%95%E5%AE%9E%E7%8E%B0"},"#"),"2.2 \u4e0b\u5355\u5b9e\u73b0"),(0,l.kt)("p",null,"\u4e0b\u5355\u7684\u65f6\u5019\uff0c\u5148\u5f80tb_order\u8868\u4e2d\u589e\u52a0\u6570\u636e\uff0c\u518d\u5f80tb_order_item\u8868\u4e2d\u589e\u52a0\u6570\u636e\u3002"),(0,l.kt)("h4",{id:"221-\u4ee3\u7801\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-1-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"},"#"),"2.2.1 \u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("p",null,"\u8fd9\u91cc\u5148\u4fee\u6539ydles-service-order\u5fae\u670d\u52a1\uff0c\u5b9e\u73b0\u4e0b\u5355\u64cd\u4f5c\uff0c\u8fd9\u91cc\u4f1a\u751f\u6210\u8ba2\u5355\u53f7\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u5728\u542f\u52a8\u7c7b\u4e2d\u521b\u5efa\u4e00\u4e2aIdWorker\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.OrderApplication"),"\u4e2d\u521b\u5efaIdWorker\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Bean\npublic IdWorker idWorker() {\n    return new IdWorker(workerId, datacenterId);\n}\n")),(0,l.kt)("p",null,"(1)\u4e1a\u52a1\u5c42"),(0,l.kt)("p",null,"\u5b9e\u73b0\u903b\u8f91\uff1a"),(0,l.kt)("p",null,"1\uff09\u83b7\u53d6\u6240\u6709\u8d2d\u7269\u8f66"),(0,l.kt)("p",null,"2\uff09\u7edf\u8ba1\u8ba1\u7b97\uff1a\u603b\u91d1\u989d\uff0c\u603b\u652f\u4ed8\u91d1\u989d\uff0c\u603b\u6570\u91cf"),(0,l.kt)("p",null,"3\uff09\u586b\u5145\u8ba2\u5355\u6570\u636e\u5e76\u4fdd\u5b58"),(0,l.kt)("p",null,"4\uff09\u83b7\u53d6\u6bcf\u4e00\u4e2a\u8d2d\u7269\u9879\u4fdd\u5b58\u5230orderItem"),(0,l.kt)("p",null,"5\uff09\u5220\u9664\u8d2d\u7269\u8f66\u4e2d\u6570\u636e"),(0,l.kt)("p",null,"\u4fee\u6539\u8ba2\u5355\u5fae\u670d\u52a1\u6dfb\u52a0com.ydles.order.service.impl.OrderServiceImpl,\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n     * \u4e0b\u5355\n     * @param order\n     * \u7f3a\u5565\u8865\u5565\n     */\n@Override\npublic boolean add(Order order){\n    //1 \u83b7\u53d6 \u8d2d\u7269\u8f66\u4fe1\u606f\n    Map cartMap = cartService.list(order.getUsername());\n    //map.put("orderItemList",orderItemList);\n    Integer totalNum = (Integer) cartMap.get("totalNum");\n    Integer totalMoney = (Integer) cartMap.get("totalMoney");\n\n    //2 order\u8868\u91cc\u5b58\u6570\u636e\n    String orderId = idWorker.nextId()+"";\n    order.setId(orderId);\n    order.setTotalNum(totalNum);\n    order.setTotalMoney(totalMoney);\n    //\u4f5c\u4e1a\uff1a\u4f18\u60e0\u91d1\u989d \u600e\u4e48\u7b97      \u672c\u5e97\u6ee150-5 \u8de8\u5e97 300-50\n    //\u4f5c\u4e1a\uff1a\u90ae\u8d39\u91d1\u989d \u600e\u4e48\u7b97\n    order.setPayMoney(totalMoney);\n    order.setCreateTime(new Date());\n    order.setUpdateTime(new Date());\n    //\u4f5c\u4e1a\uff1a\u4e70\u5bb6\u7559\u8a00\n    order.setBuyerRate("0");\n    order.setSourceType("1");\n    order.setOrderStatus("0");\n    order.setPayStatus("0");\n    order.setConsignStatus("0");\n    order.setIsDelete("0");\n\n    orderMapper.insertSelective(order);\n\n    //3 orderItem\u8868\u91cc\u5b58\u6570\u636e\n    List<OrderItem> orderItemList = (List<OrderItem>) cartMap.get("orderItemList");\n    for (OrderItem orderItem : orderItemList) {\n        orderItem.setOrderId(orderId);\n        orderItem.setPostFee(0);\n        orderItem.setIsReturn("0");\n        orderItemMapper.insertSelective(orderItem);\n    }\n\n    //4 \u5220\u9664\u8d2d\u7269\u8f66\u4fe1\u606f\n    stringRedisTemplate.delete(CART+order.getUsername());\n\n    return true;\n}\n')),(0,l.kt)("p",null,"(2)\u63a7\u5236\u5c42"),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-order\u5fae\u670d\u52a1\uff0c\u4fee\u6539com.ydles.order.controller.OrderController\u7c7b\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Autowired\nTokenDecode tokenDecode;\n\n/***\n     * \u4e0b\u5355\n     * @param order\n     * @return\n     */\n@PostMapping\npublic Result add(@RequestBody Order order){\n    String username = tokenDecode.getUserInfo().get("username");\n    order.setUsername(username);\n\n    orderService.add(order);\n    return new Result(true,StatusCode.OK,"\u6dfb\u52a0\u6210\u529f");\n}\n')),(0,l.kt)("h4",{id:"222-\u6e32\u67d3\u670d\u52a1\u5bf9\u63a5"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-2-%E6%B8%B2%E6%9F%93%E6%9C%8D%E5%8A%A1%E5%AF%B9%E6%8E%A5"},"#"),"2.2.2 \u6e32\u67d3\u670d\u52a1\u5bf9\u63a5"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206121803107-65dbc923.png",alt:"image-20211206142024505"}),"image-20211206142024505"),(0,l.kt)("p",null,"\u6211\u4eec\u9700\u8981\u5728\u6a21\u677f\u6e32\u67d3\u7aef\u8c03\u7528\u8ba2\u5355\u5fae\u670d\u52a1\u5b9e\u73b0\u4e0b\u5355\u64cd\u4f5c,\u4e0b\u5355\u64cd\u4f5c\u9700\u8981\u8c03\u7528\u8ba2\u5355\u5fae\u670d\u52a1\uff0c\u6240\u4ee5\u9700\u8981\u521b\u5efa\u5bf9\u5e94\u7684Feign\u3002"),(0,l.kt)("p",null,"(1)Feign\u521b\u5efa"),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-order-api\uff0c\u6dfb\u52a0OrderFeign\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@FeignClient(name = "order")\npublic interface OrderFeign {\n\n    @PostMapping("/order")\n    public Result add(@RequestBody Order order);\n}\n')),(0,l.kt)("p",null,"(2)\u4e0b\u5355\u8c03\u7528"),(0,l.kt)("p",null,"\u4fee\u6539ydles-web-order\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.order.controller.OrderController"),"\u6dfb\u52a0\u4e0b\u5355\u65b9\u6cd5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Autowired\nprivate OrderFeign orderFeign;\n\n@PostMapping("/add")\n@ResponseBody\npublic Result add(@RequestBody Order order){\n    Result result = orderFeign.add(order);\n    return result;\n}\n')),(0,l.kt)("p",null,"(3)\u9875\u9762\u8c03\u7528"),(0,l.kt)("p",null,"order.html"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'add:function () {\n    axios.post(\'/api/worder/add\',this.order).then(function (response) {\n        if (response.data.flag){\n            //\u6dfb\u52a0\u8ba2\u5355\u6210\u529f\n            alert("\u6dfb\u52a0\u8ba2\u5355\u6210\u529f");\n        } else{\n            alert("\u6dfb\u52a0\u8ba2\u5355\u5931\u8d25");\n        }\n    })\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<a class="sui-btn btn-danger btn-xlarge" href="javascript:void(0)" @click="add()">\u63d0\u4ea4\u8ba2\u5355</a>\n')),(0,l.kt)("p",null,"\u70b9\u51fb\u63d0\u4ea4\u8ba2\u5355\u8c03\u7528"),(0,l.kt)("p",null,"\u4fdd\u5b58\u8ba2\u5355\u6d4b\u8bd5\uff0c\u8868\u6570\u636e\u53d8\u5316\u5982\u4e0b\uff1a"),(0,l.kt)("p",null,"tb_order\u8868\u6570\u636e\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206143109177-1a498af3.png",alt:"image-20211206143109177"}),"image-20211206143109177"),(0,l.kt)("p",null,"tb_order_item\u8868\u6570\u636e\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206143122426-df5ec577.png",alt:"image-20211206143122426"}),"image-20211206143122426"),(0,l.kt)("h3",{id:"23-\u5e93\u5b58\u53d8\u66f4"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-%E5%BA%93%E5%AD%98%E5%8F%98%E6%9B%B4"},"#"),"2.3 \u5e93\u5b58\u53d8\u66f4"),(0,l.kt)("h4",{id:"231-\u4e1a\u52a1\u5206\u6790"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-1-%E4%B8%9A%E5%8A%A1%E5%88%86%E6%9E%90"},"#"),"2.3.1 \u4e1a\u52a1\u5206\u6790"),(0,l.kt)("p",null,"\u4e0a\u9762\u64cd\u4f5c\u53ea\u5b9e\u73b0\u4e86\u4e0b\u5355\u64cd\u4f5c\uff0c\u4f46\u5bf9\u5e94\u7684\u5e93\u5b58\u8fd8\u6ca1\u8ddf\u7740\u4e00\u8d77\u51cf\u5c11\uff0c\u6211\u4eec\u5728\u4e0b\u5355\u4e4b\u540e\uff0c\u5e94\u8be5\u8c03\u7528\u5546\u54c1\u5fae\u670d\u52a1\uff0c\u5c06\u4e0b\u5355\u7684\u5546\u54c1\u5e93\u5b58\u51cf\u5c11\uff0c\u9500\u91cf\u589e\u52a0\u3002\u6bcf\u6b21\u8ba2\u5355\u5fae\u670d\u52a1\u53ea\u9700\u8981\u5c06\u7528\u6237\u540d\u4f20\u5230\u5546\u54c1\u5fae\u670d\u52a1\uff0c\u5546\u54c1\u5fae\u670d\u52a1\u901a\u8fc7\u7528\u6237\u540d\u5230Redis\u4e2d\u67e5\u8be2\u5bf9\u5e94\u7684\u8d2d\u7269\u8f66\u6570\u636e\uff0c\u7136\u540e\u6267\u884c\u5e93\u5b58\u51cf\u5c11\uff0c\u5e93\u5b58\u51cf\u5c11\u9700\u8981\u63a7\u5236\u5f53\u524d\u5546\u54c1\u5e93\u5b58>=\u9500\u552e\u6570\u91cf\u3002"),(0,l.kt)("p",null,"\u5982\u4f55\u63a7\u5236\u5e93\u5b58\u6570\u91cf>=\u8d2d\u4e70\u6570\u91cf\u5462\uff1f\u5176\u5b9e\u53ef\u4ee5\u901a\u8fc7SQL\u8bed\u53e5\u5b9e\u73b0\uff0c\u6bcf\u6b21\u51cf\u5c11\u6570\u91cf\u4e4b\u524d\uff0c\u52a0\u4e2a\u6761\u4ef6\u5224\u65ad\u3002"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"where num>=#{num}"),"\u5373\u53ef\u3002"),(0,l.kt)("p",null,"\u5546\u54c1\u670d\u52a1\u9700\u8981\u67e5\u8be2\u8d2d\u7269\u8f66\u6570\u636e\uff0c\u6240\u4ee5\u9700\u8981\u5f15\u5165\u8ba2\u5355\u7684api\uff0c\u5728pom.xml\u4e2d\u6dfb\u52a0\u5982\u4e0b\u4f9d\u8d56\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"\x3c!--order api \u4f9d\u8d56--\x3e\n<dependency>\n    <groupId>com.ydles</groupId>\n    <artifactId>ydles_service_order_api</artifactId>\n    <version>1.0-SNAPSHOT</version>\n</dependency>\n")),(0,l.kt)("h4",{id:"232-\u4ee3\u7801\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"},"#"),"2.3.2 \u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("p",null,"\u8981\u8c03\u7528\u5176\u4ed6\u5fae\u670d\u52a1\uff0c\u9700\u8981\u5c06\u5934\u6587\u4ef6\u4e2d\u7684\u4ee4\u724c\u6570\u636e\u643a\u5e26\u5230\u5176\u4ed6\u5fae\u670d\u52a1\u4e2d\u53d6\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u4f7f\u7528hystrix\u7684\u591a\u7ebf\u7a0b\u6a21\u5f0f\uff0c\u4fee\u6539ydles-service-order\u7684applicatin.yml\u914d\u7f6e\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-properties"},"#hystrix \u914d\u7f6e\nhystrix:\n  command:\n    default:\n      execution:\n        isolation:\n          thread:\n            timeoutInMilliseconds: 10000\n          strategy: SEMAPHORE\n")),(0,l.kt)("p",null,"\u6bcf\u6b21\u8fd8\u9700\u8981\u4f7f\u7528\u62e6\u622a\u5668\u6dfb\u52a0\u5934\u6587\u4ef6\u4fe1\u606f\uff0c\u6dfb\u52a0\u62e6\u622a\u5668\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("p",null,"(1)Dao\u5c42"),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-goods\u5fae\u670d\u52a1\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.goods.dao.SkuMapper"),"\u63a5\u53e3\uff0c\u589e\u52a0\u5e93\u5b58\u9012\u51cf\u65b9\u6cd5,\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u9012\u51cf\u5e93\u5b58\n * @param orderItem\n * @return\n */\n@Update("UPDATE tb_sku SET num=num-#{num},sale_num=sale_num+#{num} WHERE id=#{skuId} AND num>=#{num}")\nint decrCount(OrderItem orderItem);\n')),(0,l.kt)("p",null,"(2)\u4e1a\u52a1\u5c42"),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-goods\u5fae\u670d\u52a1\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.goods.service.SkuService"),"\u63a5\u53e3\uff0c\u6dfb\u52a0\u5982\u4e0b\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/***\n * \u5e93\u5b58\u9012\u51cf\n * @param username\n */\nvoid decrCount(String username);\n")),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-goods\u5fae\u670d\u52a1\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.goods.service.impl.SkuServiceImpl"),"\u5b9e\u73b0\u7c7b\uff0c\u6dfb\u52a0\u4e00\u4e2a\u5b9e\u73b0\u65b9\u6cd5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Autowired\nprivate RedisTemplate redisTemplate;\n\n/***\n * \u5e93\u5b58\u9012\u51cf\n * @param username\n */\n@Override\npublic void decrCount(String username) {\n    //\u83b7\u53d6\u8d2d\u7269\u8f66\u6570\u636e\n    List<OrderItem> orderItems = redisTemplate.boundHashOps("Cart_" + username).values();\n\n    //\u5faa\u73af\u9012\u51cf\n    for (OrderItem orderItem : orderItems) {\n        //\u9012\u51cf\u5e93\u5b58\n        int count = skuMapper.decrCount(orderItem);\n        if(count<=0){\n            throw new RuntimeException("\u5e93\u5b58\u4e0d\u8db3\uff0c\u9012\u51cf\u5931\u8d25\uff01");\n        }\n    }\n}\n')),(0,l.kt)("p",null,"(3)\u63a7\u5236\u5c42"),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-goods\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.goods.controller.SkuController"),"\u7c7b\uff0c\u6dfb\u52a0\u5e93\u5b58\u9012\u51cf\u65b9\u6cd5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/***\n * \u5e93\u5b58\u9012\u51cf\n * @param username\n * @return\n */\n@PostMapping(value = "/decr/count")\npublic Result decrCount(@RequestParam("username") String username){\n    //\u5e93\u5b58\u9012\u51cf\n    skuService.decrCount(username);\n    return new Result(true,StatusCode.OK,"\u5e93\u5b58\u9012\u51cf\u6210\u529f\uff01");\n}\n')),(0,l.kt)("p",null,"(4)\u521b\u5efafeign"),(0,l.kt)("p",null,"\u540c\u65f6\u5728ydles-service-goods-api\u5de5\u7a0b\u6dfb\u52a0",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.goods.feign.SkuFeign"),"\u7684\u5b9e\u73b0\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/***\n * \u5e93\u5b58\u9012\u51cf\n * @param username\n * @return\n */\n@PostMapping(value = "/decr/count")\nResult decrCount(@RequestParam(value = "username") String username);\n')),(0,l.kt)("h4",{id:"233-\u8c03\u7528\u5e93\u5b58\u9012\u51cf"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-3-%E8%B0%83%E7%94%A8%E5%BA%93%E5%AD%98%E9%80%92%E5%87%8F"},"#"),"2.3.3 \u8c03\u7528\u5e93\u5b58\u9012\u51cf"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a"),(0,l.kt)("p",null,"ydles_service_order\u670d\u52a1\u8c03\u7528 ydles_service_goods\u670d\u52a1, ydles_web_order\u670d\u52a1\u7684Application\u542f\u52a8\u7c7b"),(0,l.kt)("p",null,"\u90fd\u9700\u8981\u6dfb\u52a0\u4e0b\u9762\u62e6\u622a\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Bean\npublic FeignInterceptor feignInterceptor(){\n    return new FeignInterceptor();\n}\n")),(0,l.kt)("p",null,"ydles_service_goods\u52a0\u5165\u914d\u7f6e\u4fe1\u606f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"spring:\n  application:\n    name: goods\n  redis:\n    host: 192.168.200.128\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u8c03\u7528\u5e93\u5b58\u9012\u51cf")),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-order\u5fae\u670d\u52a1\u7684com.ydles.order.service.impl.OrderServiceImpl\u7c7b\u7684add\u65b9\u6cd5\uff0c\u589e\u52a0\u5e93\u5b58\u9012\u51cf\u7684\u8c03\u7528\u3002"),(0,l.kt)("p",null,"\u5148\u6ce8\u5165SkuFeign"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Autowired\nprivate SkuFeign skuFeign;\n")),(0,l.kt)("p",null,"\u518d\u8c03\u7528\u5e93\u5b58\u9012\u51cf\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"//\u5e93\u5b58\u51cf\u5e93\u5b58\nskuFeign.decrCount(order.getUsername());\n")),(0,l.kt)("p",null,"\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u589e\u52a0\n * @param order\n */\n@Override\npublic Boolean add(Order order){\n    //\u67e5\u8be2\u51fa\u7528\u6237\u7684\u6240\u6709\u8d2d\u7269\u8f66\n    Map orderItemMap = cartService.list(order.getUsername());\n\n    //\u7edf\u8ba1\u8ba1\u7b97\n    Integer totalMoney = Integer.parseInt(String.valueOf(orderItemMap.get("totalPrice")));\n    Integer num = Integer.parseInt(String.valueOf(orderItemMap.get("totalNum")));\n\n    //\u8d2d\u4e70\u5546\u54c1\u6570\u91cf\n    order.setTotalNum(num);\n    //\u8d2d\u4e70\u91d1\u989d\n    order.setTotalMoney(totalMoney);\n    //\u652f\u4ed8\u91d1\u989d\n    order.setPayMoney(totalMoney);\n    //\u4f18\u60e0\u91d1\u989d\n    order.setPreMoney(totalMoney);\n\n    //\u5176\u4ed6\u6570\u636e\u5b8c\u5584\n    order.setCreateTime(new Date());\n    order.setUpdateTime(order.getCreateTime());\n    order.setBuyerRate("0");        //0:\u672a\u8bc4\u4ef7\uff0c1\uff1a\u5df2\u8bc4\u4ef7\n    order.setSourceType("1");       //\u6765\u6e90\uff0c1\uff1aWEB\n    order.setOrderStatus("0");      //0:\u672a\u5b8c\u6210,1:\u5df2\u5b8c\u6210\uff0c2\uff1a\u5df2\u9000\u8d27\n    order.setPayStatus("0");        //0:\u672a\u652f\u4ed8\uff0c1\uff1a\u5df2\u652f\u4ed8\uff0c2\uff1a\u652f\u4ed8\u5931\u8d25\n    order.setConsignStatus("0");    //0:\u672a\u53d1\u8d27\uff0c1\uff1a\u5df2\u53d1\u8d27\uff0c2\uff1a\u5df2\u6536\u8d27\n    order.setId(idWorker.nextId());\n    int count = orderMapper.insertSelective(order);\n\n    //\u4fdd\u5b58\u5f85\u652f\u4ed8\u8ba2\u5355\u5230redis\u4e2d\n    redisTemplate.boundValueOps(Constants.ORDER_PAY + order.getUsername()).set(order);\n    \n    //\u6dfb\u52a0\u8ba2\u5355\u660e\u7ec6\n    List<OrderItem> orderItemList = (List<OrderItem>)orderItemMap.get("orderItemList");\n    for (OrderItem orderItem : orderItemList) {\n        orderItem.setId(idWorker.nextId());\n        orderItem.setIsReturn("0");\n        orderItem.setOrderId(order.getId());\n        orderItemMapper.insertSelective(orderItem);\n    }\n\n    //\u6263\u51cf\u5e93\u5b58\n    skuFeign.decrCount(order.getUsername());\n\n    //\u6e05\u9664Redis\u7f13\u5b58\u8d2d\u7269\u8f66\u6570\u636e\n    redisTemplate.delete("Cart_"+order.getUsername());\n    return true;\n}\n')),(0,l.kt)("h4",{id:"\u6d4b\u8bd5"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E6%B5%8B%E8%AF%95"},"#"),"\u6d4b\u8bd5"),(0,l.kt)("p",null,"1\u8d2d\u7269\u8f66\u6dfb\u52a0\u5546\u54c1"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/add?skuId=1450862568724758528&num=5"},"http://localhost:8001/api/wcart/add?skuId=1450862568724758528&num=5open in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206152606093-8f79cdb1.png",alt:"image-20211206152606093"}),"image-20211206152606093"),(0,l.kt)("p",null,"2\u67e5\u770b\u8d2d\u7269\u8f66"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/list"},"http://localhost:8001/api/wcart/listopen in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206152627024-ef696722.png",alt:"image-20211206152627024"}),"image-20211206152627024"),(0,l.kt)("p",null,"3\u70b9\u51fb\u7ed3\u7b97"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206152646505-8b258555.png",alt:"image-20211206152646505"}),"image-20211206152646505"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206152654362-19689c7c.png",alt:"image-20211206152654362"}),"image-20211206152654362"),(0,l.kt)("p",null,"4\u70b9\u51fb\u63d0\u4ea4\u8ba2\u5355"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206152743660-153c1b1c.png",alt:"image-20211206152743660"}),"image-20211206152743660"),(0,l.kt)("p",null,"tb_order \u6709\u6570\u636e"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206152848108-da521fd6.png",alt:"image-20211206152848108"}),"image-20211206152848108"),(0,l.kt)("p",null,"tb_order_item\u4e5f\u6709\u6570\u636e"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206152906228-365a41ac.png",alt:"image-20211206152906228"}),"image-20211206152906228"),(0,l.kt)("p",null,"tb_sku\u8868\u67e5\u770b\u5e93\u5b58\u548c\u9500\u91cf\u662f\u5426\u66f4\u6539"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206152831101-841c5709.png",alt:"image-20211206152831101"}),"image-20211206152831101"),(0,l.kt)("p",null,"\u5e93\u5b58\u51cf\u5c11\u524d\uff0c\u67e5\u8be2\u6570\u636e\u5e93Sku\u6570\u636e\u5982\u4e0b\uff1a95\u5e93\u5b58\uff0c5\u9500\u91cf \u5e93\u5b5894\uff0c\u9500\u91cf6"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206152957078-0326cc88.png",alt:"image-20211206152957078"}),"image-20211206152957078"),(0,l.kt)("h3",{id:"24-\u589e\u52a0\u79ef\u5206\u5b66\u5458\u7ec3\u4e60"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-4-%E5%A2%9E%E5%8A%A0%E7%A7%AF%E5%88%86-%E5%AD%A6%E5%91%98%E7%BB%83%E4%B9%A0"},"#"),"2.4 \u589e\u52a0\u79ef\u5206(\u5b66\u5458\u7ec3\u4e60)"),(0,l.kt)("p",null,"tb_user\u8868"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"`points` int(11) DEFAULT NULL COMMENT '\u79ef\u5206',\n")),(0,l.kt)("p",null,"\u9700\u6c42\uff1a"),(0,l.kt)("p",null,"\u5728\u589e\u52a0\u8ba2\u5355\u7684\u65f6\u5019\uff0c\u540c\u65f6\u6dfb\u52a0\u7528\u6237\u79ef\u5206\u3002\u4e0e\u51cf\u5e93\u5b58\u9053\u7406\u76f8\u540c\u3002"),(0,l.kt)("p",null,"(1)dao\u5c42"),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-user\u5fae\u670d\u52a1\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.user.dao.UserMapper"),"\u63a5\u53e3\uff0c\u589e\u52a0\u7528\u6237\u79ef\u5206\u65b9\u6cd5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/***\n * \u589e\u52a0\u7528\u6237\u79ef\u5206\n * @param username\n * @param pint\n * @return\n */\n@Update("UPDATE tb_user SET points=points+#{point} WHERE  username=#{username}")\nint addUserPoints(@Param("username") String username, @Param("point") Integer pint);\n')),(0,l.kt)("p",null,"(2)\u4e1a\u52a1\u5c42"),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-user\u5fae\u670d\u52a1\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.user.service.UserService"),"\u63a5\u53e3\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/***\n * \u6dfb\u52a0\u7528\u6237\u79ef\u5206\n * @param username\n * @param pint\n * @return\n */\nint addUserPoints(String username,Integer pint);\n")),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-user\u5fae\u670d\u52a1\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.user.service.impl.UserServiceImpl"),"\uff0c\u589e\u52a0\u6dfb\u52a0\u79ef\u5206\u65b9\u6cd5\u5b9e\u73b0\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/***\n * \u4fee\u6539\u7528\u6237\u79ef\u5206\n * @param username\n * @param pint\n * @return\n */\n@Override\npublic int addUserPoints(String username, Integer pint) {\n    return userMapper.addUserPoints(username,pint);\n}\n")),(0,l.kt)("p",null,"(3)\u63a7\u5236\u5c42"),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-user\u5fae\u670d\u52a1\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.user.controller.UserController"),"\uff0c\u6dfb\u52a0\u589e\u52a0\u7528\u6237\u79ef\u5206\u65b9\u6cd5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Autowired\nprivate TokenDecode tokenDecode;\n\n/***\n * \u589e\u52a0\u7528\u6237\u79ef\u5206\n * @param points:\u8981\u6dfb\u52a0\u7684\u79ef\u5206\n */\n@GetMapping(value = "/points/add")\npublic Result addPoints(Integer points){\n    //\u83b7\u53d6\u7528\u6237\u540d\n    Map<String, String> userMap = tokenDecode.getUserInfo();\n    String username = userMap.get("username");\n\n    //\u6dfb\u52a0\u79ef\u5206\n    userService.addUserPoints(username,points);\n    return new Result(true,StatusCode.OK,"\u6dfb\u52a0\u79ef\u5206\u6210\u529f\uff01");\n}\n')),(0,l.kt)("p",null,"(4)Feign\u6dfb\u52a0"),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-user-api\u5de5\u7a0b\uff0c\u4fee\u6539",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.user.feign.UserFeign"),"\uff0c\u6dfb\u52a0\u589e\u52a0\u7528\u6237\u79ef\u5206\u65b9\u6cd5\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/***\n * \u6dfb\u52a0\u7528\u6237\u79ef\u5206\n * @param points\n * @return\n */\n@GetMapping(value = "/points/add")\nResult addPoints(@RequestParam(value = "points")Integer points);\n')),(0,l.kt)("h4",{id:"442-\u589e\u52a0\u79ef\u5206\u8c03\u7528"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-4-2-%E5%A2%9E%E5%8A%A0%E7%A7%AF%E5%88%86%E8%B0%83%E7%94%A8"},"#"),"4.4.2 \u589e\u52a0\u79ef\u5206\u8c03\u7528"),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-order\uff0c\u6dfb\u52a0ydles-service-user-api\u7684\u4f9d\u8d56\uff0c\u4fee\u6539pom.xml,\u6dfb\u52a0\u5982\u4e0b\u4f9d\u8d56\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"\x3c!--user api \u4f9d\u8d56--\x3e\n<dependency>\n    <groupId>com.ydles</groupId>\n    <artifactId>ydles-service-user-api</artifactId>\n    <version>1.0-SNAPSHOT</version>\n</dependency>\n")),(0,l.kt)("p",null,"\u5728\u52a0\u8ba2\u5355\u7684\u65f6\u5019\uff0c\u540c\u65f6\u6dfb\u52a0\u7528\u6237\u79ef\u5206\uff0c\u4fee\u6539ydles-service-order\u5fae\u670d\u52a1\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.order.service.impl.OrderServiceImpl"),"\u4e0b\u5355\u65b9\u6cd5\uff0c\u589e\u52a0\u8c03\u7528\u6dfb\u52a0\u79ef\u5206\u65b9\u6cd5"),(0,l.kt)("p",null,"\u4fee\u6539ydles-service-order\u7684\u542f\u52a8\u7c7b",(0,l.kt)("inlineCode",{parentName:"p"},"com.ydles.OrderApplication"),"\uff0c\u6dfb\u52a0feign\u7684\u5305\u8def\u5f84"),(0,l.kt)("p",null,"\u603b\u7ed3\uff1a"),(0,l.kt)("p",null,"1\u8ba2\u5355\u7ed3\u7b97\u9875"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206153405594-e0f5b3d8.png",alt:"image-20211206153405594"}),"image-20211206153405594"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206153523449-50edd4d3.png",alt:"image-20211206153523449"}),"image-20211206153523449"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206153555752-139fc0c1.png",alt:"image-20211206153555752"}),"image-20211206153555752"),(0,l.kt)("p",null,"2\u4e0b\u5355"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206153608375-f541562e.png",alt:"image-20211206153608375"}),"image-20211206153608375"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211206153617157-5d8b78ff.png",alt:"image-20211206153617157"}),"image-20211206153617157"),(0,l.kt)("h1",{id:"\u7b2c12\u7ae0-\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848"},(0,l.kt)("a",{parentName:"h1",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E7%AC%AC12%E7%AB%A0-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"},"#"),"\u7b2c12\u7ae0 \u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u89d2\u8272"),"\uff1a\u67b6\u6784\u5e08"),(0,l.kt)("h2",{id:"\u5b66\u4e60\u76ee\u6807"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87"},"#"),"\u5b66\u4e60\u76ee\u6807\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u80fd\u591f\u8bf4\u51facap\u5b9a\u7406"),(0,l.kt)("li",{parentName:"ul"},"\u80fd\u591f\u8bf4\u51faBASE\u5b9a\u7406"),(0,l.kt)("li",{parentName:"ul"},"\u80fd\u591f\u8bf4\u51fa\u5e38\u89c1\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848"),(0,l.kt)("li",{parentName:"ul"},"\u80fd\u591f\u8bf4\u51faseata\u6846\u67b6\u5982\u4f55\u5728\u9879\u76ee\u4e2d\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1")),(0,l.kt)("h2",{id:"1\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"},"#"),"1.\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848"),(0,l.kt)("p",null," \u521a\u624d\u6211\u4eec\u7f16\u5199\u7684\u6263\u51cf\u5e93\u5b58\u4e0e\u4fdd\u5b58\u8ba2\u5355\u662f\u5728\u4e24\u4e2a\u670d\u52a1\u4e2d\u5b58\u5728\u7684\uff0c\u5982\u679c\u6263\u51cf\u5e93\u5b58\u540e\u8ba2\u5355\u4fdd\u5b58\u5931\u8d25\u4e86\u662f\u4e0d\u4f1a\u56de\u6eda\u7684\uff0c\u8fd9\u6837\u5c31\u4f1a\u9020\u6210\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u8fd9\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u6240\u8bf4\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u95ee\u9898\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u5b66\u4e60\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u89e3\u51b3\u65b9\u6848\u3002"),(0,l.kt)("h3",{id:"11-\u672c\u5730\u4e8b\u52a1\u4e0e\u5206\u5e03\u5f0f\u4e8b\u52a1"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-1-%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1"},"#"),"1.1 \u672c\u5730\u4e8b\u52a1\u4e0e\u5206\u5e03\u5f0f\u4e8b\u52a1"),(0,l.kt)("h4",{id:"111-\u4e8b\u52a1"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-1-1-%E4%BA%8B%E5%8A%A1"},"#"),"1.1.1 \u4e8b\u52a1"),(0,l.kt)("p",null,"\u6570\u636e\u5e93\u4e8b\u52a1(\u7b80\u79f0\uff1a\u4e8b\u52a1\uff0cTransaction)\u662f\u6307\u6570\u636e\u5e93\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e2a\u903b\u8f91\u5355\u4f4d\uff0c\u7531\u4e00\u4e2a\u6709\u9650\u7684\u6570\u636e\u5e93\u64cd\u4f5c\u5e8f\u5217\u6784\u6210\u3002"),(0,l.kt)("p",null,"\u4e8b\u52a1\u62e5\u6709\u4ee5\u4e0b",(0,l.kt)("strong",{parentName:"p"},"\u56db\u4e2a\u7279\u6027"),"\uff0c\u4e60\u60ef\u4e0a\u88ab\u79f0\u4e3a",(0,l.kt)("strong",{parentName:"p"},"ACID"),"\u7279\u6027\uff1a"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u539f\u5b50\u6027(Atomicity)"),"\uff1a\u4e8b\u52a1\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u88ab\u6267\u884c\uff0c\u5305\u542b\u5728\u5176\u4e2d\u7684\u5bf9\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u88ab\u6267\u884c\uff0c\u8981\u4e48\u90fd\u4e0d\u6267\u884c\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4e00\u81f4\u6027(Consistency)"),"\uff1a\u4e8b\u52a1\u5e94\u786e\u4fdd\u6570\u636e\u5e93\u7684\u72b6\u6001\u4ece\u4e00\u4e2a\u4e00\u81f4\u72b6\u6001\u8f6c\u53d8\u4e3a\u53e6\u4e00\u4e2a\u4e00\u81f4\u72b6\u6001\u3002\u4e00\u81f4\u72b6\u6001\u662f\u6307\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u5e94\u6ee1\u8db3\u5b8c\u6574\u6027\u7ea6\u675f\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u4e00\u81f4\u6027\u8fd8\u6709\u53e6\u5916\u4e00\u5c42\u8bed\u4e49\uff0c\u5c31\u662f\u4e8b\u52a1\u7684\u4e2d\u95f4\u72b6\u6001\u4e0d\u80fd\u88ab\u89c2\u5bdf\u5230(\u8fd9\u5c42\u8bed\u4e49\u4e5f\u6709\u8bf4\u5e94\u8be5\u5c5e\u4e8e\u539f\u5b50\u6027)\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u9694\u79bb\u6027(Isolation)"),"\uff1a\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\uff0c\u4e00\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u4e0d\u5e94\u5f71\u54cd\u5176\u4ed6\u4e8b\u52a1\u7684\u6267\u884c\uff0c\u5982\u540c\u53ea\u6709\u8fd9\u4e00\u4e2a\u64cd\u4f5c\u5728\u88ab\u6570\u636e\u5e93\u6240\u6267\u884c\u4e00\u6837\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6301\u4e45\u6027(Durability)"),"\uff1a\u5df2\u88ab\u63d0\u4ea4\u7684\u4e8b\u52a1\u5bf9\u6570\u636e\u5e93\u7684\u4fee\u6539\u5e94\u8be5\u6c38\u4e45\u4fdd\u5b58\u5728\u6570\u636e\u5e93\u4e2d\u3002\u5728\u4e8b\u52a1\u7ed3\u675f\u65f6\uff0c\u6b64\u64cd\u4f5c\u5c06\u4e0d\u53ef\u9006\u8f6c\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208154640726-4a32708f.png",alt:"image-20211208154640726"}),"image-20211208154640726"),(0,l.kt)("p",null,"\u4f5c\u4e1a\uff1a\u9694\u79bb\u7ea7\u522b \u4f20\u64ad\u673a\u5236"),(0,l.kt)("h4",{id:"112-\u672c\u5730\u4e8b\u52a1"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-1-2-%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1"},"#"),"1.1.2 \u672c\u5730\u4e8b\u52a1"),(0,l.kt)("p",null,"\u8d77\u521d\uff0c\u4e8b\u52a1\u4ec5\u9650\u4e8e\u5bf9\u5355\u4e00\u6570\u636e\u5e93\u8d44\u6e90\u7684\u8bbf\u95ee\u63a7\u5236,\u67b6\u6784\u670d\u52a1\u5316\u4ee5\u540e\uff0c\u4e8b\u52a1\u7684\u6982\u5ff5\u5ef6\u4f38\u5230\u4e86\u670d\u52a1\u4e2d\u3002\u5018\u82e5\u5c06\u4e00\u4e2a\u5355\u4e00\u7684\u670d\u52a1\u64cd\u4f5c\u4f5c\u4e3a\u4e00\u4e2a\u4e8b\u52a1\uff0c\u90a3\u4e48\u6574\u4e2a\u670d\u52a1\u64cd\u4f5c\u53ea\u80fd\u6d89\u53ca\u4e00\u4e2a\u5355\u4e00\u7684\u6570\u636e\u5e93\u8d44\u6e90,\u8fd9\u7c7b\u57fa\u4e8e\u5355\u4e2a\u670d\u52a1\u5355\u4e00\u6570\u636e\u5e93\u8d44\u6e90\u8bbf\u95ee\u7684\u4e8b\u52a1\uff0c\u88ab\u79f0\u4e3a\u672c\u5730\u4e8b\u52a1(Local Transaction)\u3002"),(0,l.kt)("p",null,"\u89e3\u51b3\u65b9\u6848\uff1a@Transactional"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208155006738-ad786167.png",alt:"image-20211208155006738"}),"image-20211208155006738"),(0,l.kt)("h4",{id:"113-\u5206\u5e03\u5f0f\u4e8b\u52a1"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-1-3-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1"},"#"),"1.1.3 \u5206\u5e03\u5f0f\u4e8b\u52a1"),(0,l.kt)("p",null,"\u5206\u5e03\u5f0f\u4e8b\u52a1\u6307\u4e8b\u52a1\u7684\u53c2\u4e0e\u8005\u3001\u652f\u6301\u4e8b\u52a1\u7684\u670d\u52a1\u5668\u3001\u8d44\u6e90\u670d\u52a1\u5668\u4ee5\u53ca\u4e8b\u52a1\u7ba1\u7406\u5668\u5206\u522b\u4f4d\u4e8e\u4e0d\u540c\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u4e0d\u540c\u8282\u70b9\u4e4b\u4e0a,\u4e14\u5c5e\u4e8e\u4e0d\u540c\u7684\u5e94\u7528\uff0c\u5206\u5e03\u5f0f\u4e8b\u52a1\u9700\u8981\u4fdd\u8bc1\u8fd9\u4e9b\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002\u672c\u8d28\u4e0a\u6765\u8bf4\uff0c\u5206\u5e03\u5f0f\u4e8b\u52a1\u5c31\u662f\u4e3a\u4e86\u4fdd\u8bc1\u4e0d\u540c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e00\u81f4\u6027\u3002"),(0,l.kt)("p",null,"\u6700\u65e9\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u5e94\u7528\u67b6\u6784\u5f88\u7b80\u5355\uff0c\u4e0d\u6d89\u53ca\u670d\u52a1\u95f4\u7684\u8bbf\u95ee\u8c03\u7528\uff0c\u4ec5\u4ec5\u662f\u670d\u52a1\u5185\u64cd\u4f5c\u6d89\u53ca\u5230\u5bf9\u591a\u4e2a\u6570\u636e\u5e93\u8d44\u6e90\u7684\u8bbf\u95ee\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208155238640-0eef8867.png",alt:"image-20211208155238640"}),"image-20211208155238640"),(0,l.kt)("p",null,"\u5f53\u4e00\u4e2a\u670d\u52a1\u64cd\u4f5c\u8bbf\u95ee\u4e0d\u540c\u7684\u6570\u636e\u5e93\u8d44\u6e90\uff0c\u53c8\u5e0c\u671b\u5bf9\u5b83\u4eec\u7684\u8bbf\u95ee\u5177\u6709\u4e8b\u52a1\u7279\u6027\u65f6\uff0c\u5c31\u9700\u8981\u91c7\u7528\u5206\u5e03\u5f0f\u4e8b\u52a1\u6765\u534f\u8c03\u6240\u6709\u7684\u4e8b\u52a1\u53c2\u4e0e\u8005\u3002"),(0,l.kt)("p",null,"\u5bf9\u4e8e\u4e0a\u9762\u4ecb\u7ecd\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u5e94\u7528\u67b6\u6784\uff0c\u5c3d\u7ba1\u4e00\u4e2a\u670d\u52a1\u64cd\u4f5c\u4f1a\u8bbf\u95ee\u591a\u4e2a\u6570\u636e\u5e93\u8d44\u6e90\uff0c\u4f46\u662f\u6bd5\u7adf\u6574\u4e2a\u4e8b\u52a1\u8fd8\u662f\u63a7\u5236\u5728\u5355\u4e00\u670d\u52a1\u7684\u5185\u90e8\u3002\u5982\u679c\u4e00\u4e2a\u670d\u52a1\u64cd\u4f5c\u9700\u8981\u8c03\u7528\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\uff0c\u8fd9\u65f6\u7684\u4e8b\u52a1\u5c31\u9700\u8981\u8de8\u8d8a\u591a\u4e2a\u670d\u52a1\u4e86\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8d77\u59cb\u4e8e\u67d0\u4e2a\u670d\u52a1\u7684\u4e8b\u52a1\u5728\u8c03\u7528\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\u7684\u65f6\u5019\uff0c\u9700\u8981\u4ee5\u67d0\u79cd\u673a\u5236\u6d41\u8f6c\u5230\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\uff0c\u4ece\u800c\u4f7f\u88ab\u8c03\u7528\u7684\u670d\u52a1\u8bbf\u95ee\u7684\u8d44\u6e90\u4e5f\u81ea\u52a8\u52a0\u5165\u5230\u8be5\u4e8b\u52a1\u5f53\u4e2d\u6765\u3002\u4e0b\u56fe\u53cd\u6620\u4e86\u8fd9\u6837\u4e00\u4e2a\u8de8\u8d8a\u591a\u4e2a\u670d\u52a1\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208155459473-57c38c24.png",alt:"image-20211208155459473"}),"image-20211208155459473"),(0,l.kt)("p",null,"\u5982\u679c\u5c06\u4e0a\u9762\u8fd9\u4e24\u79cd\u573a\u666f(\u4e00\u4e2a\u670d\u52a1\u53ef\u4ee5\u8c03\u7528\u591a\u4e2a\u6570\u636e\u5e93\u8d44\u6e90\uff0c\u4e5f\u53ef\u4ee5\u8c03\u7528\u5176\u4ed6\u670d\u52a1)\u7ed3\u5408\u5728\u4e00\u8d77\uff0c\u5bf9\u6b64\u8fdb\u884c\u5ef6\u4f38\uff0c\u6574\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u53c2\u4e0e\u8005\u5c06\u4f1a\u7ec4\u6210\u5982\u4e0b\u56fe\u6240\u793a\u7684\u6811\u5f62\u62d3\u6251\u7ed3\u6784\u3002\u5728\u4e00\u4e2a\u8de8\u670d\u52a1\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e2d\uff0c\u4e8b\u52a1\u7684\u53d1\u8d77\u8005\u548c\u63d0\u4ea4\u5747\u7cfb\u540c\u4e00\u4e2a\uff0c\u5b83\u53ef\u4ee5\u662f\u6574\u4e2a\u8c03\u7528\u7684\u5ba2\u6237\u7aef\uff0c\u4e5f\u53ef\u4ee5\u662f\u5ba2\u6237\u7aef\u6700\u5148\u8c03\u7528\u7684\u90a3\u4e2a\u670d\u52a1\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208155810435-43b06256.png",alt:"image-20211208155810435"}),"image-20211208155810435"),(0,l.kt)("p",null,"\u8f83\u4e4b\u57fa\u4e8e\u5355\u4e00\u6570\u636e\u5e93\u8d44\u6e90\u8bbf\u95ee\u7684\u672c\u5730\u4e8b\u52a1\uff0c\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5e94\u7528\u67b6\u6784\u66f4\u4e3a\u590d\u6742\u3002\u5728\u4e0d\u540c\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u67b6\u6784\u4e0b\uff0c\u5b9e\u73b0\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u8981\u8003\u8651\u7684\u95ee\u9898\u5e76\u4e0d\u5b8c\u5168\u4e00\u6837\uff0c\u6bd4\u5982\u5bf9\u591a\u8d44\u6e90\u7684\u534f\u8c03\u3001\u4e8b\u52a1\u7684\u8de8\u670d\u52a1\u4f20\u64ad\u7b49\uff0c\u5b9e\u73b0\u673a\u5236\u4e5f\u662f\u590d\u6742\u591a\u53d8\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u53ea\u8981\u662f\u6d89\u53ca\u5230\u591a\u4e2a\u5fae\u670d\u52a1\u4e4b\u95f4\u8fdc\u7a0b\u8c03\u7528\u7684\u8bdd\uff0c\u90a3\u5c31\u56de\u6d89\u53ca\u5230\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002")),(0,l.kt)("p",null,"\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u4f5c\u7528\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u4fdd\u8bc1\u6bcf\u4e2a\u4e8b\u52a1\u7684\u6570\u636e\u4e00\u81f4\u6027\u3002\n")),(0,l.kt)("h3",{id:"12-\u5206\u5e03\u5f0f\u4e8b\u52a1\u76f8\u5173\u7406\u8bba"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-2-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9B%B8%E5%85%B3%E7%90%86%E8%AE%BA"},"#"),"1.2 \u5206\u5e03\u5f0f\u4e8b\u52a1\u76f8\u5173\u7406\u8bba"),(0,l.kt)("h4",{id:"121-cap\u5b9a\u7406-\u91cd\u70b9"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-2-1-cap%E5%AE%9A%E7%90%86-%E9%87%8D%E7%82%B9"},"#"),"1.2.1 CAP\u5b9a\u7406-\u91cd\u70b9"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/9-20-09b36db7.png",alt:"img"})),(0,l.kt)("p",null,"CAP\u5b9a\u7406\u662f\u5728 1998\u5e74\u52a0\u5dde\u5927\u5b66\u7684\u8ba1\u7b97\u673a\u79d1\u5b66\u5bb6 Eric Brewer \uff08\u57c3\u91cc\u514b.\u5e03\u9c81\u5c14\uff09\u63d0\u51fa\uff0c\u5206\u5e03\u5f0f\u7cfb\u7edf\u6709\u4e09\u4e2a\u6307\u6807"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Consistency \u5f3a\u4e00\u81f4\u6027"),(0,l.kt)("li",{parentName:"ul"},"Availability \u53ef\u7528\u6027"),(0,l.kt)("li",{parentName:"ul"},"Partition tolerance \u5206\u533a\u5bb9\u9519")),(0,l.kt)("p",null,"\u5b83\u4eec\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u5206\u522b\u662f C\u3001A\u3001P\u3002Eric Brewer \u8bf4\uff0c\u8fd9\u4e09\u4e2a\u6307\u6807\u4e0d\u53ef\u80fd\u540c\u65f6\u505a\u5230\u3002\u8fd9\u4e2a\u7ed3\u8bba\u5c31\u53eb\u505a CAP \u5b9a\u7406\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u56e0\u4e3a\uff1a\u5f3a\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027 \u4e92\u65a5\uff01")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208164142661-dd6b05f3.png",alt:"image-20211208164142661"}),"image-20211208164142661"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u771f\u5b9e\u60c5\u51b5"),"\uff1a"),(0,l.kt)("p",null,"1 ac \u4f20\u7edf\u9879\u76ee\u3002ssm\u7ba1\u7406\u7cfb\u7edf\uff0c\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u4e00\u4e2a\u6570\u636e\u5e93\u3002"),(0,l.kt)("p",null,"2 cp \u4fe1\u606f\u91cd\u8981\u7684\u573a\u666f\u3002\u624b\u673a\u94f6\u884c\u8f6c\u8d26\u3002\u8f6c\u5708\u5708\uff0c\u5728\u505a\u6570\u636e\u540c\u6b65\uff0c\u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c\u53ef\u7528\u6027\u662f\u6ca1\u6709\u7684\u3002"),(0,l.kt)("p",null,"3 ap \u4e92\u8054\u7f51\u3002 \u653e\u5f03\u5f3a\u4e00\u81f4\u6027\uff0c\u6162\u6162\u6570\u636e\u540c\u6b65\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208164958537-41a40344.png",alt:"image-20211208164958537"}),"image-20211208164958537"),(0,l.kt)("h5",{id:"\u5206\u533a\u5bb9\u9519-partition-tolerance"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E5%88%86%E5%8C%BA%E5%AE%B9%E9%94%99-partition-tolerance"},"#"),"\u5206\u533a\u5bb9\u9519 Partition tolerance"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7406\u89e3: \u5206\u5e03\u5f0f\u7cfb\u7edf\u96c6\u7fa4\u4e2d, \u4e00\u4e2a\u673a\u5668\u574f\u6389\u4e0d\u5e94\u8be5\u5f71\u54cd\u5176\u4ed6\u673a\u5668")),(0,l.kt)("p",null,"\u5927\u591a\u6570\u5206\u5e03\u5f0f\u7cfb\u7edf\u90fd\u5206\u5e03\u5728\u591a\u4e2a\u5b50\u7f51\u7edc\u3002\u6bcf\u4e2a\u5b50\u7f51\u7edc\u5c31\u53eb\u505a\u4e00\u4e2a\u533a\uff08partition\uff09\u3002\u5206\u533a\u5bb9\u9519\u7684\u610f\u601d\u662f\uff0c\u533a\u95f4\u901a\u4fe1\u53ef\u80fd\u5931\u8d25\u3002\u6bd4\u5982\uff0c\u4e00\u53f0\u670d\u52a1\u5668\u653e\u5728\u4e2d\u56fd\uff0c\u53e6\u4e00\u53f0\u670d\u52a1\u5668\u653e\u5728\u7f8e\u56fd\uff0c\u8fd9\u5c31\u662f\u4e24\u4e2a\u533a\uff0c\u5b83\u4eec\u4e4b\u95f4\u53ef\u80fd\u65e0\u6cd5\u901a\u4fe1\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/9-21-4def4d23.png",alt:"img"})),(0,l.kt)("p",null,"\u4e0a\u56fe\u4e2d\uff0cG1 \u548c G2 \u662f\u4e24\u53f0\u8de8\u533a\u7684\u670d\u52a1\u5668\u3002G1 \u5411 G2 \u53d1\u9001\u4e00\u6761\u6d88\u606f\uff0cG2 \u53ef\u80fd\u65e0\u6cd5\u6536\u5230\u3002\u7cfb\u7edf\u8bbe\u8ba1\u7684\u65f6\u5019\uff0c\u5fc5\u987b\u8003\u8651\u5230\u8fd9\u79cd\u60c5\u51b5\u3002"),(0,l.kt)("p",null,"\u4e00\u822c\u6765\u8bf4\uff0c\u5206\u533a\u5bb9\u9519\u65e0\u6cd5\u907f\u514d\uff0c\u56e0\u6b64\u53ef\u4ee5\u8ba4\u4e3a CAP \u7684 P \u603b\u662f\u6210\u7acb\u3002CAP \u5b9a\u7406\u544a\u8bc9\u6211\u4eec\uff0c\u5269\u4e0b\u7684 C \u548c A \u65e0\u6cd5\u540c\u65f6\u505a\u5230\u3002"),(0,l.kt)("h5",{id:"\u53ef\u7528\u6027-availability"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E5%8F%AF%E7%94%A8%E6%80%A7-availability"},"#"),"\u53ef\u7528\u6027 Availability"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7406\u89e3: \u4e00\u4e2a\u8bf7\u6c42, \u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u54cd\u5e94")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},'Availability \u4e2d\u6587\u53eb\u505a"\u53ef\u7528\u6027"\uff0c\u610f\u601d\u662f\u53ea\u8981\u6536\u5230\u7528\u6237\u7684\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u5c31\u5fc5\u987b\u7ed9\u51fa\u56de\u5e94\u3002')),(0,l.kt)("p",null,"\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u5411 G1 \u6216 G2 \u53d1\u8d77\u8bfb\u64cd\u4f5c\u3002\u4e0d\u7ba1\u662f\u54ea\u53f0\u670d\u52a1\u5668\uff0c\u53ea\u8981\u6536\u5230\u8bf7\u6c42\uff0c\u5c31\u5fc5\u987b\u544a\u8bc9\u7528\u6237\uff0c\u5230\u5e95\u662f v0 \u8fd8\u662f v1\uff0c\u5426\u5219\u5c31\u4e0d\u6ee1\u8db3\u53ef\u7528\u6027\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/9-22-897f91db.png",alt:"img"})),(0,l.kt)("h5",{id:"\u4e00\u81f4\u6027-consistency"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E4%B8%80%E8%87%B4%E6%80%A7-consistency"},"#"),"\u4e00\u81f4\u6027 Consistency"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7406\u89e3: \u4e00\u5b9a\u80fd\u8bfb\u53d6\u5230\u6700\u65b0\u7684\u6570\u636e")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},'Consistency \u4e2d\u6587\u53eb\u505a"\u4e00\u81f4\u6027"\u3002\u610f\u601d\u662f\uff0c\u5199\u64cd\u4f5c\u4e4b\u540e\u7684\u8bfb\u64cd\u4f5c\uff0c\u5fc5\u987b\u8fd4\u56de\u8be5\u503c\u3002')),(0,l.kt)("p",null,"\u4e3e\u4f8b\u6765\u8bf4\uff0c\u67d0\u6761\u8bb0\u5f55\u662f v0\uff0c\u7528\u6237\u5411 G1 \u53d1\u8d77\u4e00\u4e2a\u5199\u64cd\u4f5c\uff0c\u5c06\u5176\u6539\u4e3a v1\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/9-23-1673d5cf.png",alt:"img"})),(0,l.kt)("p",null,"\u95ee\u9898\u662f\uff0c\u7528\u6237\u6709\u53ef\u80fd\u5411 G2 \u53d1\u8d77\u8bfb\u64cd\u4f5c\uff0c\u7531\u4e8e G2 \u7684\u503c\u6ca1\u6709\u53d1\u751f\u53d8\u5316\uff0c\u56e0\u6b64\u8fd4\u56de\u7684\u662f v0\u3002G1 \u548c G2 \u8bfb\u64cd\u4f5c\u7684\u7ed3\u679c\u4e0d\u4e00\u81f4\uff0c\u8fd9\u5c31\u4e0d\u6ee1\u8db3\u4e00\u81f4\u6027\u4e86\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/9-24-1513dc77.png",alt:"img"})),(0,l.kt)("p",null,"\u4e3a\u4e86\u8ba9 G2 \u4e5f\u80fd\u53d8\u4e3a v1\uff0c\u5c31\u8981\u5728 G1 \u5199\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u8ba9 G1 \u5411 G2 \u53d1\u9001\u4e00\u6761\u6d88\u606f\uff0c\u8981\u6c42 G2 \u4e5f\u6539\u6210 v1\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/9-25-dd2eaa94.png",alt:"img"})),(0,l.kt)("h5",{id:"\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u7684\u77db\u76fe"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E4%B8%80%E8%87%B4%E6%80%A7%E5%92%8C%E5%8F%AF%E7%94%A8%E6%80%A7%E7%9A%84%E7%9F%9B%E7%9B%BE"},"#"),"\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u7684\u77db\u76fe"),(0,l.kt)("p",null,"\u4e00\u81f4\u6027(C)\u548c\u53ef\u7528\u6027(A)\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u53ef\u80fd\u540c\u65f6\u6210\u7acb\uff1f\u7b54\u6848\u5f88\u7b80\u5355\uff0c\u56e0\u4e3a\u53ef\u80fd\u901a\u4fe1\u5931\u8d25\uff08\u5373\u51fa\u73b0\u5206\u533a\u5bb9\u9519\uff09\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u4fdd\u8bc1 G2 \u7684\u4e00\u81f4\u6027\uff0c\u90a3\u4e48 G1 \u5fc5\u987b\u5728\u5199\u64cd\u4f5c\u65f6\uff0c\u9501\u5b9a G2 \u7684\u8bfb\u64cd\u4f5c\u548c\u5199\u64cd\u4f5c\u3002\u53ea\u6709\u6570\u636e\u540c\u6b65\u540e\uff0c\u624d\u80fd\u91cd\u65b0\u5f00\u653e\u8bfb\u5199\u3002\u9501\u5b9a\u671f\u95f4\uff0cG2 \u4e0d\u80fd\u8bfb\u5199\uff0c\u6ca1\u6709\u53ef\u7528\u6027(CP)\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u4fdd\u8bc1 G2 \u7684\u53ef\u7528\u6027\uff0c\u90a3\u4e48\u52bf\u5fc5\u4e0d\u80fd\u9501\u5b9a G2\uff0c\u6240\u4ee5\u4e00\u81f4\u6027\u4e0d\u6210\u7acb(AP)\u3002"),(0,l.kt)("p",null,"\u7efc\u4e0a\u6240\u8ff0\uff0cG2 \u65e0\u6cd5\u540c\u65f6\u505a\u5230\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u3002\u7cfb\u7edf\u8bbe\u8ba1\u65f6\u53ea\u80fd\u9009\u62e9\u4e00\u4e2a\u76ee\u6807\u3002\u5982\u679c\u8ffd\u6c42\u4e00\u81f4\u6027\uff0c\u90a3\u4e48\u65e0\u6cd5\u4fdd\u8bc1\u6240\u6709\u8282\u70b9\u7684\u53ef\u7528\u6027\uff1b\u5982\u679c\u8ffd\u6c42\u6240\u6709\u8282\u70b9\u7684\u53ef\u7528\u6027\uff0c\u90a3\u5c31\u6ca1\u6cd5\u505a\u5230\u4e00\u81f4\u6027\u3002"),(0,l.kt)("h4",{id:"122-base\u7406\u8bba"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-2-2-base%E7%90%86%E8%AE%BA"},"#"),"1.2.2 BASE\u7406\u8bba"),(0,l.kt)("p",null,"BASE\uff1a\u5168\u79f0\uff1aBasically Available(\u57fa\u672c\u53ef\u7528)\uff0cSoft state\uff08\u8f6f\u72b6\u6001\uff09,\u548c Eventually consistent\uff08\u6700\u7ec8\u4e00\u81f4\u6027\uff09\u4e09\u4e2a\u77ed\u8bed\u7684\u7f29\u5199\uff0c\u6765\u81ea ebay \u7684\u67b6\u6784\u5e08\u63d0\u51fa\u3002BASE \u7406\u8bba\u662f\u5bf9 CAP \u4e2d\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u6743\u8861\u7684\u7ed3\u679c\uff0c\u5176\u6765\u6e90\u4e8e\u5bf9\u5927\u578b\u4e92\u8054\u7f51\u5206\u5e03\u5f0f\u5b9e\u8df5\u7684\u603b\u7ed3\uff0c\u662f\u57fa\u4e8e CAP \u5b9a\u7406\u9010\u6b65\u6f14\u5316\u800c\u6765\u7684\u3002\u5176\u6838\u5fc3\u601d\u60f3\u662f\uff1a"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u65e2\u662f\u65e0\u6cd5\u505a\u5230\u5f3a\u4e00\u81f4\u6027\uff08Strong consistency\uff09\uff0c\u4f46\u6bcf\u4e2a\u5e94\u7528\u90fd\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u7684\u4e1a\u52a1\u7279\u70b9\uff0c\u91c7\u7528\u9002\u5f53\u7684\u65b9\u5f0f\u6765\u4f7f\u7cfb\u7edf\u8fbe\u5230\u6700\u7ec8\u4e00\u81f4\u6027\uff08Eventual consistency\uff09\u3002")),(0,l.kt)("h5",{id:"basically-available\u57fa\u672c\u53ef\u7528"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#basically-available-%E5%9F%BA%E6%9C%AC%E5%8F%AF%E7%94%A8"},"#"),"Basically Available(\u57fa\u672c\u53ef\u7528)"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7406\u89e3: \u5141\u8bb8\u670d\u52a1\u964d\u7ea7\u6216\u8005\u5141\u8bb8\u54cd\u5e94\u65f6\u95f4\u53d7\u5230\u4e00\u5b9a\u635f\u5931")),(0,l.kt)("p",null,"\u4ec0\u4e48\u662f\u57fa\u672c\u53ef\u7528\u5462\uff1f\u5047\u8bbe\u7cfb\u7edf\uff0c\u51fa\u73b0\u4e86\u4e0d\u53ef\u9884\u77e5\u7684\u6545\u969c\uff0c\u4f46\u8fd8\u662f\u80fd\u7528\uff0c\u76f8\u6bd4\u8f83\u6b63\u5e38\u7684\u7cfb\u7edf\u800c\u8a00\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u54cd\u5e94\u65f6\u95f4\u4e0a\u7684\u635f\u5931\uff1a\u6b63\u5e38\u60c5\u51b5\u4e0b\u7684\u641c\u7d22\u5f15\u64ce 0.5 \u79d2\u5373\u8fd4\u56de\u7ed9\u7528\u6237\u7ed3\u679c\uff0c\u800c",(0,l.kt)("strong",{parentName:"li"},"\u57fa\u672c\u53ef\u7528"),"\u7684\u641c\u7d22\u5f15\u64ce\u53ef\u4ee5\u5728 1 \u79d2\u4f5c\u7528\u8fd4\u56de\u7ed3\u679c\u3002"),(0,l.kt)("li",{parentName:"ol"},"\u529f\u80fd\u4e0a\u7684\u635f\u5931\uff1a\u5728\u4e00\u4e2a\u7535\u5546\u7f51\u7ad9\u4e0a\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u53ef\u4ee5\u987a\u5229\u5b8c\u6210\u6bcf\u4e00\u7b14\u8ba2\u5355\uff0c\u4f46\u662f\u5230\u4e86\u5927\u4fc3\u671f\u95f4\uff0c\u4e3a\u4e86\u4fdd\u62a4\u8d2d\u7269\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\uff0c\u90e8\u5206\u6d88\u8d39\u8005\u53ef\u80fd\u4f1a\u88ab\u5f15\u5bfc\u5230\u4e00\u4e2a\u964d\u7ea7\u9875\u9762\u3002")),(0,l.kt)("h5",{id:"soft-state\u8f6f\u72b6\u6001"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#soft-state-%E8%BD%AF%E7%8A%B6%E6%80%81"},"#"),"Soft state\uff08\u8f6f\u72b6\u6001\uff09"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7406\u89e3: \u5141\u8bb8\u540c\u6b65\u6570\u636e\u7684\u65f6\u5019\u51fa\u73b0\u4e00\u5b9a\u65f6\u95f4\u5ef6\u8fdf")),(0,l.kt)("p",null,"\u4ec0\u4e48\u662f\u8f6f\u72b6\u6001\u5462\uff1f\u76f8\u5bf9\u4e8e\u539f\u5b50\u6027\u800c\u8a00\uff0c\u8981\u6c42\u591a\u4e2a\u8282\u70b9\u7684\u6570\u636e\u526f\u672c\u90fd\u662f\u4e00\u81f4\u7684\uff0c\u8fd9\u662f\u4e00\u79cd \u201c\u786c\u72b6\u6001\u201d\u3002"),(0,l.kt)("p",null,"\u8f6f\u72b6\u6001\u6307\u7684\u662f\uff1a\u5141\u8bb8\u7cfb\u7edf\u4e2d\u7684\u6570\u636e\u5b58\u5728\u4e2d\u95f4\u72b6\u6001\uff0c\u5e76\u8ba4\u4e3a\u8be5\u72b6\u6001\u4e0d\u5f71\u54cd\u7cfb\u7edf\u7684\u6574\u4f53\u53ef\u7528\u6027\uff0c\u5373\u5141\u8bb8\u7cfb\u7edf\u5728\u591a\u4e2a\u4e0d\u540c\u8282\u70b9\u7684\u6570\u636e\u526f\u672c\u5b58\u5728\u6570\u636e\u5ef6\u65f6\u3002"),(0,l.kt)("h5",{id:"eventually-consistent\u6700\u7ec8\u4e00\u81f4\u6027"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#eventually-consistent-%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7"},"#"),"Eventually consistent\uff08\u6700\u7ec8\u4e00\u81f4\u6027\uff09"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7406\u89e3: \u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u7684\u540c\u6b65\u6570\u636e\u4e4b\u540e\uff0c\u6700\u7ec8\u90fd\u80fd\u591f\u8fbe\u5230\u4e00\u4e2a\u4e00\u81f4\u7684\u72b6\u6001 ")),(0,l.kt)("p",null,"\u7cfb\u7edf\u80fd\u591f\u4fdd\u8bc1\u5728\u6ca1\u6709\u5176\u4ed6\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\u7684\u60c5\u51b5\u4e0b\uff0c\u6570\u636e\u6700\u7ec8\u4e00\u5b9a\u80fd\u591f\u8fbe\u5230\u4e00\u81f4\u7684\u72b6\u6001\uff0c\u56e0\u6b64\u6240\u6709\u5ba2\u6237\u7aef\u5bf9\u7cfb\u7edf\u7684\u6570\u636e\u8bbf\u95ee\u6700\u7ec8\u90fd\u80fd\u591f\u83b7\u53d6\u5230\u6700\u65b0\u7684\u503c\u3002"),(0,l.kt)("h3",{id:"13-\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848-\u9762\u8bd5"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-%E9%9D%A2%E8%AF%95"},"#"),"1.3 \u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848-\u9762\u8bd5"),(0,l.kt)("p",null,"1.XA\u4e24\u6bb5\u63d0\u4ea4(\u4f4e\u6548\u7387)-2PC"),(0,l.kt)("p",null,"2.TCC\u4e09\u6bb5\u63d0\u4ea4(3\u6bb5,\u9ad8\u6548\u7387","[\u4e0d\u63a8\u8350(\u8865\u507f\u4ee3\u7801)]",")"),(0,l.kt)("p",null,"3.\u672c\u5730\u6d88\u606f\u8868(MQ+Table)"),(0,l.kt)("p",null,"4.\u4e8b\u52a1\u6d88\u606f(RocketMQ","[alibaba]",")"),(0,l.kt)("p",null,"5.Seata(alibaba)"),(0,l.kt)("p",null,"6.RabbitMQ\u7684ACK\u673a\u5236\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1(\u4f5c\u4e1a)"),(0,l.kt)("h4",{id:"131-\u57fa\u4e8exa\u534f\u8bae\u7684\u4e24\u9636\u6bb5\u63d0\u4ea4-2pc"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-1-%E5%9F%BA%E4%BA%8Exa%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4-2pc"},"#"),"1.3.1 \u57fa\u4e8eXA\u534f\u8bae\u7684\u4e24\u9636\u6bb5\u63d0\u4ea4 2pc"),(0,l.kt)("p",null,"\u9996\u5148\u6211\u4eec\u6765\u7b80\u8981\u770b\u4e0b\u5206\u5e03\u5f0f\u4e8b\u52a1\u5904\u7406\u7684XA\u89c4\u8303 \uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/9-14-1a6e6c96.png",alt:"img"})),(0,l.kt)("p",null,"\u53ef\u77e5XA\u89c4\u8303\u4e2d\u5206\u5e03\u5f0f\u4e8b\u52a1\u6709AP\uff0cRM\uff0cTM\u7ec4\u6210\uff1a"),(0,l.kt)("p",null,"\u5176\u4e2d\u5e94\u7528\u7a0b\u5e8f(Application Program \uff0c\u7b80\u79f0AP)\uff1aAP\u5b9a\u4e49\u4e8b\u52a1\u8fb9\u754c\uff08\u5b9a\u4e49\u4e8b\u52a1\u5f00\u59cb\u548c\u7ed3\u675f\uff09\u5e76\u8bbf\u95ee\u4e8b\u52a1\u8fb9\u754c\u5185\u7684\u8d44\u6e90\u3002"),(0,l.kt)("p",null,"\u8d44\u6e90\u7ba1\u7406\u5668(Resource Manager\uff0c\u7b80\u79f0RM)\uff1aRm\u7ba1\u7406\u8ba1\u7b97\u673a\u5171\u4eab\u7684\u8d44\u6e90\uff0c\u8bb8\u591a\u8f6f\u4ef6\u90fd\u53ef\u4ee5\u53bb\u8bbf\u95ee\u8fd9\u4e9b\u8d44\u6e90\uff0c\u8d44\u6e90\u5305\u542b\u6bd4\u5982",(0,l.kt)("strong",{parentName:"p"},"\u6570\u636e\u5e93"),"\u3001\u6587\u4ef6\u7cfb\u7edf\u3001\u6253\u5370\u673a\u670d\u52a1\u5668\u7b49\u3002"),(0,l.kt)("p",null,"\u4e8b\u52a1\u7ba1\u7406\u5668(Transaction Manager \uff0c\u7b80\u79f0TM)\uff1a\u8d1f\u8d23\u7ba1\u7406\u5168\u5c40\u4e8b\u52a1\uff0c\u5206\u914d\u4e8b\u52a1\u552f\u4e00\u6807\u8bc6\uff0c\u76d1\u63a7\u4e8b\u52a1\u7684\u6267\u884c\u8fdb\u5ea6\uff0c\u5e76\u8d1f\u8d23\u4e8b\u52a1\u7684\u63d0\u4ea4\u3001\u56de\u6eda\u3001\u5931\u8d25\u6062\u590d\u7b49\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4e8c\u9636\u6bb5\u534f\u8bae:")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7b2c\u4e00\u9636\u6bb5"),"TM\u8981\u6c42\u6240\u6709\u7684RM\u51c6\u5907\u63d0\u4ea4\u5bf9\u5e94\u7684\u4e8b\u52a1\u5206\u652f\uff0c\u8be2\u95eeRM\u662f\u5426\u6709\u80fd\u529b\u4fdd\u8bc1\u6210\u529f\u7684\u63d0\u4ea4\u4e8b\u52a1\u5206\u652f\uff0cRM\u6839\u636e\u81ea\u5df1\u7684\u60c5\u51b5\uff0c\u5982\u679c\u5224\u65ad\u81ea\u5df1\u8fdb\u884c\u7684\u5de5\u4f5c\u53ef\u4ee5\u88ab\u63d0\u4ea4\uff0c\u90a3\u5c31\u5bf9\u5de5\u4f5c\u5185\u5bb9\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u5e76\u7ed9TM\u56de\u6267OK\uff1b\u5426\u8005\u7ed9TM\u7684\u56de\u6267NO\u3002RM\u5728\u53d1\u9001\u4e86\u5426\u5b9a\u7b54\u590d\u5e76\u56de\u6eda\u4e86\u5df2\u7ecf\u7684\u5de5\u4f5c\u540e\uff0c\u5c31\u53ef\u4ee5\u4e22\u5f03\u8fd9\u4e2a\u4e8b\u52a1\u5206\u652f\u4fe1\u606f\u4e86\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7b2c\u4e8c\u9636\u6bb5"),"TM\u6839\u636e\u9636\u6bb51\u5404\u4e2aRM prepare\u7684\u7ed3\u679c\uff0c\u51b3\u5b9a\u662f\u63d0\u4ea4\u8fd8\u662f\u56de\u6eda\u4e8b\u52a1\u3002\u5982\u679c\u6240\u6709\u7684RM\u90fdprepare\u6210\u529f\uff0c\u90a3\u4e48TM\u901a\u77e5\u6240\u6709\u7684RM\u8fdb\u884c\u63d0\u4ea4\uff1b\u5982\u679c\u6709RM prepare\u56de\u6267NO\u7684\u8bdd\uff0c\u5219TM\u901a\u77e5\u6240\u6709RM\u56de\u6eda\u81ea\u5df1\u7684\u4e8b\u52a1\u5206\u652f\u3002"),(0,l.kt)("p",null,"\u4e5f\u5c31\u662fTM\u4e0eRM\u4e4b\u95f4\u662f\u901a\u8fc7\u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\u8fdb\u884c\u4ea4\u4e92\u7684."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4f18\u70b9\uff1a")," \u5c3d\u91cf\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u5f3a\u4e00\u81f4\uff0c\u9002\u5408\u5bf9\u6570\u636e\u5f3a\u4e00\u81f4\u8981\u6c42\u5f88\u9ad8\u7684\u5173\u952e\u9886\u57df\u3002\uff08\u5176\u5b9e\u4e5f\u4e0d\u80fd100%\u4fdd\u8bc1\u5f3a\u4e00\u81f4\uff09"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7f3a\u70b9\uff1a")," \u5b9e\u73b0\u590d\u6742\uff0c\u727a\u7272\u4e86\u53ef\u7528\u6027\uff0c\u5bf9\u6027\u80fd\u5f71\u54cd\u8f83\u5927\uff0c\u4e0d\u9002\u5408\u9ad8\u5e76\u53d1\u9ad8\u6027\u80fd\u573a\u666f\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6d41\u7a0b\u770b\u6211\u7684\u56fe"),"\uff1a"),(0,l.kt)("p",null," mysql"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208174923396-2412462d.png",alt:"image-20211208174923396"}),"image-20211208174923396"),(0,l.kt)("p",null,"\u60b2\u89c2\u9501 mysql\u884c\u7ea7\u9501 oracle\u8868\u7ea7\u9501"),(0,l.kt)("p",null,"\u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae(Two Phase Commitment Protocol)\u4e2d\uff0c\u6d89\u53ca\u5230\u4e24\u79cd\u89d2\u8272"),(0,l.kt)("p",null,"\u4e00\u4e2a\u4e8b\u52a1\u534f\u8c03\u8005\uff08coordinator\uff09\uff1a\u8d1f\u8d23\u534f\u8c03\u591a\u4e2a\u53c2\u4e0e\u8005\u8fdb\u884c\u4e8b\u52a1\u6295\u7968\u53ca\u63d0\u4ea4(\u56de\u6eda) \u591a\u4e2a\u4e8b\u52a1\u53c2\u4e0e\u8005\uff08participants\uff09\uff1a\u5373\u672c\u5730\u4e8b\u52a1\u6267\u884c\u8005"),(0,l.kt)("p",null,"\u603b\u5171\u5904\u7406\u6b65\u9aa4\u6709\u4e24\u4e2a \uff081\uff09",(0,l.kt)("strong",{parentName:"p"},"\u6295\u7968\u9636\u6bb5"),"\uff08voting phase\uff09\uff1a\u534f\u8c03\u8005\u5c06\u901a\u77e5\u4e8b\u52a1\u53c2\u4e0e\u8005\u51c6\u5907\u63d0\u4ea4\u6216\u53d6\u6d88\u4e8b\u52a1\uff0c\u7136\u540e\u8fdb\u5165\u8868\u51b3\u8fc7\u7a0b\u3002\u53c2\u4e0e\u8005\u5c06\u544a\u77e5\u534f\u8c03\u8005\u81ea\u5df1\u7684\u51b3\u7b56\uff1a\u540c\u610f\uff08\u4e8b\u52a1\u53c2\u4e0e\u8005\u672c\u5730\u4e8b\u52a1\u6267\u884c\u6210\u529f\uff0c\u4f46\u672a\u63d0\u4ea4\uff09\u6216\u53d6\u6d88\uff08\u672c\u5730\u4e8b\u52a1\u6267\u884c\u6545\u969c\uff09\uff1b \uff082\uff09",(0,l.kt)("strong",{parentName:"p"},"\u63d0\u4ea4\u9636\u6bb5"),"\uff08commit phase\uff09\uff1a\u6536\u5230\u53c2\u4e0e\u8005\u7684\u901a\u77e5\u540e\uff0c\u534f\u8c03\u8005\u518d\u5411\u53c2\u4e0e\u8005\u53d1\u51fa\u901a\u77e5\uff0c\u6839\u636e\u53cd\u9988\u60c5\u51b5\u51b3\u5b9a\u5404\u53c2\u4e0e\u8005\u662f\u5426\u8981\u63d0\u4ea4\u8fd8\u662f\u56de\u6eda\uff1b"),(0,l.kt)("h4",{id:"132-tcc\u8865\u507f\u673a\u5236"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-2-tcc%E8%A1%A5%E5%81%BF%E6%9C%BA%E5%88%B6"},"#"),"1.3.2 TCC\u8865\u507f\u673a\u5236"),(0,l.kt)("p",null,"TCC \u5176\u5b9e\u5c31\u662f\u91c7\u7528\u7684\u8865\u507f\u673a\u5236\uff0c\u5176\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u9488\u5bf9\u6bcf\u4e2a\u64cd\u4f5c\uff0c\u90fd\u8981\u6ce8\u518c\u4e00\u4e2a\u4e0e\u5176\u5bf9\u5e94\u7684\u786e\u8ba4\u548c\u8865\u507f\uff08\u64a4\u9500\uff09\u64cd\u4f5c\u3002\u5b83\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Try \u9636\u6bb5\u4e3b\u8981\u662f\u5bf9\u4e1a\u52a1\u7cfb\u7edf\u505a\u68c0\u6d4b\u53ca\u8d44\u6e90\u9884\u7559"),(0,l.kt)("li",{parentName:"ul"},"Confirm \u9636\u6bb5\u4e3b\u8981\u662f\u5bf9\u4e1a\u52a1\u7cfb\u7edf\u505a\u786e\u8ba4\u63d0\u4ea4\uff0cTry\u9636\u6bb5\u6267\u884c\u6210\u529f\u5e76\u5f00\u59cb\u6267\u884c Confirm\u9636\u6bb5\u65f6\uff0c\u9ed8\u8ba4 Confirm\u9636\u6bb5\u662f\u4e0d\u4f1a\u51fa\u9519\u7684\u3002\u5373\uff1a\u53ea\u8981Try\u6210\u529f\uff0cConfirm\u4e00\u5b9a\u6210\u529f\u3002"),(0,l.kt)("li",{parentName:"ul"},"Cancel \u9636\u6bb5\u4e3b\u8981\u662f\u5728\u4e1a\u52a1\u6267\u884c\u9519\u8bef\uff0c\u9700\u8981\u56de\u6eda\u7684\u72b6\u6001\u4e0b\u6267\u884c\u7684\u4e1a\u52a1\u53d6\u6d88\uff0c\u9884\u7559\u8d44\u6e90\u91ca\u653e\u3002")),(0,l.kt)("p",null,"\u4f8b\u5982\uff1a A\u8981\u5411 B \u8f6c\u8d26\uff0c\u601d\u8def\u5927\u6982\u662f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u6211\u4eec\u6709\u4e00\u4e2a\u672c\u5730\u65b9\u6cd5\uff0c\u91cc\u9762\u4f9d\u6b21\u8c03\u7528 \n1\u3001\u9996\u5148\u5728 Try \u9636\u6bb5\uff0c\u8981\u5148\u8c03\u7528\u8fdc\u7a0b\u63a5\u53e3\u628a B\u548c A\u7684\u94b1\u7ed9\u51bb\u7ed3\u8d77\u6765\u3002 \n2\u3001\u5728 Confirm \u9636\u6bb5\uff0c\u6267\u884c\u8fdc\u7a0b\u8c03\u7528\u7684\u8f6c\u8d26\u7684\u64cd\u4f5c\uff0c\u8f6c\u8d26\u6210\u529f\u8fdb\u884c\u89e3\u51bb\u3002 \n3\u3001\u5982\u679c\u7b2c2\u6b65\u6267\u884c\u6210\u529f\uff0c\u90a3\u4e48\u8f6c\u8d26\u6210\u529f\uff0c\u5982\u679c\u7b2c\u4e8c\u6b65\u6267\u884c\u5931\u8d25\uff0c\u5219\u8c03\u7528\u8fdc\u7a0b\u51bb\u7ed3\u63a5\u53e3\u5bf9\u5e94\u7684\u89e3\u51bb\u65b9\u6cd5 (Cancel)\u3002 \n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4f18\u70b9\uff1a")," \u76f8\u6bd4\u4e24\u9636\u6bb5\u63d0\u4ea4\uff0c\u53ef\u7528\u6027\u6bd4\u8f83\u5f3a"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7f3a\u70b9\uff1a")," \u6570\u636e\u7684\u4e00\u81f4\u6027\u8981\u5dee\u4e00\u4e9b\u3002TCC\u5c5e\u4e8e\u5e94\u7528\u5c42\u7684\u4e00\u79cd\u8865\u507f\u65b9\u5f0f\uff0c\u6240\u4ee5\u9700\u8981\u7a0b\u5e8f\u5458\u5728\u5b9e\u73b0\u7684\u65f6\u5019\u591a\u5199\u5f88\u591a\u8865\u507f\u7684\u4ee3\u7801\uff0c\u5728\u4e00\u4e9b\u573a\u666f\u4e2d\uff0c\u4e00\u4e9b\u4e1a\u52a1\u6d41\u7a0b\u53ef\u80fd\u7528TCC\u4e0d\u592a\u597d\u5b9a\u4e49\u53ca\u5904\u7406\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6d41\u7a0b\u770b\u6211\u7684\u56fe\uff1a")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208180127771-6e94911f.png",alt:"image-20211208180127771"}),"image-20211208180127771"),(0,l.kt)("h4",{id:"133-\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027-\u91cd\u70b9"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-3-%E6%B6%88%E6%81%AF%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7-%E9%87%8D%E7%82%B9"},"#"),"1.3.3 \u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027-\u91cd\u70b9"),(0,l.kt)("p",null,"\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027\u5e94\u8be5\u662f\u4e1a\u754c\u4f7f\u7528\u6700\u591a\u7684\uff0c\u5176\u6838\u5fc3\u601d\u60f3\u662f\u5c06\u5206\u5e03\u5f0f\u4e8b\u52a1\u62c6\u5206\u6210\u672c\u5730\u4e8b\u52a1\u8fdb\u884c\u5904\u7406\uff0c\u8fd9\u79cd\u601d\u8def\u662f\u6765\u6e90\u4e8eebay\u3002\u6211\u4eec\u53ef\u4ee5\u4ece\u4e0b\u9762\u7684\u6d41\u7a0b\u56fe\u4e2d\u770b\u51fa\u5176\u4e2d\u7684\u4e00\u4e9b\u7ec6\u8282\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/9-16-7fb4fb35.png",alt:"img"})),(0,l.kt)("p",null,"\u57fa\u672c\u601d\u8def\u5c31\u662f\uff1a"),(0,l.kt)("p",null,"\u6d88\u606f\u751f\u4ea7\u65b9\uff0c\u9700\u8981\u989d\u5916\u5efa\u4e00\u4e2a\u6d88\u606f\u8868\uff0c\u5e76\u8bb0\u5f55\u6d88\u606f\u53d1\u9001\u72b6\u6001\u3002\u6d88\u606f\u8868\u548c\u4e1a\u52a1\u6570\u636e\u8981\u5728\u4e00\u4e2a\u4e8b\u52a1\u91cc\u63d0\u4ea4\uff0c\u4e5f\u5c31\u662f\u8bf4\u4ed6\u4eec\u8981\u5728\u4e00\u4e2a\u6570\u636e\u5e93\u91cc\u9762\u3002\u7136\u540e\u6d88\u606f\u4f1a\u7ecf\u8fc7MQ\u53d1\u9001\u5230\u6d88\u606f\u7684\u6d88\u8d39\u65b9\u3002\u5982\u679c\u6d88\u606f\u53d1\u9001\u5931\u8d25\uff0c\u4f1a\u8fdb\u884c\u91cd\u8bd5\u53d1\u9001\u3002"),(0,l.kt)("p",null,"\u6d88\u606f\u6d88\u8d39\u65b9\uff0c\u9700\u8981\u5904\u7406\u8fd9\u4e2a\u6d88\u606f\uff0c\u5e76\u5b8c\u6210\u81ea\u5df1\u7684\u4e1a\u52a1\u903b\u8f91\u3002\u6b64\u65f6\u5982\u679c\u672c\u5730\u4e8b\u52a1\u5904\u7406\u6210\u529f\uff0c\u8868\u660e\u5df2\u7ecf\u5904\u7406\u6210\u529f\u4e86\uff0c\u5982\u679c\u5904\u7406\u5931\u8d25\uff0c\u90a3\u4e48\u5c31\u4f1a\u91cd\u8bd5\u6267\u884c\u3002\u5982\u679c\u662f\u4e1a\u52a1\u4e0a\u9762\u7684\u5931\u8d25\uff0c\u53ef\u4ee5\u7ed9\u751f\u4ea7\u65b9\u53d1\u9001\u4e00\u4e2a\u4e1a\u52a1\u8865\u507f\u6d88\u606f\uff0c\u901a\u77e5\u751f\u4ea7\u65b9\u8fdb\u884c\u56de\u6eda\u7b49\u64cd\u4f5c\u3002"),(0,l.kt)("p",null,"\u751f\u4ea7\u65b9\u548c\u6d88\u8d39\u65b9\u5b9a\u65f6\u626b\u63cf\u672c\u5730\u6d88\u606f\u8868\uff0c\u628a\u8fd8\u6ca1\u5904\u7406\u5b8c\u6210\u7684\u6d88\u606f\u6216\u8005\u5931\u8d25\u7684\u6d88\u606f\u518d\u53d1\u9001\u4e00\u904d\u3002\u5982\u679c\u6709\u9760\u8c31\u7684\u81ea\u52a8\u5bf9\u8d26\u8865\u8d26\u903b\u8f91\uff0c\u8fd9\u79cd\u65b9\u6848\u8fd8\u662f\u975e\u5e38\u5b9e\u7528\u7684\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4f18\u70b9\uff1a")," \u4e00\u79cd\u975e\u5e38\u7ecf\u5178\u7684\u5b9e\u73b0\uff0c\u907f\u514d\u4e86\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u5b9e\u73b0\u4e86\u6700\u7ec8\u4e00\u81f4\u6027\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7f3a\u70b9\uff1a")," \u6d88\u606f\u8868\u4f1a\u8026\u5408\u5230\u4e1a\u52a1\u7cfb\u7edf\u4e2d\uff0c\u5982\u679c\u6ca1\u6709\u5c01\u88c5\u597d\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4f1a\u6709\u5f88\u591a\u6742\u6d3b\u9700\u8981\u5904\u7406\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6d41\u7a0b\u770b\u6211\u7684\u56fe\uff1a")),(0,l.kt)("p",null,"\u9700\u6c42\uff1a\u4e0b\u5355\u540c\u65f6\uff0c\u51cf\u5e93\u5b58"),(0,l.kt)("p",null,"\u53c2\u4e0e\u8005A \u8ba2\u5355\u670d\u52a1"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208221414338-a08cee39.png",alt:"image-20211208221414338"}),"image-20211208221414338"),(0,l.kt)("p",null,"1\u3001\u8ba2\u5355\u670d\u52a1"),(0,l.kt)("p",null,"1.1 \u8ba2\u5355\u8868\u63d2\u5165\u6570\u636e\uff0c\u8ba2\u5355\u6d88\u606f\u8868\u6dfb\u52a0\u6570\u636e101\u3002\u672c\u5730\u4e8b\u52a1\uff0c\u53ef\u4ee5\u63a7\u5236\u4f4f\u3002"),(0,l.kt)("p",null,"1.2 \u5b9a\u65f6\u4efb\u52a1\uff1a\u626b\u63cf\u8ba2\u5355\u6d88\u606f\u8868---\u300bmq\u53d1\u4e00\u6761\u6d88\u606f\uff0c\u8ba2\u5355\u4fe1\u606f"),(0,l.kt)("p",null,"2\u3001\u5546\u54c1\u670d\u52a1"),(0,l.kt)("p",null,"2.1\u76d1\u542c\u6d88\u606f\u961f\u5217\uff0c\u6536\u5230\u6d88\u606f\u8ba2\u5355\u8be6\u60c5\u3002"),(0,l.kt)("p",null,"2.2sku \u51cf\u5e93\u5b58\uff0c\u63a5\u53d7\u5230\u5546\u54c1\u8ba2\u5355\u7684\u6d88\u606f\u8868\u3002\u672c\u5730\u4e8b\u52a1\uff0c\u53ef\u4ee5\u63a7\u5236\u4f4f\u3002"),(0,l.kt)("p",null,"2.3 \u5b9a\u65f6\u4efb\u52a1\uff1a\u626b\u63cf\u63a5\u53d7\u5230\u5546\u54c1\u8ba2\u5355\u7684\u6d88\u606f\u8868---\u300bmq\u53d1\u4e00\u6761\u6d88\u606f\uff0c\u6211\u5df2\u7ecf\u51cf\u5e93\u5b58\u4e86"),(0,l.kt)("p",null,"2.4 mq\u53d1\u4e00\u6761\u6d88\u606f \u63a5\u53d7\u5230\u5546\u54c1\u8ba2\u5355\u7684\u6d88\u606f\u8868 101 staus 2 \u5df2\u7ecf\u53d1\u4e86\u6d88\u606f\u4e86"),(0,l.kt)("p",null,"3\u3001\u8ba2\u5355\u670d\u52a1"),(0,l.kt)("p",null,"3.1\u76d1\u542c\u6d88\u606f\u961f\u5217\uff08\u5df2\u7ecf\u51cf\u5e93\u5b58\u4e86\uff09 \u8ba2\u5355\u6d88\u606f\u8868 \u5220\u9664"),(0,l.kt)("h2",{id:"2-\u5206\u5e03\u5f0f\u4e8b\u52a1\u6846\u67b6seata"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%A1%86%E6%9E%B6seata"},"#"),"2. \u5206\u5e03\u5f0f\u4e8b\u52a1\u6846\u67b6seata"),(0,l.kt)("h3",{id:"21-seata\u7b80\u4ecb"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-1-seata%E7%AE%80%E4%BB%8B"},"#"),"2.1 seata\u7b80\u4ecb"),(0,l.kt)("p",null," Seata\uff08\u539f\u540dFescar\uff09 \u662f\u963f\u91cc18\u5e74\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u6846\u67b6\u3002Fescar\u7684\u5f00\u6e90\u5bf9\u5206\u5e03\u5f0f\u4e8b\u52a1\u6846\u67b6\u9886\u57df\u5f71\u54cd\u5f88\u5927\u3002\u4f5c\u4e3a\u5f00\u6e90\u5927\u6237\uff0cFescar\u6765\u81ea\u963f\u91cc\u7684GTS\uff0c\u7ecf\u5386\u4e86\u597d\u51e0\u6b21\u53cc\u5341\u4e00\u7684\u8003\u9a8c\uff0c\u4e00\u7ecf\u5f00\u6e90\u4fbf\u9887\u53d7\u5173\u6ce8\u3002\u540e\u6765Fescar\u6539\u540d\u4e3aSeata\u3002 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/seata/seata"},"https://github.com/seata/seataopen in new window")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Fescar\u867d\u7136\u662f\u4e8c\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u4f46\u662f\u5176\u89e3\u51b3\u4e86XA\u7684\u4e00\u4e9b\u7f3a\u70b9:\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5355\u70b9\u95ee\u9898:\u867d\u7136\u76ee\u524dFescar(0.4.2)\u8fd8\u662f\u5355server\u7684\uff0c\u4f46\u662fFescar\u5b98\u65b9\u9884\u8ba1\u5c06\u4f1a\u57280.5.x\u4e2d\u63a8\u51faHA-Cluster\uff0c\u5230\u65f6\u5019\u5c31\u53ef\u4ee5\u89e3\u51b3\u5355\u70b9\u95ee\u9898\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u540c\u6b65\u963b\u585e:Fescar\u7684\u4e8c\u9636\u6bb5\uff0c\u5176\u518d",(0,l.kt)("strong",{parentName:"li"},"\u7b2c\u4e00\u9636\u6bb5\u7684\u65f6\u5019\u672c\u5730\u4e8b\u52a1"),"\u5c31\u5df2\u7ecf\u63d0\u4ea4\u91ca\u653e\u8d44\u6e90\u4e86\uff0c\u4e0d\u4f1a\u50cfXA\u4f1a\u518d\u4e24\u4e2aprepare\u548ccommit\u9636\u6bb5\u8d44\u6e90\u90fd\u9501\u4f4f\uff0c\u5e76\u4e14",(0,l.kt)("strong",{parentName:"li"},"Fescar,commit\u662f\u5f02\u6b65\u64cd\u4f5c"),"\uff0c\u4e5f\u662f\u63d0\u5347\u6027\u80fd\u7684\u4e00\u5927\u5173\u952e\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u6570\u636e\u4e0d\u4e00\u81f4:\u5982\u679c\u51fa\u73b0\u90e8\u5206commit\u5931\u8d25\uff0c\u90a3\u4e48fescar-server\u4f1a\u6839\u636e\u5f53\u524d\u7684\u4e8b\u52a1\u6a21\u5f0f\u548c\u5206\u652f\u4e8b\u52a1\u7684\u8fd4\u56de\u72b6\u6001\u7684\u7ed3\u679c\u6765\u8fdb\u884c\u4e0d\u540c\u7684\u91cd\u8bd5\u7b56\u7565\u3002\u5e76\u4e14fescar\u7684\u672c\u5730\u4e8b\u52a1\u4f1a\u5728\u4e00\u9636\u6bb5\u7684\u65f6\u5019\u8fdb\u884c\u63d0\u4ea4\uff0c\u5176\u5b9e\u5355\u770b\u6570\u636e\u5e93\u6765\u8bf4\u5728commit\u7684\u65f6\u5019\u6570\u636e\u5e93\u5df2\u7ecf\u662f\u4e00\u81f4\u7684\u4e86\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u53ea\u80fd\u7528\u4e8e\u5355\u4e00\u6570\u636e\u5e93: Fescar\u63d0\u4f9b\u4e86\u4e09\u79cd\u6a21\u5f0f\uff0c",(0,l.kt)("strong",{parentName:"li"},"AT\u548cTCC\u548c\u6df7\u5408\u6a21\u5f0f"),"\u3002\u5728AT\u6a21\u5f0f\u4e0b\u4e8b\u52a1\u8d44\u6e90\u53ef\u4ee5\u662f\u4efb\u4f55\u652f\u6301ACID\u7684\u6570\u636e\u5e93\uff0c\u5728TCC\u6a21\u5f0f\u4e0b\u4e8b\u52a1\u8d44\u6e90\u6ca1\u6709\u9650\u5236\uff0c\u53ef\u4ee5\u662f\u7f13\u5b58\uff0c\u53ef\u4ee5\u662f\u6587\u4ef6\uff0c\u53ef\u4ee5\u662f\u5176\u4ed6\u7684\u7b49\u7b49\u3002\u5f53\u7136\u8fd9\u4e24\u4e2a\u6a21\u5f0f\u4e5f\u53ef\u4ee5\u6df7\u7528\u3002")),(0,l.kt)("p",null,"\u540c\u65f6Fescar\u4e5f\u4fdd\u7559\u4e86\u63a5\u8fd10\u4e1a\u52a1\u5165\u4fb5\u7684\u4f18\u70b9\uff0c\u53ea\u9700\u8981\u7b80\u5355\u7684\u914d\u7f6eFescar\u7684\u6570\u636e\u4ee3\u7406\u548c\u52a0\u4e2a\u6ce8\u89e3\uff0c\u52a0\u4e00\u4e2aUndolog\u8868\uff0c\u5c31\u53ef\u4ee5\u8fbe\u5230\u6211\u4eec\u60f3\u8981\u7684\u76ee\u7684\u3002"),(0,l.kt)("h3",{id:"22-\u5b9e\u73b0\u539f\u7406"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"},"#"),"2.2 \u5b9e\u73b0\u539f\u7406"),(0,l.kt)("p",null,"Fescar\u5c06\u4e00\u4e2a\u672c\u5730\u4e8b\u52a1\u505a\u4e3a\u4e00\u4e2a\u5206\u5e03\u5f0f\u4e8b\u52a1\u5206\u652f\uff0c\u6240\u4ee5\u82e5\u5e72\u4e2a\u5206\u5e03\u5728\u4e0d\u540c\u5fae\u670d\u52a1\u4e2d\u7684\u672c\u5730\u4e8b\u52a1\u5171\u540c\u7ec4\u6210\u4e86\u4e00\u4e2a\u5168\u5c40\u4e8b\u52a1\uff0c\u7ed3\u6784\u5982\u4e0b\u3002"),(0,l.kt)("p",null,"\u5b98\u5e2e\u52a9\u6587\u6863\uff1a ",(0,l.kt)("a",{parentName:"p",href:"https://seata.io/zh-cn/index.html"},"https://seata.io/zh-cn/index.htmlopen in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200304154454364-b860d95e.png",alt:"image-20200304154454364"}),"image-20200304154454364"),(0,l.kt)("p",null,"TM\uff1a\u5168\u5c40\u4e8b\u52a1\u7ba1\u7406\u5668\uff0c\u5728\u6807\u6ce8\u5f00\u542ffescar\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u670d\u52a1\u7aef\u5f00\u542f\uff0c\u5e76\u5c06\u5168\u5c40\u4e8b\u52a1\u53d1\u9001\u5230TC\u4e8b\u52a1\u63a7\u5236\u7aef\u7ba1\u7406"),(0,l.kt)("p",null,"TC\uff1a\u4e8b\u52a1\u63a7\u5236\u4e2d\u5fc3\uff0c\u63a7\u5236\u5168\u5c40\u4e8b\u52a1\u7684\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u3002\u8fd9\u4e2a\u7ec4\u4ef6\u9700\u8981\u72ec\u7acb\u90e8\u7f72\u7ef4\u62a4\uff0c\u76ee\u524d\u53ea\u652f\u6301\u5355\u673a\u7248\u672c\uff0c\u540e\u7eed\u8fed\u4ee3\u8ba1\u5212\u4f1a\u6709\u96c6\u7fa4\u7248\u672c"),(0,l.kt)("p",null,"RM\uff1a\u8d44\u6e90\u7ba1\u7406\u5668\uff0c\u4e3b\u8981\u8d1f\u8d23\u5206\u652f\u4e8b\u52a1\u7684\u4e0a\u62a5\uff0c\u672c\u5730\u4e8b\u52a1\u7684\u7ba1\u7406"),(0,l.kt)("p",null,"\u4e00\u6bb5\u8bdd\u7b80\u8ff0\u5176\u5b9e\u73b0\u8fc7\u7a0b\uff1a\u670d\u52a1\u8d77\u59cb\u65b9\u53d1\u8d77\u5168\u5c40\u4e8b\u52a1\u5e76\u6ce8\u518c\u5230TC\u3002\u5728\u8c03\u7528\u534f\u540c\u670d\u52a1\u65f6\uff0c\u534f\u540c\u670d\u52a1\u7684\u4e8b\u52a1\u5206\u652f\u4e8b\u52a1\u4f1a\u5148\u5b8c\u6210\u9636\u6bb5\u4e00\u7684\u4e8b\u52a1\u63d0\u4ea4\u6216\u56de\u6eda\uff0c\u5e76\u751f\u6210\u4e8b\u52a1\u56de\u6eda\u7684undo_log\u65e5\u5fd7\uff0c\u540c\u65f6\u6ce8\u518c\u5f53\u524d\u534f\u540c\u670d\u52a1\u5230TC\u5e76\u4e0a\u62a5\u5176\u4e8b\u52a1\u72b6\u6001\uff0c\u5f52\u5e76\u5230\u540c\u4e00\u4e2a\u4e1a\u52a1\u7684\u5168\u5c40\u4e8b\u52a1\u4e2d\u3002\u6b64\u65f6\u82e5\u6ca1\u6709\u95ee\u9898\u7ee7\u7eed\u4e0b\u4e00\u4e2a\u534f\u540c\u670d\u52a1\u7684\u8c03\u7528\uff0c\u671f\u95f4\u4efb\u4f55\u534f\u540c\u670d\u52a1\u7684\u5206\u652f\u4e8b\u52a1\u56de\u6eda\uff0c\u90fd\u4f1a\u901a\u77e5\u5230TC\uff0cTC\u5728\u901a\u77e5\u5168\u5c40\u4e8b\u52a1\u5305\u542b\u7684\u6240\u6709\u5df2\u5b8c\u6210\u4e00\u9636\u6bb5\u63d0\u4ea4\u7684\u5206\u652f\u4e8b\u52a1\u56de\u6eda\u3002\u5982\u679c\u6240\u6709\u5206\u652f\u4e8b\u52a1\u90fd\u6b63\u5e38\uff0c\u6700\u540e\u56de\u5230\u5168\u5c40\u4e8b\u52a1\u53d1\u8d77\u65b9\u65f6\uff0c\u4e5f\u4f1a\u901a\u77e5\u5230TC\uff0cTC\u5728\u901a\u77e5\u5168\u5c40\u4e8b\u52a1\u5305\u542b\u7684\u6240\u6709\u5206\u652f\u5220\u9664\u56de\u6eda\u65e5\u5fd7\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u4e3a\u4e86\u89e3\u51b3\u5199\u9694\u79bb\u548c\u5ea6\u9694\u79bb\u7684\u95ee\u9898\u4f1a\u6d89\u53ca\u5230TC\u7ba1\u7406\u7684\u5168\u5c40\u9501\u3002"),(0,l.kt)("p",null,"\uff08\u589e\u52a0\u8ba2\u5355(branchId=901)\uff0c\u51cf\u5e93\u5b58(branchId=109)\uff09 xid=101"),(0,l.kt)("h3",{id:"23-fescar\u6a21\u5f0f"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-fescar%E6%A8%A1%E5%BC%8F"},"#"),"2.3 Fescar\u6a21\u5f0f"),(0,l.kt)("p",null,"Fescar\u5bf9\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u5b9e\u73b0\u63d0\u4f9b\u4e863\u79cd\u6a21\u5f0f\uff0cAT\u6a21\u5f0f\u548cTCC\u6a21\u5f0f\u3001saga\u6a21\u5f0f\uff1a"),(0,l.kt)("h4",{id:"231-at\u6a21\u5f0f"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-1-at%E6%A8%A1%E5%BC%8F"},"#"),"2.3.1 AT\u6a21\u5f0f"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"AT\u6a21\u5f0f"),"\uff1a\u4e3b\u8981\u5173\u6ce8\u591a DB \u8bbf\u95ee\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u5b9e\u73b0\u8d77\u6765\u6bd4\u8f83\u7b80\u5355\uff0c\u5bf9\u4e1a\u52a1\u7684\u4fb5\u5165\u8f83\u5c0f\uff0c\u4f46\u6027\u80fd\u6ca1\u6709TCC\u9ad8\uff0c\u8fd9\u79cd\u6a21\u5f0f\u63a8\u8350\u5927\u5bb6\u4f7f\u7528\u3002"),(0,l.kt)("p",null,"AT\u6a21\u5f0f\u90e8\u5206\u4ee3\u7801\u5982\u4e0b\uff1a\u4e0d\u9700\u8981\u5173\u6ce8\u6267\u884c\u72b6\u6001\uff0c\u5bf9\u4e1a\u52a1\u4ee3\u7801\u4fb5\u5165\u8f83\u5c0f\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n  * \u6b64\u4ee3\u7801\u4e3a\u793a\u4f8b\u4ee3\u7801, \u4e0d\u9700\u8981\u6f14\u793a, \u4e3b\u8981\u770bAT\u548cTCC\u4ee3\u7801\u7684\u533a\u522b\u4f7f\u7528\n  */\n@GlobalTransactional(timeoutMills = 300000, name = "dubbo-demo-tx")\npublic void purchase(String userId, String commodityCode, int orderCount) {\n    LOGGER.info("purchase begin ... xid: " + RootContext.getXID());\n    storageService.deduct(commodityCode, orderCount);\n    orderService.create(userId, commodityCode, orderCount);\n    throw new RuntimeException("AT \u6a21\u5f0f\u53d1\u751f\u5f02\u5e38\uff0c\u56de\u6eda\u4e8b\u52a1");\n}\n')),(0,l.kt)("p",null,"AT\u6a21\u5f0f\u7684\u6838\u5fc3\u662f\u5bf9\u4e1a\u52a1\u65e0\u4fb5\u5165\uff0c\u662f\u4e00\u79cd\u6539\u8fdb\u540e\u7684\u4e24\u9636\u6bb5\u63d0\u4ea4\uff0c\u5176\u8bbe\u8ba1\u601d\u8def\u5982\u56fe\uff1a"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7b2c\u4e00\u9636\u6bb5\uff1a")),(0,l.kt)("p",null,"\u6838\u5fc3\u5728\u4e8e\u5bf9\u4e1a\u52a1sql\u8fdb\u884c\u89e3\u6790\uff0c\u8f6c\u6362\u6210undolog\uff0c\u4e24\u9636\u6bb5\u63d0\u4ea4\u5f80\u5f80\u5bf9\u8d44\u6e90\u7684\u9501\u5b9a\u9700\u8981\u6301\u7eed\u5230\u7b2c\u4e8c\u9636\u6bb5\u5b9e\u9645\u7684\u63d0\u4ea4\u6216\u8005\u56de\u6eda\u64cd\u4f5c\uff0c\u800c\u6709\u4e86\u56de\u6eda\u65e5\u5fd7\u4e4b\u540e\uff0c\u53ef\u4ee5\u5728\u7b2c\u4e00\u9636\u6bb5\u91ca\u653e\u5bf9\u8d44\u6e90\u7684\u9501\u5b9a\uff0c\u964d\u4f4e\u4e86\u9501\u8303\u56f4\uff0c\u63d0\u9ad8\u6548\u7387\uff0c\u5373\u4f7f\u7b2c\u4e8c\u9636\u6bb5\u53d1\u751f\u5f02\u5e38\u9700\u8981\u56de\u6eda\uff0c\u53ea\u9700\u627e\u5bf9undolog\u4e2d\u5bf9\u5e94\u6570\u636e\u5e76\u53cd\u89e3\u6790\u6210sql\u6765\u8fbe\u5230\u56de\u6eda\u76ee\u7684\u3002Seata\u901a\u8fc7\u4ee3\u7406\u6570\u636e\u6e90\u5c06\u4e1a\u52a1sql\u7684\u6267\u884c\u89e3\u6790\u6210undolog\u6765\u4e0e\u4e1a\u52a1\u6570\u636e\u7684\u66f4\u65b0\u540c\u65f6\u5165\u5e93\uff0c\u8fbe\u5230\u4e86\u5bf9\u4e1a\u52a1\u65e0\u4fb5\u5165\u7684\u6548\u679c\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7b2c\u4e8c\u9636\u6bb5\uff1a")),(0,l.kt)("p",null,"\u5982\u679c\u51b3\u8bae\u662f\u5168\u5c40\u63d0\u4ea4\uff0c\u6b64\u65f6\u5206\u652f\u4e8b\u52a1\u6b64\u65f6\u5df2\u7ecf\u5b8c\u6210\u63d0\u4ea4\uff0c\u4e0d\u9700\u8981\u540c\u6b65\u534f\u8c03\u5904\u7406\uff08\u53ea\u9700\u8981\u5f02\u6b65\u6e05\u7406\u56de\u6eda\u65e5\u5fd7\uff09\uff0cPhase2 \u53ef\u4ee5\u975e\u5e38\u5feb\u901f\u5730\u5b8c\u6210\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u51b3\u8bae\u662f\u5168\u5c40\u56de\u6eda\uff0cRM \u6536\u5230\u534f\u8c03\u5668\u53d1\u6765\u7684\u56de\u6eda\u8bf7\u6c42\uff0c\u901a\u8fc7 XID \u548c Branch ID \u627e\u5230\u76f8\u5e94\u7684\u56de\u6eda\u65e5\u5fd7\u8bb0\u5f55\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u901a\u8fc7\u56de\u6eda\u8bb0\u5f55\u751f\u6210\u53cd\u5411\u7684\u66f4\u65b0 SQL \u5e76\u6267\u884c"),"\uff0c\u4ee5\u5b8c\u6210\u5206\u652f\u7684\u56de\u6eda\u3002"),(0,l.kt)("h4",{id:"233-tcc\u6a21\u5f0f"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-3-tcc%E6%A8%A1%E5%BC%8F"},"#"),"2.3.3 TCC\u6a21\u5f0f"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"TCC\u6a21\u5f0f"),"\uff1aTCC\u8865\u507f\u673a\u5236\uff0c\u5bf9\u4ee3\u7801\u9020\u6210\u4e00\u5b9a\u7684\u4fb5\u5165,\u5b9e\u73b0\u96be\u5ea6\u8f83\u5927\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4e0d\u63a8\u8350\uff0c\u4e0d\u8fc7TCC\u6a21\u5f0f\u7684\u7279\u70b9\u662f\u6027\u80fd\u9ad8\u3002"),(0,l.kt)("p",null,"TCC\u6a21\u5f0f\u90e8\u5206\u4ee3\u7801\u5982\u4e0b\uff1a\u53ef\u4ee5\u770b\u5230\u6267\u884c\u4e8b\u52a1\u56de\u6eda\uff0c\u90fd\u9700\u8981\u6839\u636e\u4e0d\u540c\u9636\u6bb5\u6267\u884c\u7684\u72b6\u6001\u5224\u65ad\uff0c\u4fb5\u5165\u4e86\u4e1a\u52a1\u4ee3\u7801\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u6b64\u4ee3\u7801\u4e3a\u793a\u4f8b\u4ee3\u7801, \u4e0d\u9700\u8981\u6f14\u793a, \u4e3b\u8981\u770bAT\u548cTCC\u4ee3\u7801\u7684\u533a\u522b\u4f7f\u7528\n * \u8f6c\u8d26\u64cd\u4f5c\n * @param from  \u6263\u94b1\u8d26\u6237\n * @param to  \u52a0\u94b1\u8d26\u6237\n * @param amount  \u8f6c\u8d26\u91d1\u989d\n * @return\n */\n@Override\n@GlobalTransactional\npublic boolean transfer(final String from, final String to, final double amount) {\n    //\u6263\u94b1\u53c2\u4e0e\u8005\uff0c\u4e00\u9636\u6bb5\u6267\u884c\n    boolean ret = firstTccAction.prepareMinus(null, from, amount);\n\n    if(!ret){\n        //\u6263\u94b1\u53c2\u4e0e\u8005\uff0c\u4e00\u9636\u6bb5\u5931\u8d25; \u56de\u6eda\u672c\u5730\u4e8b\u52a1\u548c\u5206\u5e03\u5f0f\u4e8b\u52a1\n        throw new RuntimeException("\u8d26\u53f7:["+from+"] \u9884\u6263\u6b3e\u5931\u8d25");\n    }\n\n    //\u52a0\u94b1\u53c2\u4e0e\u8005\uff0c\u4e00\u9636\u6bb5\u6267\u884c\n    ret = secondTccAction.prepareAdd(null, to, amount);\n\n    if(!ret){\n        throw new RuntimeException("\u8d26\u53f7:["+to+"] \u9884\u6536\u6b3e\u5931\u8d25");\n    }\n\n    System.out.println(String.format("transfer amount[%s] from [%s] to [%s] finish.", String.valueOf(amount), from, to));\n    return true;\n}\n')),(0,l.kt)("h4",{id:"233-saga\u6a21\u5f0f"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-3-saga%E6%A8%A1%E5%BC%8F"},"#"),"2.3.3 Saga\u6a21\u5f0f"),(0,l.kt)("p",null,"\u8be6\u89c1 ",(0,l.kt)("a",{parentName:"p",href:"https://seata.io/zh-cn/docs/dev/mode/saga-mode.html"},"https://seata.io/zh-cn/docs/dev/mode/saga-mode.htmlopen in new window")),(0,l.kt)("h2",{id:"3-seata\u6848\u4f8b"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-seata%E6%A1%88%E4%BE%8B"},"#"),"3 Seata\u6848\u4f8b"),(0,l.kt)("h3",{id:"31\u51c6\u5907\u5de5\u4f5c"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-1%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"},"#"),"3.1\u51c6\u5907\u5de5\u4f5c"),(0,l.kt)("p",null," 1\u5bfc\u5165\u8d44\u6599\u4e2d\u7684ydles_common_fescar\u3002\u6ce8\u610f\u603b\u7236\u5de5\u7a0b\u4e2d\u52a0\u5165\u6a21\u5757"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"<module>ydles_common_fescar</module>\n")),(0,l.kt)("p",null," 2\u89c2\u5bdf\u6a21\u5757\u4e2d\u7684\u4e09\u4e2a\u7c7b\u3002"),(0,l.kt)("p",null," ",(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209000033506-c324735a.png",alt:"image-20211209000033506"})),(0,l.kt)("p",null," 3\u6570\u636e\u5e93ydles_order\u4e2d\u7684undo_log\u8868\u4e3a\u8bb0\u5f55\u76f8\u5173\u64cd\u4f5c\u7684\u8868"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209000144424-e15a585c.png",alt:"image-20211209000144424"}),"image-20211209000144424"),(0,l.kt)("p",null,"4\u8d44\u6599\u4e2d\u7684fescar-server-0.4.2\u89e3\u538b\uff0cbin\u76ee\u5f55\u4e2d\u53cc\u51fbfescar-server.bat\u3002",(0,l.kt)("strong",{parentName:"p"},"\u6ce8\u610f"),"\uff1a\u8fd9\u662ffescar\u7684\u670d\u52a1\uff0c\u5e76\u4e14\u653e\u5230\u4e00\u4e2a\u77ed\u76ee\u5f55\u624d\u80fd\u6267\u884c\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209000404624-d97345d0.png",alt:"image-20211209000404624"}),"image-20211209000404624"),(0,l.kt)("h3",{id:"32\u5206\u5e03\u5f0f\u4e8b\u52a1\u9519\u8bef\u6f14\u793a"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-2%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E9%94%99%E8%AF%AF%E6%BC%94%E7%A4%BA"},"#"),"3.2\u5206\u5e03\u5f0f\u4e8b\u52a1\u9519\u8bef\u6f14\u793a"),(0,l.kt)("p",null,"1order\u670d\u52a1 com.ydles.order.service.impl \u7684 add\u65b9\u6cd5\u4e2d\u589e\u52a0\u4e00\u4e2a\u9519\u8bef \u672c\u5730\u4e8b\u52a1\u63a7\u5236\u6ce8\u89e3\u589e\u52a0@Transactional"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'        //\u51cf\u5e93\u5b58\n        skuFeign.decrCount(order.getUsername());\n\n        int i=1/0;\n\n        // 5\uff09\u5220\u9664\u8d2d\u7269\u8f66\u4e2d\u6570\u636e\n        redisTemplate.delete("cart_"+order.getUsername());\n')),(0,l.kt)("p",null,"2goods \u670d\u52a1 com.ydles.goods.service.impl decrCount\u51cf\u5e93\u5b58\u65b9\u6cd5\u4e0a\u589e\u52a0\u672c\u5730\u4e8b\u52a1\u63a7\u5236\u6ce8\u89e3@Transactional"),(0,l.kt)("p",null,"3\u67e5\u770b\u6570\u636e\u5e93 tb_order tb_order_item\u4e2d\u6ca1\u6570\u636e\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001159153-6bf084e1.png",alt:"image-20211209001159153"}),"image-20211209001159153"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001206890-ab28a1d3.png",alt:"image-20211209001206890"}),"image-20211209001206890"),(0,l.kt)("p",null,"tb_sku\u67e5\u770b\u4e00\u6761\u6570\u636e\u5e93\u5b58\u91cf 100"),(0,l.kt)("p",null,"4\u767b\u9646\u8d2d\u7269\u8f66\u5e76\u767b\u9646 ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/list"},"http://localhost:8001/api/wcart/listopen in new window")),(0,l.kt)("p",null,"5\u5f80\u8d2d\u7269\u8f66\u6dfb\u52a0\u6570\u636e ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/add?skuId=1450862568724758528&num=5"},"http://localhost:8001/api/wcart/add?skuId=1450862568724758528&num=5open in new window")),(0,l.kt)("p",null,"6\u8d2d\u7269\u8f66\u9875\u9762\u70b9\u51fb\u7ed3\u7b97\u5230\u8ba2\u5355\u9875\u9762"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001242965-52894bc4.png",alt:"image-20211209001242965"}),"image-20211209001242965"),(0,l.kt)("p",null,"7\u70b9\u51fb\u63d0\u4ea4\u8ba2\u5355"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001233900-dc70a307.png",alt:"image-20211209001233900"}),"image-20211209001233900"),(0,l.kt)("p",null,"8\u4ee3\u7801\u4e2d order\u670d\u52a1\u62a5\u9519"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001252770-1eb805bc.png",alt:"image-20211209001252770"}),"image-20211209001252770"),(0,l.kt)("p",null,"9\u89c2\u5bdf\u6570\u636e\u5e93"),(0,l.kt)("p",null,"tb_order tb_order_item\u6ca1\u53d8"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001159153-6bf084e1.png",alt:"image-20211209001159153"}),"image-20211209001159153"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001206890-ab28a1d3.png",alt:"image-20211209001206890"}),"image-20211209001206890"),(0,l.kt)("p",null,"tb_sku 1450862568724758528\u5546\u54c1\u5e93\u5b58\u51cf\u5c11\u4e865"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001328489-52ca7c07.png",alt:"image-20211209001328489"}),"image-20211209001328489"),(0,l.kt)("p",null,"10 \u4e3a\u4ec0\u4e48"),(0,l.kt)("p",null,"order goods\u670d\u52a1\u662f\u4e24\u4e2a\u670d\u52a1\uff0c\u5373\u4f7f\u52a0\u4e0a@Transactional\u4e5f\u662f\u672c\u5730\u4e8b\u52a1\u63a7\u5236\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001403817-97cc1736.png",alt:"image-20211209001403817"}),"image-20211209001403817"),(0,l.kt)("h3",{id:"33-\u5206\u5e03\u5f0f\u4e8b\u52a1\u6b63\u786e\u6f14\u793a"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%AD%A3%E7%A1%AE%E6%BC%94%E7%A4%BA"},"#"),"3.3 \u5206\u5e03\u5f0f\u4e8b\u52a1\u6b63\u786e\u6f14\u793a"),(0,l.kt)("p",null,"1 goods order \u589e\u52a0fescar\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"        <dependency>\n            <groupId>com.ydles</groupId>\n            <artifactId>ydles_common_fescar</artifactId>\n            <version>1.0-SNAPSHOT</version>\n        </dependency>\n")),(0,l.kt)("p",null,'2\u5728\u8ba2\u5355\u5fae\u670d\u52a1\u7684OrderServiceImpl\u7684add\u65b9\u6cd5\u4e0a\u589e\u52a0@GlobalTransactional(name = "order_add")\u6ce8\u89e3'),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001555985-643dfe75.png",alt:"image-20211209001555985"}),"image-20211209001555985"),(0,l.kt)("p",null,"\u6211\u7684\u8d2d\u7269\u8f66"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001721316-38d5d8e1.png",alt:"image-20211209001721316"}),"image-20211209001721316"),(0,l.kt)("p",null,"\u5230\u7ed3\u7b97\u9875"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001737111-f8df4cdb.png",alt:"image-20211209001737111"}),"image-20211209001737111"),(0,l.kt)("p",null,"\u4e0b\u5355\u5931\u8d25\u4e86"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001813785-c968a192.png",alt:"image-20211209001813785"}),"image-20211209001813785"),(0,l.kt)("p",null,"3order \u670d\u52a1\u91cd\u542f \u89c2\u5bdf fescar\u63a7\u5236\u53f0\u8f93\u51fa"),(0,l.kt)("p",null,"4goods \u670d\u52a1\u91cd\u542f \u89c2\u5bdf fescar\u63a7\u5236\u53f0\u8f93\u51fa"),(0,l.kt)("p",null,"5\u91cd\u65b0\u63d0\u4ea4\u8ba2\u5355 \u4f9d\u7136\u5931\u8d25 \u4f46\u5e93\u5b58\u4e0d\u6263\u51cf\u4e86"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209001946242-ef4fae3f.png",alt:"image-20211209001946242"}),"image-20211209001946242"),(0,l.kt)("h2",{id:"4\u6d88\u606f\u961f\u5217\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1---\u6574\u4e2a\u9879\u76ee\u7684\u91cd\u70b9"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1-%E6%95%B4%E4%B8%AA%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%87%8D%E7%82%B9"},"#"),"4\u6d88\u606f\u961f\u5217\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1---\u6574\u4e2a\u9879\u76ee\u7684\u91cd\u70b9"),(0,l.kt)("h4",{id:"1\u4e1a\u52a1\u6d41\u7a0b-\u91cd\u70b9"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B-%E9%87%8D%E7%82%B9"},"#"),"1\u4e1a\u52a1\u6d41\u7a0b-\u91cd\u70b9"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a\uff08\u4e00\u6b21\u4e0b\u5355---\u300b\u7528\u6237\u79ef\u5206\u589e\u52a0\u4e00\u6b21\uff09 \u4e8b\u52a1"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209011831937-a99b3a5d.png",alt:"image-20211209011831937"}),"image-20211209011831937"),(0,l.kt)("p",null,"1 order"),(0,l.kt)("p",null," 1.1 order task.\u672c\u5730\u4e8b\u52a1\u63a7\u5236\u3002"),(0,l.kt)("p",null," 1.2 spring-task\u626b\u8868 task-----\u300bmq\u53d1\u6d88\u606f"),(0,l.kt)("p",null,"2user"),(0,l.kt)("p",null," 2.1\u76d1\u542c\u6d88\u606f 6"),(0,l.kt)("p",null," 2.2 8\u76f8\u5f53\u4e8e\u9501 11\u91ca\u653e\u9501"),(0,l.kt)("p",null," 2.3 mq\uff08\u53e6\u4e00\u4e2a\u961f\u5217\uff09 task \u79ef\u5206\u52a0\u4e0a\u4e86"),(0,l.kt)("p",null,"3order"),(0,l.kt)("p",null," 3.1\u76d1\u542c\u6d88\u606f task_his \u52a0\u4e0a\uff0c\u540e\u671f\u67e5\u770b\uff0ctask \u5220\u9664"),(0,l.kt)("h4",{id:"2\u4ee3\u7801\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"},"#"),"2\u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("h5",{id:"21\u51c6\u5907"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-1%E5%87%86%E5%A4%87"},"#"),"2.1\u51c6\u5907"),(0,l.kt)("h6",{id:"1order\u4e2d\u6dfb\u52a0\u4e24\u5f20\u8868"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1order%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%B8%A4%E5%BC%A0%E8%A1%A8"},"#"),"1order\u4e2d\u6dfb\u52a0\u4e24\u5f20\u8868"),(0,l.kt)("p",null," tb_task \u4efb\u52a1\u8868"),(0,l.kt)("p",null," ",(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209012241987-10f3aeca.png",alt:"image-20211209012241987"})),(0,l.kt)("p",null," tb_task_his \u5386\u53f2\u4efb\u52a1\u8868"),(0,l.kt)("p",null," ",(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209012312800-ac75811f.png",alt:"image-20211209012312800"})),(0,l.kt)("h6",{id:"2order-api\u4e2d\u6dfb\u52a0\u5bf9\u5e94\u7684\u5b9e\u4f53\u7c7b"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2order-api%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%AF%B9%E5%BA%94%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB"},"#"),"2order-api\u4e2d\u6dfb\u52a0\u5bf9\u5e94\u7684\u5b9e\u4f53\u7c7b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydles.order.pojo;\n\nimport javax.persistence.Column;\nimport javax.persistence.Id;\nimport javax.persistence.Table;\nimport java.util.Date;\n\n@Table(name = "tb_task")\npublic class Task {\n    @Id\n    private Long id;\n\n    @Column(name = "create_time")\n    private Date createTime;\n\n    @Column(name = "update_time")\n    private Date updateTime;\n\n    @Column(name = "delete_time")\n    private Date deleteTime;\n\n    @Column(name = "task_type")\n    private String taskType;\n\n    @Column(name = "mq_exchange")\n    private String mqExchange;\n\n    @Column(name = "mq_routingkey")\n    private String mqRoutingkey;\n\n    @Column(name = "request_body")\n    private String requestBody;\n\n    @Column(name = "status")\n    private String status;\n\n    @Column(name = "errormsg")\n    private String errormsg;\n\n    public Long getId() {\n        return id;\n    }\n\n    public void setId(Long id) {\n        this.id = id;\n    }\n\n    public Date getCreateTime() {\n        return createTime;\n    }\n\n    public void setCreateTime(Date createTime) {\n        this.createTime = createTime;\n    }\n\n    public Date getUpdateTime() {\n        return updateTime;\n    }\n\n    public void setUpdateTime(Date updateTime) {\n        this.updateTime = updateTime;\n    }\n\n    public Date getDeleteTime() {\n        return deleteTime;\n    }\n\n    public void setDeleteTime(Date deleteTime) {\n        this.deleteTime = deleteTime;\n    }\n\n    public String getTaskType() {\n        return taskType;\n    }\n\n    public void setTaskType(String taskType) {\n        this.taskType = taskType;\n    }\n\n    public String getMqExchange() {\n        return mqExchange;\n    }\n\n    public void setMqExchange(String mqExchange) {\n        this.mqExchange = mqExchange;\n    }\n\n    public String getMqRoutingkey() {\n        return mqRoutingkey;\n    }\n\n    public void setMqRoutingkey(String mqRoutingkey) {\n        this.mqRoutingkey = mqRoutingkey;\n    }\n\n    public String getRequestBody() {\n        return requestBody;\n    }\n\n    public void setRequestBody(String requestBody) {\n        this.requestBody = requestBody;\n    }\n\n    public String getStatus() {\n        return status;\n    }\n\n    public void setStatus(String status) {\n        this.status = status;\n    }\n\n    public String getErrormsg() {\n        return errormsg;\n    }\n\n    public void setErrormsg(String errormsg) {\n        this.errormsg = errormsg;\n    }\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydles.order.pojo;\n\nimport javax.persistence.Column;\nimport javax.persistence.Id;\nimport javax.persistence.Table;\nimport java.util.Date;\n\n@Table(name = "tb_task_his")\npublic class TaskHis {\n\n    @Id\n    private Long id;\n\n    @Column(name = "create_time")\n    private Date createTime;\n\n    @Column(name = "update_time")\n    private Date updateTime;\n\n    @Column(name = "delete_time")\n    private Date deleteTime;\n\n    @Column(name = "task_type")\n    private String taskType;\n\n    @Column(name = "mq_exchange")\n    private String mqExchange;\n\n    @Column(name = "mq_routingkey")\n    private String mqRoutingkey;\n\n    @Column(name = "request_body")\n    private String requestBody;\n\n    @Column(name = "status")\n    private String status;\n\n    @Column(name = "errormsg")\n    private String errormsg;\n\n    public Long getId() {\n        return id;\n    }\n\n    public void setId(Long id) {\n        this.id = id;\n    }\n\n    public Date getCreateTime() {\n        return createTime;\n    }\n\n    public void setCreateTime(Date createTime) {\n        this.createTime = createTime;\n    }\n\n    public Date getUpdateTime() {\n        return updateTime;\n    }\n\n    public void setUpdateTime(Date updateTime) {\n        this.updateTime = updateTime;\n    }\n\n    public Date getDeleteTime() {\n        return deleteTime;\n    }\n\n    public void setDeleteTime(Date deleteTime) {\n        this.deleteTime = deleteTime;\n    }\n\n    public String getTaskType() {\n        return taskType;\n    }\n\n    public void setTaskType(String taskType) {\n        this.taskType = taskType;\n    }\n\n    public String getMqExchange() {\n        return mqExchange;\n    }\n\n    public void setMqExchange(String mqExchange) {\n        this.mqExchange = mqExchange;\n    }\n\n    public String getMqRoutingkey() {\n        return mqRoutingkey;\n    }\n\n    public void setMqRoutingkey(String mqRoutingkey) {\n        this.mqRoutingkey = mqRoutingkey;\n    }\n\n    public String getRequestBody() {\n        return requestBody;\n    }\n\n    public void setRequestBody(String requestBody) {\n        this.requestBody = requestBody;\n    }\n\n    public String getStatus() {\n        return status;\n    }\n\n    public void setStatus(String status) {\n        this.status = status;\n    }\n\n    public String getErrormsg() {\n        return errormsg;\n    }\n\n    public void setErrormsg(String errormsg) {\n        this.errormsg = errormsg;\n    }\n}\n')),(0,l.kt)("h6",{id:"3-ydles_user\u65b0\u589e\u79ef\u5206\u65e5\u5fd7\u8868"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-ydles-user%E6%96%B0%E5%A2%9E%E7%A7%AF%E5%88%86%E6%97%A5%E5%BF%97%E8%A1%A8"},"#"),"3 ydles_user\u65b0\u589e\u79ef\u5206\u65e5\u5fd7\u8868"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209012706482-2e5c4330.png",alt:"image-20211209012706482"}),"image-20211209012706482"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209012742948-cad23f23.png",alt:"image-20211209012742948"}),"image-20211209012742948"),(0,l.kt)("h6",{id:"4-ydles_service_user_api\u6dfb\u52a0\u5b9e\u4f53\u7c7b-pointlog"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-ydles-service-user-api%E6%B7%BB%E5%8A%A0%E5%AE%9E%E4%BD%93%E7%B1%BB-pointlog"},"#"),"4 ydles_service_user_api\u6dfb\u52a0\u5b9e\u4f53\u7c7b PointLog"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydles.user.pojo;\n\nimport javax.persistence.Table;\n\n@Table(name = "tb_point_log")\npublic class PointLog {\n\n    private String orderId;\n    private String userId;\n    private Integer point;\n\n    public String getOrderId() {\n        return orderId;\n    }\n\n    public void setOrderId(String orderId) {\n        this.orderId = orderId;\n    }\n\n    public String getUserId() {\n        return userId;\n    }\n\n    public void setUserId(String userId) {\n        this.userId = userId;\n    }\n\n    public Integer getPoint() {\n        return point;\n    }\n\n    public void setPoint(Integer point) {\n        this.point = point;\n    }\n}\n')),(0,l.kt)("h6",{id:"5rabbitmq"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_5rabbitmq"},"#"),"5rabbitMQ"),(0,l.kt)("p",null,"1 order \u670d\u52a1 \u5bfc\u5305"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"        <dependency>\n            <groupId>org.springframework.amqp</groupId>\n            <artifactId>spring-rabbit</artifactId>\n        </dependency>\n")),(0,l.kt)("p",null,"2config \u4e0b rabbitMQ\u914d\u7f6e\u7c7b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydles.order.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\npublic class RabbitMQConfig {\n\n    //\u6dfb\u52a0\u79ef\u5206\u4efb\u52a1\u4ea4\u6362\u673a\n    public static final String EX_BUYING_ADDPOINTUSER = "ex_buying_addpointuser";\n\n    //\u6dfb\u52a0\u79ef\u5206\u6d88\u606f\u961f\u5217\n    public static final String CG_BUYING_ADDPOINT = "cg_buying_addpoint";\n\n    //\u5b8c\u6210\u6dfb\u52a0\u79ef\u5206\u6d88\u606f\u961f\u5217\n    public static final String CG_BUYING_FINISHADDPOINT = "cg_buying_finishaddpoint";\n\n    //\u6dfb\u52a0\u79ef\u5206\u8def\u7531key\n    public static final String CG_BUYING_ADDPOINT_KEY = "addpoint";\n\n    //\u5b8c\u6210\u6dfb\u52a0\u79ef\u5206\u8def\u7531key\n    public static final String CG_BUYING_FINISHADDPOINT_KEY = "finishaddpoint";\n\n    //\u58f0\u660e\u4ea4\u6362\u673a\n    @Bean(EX_BUYING_ADDPOINTUSER)\n    public Exchange EX_BUYING_ADDPOINTUSER(){\n        return ExchangeBuilder.directExchange(EX_BUYING_ADDPOINTUSER).durable(true).build();\n    }\n\n    //\u58f0\u660e\u961f\u5217\n    @Bean(CG_BUYING_ADDPOINT)\n    public Queue CG_BUYING_ADDPOINT(){\n        Queue queue = new Queue(CG_BUYING_ADDPOINT);\n        return queue;\n    }\n    @Bean(CG_BUYING_FINISHADDPOINT)\n    public Queue CG_BUYING_FINISHADDPOINT(){\n        Queue queue = new Queue(CG_BUYING_FINISHADDPOINT);\n        return queue;\n    }\n\n    //\u961f\u5217\u7ed1\u5b9a\u4ea4\u6362\u673a\n    @Bean\n    public Binding BINDING_CG_BUYING_ADDPOINT(@Qualifier(CG_BUYING_ADDPOINT) Queue queue, @Qualifier(EX_BUYING_ADDPOINTUSER)Exchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(CG_BUYING_ADDPOINT_KEY).noargs();\n    }\n    @Bean\n    public Binding BINDING_CG_BUYING_FINISHADDPOINT(@Qualifier(CG_BUYING_FINISHADDPOINT) Queue queue,@Qualifier(EX_BUYING_ADDPOINTUSER)Exchange exchange){\n        return BindingBuilder.bind(queue).to(exchange).with(CG_BUYING_FINISHADDPOINT_KEY).noargs();\n    }\n}\n')),(0,l.kt)("p",null,"3\u914d\u7f6e\u6587\u4ef6 rabbitmq"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"  rabbitmq:\n    host: 192.168.200.128\n")),(0,l.kt)("h5",{id:"22-\u8ba2\u5355\u670d\u52a1\u903b\u8f91"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1%E9%80%BB%E8%BE%91"},"#"),"2.2 \u8ba2\u5355\u670d\u52a1\u903b\u8f91"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209014056551-aab52bfa.png",alt:"image-20211209014056551"}),"image-20211209014056551"),(0,l.kt)("h6",{id:"1dao\u5c42-\u589e\u52a0mapper"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1dao%E5%B1%82-%E5%A2%9E%E5%8A%A0mapper"},"#"),"1dao\u5c42 \u589e\u52a0mapper"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"package com.ydles.order.dao;\n\nimport com.ydles.order.pojo.Task;\nimport tk.mybatis.mapper.common.Mapper;\n\npublic interface TaskMapper extends Mapper<Task> {\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"package com.ydles.order.dao;\n\nimport com.ydles.order.pojo.TaskHis;\nimport tk.mybatis.mapper.common.Mapper;\n\npublic interface TaskHisMapper extends Mapper<TaskHis> {\n}\n")),(0,l.kt)("h6",{id:"2\u4e0b\u5355\u903b\u8f91\u4e2d\u589e\u52a0\u4efb\u52a1"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2%E4%B8%8B%E5%8D%95%E9%80%BB%E8%BE%91%E4%B8%AD%E5%A2%9E%E5%8A%A0%E4%BB%BB%E5%8A%A1"},"#"),"2\u4e0b\u5355\u903b\u8f91\u4e2d\u589e\u52a0\u4efb\u52a1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"    @Autowired\n    TaskMapper taskMapper;\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'        // int i=1/0;\n        //\u6dfb\u52a0\u4efb\u52a1\u6570\u636e\n        System.out.println("\u5411\u8ba2\u5355\u6570\u636e\u5e93\u4e2d\u7684\u4efb\u52a1\u8868\u53bb\u6dfb\u52a0\u4efb\u52a1\u6570\u636e");\n        Task task = new Task();\n        task.setCreateTime(new Date());\n        task.setUpdateTime(new Date());\n        task.setMqExchange(RabbitMQConfig.EX_BUYING_ADDPOINTUSER);\n        task.setMqRoutingkey(RabbitMQConfig.CG_BUYING_ADDPOINT_KEY);\n\n        Map map = new HashMap();\n        map.put("username",order.getUsername());\n        map.put("orderId",orderId);\n        map.put("point",order.getPayMoney());\n        task.setRequestBody(JSON.toJSONString(map));\n        taskMapper.insertSelective(task);\n')),(0,l.kt)("h6",{id:"3\u5b9a\u65f6\u4efb\u52a1\u5b9a\u65f6\u53d1\u9001\u4efb\u52a1\u8868\u4fe1\u606f\u5230mq"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1-%E5%AE%9A%E6%97%B6%E5%8F%91%E9%80%81%E4%BB%BB%E5%8A%A1%E8%A1%A8%E4%BF%A1%E6%81%AF%E5%88%B0mq"},"#"),"3\u5b9a\u65f6\u4efb\u52a1\uff0c\u5b9a\u65f6\u53d1\u9001\u4efb\u52a1\u8868\u4fe1\u606f\u5230mq"),(0,l.kt)("p",null,"\u542f\u52a8\u7c7b\u589e\u52a0"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"@EnableScheduling //\u5f00\u542f\u5b9a\u65f6\u4efb\u52a1\n")),(0,l.kt)("p",null,"\u65b0\u5efatask\u5305\uff0c\u52a0\u5165\u5b9a\u65f6\u4efb\u52a1\u7c7b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class QueryPointTask {\n    @Autowired\n    private TaskMapper taskMapper;\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n    @Scheduled(cron = "0/2 * * * * ?")\n    public void queryTask(){\n        //1. \u83b7\u53d6\u5c0f\u4e8e\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4\u7684\u6570\u636e\n        List<Task> taskList = taskMapper.findTaskLessThanCurrentTime(new Date());\n        if (taskList != null && taskList.size()>0){\n            //2.\u5c06\u4efb\u52a1\u53d1\u9001\u5230\u6d88\u606f\u961f\u5217\u4e0a\n            for (Task task : taskList) {\n                rabbitTemplate.convertAndSend(RabbitMQConfig.EX_BUYING_ADDPOINTUSER, RabbitMQConfig.CG_BUYING_ADDPOINT_KEY, JSON.toJSONString(task));\n                System.out.println("\u8ba2\u5355\u670d\u52a1\u5411\u6dfb\u52a0\u79ef\u5206\u961f\u5217\u53d1\u9001\u4e86\u4e00\u6761\u6d88\u606f");\n            }\n        }\n    }\n}\n')),(0,l.kt)("p",null,"taskmapper\u4e2d\u81ea\u5b9a\u4e49\u67e5\u8be2\u5c0f\u4e8e\u5f53\u524d\u65f6\u95f4\u7684\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'    @Select("select * from tb_task where update_time<#{currentTime}")\n    @Results({@Result(column = "create_time",property = "createTime"),\n            @Result(column = "update_time",property = "updateTime"),\n            @Result(column = "delete_time",property = "deleteTime"),\n            @Result(column = "task_type",property = "taskType"),\n            @Result(column = "mq_exchange",property = "mqExchange"),\n            @Result(column = "mq_routingkey",property = "mqRoutingkey"),\n            @Result(column = "request_body",property = "requestBody"),\n            @Result(column = "status",property = "status"),\n            @Result(column = "errormsg",property = "errormsg")})\n    List<Task> findTaskLessThanCurrentTime(Date currentTime);\n')),(0,l.kt)("h5",{id:"23-\u7528\u6237\u670d\u52a1\u903b\u8f91"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E9%80%BB%E8%BE%91"},"#"),"2.3 \u7528\u6237\u670d\u52a1\u903b\u8f91"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209021057873-d9d4537d.png",alt:"image-20211209021057873"}),"image-20211209021057873"),(0,l.kt)("h6",{id:"1\u914d\u7f6e\u6587\u4ef6\u589e\u52a0redis-rabbitmq\u914d\u7f6e"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A2%9E%E5%8A%A0redis-rabbitmq%E9%85%8D%E7%BD%AE"},"#"),"1\u914d\u7f6e\u6587\u4ef6\u589e\u52a0redis rabbitMQ\u914d\u7f6e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"spring:\n  application:\n    name: user\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://192.168.200.128:3306/ydles_user?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC\n    username: root\n    password: root\n  main:\n    allow-bean-definition-overriding: true #\u5f53\u9047\u5230\u540c\u6837\u540d\u5b57\u7684\u65f6\u5019\uff0c\u662f\u5426\u5141\u8bb8\u8986\u76d6\u6ce8\u518c\n  redis:\n    host: 192.168.200.128\n  rabbitmq:\n    host: 192.168.200.128\n")),(0,l.kt)("h6",{id:"2\u5bfc\u5165mq\u4f9d\u8d56"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2%E5%AF%BC%E5%85%A5mq%E4%BE%9D%E8%B5%96"},"#"),"2\u5bfc\u5165mq\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"        <dependency>\n            <groupId>org.springframework.amqp</groupId>\n            <artifactId>spring-rabbit</artifactId>\n        </dependency>\n")),(0,l.kt)("h6",{id:"3mq\u914d\u7f6e\u7c7b"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3mq%E9%85%8D%E7%BD%AE%E7%B1%BB"},"#"),"3mq\u914d\u7f6e\u7c7b"),(0,l.kt)("p",null,"RabbitMQConfig \uff0c\u4eceorder\u670d\u52a1copy"),(0,l.kt)("h6",{id:"4\u6dfb\u52a0\u4f9d\u8d56"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"},"#"),"4\u6dfb\u52a0\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"        <dependency>\n            <groupId>com.ydles</groupId>\n            <artifactId>ydles_service_order_api</artifactId>\n            <version>1.0-SNAPSHOT</version>\n        </dependency>\n")),(0,l.kt)("h6",{id:"4\u76d1\u542cmq\u961f\u5217"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4%E7%9B%91%E5%90%ACmq%E9%98%9F%E5%88%97"},"#"),"4\u76d1\u542cmq\u961f\u5217"),(0,l.kt)("p",null,"com.ydles.user.listener\u521b\u5efaAddPointListener"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydles.user.listener;\n\nimport com.alibaba.fastjson.JSON;\nimport com.ydles.order.pojo.Task;\nimport com.ydles.user.config.RabbitMQConfig;\nimport com.ydles.user.service.UserService;\nimport org.apache.commons.lang.StringUtils;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class AddPointListener {\n\n    @Autowired\n    private RedisTemplate redisTemplate;\n\n    @Autowired\n    private UserService userService;\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @RabbitListener(queues = RabbitMQConfig.CG_BUYING_ADDPOINT)\n    public void receiveAddPointMessage(String message){\n        System.out.println("\u7528\u6237\u670d\u52a1\u63a5\u6536\u5230\u4e86\u4efb\u52a1\u6d88\u606f");\n\n        //\u8f6c\u6362\u6d88\u606f\n        Task task = JSON.parseObject(message, Task.class);\n        if (task == null || StringUtils.isEmpty(task.getRequestBody())){\n            return;\n        }\n\n        //\u5224\u65adredis\u4e2d\u5f53\u524d\u7684\u4efb\u52a1\u662f\u5426\u5b58\u5728\n        Object value = redisTemplate.boundValueOps(task.getId()).get();\n        if (value != null){\n            return;\n        }\n     \n}\n')),(0,l.kt)("h6",{id:"5\u66f4\u65b0\u79ef\u5206\u65b9\u6cd5\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_5%E6%9B%B4%E6%96%B0%E7%A7%AF%E5%88%86%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"},"#"),"5\u66f4\u65b0\u79ef\u5206\u65b9\u6cd5\u5b9e\u73b0"),(0,l.kt)("p",null,"1userService \u5b9a\u4e49\u63a5\u53e3"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"int updateUserPoint(Task task);\n")),(0,l.kt)("p",null,"\u5b9e\u73b0\u7c7b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Override\n    @Transactional\n    public int updateUserPoint(Task task) {\n        System.out.println("\u7528\u6237\u670d\u52a1\u73b0\u5728\u5f00\u59cb\u5bf9\u4efb\u52a1\u8fdb\u884c\u5904\u7406");\n        //1.\u4ecetask\u4e2d\u83b7\u53d6\u76f8\u5173\u6570\u636e\n        Map map = JSON.parseObject(task.getRequestBody(), Map.class);\n        String username = map.get("username").toString();\n        String orderId = map.get("orderId").toString();\n        int point = (int) map.get("point");\n\n        //2.\u5224\u65ad\u5f53\u524d\u7684\u4efb\u52a1\u662f\u5426\u64cd\u4f5c\u8fc7\n        PointLog pointLog = pointLogMapper.findPointLogByOrderId(orderId);\n        if (pointLog != null){\n            return 0;\n        }\n\n        //3.\u5c06\u4efb\u52a1\u5b58\u5165\u5230redis\u4e2d\n        redisTemplate.boundValueOps(task.getId()).set("exist",30, TimeUnit.SECONDS);\n\n        //4.\u4fee\u6539\u7528\u6237\u79ef\u5206\n        int result = userMapper.updateUserPoint(username,point);\n        if (result<=0){\n            return 0;\n        }\n\n        //5.\u8bb0\u5f55\u79ef\u5206\u65e5\u5fd7\u4fe1\u606f\n        pointLog = new PointLog();\n        pointLog.setUserId(username);\n        pointLog.setOrderId(orderId);\n        pointLog.setPoint(point);\n        result = pointLogMapper.insertSelective(pointLog);\n        if (result <= 0){\n            return 0;\n        }\n\n        //6.\u5220\u9664redis\u4e2d\u7684\u4efb\u52a1\u4fe1\u606f\n        redisTemplate.delete(task.getId());\n        System.out.println("\u7528\u6237\u670d\u52a1\u5b8c\u6210\u4e86\u66f4\u6539\u7528\u6237\u79ef\u5206\u7684\u64cd\u4f5c");\n        return 1;\n    }\n')),(0,l.kt)("p",null,"2dao\u5c42\u65b0\u5efamapper,\u67e5\u8be2\u5f53\u524d\u4efb\u52a1\u662f\u5426\u64cd\u4f5c\u8fc7"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydles.user.dao;\n\nimport com.ydles.user.pojo.PointLog;\nimport org.apache.ibatis.annotations.Param;\nimport org.apache.ibatis.annotations.Select;\nimport tk.mybatis.mapper.common.Mapper;\n\npublic interface PointLogMapper extends Mapper<PointLog> {\n\n    @Select("select * from tb_point_log where order_id =#{orderId}")\n    PointLog findPointLogByOrderId(@Param("orderId") String orderId);\n}\n')),(0,l.kt)("p",null,"3userMapper\u65b0\u589e\u4e00\u4e2a\u4fee\u6539\u7528\u6237\u79ef\u5206\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydles.user.dao;\n\nimport com.ydles.user.pojo.User;\nimport org.apache.ibatis.annotations.Param;\nimport org.apache.ibatis.annotations.Update;\nimport tk.mybatis.mapper.common.Mapper;\n\npublic interface UserMapper extends Mapper<User> {\n\n    @Update("update tb_user set points=points+#{point} where username=#{username}")\n    int updateUserPoint(@Param("username")String username, @Param("point") int point);\n}\n')),(0,l.kt)("p",null,"4AddPointListener\u5b8c\u5584"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydles.user.listener;\n\nimport com.alibaba.fastjson.JSON;\nimport com.ydles.order.pojo.Task;\nimport com.ydles.user.config.RabbitMQConfig;\nimport com.ydles.user.service.UserService;\nimport org.apache.commons.lang.StringUtils;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class AddPointListener {\n\n    @Autowired\n    private RedisTemplate redisTemplate;\n\n    @Autowired\n    private UserService userService;\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @RabbitListener(queues = RabbitMQConfig.CG_BUYING_ADDPOINT)\n    public void receiveAddPointMessage(String message){\n        System.out.println("\u7528\u6237\u670d\u52a1\u63a5\u6536\u5230\u4e86\u4efb\u52a1\u6d88\u606f");\n\n        //1\u8f6c\u6362\u6d88\u606f\n        Task task = JSON.parseObject(message, Task.class);\n        if (task == null || StringUtils.isEmpty(task.getRequestBody())){\n            return;\n        }\n\n        //2\u5224\u65adredis\u4e2d\u5f53\u524d\u7684\u4efb\u52a1\u662f\u5426\u5b58\u5728\n        Object value = redisTemplate.boundValueOps(task.getId()).get();\n        if (value != null){\n            return;\n        }\n\n        //3\u66f4\u65b0\u7528\u6237\u79ef\u5206\n        int result = userService.updateUserPoint(task);\n        if (result == 0){\n            return;\n        }\n\n        //4\u5411\u8ba2\u5355\u670d\u52a1\u8fd4\u56de\u901a\u77e5\u6d88\u606f\n        rabbitTemplate.convertAndSend(RabbitMQConfig.EX_BUYING_ADDPOINTUSER,RabbitMQConfig.CG_BUYING_FINISHADDPOINT_KEY,JSON.toJSONString(task));\n        System.out.println("\u7528\u6237\u670d\u52a1\u5411\u5b8c\u6210\u6dfb\u52a0\u79ef\u5206\u961f\u5217\u53d1\u9001\u4e86\u4e00\u6761\u6d88\u606f");\n    }\n}\n')),(0,l.kt)("h5",{id:"24\u8ba2\u5355\u670d\u52a1\u6536\u5c3e"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-4%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1%E6%94%B6%E5%B0%BE"},"#"),"2.4\u8ba2\u5355\u670d\u52a1\u6536\u5c3e"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209025157447-875bd352.png",alt:"image-20211209025157447"}),"image-20211209025157447"),(0,l.kt)("p",null,"\u5efa\u7acb\u76d1\u542c\u7c7bDelTaskListener"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydles.order.listener;\n\nimport com.alibaba.fastjson.JSON;\nimport com.ydles.order.config.RabbitMQConfig;\nimport com.ydles.order.pojo.Task;\nimport com.ydles.order.service.TaskService;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class DelTaskListener {\n\n    @Autowired\n    private TaskService taskService;\n\n    @RabbitListener(queues = RabbitMQConfig.CG_BUYING_FINISHADDPOINT)\n    public void receiveDelTaskMessage(String message){\n        System.out.println("\u8ba2\u5355\u670d\u52a1\u63a5\u6536\u5230\u4e86\u5220\u9664\u4efb\u52a1\u64cd\u4f5c\u7684\u6d88\u606f");\n\n        Task task = JSON.parseObject(message, Task.class);\n\n        //\u5220\u9664\u539f\u6709\u7684\u4efb\u52a1\u6570\u636e,\u5e76\u5411\u5386\u53f2\u4efb\u52a1\u8868\u4e2d\u6dfb\u52a0\u8bb0\u5f55\n        taskService.delTask(task);\n    }\n}\n')),(0,l.kt)("p",null,"\u521b\u5efataskService\u5199\u51fa\u5220\u9664\u4efb\u52a1\u7684\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public interface TaskService {\n    void delTask(Task task);\n}\n")),(0,l.kt)("p",null,"\u5b9e\u73b0taskService"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydles.order.service.impl;\n\nimport com.ydles.order.dao.TaskHisMapper;\nimport com.ydles.order.dao.TaskMapper;\nimport com.ydles.order.pojo.Task;\nimport com.ydles.order.pojo.TaskHis;\nimport com.ydles.order.service.TaskService;\nimport org.springframework.beans.BeanUtils;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.util.Date;\n\n@Service\npublic class TaskServiceImpl implements TaskService {\n\n    @Autowired\n    private TaskHisMapper taskHisMapper;\n\n    @Autowired\n    private TaskMapper taskMapper;\n\n    @Override\n    @Transactional\n    public void delTask(Task task) {\n\n        //1.\u8bb0\u5f55\u5220\u9664\u65f6\u95f4\n        task.setDeleteTime(new Date());\n        Long taskId = task.getId();\n        task.setId(null);\n\n        //2bean\u62f7\u8d1d\n        TaskHis taskHis = new TaskHis();\n        BeanUtils.copyProperties(task,taskHis);\n\n        //3\u8bb0\u5f55\u5386\u53f2\u4efb\u52a1\u6570\u636e\n        taskHisMapper.insertSelective(taskHis);\n\n        //4\u5220\u9664\u539f\u6709\u4efb\u52a1\u6570\u636e\n        //taskMapper.deleteByPrimaryKey(id);\n        task.setId(id);\n        taskMapper.delete(task);\n        System.out.println("\u8ba2\u5355\u670d\u52a1\u5b8c\u6210\u4e86\u6dfb\u52a0\u5386\u53f2\u4efb\u52a1\u5e76\u5220\u9664\u539f\u6709\u4efb\u52a1\u7684\u64cd\u4f5c");\n    }\n}\n')),(0,l.kt)("h5",{id:"25\u6548\u679c\u6d4b\u8bd5"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-5%E6%95%88%E6%9E%9C%E6%B5%8B%E8%AF%95"},"#"),"2.5\u6548\u679c\u6d4b\u8bd5"),(0,l.kt)("p",null,"order user\u670d\u52a1\u4ee5dubug\u6253\u5f00\u3002"),(0,l.kt)("p",null,"\u4ece\u5934\u5230\u6700\u540e\u4e00\u6b65\u4e00\u6b65\u6d4b\u8bd5\u3002\u5173\u952e\u70b9\uff1a"),(0,l.kt)("p",null,"1order\u4e0b\u5355\u4efb\u52a1\u8868\u4e2d\u6570\u636e"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209031308844-2811c4fc.png",alt:"image-20211209031308844"}),"image-20211209031308844"),(0,l.kt)("p",null,"2order \u5b9a\u65f6\u4efb\u52a1\u626b\u63cf\u8868\uff0c\u53d1\u4fe1\u606f"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209031315436-18d67ccf.png",alt:"image-20211209031315436"}),"image-20211209031315436"),(0,l.kt)("p",null,"3user\u6536\u5230\u4fe1\u606f\uff0c\u68c0\u67e5redis,\u4fee\u6539\u79ef\u5206"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209031335319-40546e9b.png",alt:"image-20211209031335319"}),"image-20211209031335319"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209031344811-26114b41.png",alt:"image-20211209031344811"}),"image-20211209031344811"),(0,l.kt)("p",null,"4order\u6536\u5230\u6210\u529f\u6d88\u606f"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209031259362-016343a5.png",alt:"image-20211209031259362"}),"image-20211209031259362"),(0,l.kt)("p",null,"\u603b\u7ed3\uff1a"),(0,l.kt)("p",null,"1\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848"),(0,l.kt)("p",null,"\u4e8b\u52a1\uff1aACID \u9762\u8bd5\u5fc5\u95ee\uff0c\u9694\u79bb\u7ea7\u522b\uff0c\u4f20\u64ad\u884c\u4e3a"),(0,l.kt)("p",null,"\u672c\u5730\u4e8b\u52a1\uff1a@transactional"),(0,l.kt)("p",null,"\u5206\u5e03\u5f0f\u4e8b\u52a1"),(0,l.kt)("p",null,"2\u89e3\u51b3\u65b9\u6848"),(0,l.kt)("p",null,"2.1xa 2pc mysql"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208174923396-2412462d.png",alt:"image-20211208174923396"}),"image-20211208174923396"),(0,l.kt)("p",null,"2.2 tcc"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208180127771-6e94911f.png",alt:"image-20211208180127771"}),"image-20211208180127771"),(0,l.kt)("p",null,"2.3 \u6d88\u606f\u961f\u5217"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211208221414338-a08cee39.png",alt:"image-20211208221414338"}),"image-20211208221414338"),(0,l.kt)("p",null,"3Seata"),(0,l.kt)("p",null,"4\u4e0b\u5355 \u4f7f\u7528\u6d88\u606f\u961f\u5217\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211209011831937-a99b3a5d.png",alt:"image-20211209011831937"}),"image-20211209011831937"),(0,l.kt)("h1",{id:"\u7b2c13\u7ae0-\u5fae\u4fe1\u626b\u7801\u652f\u4ed8"},(0,l.kt)("a",{parentName:"h1",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E7%AC%AC13%E7%AB%A0-%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E6%94%AF%E4%BB%98"},"#"),"\u7b2c13\u7ae0 \u5fae\u4fe1\u626b\u7801\u652f\u4ed8"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u89d2\u8272"),"\uff1a \u652f\u4ed8\u76f8\u5173\u6a21\u5757\u7684\u5f00\u53d1\u5de5\u7a0b\u5e08\uff0c\u96be\u3002"),(0,l.kt)("h2",{id:"\u5b66\u4e60\u76ee\u6807-1"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87-1"},"#"),"\u5b66\u4e60\u76ee\u6807\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u80fd\u591f\u6839\u636e\u5fae\u4fe1\u652f\u4ed8\u7684\u5f00\u53d1\u6587\u6863\u8c03\u7528\u5fae\u4fe1\u652f\u4ed8\u7684api"),(0,l.kt)("li",{parentName:"ul"},"\u5b8c\u6210\u7edf\u4e00\u4e0b\u5355\u751f\u6210\u5fae\u4fe1\u652f\u4ed8\u4e8c\u7ef4\u7801\u529f\u80fd"),(0,l.kt)("li",{parentName:"ul"},"\u5b8c\u6210\u652f\u4ed8\u56de\u8c03\u7684\u903b\u8f91\u5904\u7406"),(0,l.kt)("li",{parentName:"ul"},"\u5b8c\u6210\u63a8\u9001\u652f\u4ed8\u901a\u77e5\u529f\u80fd")),(0,l.kt)("h2",{id:"1-\u5fae\u4fe1\u652f\u4ed8\u5feb\u901f\u5165\u95e8"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"},"#"),"1. \u5fae\u4fe1\u652f\u4ed8\u5feb\u901f\u5165\u95e8"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"data:image/png;base64,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",alt:"img"})),(0,l.kt)("p",null,"native \u652f\u4ed8\u6587\u6863\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=6_1"},"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=6_1open in new window")),(0,l.kt)("h3",{id:"11-\u5fae\u4fe1\u652f\u4ed8\u7533\u8bf7\u4e86\u89e3"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-1-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E7%94%B3%E8%AF%B7-%E4%BA%86%E8%A7%A3"},"#"),"1.1 \u5fae\u4fe1\u652f\u4ed8\u7533\u8bf7\uff08\u4e86\u89e3\uff09"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7b2c\u4e00\u6b65\uff1a\u6ce8\u518c\u516c\u4f17\u53f7\uff08\u7c7b\u578b\u987b\u4e3a\uff1a\u670d\u52a1\u53f7\uff09")),(0,l.kt)("p",null,"\u8bf7\u6839\u636e\u8425\u4e1a\u6267\u7167\u7c7b\u578b\u9009\u62e9\u4ee5\u4e0b\u4e3b\u4f53\u6ce8\u518c\uff1a",(0,l.kt)("a",{parentName:"p",href:"http://kf.qq.com/faq/120911VrYVrA151009JB3i2Q.html"},"\u4e2a\u4f53\u5de5\u5546\u6237open in new window"),"| ",(0,l.kt)("a",{parentName:"p",href:"http://kf.qq.com/faq/120911VrYVrA151013MfYvYV.html"},"\u4f01\u4e1a/\u516c\u53f8open in new window"),"| ",(0,l.kt)("a",{parentName:"p",href:"http://kf.qq.com/faq/161220eaAJjE161220IJn6zU.html"},"\u653f\u5e9copen in new window"),"| ",(0,l.kt)("a",{parentName:"p",href:"http://kf.qq.com/faq/161220IFBJFv161220YnqAbQ.html"},"\u5a92\u4f53open in new window"),"| ",(0,l.kt)("a",{parentName:"p",href:"http://kf.qq.com/faq/120911VrYVrA151013nYFZ7Z.html"},"\u5176\u4ed6\u7c7b\u578bopen in new window"),"\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7b2c\u4e8c\u6b65\uff1a\u8ba4\u8bc1\u516c\u4f17\u53f7")),(0,l.kt)("p",null,"\u516c\u4f17\u53f7\u8ba4\u8bc1\u540e\u624d\u53ef\u7533\u8bf7\u5fae\u4fe1\u652f\u4ed8\uff0c\u8ba4\u8bc1\u8d39\uff1a",(0,l.kt)("strong",{parentName:"p"},"300\u5143/\u6b21"),"\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7b2c\u4e09\u6b65\uff1a\u63d0\u4ea4\u8d44\u6599\u7533\u8bf7\u5fae\u4fe1\u652f\u4ed8")),(0,l.kt)("p",null,"\u767b\u5f55\u516c\u4f17\u5e73\u53f0\uff0c\u70b9\u51fb\u5de6\u4fa7\u83dc\u5355\u3010\u5fae\u4fe1\u652f\u4ed8\u3011\uff0c\u5f00\u59cb\u586b\u5199\u8d44\u6599\u7b49\u5f85\u5ba1\u6838\uff0c\u5ba1\u6838\u65f6\u95f4\u4e3a1-5\u4e2a\u5de5\u4f5c\u65e5\u5185\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7b2c\u56db\u6b65\uff1a\u5f00\u6237\u6210\u529f\uff0c\u767b\u5f55\u5546\u6237\u5e73\u53f0\u8fdb\u884c\u9a8c\u8bc1")),(0,l.kt)("p",null,"\u8d44\u6599\u5ba1\u6838\u901a\u8fc7\u540e\uff0c\u8bf7\u767b\u5f55\u8054\u7cfb\u4eba\u90ae\u7bb1\u67e5\u6536\u5546\u6237\u53f7\u548c\u5bc6\u7801\uff0c\u5e76\u767b\u5f55\u5546\u6237\u5e73\u53f0\u586b\u5199\u8d22\u4ed8\u901a\u5907\u4ed8\u91d1\u6253\u7684\u5c0f\u989d\u8d44\u91d1\u6570\u989d\uff0c\u5b8c\u6210\u8d26\u6237\u9a8c\u8bc1\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7b2c\u4e94\u6b65\uff1a\u5728\u7ebf\u7b7e\u7f72\u534f\u8bae")),(0,l.kt)("p",null,"\u672c\u534f\u8bae\u4e3a\u7ebf\u4e0a\u7535\u5b50\u534f\u8bae\uff0c\u7b7e\u7f72\u540e\u65b9\u53ef\u8fdb\u884c\u4ea4\u6613\u53ca\u8d44\u91d1\u7ed3\u7b97\uff0c\u7b7e\u7f72\u5b8c\u7acb\u5373\u751f\u6548\u3002"),(0,l.kt)("p",null,"\u672c\u8bfe\u7a0b\u5df2\u7ecf\u63d0\u4f9b\u597d\u201c\u5143\u52a8\u529b\u6559\u80b2\u201d\u7684\u5fae\u4fe1\u652f\u4ed8\u8d26\u53f7\uff0c\u5b66\u5458\u65e0\u9700\u7533\u8bf7\u3002"),(0,l.kt)("p",null,"\u5b8c\u6210\u4e0a\u8ff0\u6b65\u9aa4\uff0c\u4f60\u53ef\u4ee5\u5f97\u5230\u8c03\u7528API\u7528\u5230\u7684\u8d26\u53f7\u548c\u5bc6\u94a5"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff01\uff01\uff01\uff01\u771f\u5b9e\u5730\u6d4b\u8bd5\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5199\u7684\u63a5\u53e3\uff0c\u94b1\u90fd\u4f1a\u7ed9\u6211\u4eec\u5143\u52a8\u529b\u3002\u94b1\u4e00\u5b9a\u8bbe\u7f6e\u62101\u5206\u94b1\u3002")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"appid"),"\uff1a\u5fae\u4fe1\u516c\u4f17\u8d26\u53f7\u6216\u5f00\u653e\u5e73\u53f0APP\u7684\u552f\u4e00\u6807\u8bc6 wxababcd122d1618eb"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"mch_id"),"\uff1a\u5546\u6237\u53f7 1611671554"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"key"),"\uff1a\u5546\u6237\u5bc6\u94a5 ydlclass66666688888YDLCLASS66688"),(0,l.kt)("h3",{id:"12-\u5fae\u4fe1\u652f\u4ed8\u5f00\u53d1\u6587\u6863\u4e0esdk"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-2-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3%E4%B8%8Esdk"},"#"),"1.2 \u5fae\u4fe1\u652f\u4ed8\u5f00\u53d1\u6587\u6863\u4e0eSDK"),(0,l.kt)("p",null,"\u5728\u7ebf\u5fae\u4fe1\u652f\u4ed8\u5f00\u53d1\u6587\u6863\uff1a"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://pay.weixin.qq.com/wiki/doc/api/index.html"},"https://pay.weixin.qq.com/wiki/doc/api/index.htmlopen in new window")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_1"},"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_1open in new window")),(0,l.kt)("p",null,"\u5fae\u4fe1\u652f\u4ed8\u63a5\u53e3\u8c03\u7528\u7684\u6574\u4f53\u601d\u8def\uff1a"),(0,l.kt)("p",null,"\u6309API\u8981\u6c42\u7ec4\u88c5\u53c2\u6570\uff0c\u4ee5XML\u65b9\u5f0f\u53d1\u9001\uff08POST\uff09\u7ed9\u5fae\u4fe1\u652f\u4ed8\u63a5\u53e3\uff08URL\uff09,\u5fae\u4fe1\u652f\u4ed8\u63a5\u53e3\u4e5f\u662f\u4ee5XML\u65b9\u5f0f\u7ed9\u4e88\u54cd\u5e94\u3002\u7a0b\u5e8f\u6839\u636e\u8fd4\u56de\u7684\u7ed3\u679c\uff08\u5176\u4e2d\u5305\u62ec\u652f\u4ed8URL\uff09\u751f\u6210\u4e8c\u7ef4\u7801\u6216\u5224\u65ad\u8ba2\u5355\u72b6\u6001\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u89e3\u538b\u4ece\u5b98\u7f51\u4e0b\u8f7d\u7684sdk ,\u5b89\u88c5\u5230\u672c\u5730\u4ed3\u5e93"),(0,l.kt)("p",null,"com.github.wxpay.sdk.WXPay\u7c7b\u4e0b\u63d0\u4f9b\u4e86\u5bf9\u5e94\u7684\u65b9\u6cd5\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u65b9\u6cd5\u540d"),(0,l.kt)("th",{parentName:"tr",align:null},"\u8bf4\u660e"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"microPay"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5237\u5361\u652f\u4ed8")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"unifiedOrder"),(0,l.kt)("td",{parentName:"tr",align:null},"\u7edf\u4e00\u4e0b\u5355")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"orderQuery"),(0,l.kt)("td",{parentName:"tr",align:null},"\u67e5\u8be2\u8ba2\u5355")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"reverse"),(0,l.kt)("td",{parentName:"tr",align:null},"\u64a4\u9500\u8ba2\u5355")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"closeOrder"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5173\u95ed\u8ba2\u5355")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"refund"),(0,l.kt)("td",{parentName:"tr",align:null},"\u7533\u8bf7\u9000\u6b3e")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"refundQuery"),(0,l.kt)("td",{parentName:"tr",align:null},"\u67e5\u8be2\u9000\u6b3e")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"downloadBill"),(0,l.kt)("td",{parentName:"tr",align:null},"\u4e0b\u8f7d\u5bf9\u8d26\u5355")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"report"),(0,l.kt)("td",{parentName:"tr",align:null},"\u4ea4\u6613\u4fdd\u969c")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"shortUrl"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8f6c\u6362\u77ed\u94fe\u63a5")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"authCodeToOpenid"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6388\u6743\u7801\u67e5\u8be2openid")))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6d4b\u8bd5\u5de5\u7a0b")),(0,l.kt)("p",null,"1\u521b\u5efatest_pay ,\u5bfc\u5165\u4f9d\u8d56\u3002",(0,l.kt)("strong",{parentName:"p"},"\u5c06\u6211\u7684\u4ed3\u5e93com.github.wxpay\u76f8\u5173\u5305\u53d1\u7ed9\u5b66\u751f\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependencies>\n    <dependency>\n        <groupId>com.github.wxpay</groupId>\n        <artifactId>wxpay-sdk</artifactId>\n        <version>3.0.9</version>\n    </dependency>\n    <dependency>\n        <groupId>commons-logging</groupId>\n        <artifactId>commons-logging</artifactId>\n        <version>1.2</version>\n    </dependency>\n</dependencies>\n")),(0,l.kt)("p",null,"2\u521b\u5efa\u914d\u7f6e\u7c7b ",(0,l.kt)("strong",{parentName:"p"},"\u6ce8\u610f"),"\uff1a\u5305\u540d\u5fc5\u987b\u4e3acom.github.wxpay.sdk"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.github.wxpay.sdk;\n\nimport java.io.InputStream;\n\npublic class MyConfig extends WXPayConfig {\n    //\u6b63\u5f0f\n    public String getAppID() {\n        return "wxababcd122d1618eb";\n    }\n\n    public String getMchID() {\n        return "1611671554";\n    }\n\n    //\u6d4b\u8bd5\n    public String getKey() {\n        return "ydlclass66666688888YDLCLASS66688";\n    }\n    //\u6b63\u5f0f\n    //public String getKey() {\n    //    return "0c804332f41cbf77b014d7096ae900f6";\n    //}\n\n    public InputStream getCertStream() {\n        return null;\n    }\n\n    public IWXPayDomain getWXPayDomain() {\n        return new IWXPayDomain() {\n            public void report(String s, long l, Exception e) {\n            }\n\n            public DomainInfo getDomain(WXPayConfig wxPayConfig) {\n                return new DomainInfo("api.mch.weixin.qq.com", true);\n            }\n        };\n    }\n}\n')),(0,l.kt)("p",null,"3\u6d4b\u8bd5\u7c7b \u5305\u540d\u968f\u610f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package ydles.test;\n\nimport com.github.wxpay.sdk.MyConfig;\nimport com.github.wxpay.sdk.WXPay;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n/**\n * creste by ydles.itcast\n */\npublic class PayTest {\n    public static void main(String[] args) throws Exception {\n        MyConfig myConfig=new MyConfig();\n        WXPay wxPay=new WXPay(myConfig);\n\n        //\u6839\u636e\u5b98\u65b9\u6587\u6863 \u5fc5\u586b\u503c\u5c01\u88c5\u6570\u636e\n        Map<String,String> map = new HashMap<>();\n        map.put("body", "\u5143\u52a8\u529b\u4e8c\u5962");\n        map.put("out_trade_no", "123654");\n        map.put("total_fee", "1");\n        map.put("spbill_create_ip", "127.0.0.1");\n        map.put("notify_url", "http://www.baidu.com");\n        map.put("trade_type", "NATIVE");\n\n        Map<String, String> resultMap = wxPay.unifiedOrder(map);\n        System.out.println(resultMap);\n\n    }\n}\n')),(0,l.kt)("p",null,"4\u5f97\u5230"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"{nonce_str=l1pTBT12JvPIN0lO, code_url=weixin://wxpay/bizpayurl?pr=PFNjrIXzz, appid=wxababcd122d1618eb, sign=FF218956CA8C00145F4BACBC0AA843012E2DE2498FAAD4809769EB367582340A, trade_type=NATIVE, return_msg=OK, result_code=SUCCESS, mch_id=1611671554, return_code=SUCCESS, prepay_id=wx15174918803690023343d15a9737140000}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"QRcode")),(0,l.kt)("p",null,"1\u6253\u5f00\u8d44\u6e90\u6587\u4ef6\u5939 weixinpay.html"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211215175333830-b1e5218d.png",alt:"image-20211215175333830"}),"image-20211215175333830"),(0,l.kt)("p",null,"\u652f\u4ed8\u56fe\u7247\u4e3aqrcode.js\u751f\u6210\u3002\u4fee\u6539\u6e90\u4ee3\u7801\u4e3a\u672c\u4eba\u751f\u6210\u7684\uff0c\u5373\u53ef\u5fae\u4fe1\u626b\u63cf\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'qrcode.makeCode("weixin://wxpay/bizpayurl?pr=PFNjrIXzz");\n')),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211215175246842-329dfb39.png",alt:"image-20211215175246842"}),"image-20211215175246842"),(0,l.kt)("h2",{id:"2-\u5fae\u4fe1\u652f\u4ed8\u4e8c\u7ef4\u7801"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E4%BA%8C%E7%BB%B4%E7%A0%81"},"#"),"2. \u5fae\u4fe1\u652f\u4ed8\u4e8c\u7ef4\u7801"),(0,l.kt)("h3",{id:"21-\u9700\u6c42\u5206\u6790"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"},"#"),"2.1 \u9700\u6c42\u5206\u6790"),(0,l.kt)("p",null,"\u7528\u6237\u5728\u63d0\u4ea4\u8ba2\u5355\u540e\uff0c\u5982\u679c\u662f\u9009\u62e9\u652f\u4ed8\u65b9\u5f0f\u4e3a\u5fae\u4fe1\u652f\u4ed8\uff0c\u90a3\u5e94\u8be5\u8df3\u8f6c\u5230\u5fae\u4fe1\u652f\u4ed8\u4e8c\u7ef4\u7801\u9875\u9762\uff0c\u7528\u6237\u626b\u63cf\u4e8c\u7ef4\u7801\u53ef\u4ee5\u8fdb\u884c\u652f\u4ed8\uff0c\u91d1\u989d\u4e0e\u8ba2\u5355\u91d1\u989d\u76f8\u540c\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6d41\u7a0b\uff1a\u5546\u54c1\u8be6\u60c5\u9875-----\u300b\u8d2d\u7269\u8f66-----\u300b\u8ba2\u5355----\u300b\u652f\u4ed8\u65b9\u5f0fpay.html------\u300b\u5fae\u4fe1\u652f\u4ed8\u9875weixinpay.html--------\u300b\u652f\u4ed8\u6210\u529f")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221110506739-ccd04c86.png",alt:"image-20211221110506739"}),"image-20211221110506739"),(0,l.kt)("h3",{id:"22-\u5b9e\u73b0\u601d\u8def"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"},"#"),"2.2 \u5b9e\u73b0\u601d\u8def"),(0,l.kt)("p",null,"\u524d\u7aef\u9875\u9762\u5411\u540e\u7aef\u4f20\u9012\u8ba2\u5355\u53f7\uff0c\u540e\u7aef\u6839\u636e\u8ba2\u5355\u53f7\u67e5\u8be2\u8ba2\u5355\uff0c\u68c0\u67e5\u662f\u5426\u4e3a\u5f53\u524d\u7528\u6237\u7684\u672a\u652f\u4ed8\u8ba2\u5355\uff0c\u5982\u679c\u662f\u5219\u6839\u636e\u8ba2\u5355\u53f7\u548c\u91d1\u989d\u751f\u6210\u652f\u4ed8url\u8fd4\u7ed9\u524d\u7aef\uff0c\u524d\u7aef\u5f97\u5230\u652f\u4ed8url\u751f\u6210\u652f\u4ed8\u4e8c\u7ef4\u7801\u3002"),(0,l.kt)("h3",{id:"23-\u4ee3\u7801\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"},"#"),"2.3 \u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("h4",{id:"231-\u63d0\u4ea4\u8ba2\u5355\u8df3\u8f6c\u652f\u4ed8\u9875"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-1-%E6%8F%90%E4%BA%A4%E8%AE%A2%E5%8D%95%E8%B7%B3%E8%BD%AC%E6%94%AF%E4%BB%98%E9%A1%B5"},"#"),"2.3.1 \u63d0\u4ea4\u8ba2\u5355\u8df3\u8f6c\u652f\u4ed8\u9875"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u8ba2\u5355----\u300b\u652f\u4ed8\u65b9\u5f0fpay.html")),(0,l.kt)("p",null,"1\u66f4\u65b0ydles_service_order"),(0,l.kt)("p",null,"OrderServiceImpl\u4e2dadd() ,\u8bbe\u7f6e\u8fd4\u56de\u503c\u4e3a\u8ba2\u5355Id"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public String add(Order order) \n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"//\u6700\u540e\u8fd4\u56de\nreturn order.getId();\n")),(0,l.kt)("p",null,"OrderService"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"String add(Order order);\n")),(0,l.kt)("p",null,"OrderController"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'String orderId = orderService.add(order);\nreturn new Result(true,StatusCode.OK,"\u6dfb\u52a0\u6210\u529f",orderId);\n')),(0,l.kt)("p",null,"2\u4fee\u6539web-order\u4e2d\u63d0\u4ea4\u8ba2\u5355\u9875\u9762\uff0c\u4e0b\u5355\u6210\u529f\u8df3\u8f6c\u81f3\u9009\u62e9\u652f\u4ed8\u9875\u9762\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'if (response.data.flag){\n    //\u6dfb\u52a0\u8ba2\u5355\u6210\u529f\n    alert("\u6dfb\u52a0\u8ba2\u5355\u6210\u529f");\n    var orderId = response.data.data;\n    location.href="/api/worder/toPayPage?orderId="+orderId;\n} else{\n    alert("\u6dfb\u52a0\u8ba2\u5355\u5931\u8d25");\n}\n')),(0,l.kt)("p",null,"3\u5728OrderController\u4e2d\u65b0\u589e\u65b9\u6cd5\uff0c\u7528\u4e8e\u8df3\u8f6c\u652f\u4ed8\u9875"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@GetMapping("/toPayPage")\npublic String toPayPage(String orderId,Model model){\n    //\u83b7\u53d6\u5230\u8ba2\u5355\u7684\u76f8\u5173\u4fe1\u606f\n    Order order = orderFeign.findById(orderId).getData();\n    model.addAttribute("orderId",orderId);\n    model.addAttribute("payMoney",order.getPayMoney());\n    return "pay";\n}\n')),(0,l.kt)("p",null,"4order\u670d\u52a1\u4e2d\u5df2\u7ecf\u6709\u65b9\u6cd5\uff1aorderController\u4e2d \u6839\u636e\u8ba2\u5355id\u67e5\u8be2\u8ba2\u5355\u4fe1\u606f findById"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/***\n     * \u6839\u636eID\u67e5\u8be2\u6570\u636e\n     * @param id\n     * @return\n     */\n@GetMapping("/{id}")\npublic Result findById(@PathVariable String id){\n    Order order = orderService.findById(id);\n    return new Result(true,StatusCode.OK,"\u67e5\u8be2\u6210\u529f",order);\n}\n')),(0,l.kt)("p",null,"\u628a\u5b83\u66b4\u9732\u51fa\u53bb OrderFeign"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@FeignClient(name = "order")\npublic interface OrderFeign {\n\n    @PostMapping("/order")\n    public Result add(@RequestBody Order order);\n\n\n    @GetMapping("/order/{id}")\n    public Result<Order> findById(@PathVariable String id);\n}\n')),(0,l.kt)("p",null,"5\u76f8\u5173\u9875\u9762\u653e\u81f3resources"),(0,l.kt)("p",null,"6\u6d4b\u8bd5"),(0,l.kt)("p",null,"\u767b\u9646 ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/oauth/toLogin"},"http://localhost:8001/api/oauth/toLoginopen in new window")),(0,l.kt)("p",null,"\u6dfb\u52a0\u5546\u54c1\uff1a ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/add?skuId=1450862568724758528&num=5"},"http://localhost:8001/api/wcart/add?skuId=1450862568724758528&num=5open in new window")),(0,l.kt)("p",null,"\u67e5\u770b\u8d2d\u7269\u8f66\uff1a ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/list"},"http://localhost:8001/api/wcart/listopen in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221114601627-e567585a.png",alt:"image-20211221114601627"}),"image-20211221114601627"),(0,l.kt)("p",null,"\u70b9\u51fb\u7ed3\u7b97"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221114628720-ea35e002.png",alt:"image-20211221114628720"}),"image-20211221114628720"),(0,l.kt)("p",null,"\u70b9\u51fb\u63d0\u4ea4\u8ba2\u5355\uff0c\u8df3\u8f6c\u81f3\u652f\u4ed8\u9875\u9762"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221114637493-2fe67dc8.png",alt:"image-20211221114637493"}),"image-20211221114637493"),(0,l.kt)("h4",{id:"232-\u652f\u4ed8\u5fae\u670d\u52a1\u6743\u9650\u96c6\u6210"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-2-%E6%94%AF%E4%BB%98%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90%E9%9B%86%E6%88%90"},"#"),"2.3.2 \u652f\u4ed8\u5fae\u670d\u52a1\u6743\u9650\u96c6\u6210"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221144256113-e80b69c9.png",alt:"image-20211221144256113"}),"image-20211221144256113"),(0,l.kt)("p",null,"1service\u4e8c\u7ea7\u76ee\u5f55\u4e0b\uff0c\u65b0\u5efa\u5fae\u670d\u52a1ydles_service_pay"),(0,l.kt)("p",null,"2\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependencies>\n    <dependency>\n        <groupId>com.ydles</groupId>\n        <artifactId>ydles_common</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </dependency>\n    <dependency>\n        <groupId>com.github.wxpay</groupId>\n        <artifactId>wxpay-sdk</artifactId>\n        <version>3.0.9</version>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter</artifactId>\n        <exclusions>\n            <exclusion>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-starter-logging</artifactId>\n            </exclusion>\n        </exclusions>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-amqp</artifactId>\n    </dependency>\n</dependencies>\n")),(0,l.kt)("p",null,"3\u914d\u7f6e\u6587\u4ef6 application.yml"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"server:\n  port: 9010\nspring:\n  application:\n    name: pay\n  rabbitmq:\n    host: 192.168.200.128\n  main:\n    allow-bean-definition-overriding: true #\u5f53\u9047\u5230\u540c\u6837\u540d\u5b57\u7684\u65f6\u5019\uff0c\u662f\u5426\u5141\u8bb8\u8986\u76d6\u6ce8\u518c\neureka:\n  client:\n    service-url:\n      defaultZone: http://127.0.0.1:6868/eureka\n  instance:\n    prefer-ip-address: true\nwxpay:\n  notify_url: http://itlils.cross.echosite.cn/wxpay/notify #\u56de\u8c03\u5730\u5740\n")),(0,l.kt)("p",null,"4\u5fae\u4fe1\u652f\u4ed8\u914d\u7f6e\u7c7b\uff0ccopy\u3002\u6ce8\u610f\u5305\u540d"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.github.wxpay.sdk;\n\nimport java.io.InputStream;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201cIT\u674e\u54e5\u4ea4\u670b\u53cb\u201d\n * \u4e2a\u4eba\u5fae itlils\n *  \u5fae\u4fe1\u652f\u4ed8\u914d\u7f6e\u7c7b\uff0c\u653e\u7740\u5546\u6237\u7684\u76f8\u5173\u4fe1\u606f\n */\npublic class MyConfig extends WXPayConfig{\n\n    @Override\n    String getAppID() {\n        return "wxababcd122d1618eb";\n    }\n\n    @Override\n    String getMchID() {\n        return "1611671554";\n    }\n\n    @Override\n    String getKey() {\n        return "ydlclass66666688888YDLCLASS66688";\n    }\n\n    @Override\n    InputStream getCertStream() {\n        return null;\n    }\n\n    @Override\n    IWXPayDomain getWXPayDomain() {\n        return new IWXPayDomain() {\n            @Override\n            public void report(String s, long l, Exception e) {\n\n            }\n\n            @Override\n            public DomainInfo getDomain(WXPayConfig wxPayConfig) {\n                return new DomainInfo("api.mch.weixin.qq.com", true);\n            }\n        };\n    }\n}\n')),(0,l.kt)("p",null,"5\u542f\u52a8\u7c7b com.ydles.pay\u4e0b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"package com.ydles.pay;\nimport com.github.wxpay.sdk.MyConfig;\nimport com.github.wxpay.sdk.WXPay;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.netflix.eureka.EnableEurekaClient;\nimport org.springframework.context.annotation.Bean;\n\n@SpringBootApplication\n@EnableEurekaClient\npublic class PayApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(PayApplication.class,args);\n    }\n\n    @Bean\n    public WXPay wxPay(){\n        try {\n            return new WXPay(new MyConfig());\n        } catch (Exception e) {\n            e.printStackTrace();\n            return  null;\n        }\n    }\n}\n")),(0,l.kt)("h4",{id:"233-\u652f\u4ed8\u5fae\u670d\u52a1-\u4e0b\u5355"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-3-%E6%94%AF%E4%BB%98%E5%BE%AE%E6%9C%8D%E5%8A%A1-%E4%B8%8B%E5%8D%95"},"#"),"2.3.3 \u652f\u4ed8\u5fae\u670d\u52a1-\u4e0b\u5355"),(0,l.kt)("p",null,"ydles_service_pay\u670d\u52a1"),(0,l.kt)("p",null,"\uff081\uff09\u521b\u5efacom.ydles.pay.service\u5305\uff0c\u5305\u4e0b\u521b\u5efa\u63a5\u53e3WxPayService"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"package com.ydles.pay.service;\n\nimport java.util.Map;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201cIT\u674e\u54e5\u4ea4\u670b\u53cb\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\npublic interface WxPayService {\n    //\u5fae\u4fe1\u4e0b\u5355\u8981\u4e8c\u7ef4\u7801\n    public Map nativePay(String orderId,Integer money);\n}\n")),(0,l.kt)("p",null,"\uff082\uff09\u521b\u5efacom.ydles.pay.service.impl \u5305 ,\u65b0\u589e\u670d\u52a1\u7c7bWxPayServiceImpl \u62d3\u5c55\uff1a\u6d89\u53ca\u94b1\u7684\u8ba1\u7b97\uff0c\u6ce8\u610f\u7528BigDecimal ",(0,l.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/zhangyinhua/p/11545305.html"},"https://www.cnblogs.com/zhangyinhua/p/11545305.htmlopen in new window")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201cIT\u674e\u54e5\u4ea4\u670b\u53cb\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@Service\npublic class WxPayServiceImpl implements WxPayService {\n    @Autowired\n    WXPay wxPay;\n\n    @Override\n    public Map nativePay(String orderId, Integer money) {\n        try {\n            //\u6839\u636e\u5b98\u65b9\u6587\u6863 \u8bf7\u6c42\u63a5\u53e3\n            Map<String, String> reqData=new HashMap<>();\n            reqData.put("body","\u52a8\u529b\u4e8c\u5962\u4e0b\u5355\u652f\u4ed8");\n            reqData.put("out_trade_no", orderId);\n\n            //\u91d1\u94b1\u8ba1\u7b97 BigDecimal:\u91d1\u989d\u548c\u8ba1\u7b97\u90fd\u7528\u4ed6\u7684\n            BigDecimal yuan=new BigDecimal("0.01");\n            BigDecimal beishu=new BigDecimal(100);\n            BigDecimal fen = yuan.multiply(beishu);\n            fen=fen.setScale(0,BigDecimal.ROUND_UP);\n            reqData.put("total_fee", String.valueOf(fen));\n\n            reqData.put("spbill_create_ip", "192.168.1.1");\n            reqData.put("notify_url", "http://www.baidu.com");\n            reqData.put("trade_type", "NATIVE");\n\n            Map<String, String> resultMap = wxPay.unifiedOrder(reqData);\n            System.out.println(resultMap);\n            return resultMap;\n        }catch (Exception e){\n            e.printStackTrace();\n            return null;\n        }\n    }\n}\n')),(0,l.kt)("p",null,"\uff083\uff09\u521b\u5efacom.ydles.pay.controller\u5305 \uff0c\u65b0\u589eWxPayController"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201cIT\u674e\u54e5\u4ea4\u670b\u53cb\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@RestController\n@RequestMapping("/wxpay")\npublic class WxPayController {\n    @Autowired\n    WxPayService wxPayService;\n\n    //\u5fae\u4fe1\u4e0b\u5355\n    @GetMapping("/nativePay")\n    public Result<Map> nativePay(@RequestParam("orderId")String orderId,@RequestParam("money")Integer money){\n        Map map = wxPayService.nativePay(orderId, money);\n        return new Result(true, StatusCode.OK,"\u5fae\u4fe1\u4e0b\u5355\u6210\u529f",map);\n    }\n}\n')),(0,l.kt)("p",null,"\u6d4b\u8bd5\uff1a",(0,l.kt)("a",{parentName:"p",href:"http://localhost:9010/wxpay/nativePay?orderId=123321&money=1"},"http://localhost:9010/wxpay/nativePay?orderId=123321&money=1open in new window")," \u8ba2\u5355\u53f7\u53ef\u80fd\u91cd\u590d\uff0c\u5927\u5bb6\u6362\u4e00\u4e0b\u5c31\u597d\u4e86\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221150107575-b9d3c8e2.png",alt:"image-20211221150107575"}),"image-20211221150107575"),(0,l.kt)("h4",{id:"233-\u652f\u4ed8\u6e32\u67d3\u9875\u9762\u5fae\u670d\u52a1"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-3-%E6%94%AF%E4%BB%98%E6%B8%B2%E6%9F%93%E9%A1%B5%E9%9D%A2%E5%BE%AE%E6%9C%8D%E5%8A%A1"},"#"),"2.3.3 \u652f\u4ed8\u6e32\u67d3\u9875\u9762\u5fae\u670d\u52a1"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u652f\u4ed8\u65b9\u5f0fpay.html------\u300b\u5fae\u4fe1\u652f\u4ed8\u9875weixinpay.html")),(0,l.kt)("p",null,"\u9875\u9762\u9700\u8981\u8c03\u7528\u6211\u4eec\u7684\u5fae\u670d\u52a1\uff0c\u6240\u4ee5\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221151905932-a25f40c9.png",alt:"image-20211221151905932"}),"image-20211221151905932"),(0,l.kt)("p",null,"\uff081\uff09\u65b0\u589eydles_service_pay_api\u6a21\u5757 \uff0cpom.xml\u4e2d\u52a0\u5165\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependencies>\n    <dependency>\n        <groupId>com.ydles</groupId>\n        <artifactId>ydles_common</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </dependency>\n</dependencies>\n")),(0,l.kt)("p",null,"\u65b0\u589ecom.ydles.pay.feign\u5305\uff0c\u5305\u4e0b\u521b\u5efa\u63a5\u53e3"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@FeignClient(name = "pay")\npublic interface PayFeign {\n\n    @GetMapping("/wxpay/nativePay")\n    public Result nativePay(@RequestParam("orderId") String orderId, @RequestParam("money") Integer money);\n}\n')),(0,l.kt)("p",null,"\uff082\uff09ydles_web_order\u7684pom.xml\u52a0\u5165\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>com.ydles</groupId>\n    <artifactId>ydles_service_pay_api</artifactId>\n    <version>1.0-SNAPSHOT</version>\n</dependency>\n")),(0,l.kt)("p",null,"\u542f\u52a8\u7c7b\u589e\u52a0\u626b\u5305"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'@EnableFeignClients(basePackages = {"com.ydles.pay.feign","com.ydles.order.feign","com.ydles.user.feign"})\n')),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221152256881-6a50d8de.png",alt:"image-20211221152256881"}),"image-20211221152256881"),(0,l.kt)("p",null,"ydles_web_order\u65b0\u589ePayController"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Controller\n@RequestMapping("/wxpay")\npublic class PayController {\n\n    @Autowired\n    private OrderFeign orderFeign;\n\n    @Autowired\n    private PayFeign payFeign;\n\n    //\u8df3\u8f6c\u5230\u5fae\u4fe1\u652f\u4ed8\u4e8c\u7ef4\u7801\u9875\u9762\n    @GetMapping\n    public String wxPay(String orderId , Model model){\n        //1.\u6839\u636eorderid\u67e5\u8be2\u8ba2\u5355,\u5982\u679c\u8ba2\u5355\u4e0d\u5b58\u5728,\u8df3\u8f6c\u5230\u9519\u8bef\u9875\u9762\n        Result<Order> orderResult = orderFeign.findById(orderId);\n        if (orderResult.getData() == null){\n            return "fail";\n        }\n\n        //2.\u6839\u636e\u8ba2\u5355\u7684\u652f\u4ed8\u72b6\u6001\u8fdb\u884c\u5224\u65ad,\u5982\u679c\u4e0d\u662f\u672a\u652f\u4ed8\u7684\u8ba2\u5355,\u8df3\u8f6c\u5230\u9519\u8bef\u9875\u9762\n        Order order = orderResult.getData();\n        if (!"0".equals(order.getPayStatus())){\n            return "fail";\n        }\n\n        //3.\u57fa\u4e8epayFeign\u8c03\u7528\u7edf\u8ba1\u4e0b\u5355\u63a5\u53e3,\u5e76\u83b7\u53d6\u8fd4\u56de\u7ed3\u679c\n        Result payResult = payFeign.nativePay(orderId, order.getPayMoney());\n        if (payResult.getData() == null){\n            return "fail";\n        }\n\n        //4.\u5c01\u88c5\u7ed3\u679c\u6570\u636e\n        Map payMap = (Map) payResult.getData();\n        payMap.put("orderId",orderId);\n        payMap.put("payMoney",order.getPayMoney());\n\n        model.addAllAttributes(payMap);\n        return "wxpay";\n    }\n')),(0,l.kt)("p",null,"\uff084\uff09\u5c06\u9759\u6001\u539f\u578b\u4e2dwxpay.html\u62f7\u8d1d\u5230templates\u6587\u4ef6\u5939\u4e0b\u4f5c\u4e3a\u6a21\u677f\uff0c\u4fee\u6539\u6a21\u677f\uff0c\u90e8\u5206\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("p",null,"\u4e8c\u7ef4\u7801\u5730\u5740\u6e32\u67d3"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"qrcode.makeCode([[${code_url}]]);\n")),(0,l.kt)("p",null,"\u67e5\u770b\u663e\u793a\u8ba2\u5355\u53f7\u4e0e\u91d1\u989d"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<h4 class="fl tit-txt"><span class="success-icon"></span><span  class="success-info" th:text="|\u8ba2\u5355\u63d0\u4ea4\u6210\u529f\uff0c\u8bf7\u60a8\u53ca\u65f6\u4ed8\u6b3e\uff01\u8ba2\u5355\u53f7\uff1a${orderId}|"></span></h4>\n<span class="fr"><em class="sui-lead">\u5e94\u4ed8\u91d1\u989d\uff1a</em><em  class="orange money" th:text="${#numbers.formatDecimal(payMoney/100.0,1,2)}"></em>\u5143</span>\n')),(0,l.kt)("p",null,"pay.html"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<li><a th:href="|/api/wxpay?orderId=${orderId}|"><img src="/./image/_/pay3.jpg"></a> </li>\n')),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221154450109-0d8fe381.png",alt:"image-20211221154450109"}),"image-20211221154450109"),(0,l.kt)("p",null,"ydles_gateway_web\u9879\u76ee\u7684application.yml\u6587\u4ef6\u52a0\u5165"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"#\u8d2d\u7269\u8f66\u8ba2\u5355\u6e32\u67d3\u5fae\u670d\u52a1\n        - id: ydles_order_web_route\n          uri: lb://order-web\n          predicates:\n            - Path=/api/wcart/**,/api/worder/**,/api/wxpay/**\n          filters:\n            - StripPrefix=1\n")),(0,l.kt)("p",null,"\u67e5\u770bydles_gateway_web\u9879\u76ee\u7684UrlFilter.java\u4e2d"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public static String orderFilterPath = "/api/wpay,/api/wpay/**,/api/worder/**,/api/user/**,\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6d4b\u8bd5")),(0,l.kt)("p",null,"1\u91cd\u542fgatewaty-web service-pay web-order"),(0,l.kt)("p",null,"2\u6dfb\u52a0\u5546\u54c1\uff1a ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/add?skuId=1450862568724758528&num=5"},"http://localhost:8001/api/wcart/add?skuId=1450862568724758528&num=5open in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221162207178-7d37ab54.png",alt:"image-20211221162207178"}),"image-20211221162207178"),(0,l.kt)("p",null,"3\u67e5\u770b\u8d2d\u7269\u8f66\uff1a ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/list"},"http://localhost:8001/api/wcart/listopen in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221162214876-3626ccaa.png",alt:"image-20211221162214876"}),"image-20211221162214876"),(0,l.kt)("p",null,"4\u70b9\u51fb\uff1a\u7ed3\u7b97---\u300b\u63d0\u4ea4\u8ba2\u5355--\u300b\u9009\u62e9\u5fae\u4fe1\u652f\u4ed8--\u300b\u8df3\u5230\u4e8c\u7ef4\u7801\u9875\u9762--\u300b\u626b\u63cf\u4e8c\u7ef4\u7801\uff0c\u4f60\u5c06\u635f\u59311\u5206\u94b1\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221200858087-5edd9c41.png",alt:"image-20211221200858087"}),"image-20211221200858087"),(0,l.kt)("h2",{id:"3-\u652f\u4ed8\u56de\u8c03\u903b\u8f91\u5904\u7406"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-%E6%94%AF%E4%BB%98%E5%9B%9E%E8%B0%83%E9%80%BB%E8%BE%91%E5%A4%84%E7%90%86"},"#"),"3. \u652f\u4ed8\u56de\u8c03\u903b\u8f91\u5904\u7406"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221203416360-61d74041.png",alt:"image-20211221203416360"}),"image-20211221203416360"),(0,l.kt)("h3",{id:"31-\u9700\u6c42\u5206\u6790"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"},"#"),"3.1 \u9700\u6c42\u5206\u6790"),(0,l.kt)("p",null,"\u5728\u5b8c\u6210\u652f\u4ed8\u540e\uff0c\u4fee\u6539\u8ba2\u5355\u72b6\u6001\u4e3a\u5df2\u652f\u4ed8\uff0c\u5e76\u8bb0\u5f55\u8ba2\u5355\u65e5\u5fd7\u3002"),(0,l.kt)("h3",{id:"32-\u5b9e\u73b0\u601d\u8def"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-2-%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"},"#"),"3.2 \u5b9e\u73b0\u601d\u8def"),(0,l.kt)("p",null,"\uff081\uff09\u63a5\u53d7\u5fae\u4fe1\u652f\u4ed8\u5e73\u53f0\u7684\u56de\u8c03\u4fe1\u606f\uff08xml\uff09"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<xml><appid><![CDATA[wx8397f8696b538317]]></appid>\n<bank_type><![CDATA[CFT]]></bank_type>\n<cash_fee><![CDATA[1]]></cash_fee>\n<fee_type><![CDATA[CNY]]></fee_type>\n<is_subscribe><![CDATA[N]]></is_subscribe>\n<mch_id><![CDATA[1473426802]]></mch_id>\n<nonce_str><![CDATA[c6bea293399a40e0a873df51e667f45a]]></nonce_str>\n<openid><![CDATA[oNpSGwbtNBQROpN_dL8WUZG3wRkM]]></openid>\n<out_trade_no><![CDATA[1553063775279]]></out_trade_no>\n<result_code><![CDATA[SUCCESS]]></result_code>\n<return_code><![CDATA[SUCCESS]]></return_code>\n<sign><![CDATA[DD4E5DF5AF8D8D8061B0B8BF210127DE]]></sign>\n<time_end><![CDATA[20190320143646]]></time_end>\n<total_fee>1</total_fee>\n<trade_type><![CDATA[NATIVE]]></trade_type>\n<transaction_id><![CDATA[4200000248201903206581106357]]></transaction_id>\n</xml>\n")),(0,l.kt)("p",null,"\uff082\uff09\u6536\u5230\u901a\u77e5\u540e\uff0c\u8c03\u7528\u67e5\u8be2\u63a5\u53e3\u67e5\u8be2\u8ba2\u5355\u3002"),(0,l.kt)("p",null,"\uff083\uff09\u5982\u679c\u652f\u4ed8\u7ed3\u679c\u4e3a\u6210\u529f\uff0c\u5219\u8c03\u7528\u4fee\u6539\u8ba2\u5355\u72b6\u6001\u548c\u8bb0\u5f55\u8ba2\u5355\u65e5\u5fd7\u7684\u65b9\u6cd5\u3002"),(0,l.kt)("h3",{id:"33-\u4ee3\u7801\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"},"#"),"3.3 \u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("h4",{id:"331-\u5185\u7f51\u7a7f\u900f\u5de5\u5177"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-1-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7"},"#"),"3.3.1 \u5185\u7f51\u7a7f\u900f\u5de5\u5177"),(0,l.kt)("p",null,"natapp ",(0,l.kt)("a",{parentName:"p",href:"https://natapp.cn/"},"https://natapp.cn/open in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221204125489-5f8703f8.png",alt:"image-20211221204125489"}),"image-20211221204125489"),(0,l.kt)("h4",{id:"332\u4e0b\u8f7d\u914d\u7f6e\u6587\u4ef6\u548c\u5ba2\u6237\u7aef"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-2%E4%B8%8B%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF"},"#"),"3.3.2\u4e0b\u8f7d\u914d\u7f6e\u6587\u4ef6\u548c\u5ba2\u6237\u7aef"),(0,l.kt)("p",null,"\u5982\u4f55\u4f7f\u7528\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://natapp.cn/article/natapp_newbie"},"https://natapp.cn/article/natapp_newbieopen in new window")),(0,l.kt)("p",null,"\u89e3\u538b\u8d44\u6599\uff0c\u5c06\u914d\u7f6e\u6587\u4ef6\u4e0e\u7a0b\u5e8f\u5e73\u884c\u653e\u7f6e\u3002\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"data:image/png;base64,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",alt:"image-20211221205259145"}),"image-20211221205259145"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221205320127-d3014723.png",alt:"image-20211221205320127"}),"image-20211221205320127"),(0,l.kt)("h4",{id:"333-\u542f\u52a8"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-3-%E5%90%AF%E5%8A%A8"},"#"),(0,l.kt)("strong",{parentName:"h4"},"3.3.3 \u542f\u52a8")),(0,l.kt)("p",null,"\u53cc\u51fbnatapp.exe"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221205424476-a7e3fbf7.png",alt:"image-20211221205424476"}),"image-20211221205424476"),(0,l.kt)("p",null,"\u5916\u7f51\u5730\u5740\u9ed8\u8ba4\u6620\u5c04\u672c\u5730\u768480\u7aef\u53e3 \u53ef\u4ee5\u4fee\u6539"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221205450080-c69f4636.png",alt:"image-20211221205450080"}),"image-20211221205450080"),(0,l.kt)("h4",{id:"334-\u6d4b\u8bd5"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-4-%E6%B5%8B%E8%AF%95"},"#"),(0,l.kt)("strong",{parentName:"h4"},"3.3.4 \u6d4b\u8bd5")),(0,l.kt)("p",null,"1ydles_service_pay \u5fae\u670d\u52a1 WXPayController \u589e\u52a0\u4e00\u4e2a\u6d4b\u8bd5\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@RequestMapping("/notify")\npublic void notifyLogic() {\n    System.out.println("\u652f\u4ed8\u6210\u529f\u56de\u8c03");\n}\n')),(0,l.kt)("p",null,"2\u91cd\u542fydles_service_pay"),(0,l.kt)("p",null,"3\u8bbf\u95ee ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:9010/wxpay/notify"},"http://localhost:9010/wxpay/notifyopen in new window")," \u7a0b\u5e8f\u6253\u5370\u8f93\u51fa"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221205220246-f5d79981.png",alt:"image-20211221205220246"}),"image-20211221205220246"),(0,l.kt)("p",null,"4\u8bbf\u95ee ",(0,l.kt)("a",{parentName:"p",href:"http://lizihao.cross.echosite.cn/wxpay/notify"},"http://lizihao.cross.echosite.cn/wxpay/notifyopen in new window")," \u7a0b\u5e8f\u6253\u5370\u8f93\u51fa"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221205220246-f5d79981.png",alt:"image-20211221205221905"}),"image-20211221205221905"),(0,l.kt)("h4",{id:"335-\u63a5\u6536\u56de\u8c03\u4fe1\u606f"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-5-%E6%8E%A5%E6%94%B6%E5%9B%9E%E8%B0%83%E4%BF%A1%E6%81%AF"},"#"),"3.3.5 \u63a5\u6536\u56de\u8c03\u4fe1\u606f"),(0,l.kt)("p",null,"1 \u4fee\u6539\u652f\u4ed8\u5fae\u670d\u52a1\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"wxpay:\n  notify_url: http://mp93g5.natappfree.cc/wxpay/notify #\u56de\u8c03\u5730\u5740\n")),(0,l.kt)("p",null,"2\u4fee\u6539WxPayServiceImpl \uff0c\u5f15\u5165"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Value("${wxpay.notify_url}")\nprivate String notifyUrl;\n')),(0,l.kt)("p",null,"3\u4fee\u6539WxPayServiceImpl \u7684nativePay\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'map.put("notify_url",notifyUrl);//\u56de\u8c03\u5730\u5740\n')),(0,l.kt)("p",null,"4\u6d4b\u8bd5\uff1a"),(0,l.kt)("p",null,"4.1\u91cd\u542fydles_service_pay"),(0,l.kt)("p",null,"4.2\u6dfb\u52a0\u5546\u54c1\uff1a ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/add?skuId=1450862568724758528&num=5"},"http://localhost:8001/api/wcart/add?skuId=1450862568724758528&num=5open in new window")),(0,l.kt)("p",null,"4.3\u67e5\u770b\u8d2d\u7269\u8f66\uff1a ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/list"},"http://localhost:8001/api/wcart/listopen in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221232224662-b901e7ea.png",alt:"image-20211221232224662"}),"image-20211221232224662"),(0,l.kt)("p",null,"4.4\u70b9\u51fb\uff1a\u7ed3\u7b97---\u300b\u63d0\u4ea4\u8ba2\u5355--\u300b\u9009\u62e9\u5fae\u4fe1\u652f\u4ed8--\u300b\u8df3\u5230\u4e8c\u7ef4\u7801\u9875\u9762--\u300b\u626b\u63cf\u4e8c\u7ef4\u7801 \u67e5\u770b\u53ef\u4ee5\u56de\u8c03\u591a\u6b21"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221232328432-ed3fc658.png",alt:"image-20211221232328432"}),"image-20211221232328432"),(0,l.kt)("p",null,"\u4e3a\u4ec0\u4e48\u591a\u6b21\u56de\u8c03\uff1f ",(0,l.kt)("a",{parentName:"p",href:"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_7&index=8"},"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_7&index=8open in new window")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u6ce8\u610f\uff1a\n1\u3001\u540c\u6837\u7684\u901a\u77e5\u53ef\u80fd\u4f1a\u591a\u6b21\u53d1\u9001\u7ed9\u5546\u6237\u7cfb\u7edf\u3002\u5546\u6237\u7cfb\u7edf\u5fc5\u987b\u80fd\u591f\u6b63\u786e\u5904\u7406\u91cd\u590d\u7684\u901a\u77e5\u3002\n2\u3001\u540e\u53f0\u901a\u77e5\u4ea4\u4e92\u65f6\uff0c\u5982\u679c\u5fae\u4fe1\u6536\u5230\u5546\u6237\u7684\u5e94\u7b54\u4e0d\u7b26\u5408\u89c4\u8303\u6216\u8d85\u65f6\uff0c\u5fae\u4fe1\u4f1a\u5224\u5b9a\u672c\u6b21\u901a\u77e5\u5931\u8d25\uff0c\u91cd\u65b0\u53d1\u9001\u901a\u77e5\uff0c\u76f4\u5230\u6210\u529f\u4e3a\u6b62\uff08\u5728\u901a\u77e5\u4e00\u76f4\u4e0d\u6210\u529f\u7684\u60c5\u51b5\u4e0b\uff0c\u5fae\u4fe1\u603b\u5171\u4f1a\u53d1\u8d77\u591a\u6b21\u901a\u77e5\uff0c\u901a\u77e5\u9891\u7387\u4e3a15s/15s/30s/3m/10m/20m/30m/30m/30m/60m/3h/3h/3h/6h/6h - \u603b\u8ba1 24h4m\uff09\uff0c\u4f46\u5fae\u4fe1\u4e0d\u4fdd\u8bc1\u901a\u77e5\u6700\u7ec8\u4e00\u5b9a\u80fd\u6210\u529f\u3002\n")),(0,l.kt)("h4",{id:"336-\u5904\u7406\u56de\u8c03\u901a\u77e5-\u91cd\u70b9"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-6-%E5%A4%84%E7%90%86%E5%9B%9E%E8%B0%83%E9%80%9A%E7%9F%A5-%E9%87%8D%E7%82%B9"},"#"),"3.3.6 \u5904\u7406\u56de\u8c03\u901a\u77e5-\u91cd\u70b9"),(0,l.kt)("p",null,"1\u8d44\u6e90\u6587\u4ef6\u5939 ConvertUtils \u653e\u5230 common\u5de5\u7a0b\u7684utils\u5305\u4e0b"),(0,l.kt)("p",null,"2\u5fae\u4fe1\u652f\u4ed8\u5e73\u53f0\u53d1\u9001\u7ed9\u56de\u8c03\u5730\u5740\u7684\u662f\u4e8c\u8fdb\u5236\u6d41\uff0c\u6211\u4eec\u9700\u8981\u63d0\u53d6\u4e8c\u8fdb\u5236\u6d41\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\uff0c\u8fd9\u4e2a\u5b57\u7b26\u4e32\u5c31\u662fxml\u683c\u5f0f\u3002"),(0,l.kt)("p",null,"\u4fee\u6539notify\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u56de\u8c03\n */\n@RequestMapping("/notify")\npublic String wxPayNotify(HttpServletRequest request, HttpServletResponse response) throws IOException {\n    System.out.println("\u652f\u4ed8\u6210\u529f\u56de\u8c03\u3002\u3002\u3002\u3002");\n    try {\n            //1\u8f93\u5165\u6d41\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\n            String xml = ConvertUtils.convertToString(request.getInputStream());\n            System.out.println(xml);\n\n        //\u5982\u679c\u6210\u529f\uff0c\u7ed9\u5fae\u4fe1\u652f\u4ed8\u4e00\u4e2a\u6210\u529f\u7684\u54cd\u5e94\n        //\u54cd\u5e94\u6570\u636e\u8bbe\u7f6e\n        //2\u7ed9\u5fae\u4fe1\u4e00\u4e2a\u7ed3\u679c\u901a\u77e5\n            response.setContentType("text/xml");\n            String data = "<xml><return_code><![CDATA[SUCCESS]]></return_code><return_msg><![CDATA[OK]]></return_msg></xml>";\n            response.getWriter().write(data);\n        \n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6ce8\u610f\uff1a"),"1\u3001\u540c\u6837\u7684\u901a\u77e5\u53ef\u80fd\u4f1a\u591a\u6b21\u53d1\u9001\u7ed9\u5546\u6237\u7cfb\u7edf\u3002\u5546\u6237\u7cfb\u7edf\u5fc5\u987b\u80fd\u591f\u6b63\u786e\u5904\u7406\u91cd\u590d\u7684\u901a\u77e5\u30022\u3001\u540e\u53f0\u901a\u77e5\u4ea4\u4e92\u65f6\uff0c\u5982\u679c\u5fae\u4fe1\u6536\u5230\u5546\u6237\u7684\u5e94\u7b54\u4e0d\u7b26\u5408\u89c4\u8303\u6216\u8d85\u65f6\uff0c\u5fae\u4fe1\u4f1a\u5224\u5b9a\u672c\u6b21\u901a\u77e5\u5931\u8d25\uff0c\u91cd\u65b0\u53d1\u9001\u901a\u77e5\uff0c\u76f4\u5230\u6210\u529f\u4e3a\u6b62\uff08\u5728\u901a\u77e5\u4e00\u76f4\u4e0d\u6210\u529f\u7684\u60c5\u51b5\u4e0b\uff0c\u5fae\u4fe1\u603b\u5171\u4f1a\u53d1\u8d7710\u6b21\u901a\u77e5\uff0c\u901a\u77e5\u9891\u7387\u4e3a15s/15s/30s/3m/10m/20m/30m/30m/30m/60m/3h/3h/3h/6h/6h - \u603b\u8ba1 24h4m\uff09\uff0c\u4f46\u5fae\u4fe1\u4e0d\u4fdd\u8bc1\u901a\u77e5\u6700\u7ec8\u4e00\u5b9a\u80fd\u6210\u529f\u3002"),(0,l.kt)("p",null,"\u6d4b\u8bd5\u540e\uff0c\u5728\u63a7\u5236\u53f0\u770b\u5230\u8f93\u51fa\u7684\u6d88\u606f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"\u8bbf\u95ee\u5230 notify\u63a5\u53e3\u4e86\uff01\n<xml><appid><![CDATA[wxababcd122d1618eb]]></appid>\n<bank_type><![CDATA[OTHERS]]></bank_type>\n<cash_fee><![CDATA[1]]></cash_fee>\n<fee_type><![CDATA[CNY]]></fee_type>\n<is_subscribe><![CDATA[Y]]></is_subscribe>\n<mch_id><![CDATA[1611671554]]></mch_id>\n<nonce_str><![CDATA[WNXFCMMCQSYiM09qrr4nwDH41iJnwuSs]]></nonce_str>\n<openid><![CDATA[o9tV755anFQYm27bYNC1ALQ5Ovfs]]></openid>\n<out_trade_no><![CDATA[1473316925973991424]]></out_trade_no>\n<result_code><![CDATA[SUCCESS]]></result_code>\n<return_code><![CDATA[SUCCESS]]></return_code>\n<sign><![CDATA[E6A69A88C986B64411ACB2DA7E945EB48BF6391C06B0972DA6AEC80C00FC74F9]]></sign>\n<time_end><![CDATA[20211221233851]]></time_end>\n<total_fee>1</total_fee>\n<trade_type><![CDATA[NATIVE]]></trade_type>\n<transaction_id><![CDATA[4200001414202112216382710751]]></transaction_id>\n</xml>\n")),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u5c06\u6b64xml\u5b57\u7b26\u4e32\uff0c\u8f6c\u6362\u4e3amap\uff0c\u63d0\u53d6\u5176\u4e2d\u7684out_trade_no\uff08\u8ba2\u5355\u53f7\uff09\uff0c\u6839\u636e\u8ba2\u5355\u53f7\u4fee\u6539\u8ba2\u5355\u72b6\u6001\u3002"),(0,l.kt)("h4",{id:"337-\u6536\u5230\u5fae\u4fe1\u901a\u77e5\u540e\u7684\u903b\u8f91"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-7-%E6%94%B6%E5%88%B0%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5%E5%90%8E%E7%9A%84%E9%80%BB%E8%BE%91"},"#"),"3.3.7 \u6536\u5230\u5fae\u4fe1\u901a\u77e5\u540e\u7684\u903b\u8f91"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u652f\u4ed8\u670d\u52a1\uff1a\u67e5\u8be2\u8ba2\u5355\u9a8c\u8bc1\u901a\u77e5")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221235105274-6db9cee5.png",alt:"image-20211221235105274"}),"image-20211221235105274"),(0,l.kt)("p",null,"\u5fae\u4fe1\u65b9\u9762\u67e5\u8be2\u8ba2\u5355\u5982\u4f55\u505a ",(0,l.kt)("a",{parentName:"p",href:"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_2"},"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_2open in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221235203111-b2b94980.png",alt:"image-20211221235203111"}),"image-20211221235203111"),(0,l.kt)("p",null,"\uff081\uff09WxPayService\u65b0\u589e\u65b9\u6cd5\u5b9a\u4e49"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n * \u67e5\u8be2\u8ba2\u5355\n * @param orderId\n * @return\n */\nMap queryOrder(String orderId);\n")),(0,l.kt)("p",null,"\uff082\uff09WxPayServiceImpl\u5b9e\u73b0\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'    @Override\n    public Map queryOrder(String orderId) {\n        try{\n            Map<String ,String> map = new HashMap();\n            map.put("out_trade_no",orderId);\n            Map<String, String> resultMap = wxPay.orderQuery(map);\n            return resultMap;\n        }catch (Exception e){\n            e.printStackTrace();\n            return null;\n        }\n    }\n')),(0,l.kt)("p",null,"\uff083\uff09\u4fee\u6539notify\u65b9\u6cd5"),(0,l.kt)("p",null,"\u4e0b\u5355\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222001359665-5c78ed50.png",alt:"image-20211222001359665"}),"image-20211222001359665"),(0,l.kt)("p",null,"\u4e0b\u5355",(0,l.kt)("strong",{parentName:"p"},"\u901a\u77e5"),"\u6210\u529f\u4e0e\u5426\u5728\u54ea\u513f\uff1f ",(0,l.kt)("a",{parentName:"p",href:"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_7&index=8"},"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_7&index=8open in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"data:image/png;base64,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",alt:"image-20200305014740028"}),"image-20200305014740028"),(0,l.kt)("p",null,"\u6211\u4eec\u7684",(0,l.kt)("strong",{parentName:"p"},"\u8ba2\u5355\u53f7"),"\u5728\u54ea\u513f\uff1f \u5728\u4e0b\u5355\u540e\u5fae\u4fe1\u56de\u8c03\u7684\u8bf7\u6c42\u91cc\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221235940049-37e099e7.png",alt:"image-20211221235940049"}),"image-20211221235940049"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200305012941294-3c13dd66.png",alt:"image-20200305012941294"}),"image-20200305012941294"),(0,l.kt)("p",null,"================================================================================================="),(0,l.kt)("p",null,"\u67e5\u8be2\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_2"},"https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_2open in new window")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u67e5\u8be2\u7ed3\u679c"),"\u5982\u4f55\uff1f"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200305015926052-167e538f.png",alt:"image-20200305015926052"}),"image-20200305015926052"),(0,l.kt)("p",null,"\u67e5\u8be2",(0,l.kt)("strong",{parentName:"p"},"\u8ba2\u5355\u7ed3\u679c"),"\u7ed3\u679c\u5982\u4f55\uff1f"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA5sAAAAvCAYAAABt2N7uAAAOzklEQVR4nO3dT2gbVx4H8K+XgntJc6m82taFhJFLwb4oNUHggscQ1yawhYKQjzHR+FDhFHqy1JNPHvm0kBiVYikohx4sBDksBLsOWIYEhFEsCjaU2kPDxm2F1UubS3zyHmYkzYxmNJIzsmXp+4FAPJo/bzR/9H7zfu9N3+np6SlMSqU/4fW+b55MREREREREBMA5bvzHOZaFiIiIiIiIegSDTSIiIiIiInLdO3YflEp/nmc5iIiIiIiIqIvYBpvss0lERERERER2nBoomUZLRERERERErmOwSURERERERK5jsElERERERESuY7BJRERERERErmOwSURERERERK5jsElERERERESuY7BJRERERERErmOwSURERERERK5756ILQF3su08vugSXy1cvLroERERERESuYcsmERERERERuY7BJhEREREREbmOwSYRERERERG57hyCzTIydwXIBe3PggzhbgblJpYJZxvPZVDKICyEkSk5bN+kGBcgCE38ixebLwtdkBN8vbiL649PLrogVfuPD9C3eIz9iy7IRStlEHa8zqyu3x5k/q7OeO8pZ8MQBBntuHOVs2HL+3g5G7a9b6vlMR1rbV/t7s9drdFxLsi2x64YtzknCrLxerL8nVV/D/Xz1b77+s/qyuV0brp07lIX6unzXVentfktrL8HFiHb7lf992L7PRF1gA5s2SwjczeA2DaQWwjYVkyNF2YZmW83MPU8hZDXHECq60rO2FdqpTUFilL5l4UECVlFN21NOu8vgVzRecFnbzNdV4Z/ecjjF12+DlDKIDwWg093T8r7VuoqSC09iGtDGaMLPmQfhuCpTlQrRoGFnOUi5WwYgSdTyFePt3qvhjeE1JqE5Ex7guKO5XicW1OMCxBmYLy+IgoCdRXnADZu5w3XnZAw/h6Ky3njtRn1N1dml/eJukivn++FJGLbEuaDlTumCPm58TcwNmpeZh3JcRHi9ga2+BCWLrkOG422CFkIqhcYUA0ea7RAFDIk3YVZjAegRBTEvOrnSkSBEjUuo0QsLmZNckZA0jxNME2Zm36bHSMiJBE0X1cGIuRzK0tnKqZjyM1lkdLdqzzBFGJnWJcnmIISdK1oVcV0DFjOw1+ZUMogPKZgXslDuBvAhnmBSnCq6INT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",alt:"image-20200305015403233"}),"image-20200305015403233"),(0,l.kt)("p",null,"\u6b64\u6b21\u67e5\u8be2\u4e0b\u5355\u6211\u4eec\u5546\u54c1\u7684\u8ba2\u5355\u53f7\u662f\u4ec0\u4e48\uff1f"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200305020047787-0115833e.png",alt:"image-20200305020047787"}),"image-20200305020047787"),(0,l.kt)("p",null,"\u6b64\u6b21\u652f\u4ed8\u52a8\u4f5c\u7684id\u5728\u54ea\u513f\uff1f"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200305015219298-084b4177.png",alt:"image-20200305015219298"}),"image-20200305015219298"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@RequestMapping("/wxpay")\n@RestController\npublic class WXPayController {\n\n    @Autowired\n    private WXPayService wxPayService;\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    //\u4e0b\u5355\n    @GetMapping("/nativePay")\n    public Result nativePay(@RequestParam("orderId") String orderId, @RequestParam("money") Integer money) {\n        Map resultMap = wxPayService.nativePay(orderId, money);\n        return new Result(true, StatusCode.OK, "", resultMap);\n    }\n\n    @RequestMapping("/notify")\n    public void notifyLogic(HttpServletRequest request, HttpServletResponse response) {\n        System.out.println("\u652f\u4ed8\u6210\u529f\u56de\u8c03");\n\n        try {\n            //1\u8f93\u5165\u6d41\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\n            String xml = ConvertUtils.convertToString(request.getInputStream());\n            System.out.println(xml);\n\n            //3\u57fa\u4e8e\u5fae\u4fe1\u53d1\u9001\u7684\u901a\u77e5\u5185\u5bb9,\u5b8c\u6210\u540e\u7eed\u7684\u4e1a\u52a1\u903b\u8f91\u5904\u7406\n            Map<String, String> map = WXPayUtil.xmlToMap(xml);\n            if ("SUCCESS".equals(map.get("result_code"))) {\n\n                //\u67e5\u8be2\u8ba2\u5355\n                Map result = wxPayService.queryOrder(map.get("out_trade_no"));\n                System.out.println("\u67e5\u8be2\u8ba2\u5355\u7ed3\u679c:" + result);\n\n                if ("SUCCESS".equals(result.get("result_code"))) {\n\n                    //\u5c06\u8ba2\u5355\u7684\u6d88\u606f\u53d1\u9001\u5230mq\'\n                    Map message = new HashMap();\n                    message.put("orderId", result.get("out_trade_no"));\n                    message.put("transactionId", result.get("transaction_id"));\n\n                    //\u6d88\u606f\u7684\u53d1\u9001\n                    rabbitTemplate.convertAndSend("", RabbitMQConfig.ORDER_PAY, JSON.toJSONString(message));\n\n                    \n                } else {\n                    //\u8f93\u51fa\u9519\u8bef\u539f\u56e0\n                    System.out.println(map.get("err_code_des"));\n                }\n            } else {\n                //\u8f93\u51fa\u9519\u8bef\u539f\u56e0\n                System.out.println(map.get("err_code_des"));\n            }\n\n            //2\u7ed9\u5fae\u4fe1\u4e00\u4e2a\u7ed3\u679c\u901a\u77e5\n            response.setContentType("text/xml");\n            String data = "<xml><return_code><![CDATA[SUCCESS]]></return_code><return_msg><![CDATA[OK]]></return_msg></xml>";\n            response.getWriter().write(data);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n\n    }\n}\n')),(0,l.kt)("p",null,"config\u5305\u4e0b\u589e\u52a0rebbitMQ\u914d\u7f6e\u7c7b\u3002\u5e76\u68c0\u67e5\u4f9d\u8d56\u548c\u914d\u7f6e\u6587\u4ef6\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydles.pay.config;\n\nimport org.springframework.amqp.core.Queue;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n@Configuration\npublic class RabbitMQConfig {\n\n    public static final String ORDER_PAY="order_pay";\n\n    @Bean\n    public Queue queue(){\n        return  new Queue(ORDER_PAY);\n    }\n}\n')),(0,l.kt)("h4",{id:"338-\u8ba2\u5355\u670d\u52a1\u4fee\u6539\u8ba2\u5355\u72b6\u6001"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-8-%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1%E4%BF%AE%E6%94%B9%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81"},"#"),"3.3.8 \u8ba2\u5355\u670d\u52a1\u4fee\u6539\u8ba2\u5355\u72b6\u6001"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222001437864-e80a71e6.png",alt:"image-20211222001437864"}),"image-20211222001437864"),(0,l.kt)("p",null,"1rabbitMQ\u914d\u7f6e\u7c7b\uff0c\u628a\u652f\u4ed8\u670d\u52a1\u5b9a\u4e49\u7684\u961f\u5217\u5b9a\u4e49"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public static final String ORDER_PAY="order_pay";\n\n@Bean\npublic Queue queue(){\n    return  new Queue(ORDER_PAY);\n}\n')),(0,l.kt)("p",null,"2 com.ydles.order.listener\u5305\u4e0b\u521b\u5efaOrderPayListener"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class OrderPayListener {\n    @Autowired\n    private OrderService orderService;\n\n    @RabbitListener(queues = RabbitMQConfig.ORDER_PAY)\n    public void receivePayMessage(String message) {\n        System.out.println("\u63a5\u6536\u5230\u4e86\u8ba2\u5355\u652f\u4ed8\u7684\u6d88\u606f:" + message);\n        Map map = JSON.parseObject(message, Map.class);\n        //\u8c03\u7528\u4e1a\u52a1\u5c42,\u5b8c\u6210\u8ba2\u5355\u6570\u636e\u5e93\u7684\u4fee\u6539\n        orderService.updatePayStatus((String) map.get("orderId"), (String) map.get("transactionId"));\n    }\n}\n')),(0,l.kt)("p",null,"3OrderService\u63a5\u53e3\u65b0\u589e\u65b9\u6cd5\u5b9a\u4e49"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n * \u4fee\u6539\u8ba2\u5355\u72b6\u6001\u4e3a\u5df2\u652f\u4ed8\n * @param orderId\n * @param transactionId\n */\nvoid updatePayStatus(String orderId,String transactionId);\n")),(0,l.kt)("p",null,"4OrderServiceImpl\u65b0\u589e\u65b9\u6cd5\u5b9e\u73b0"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Autowired\nprivate OrderLogMapper orderLogMapper;\n\n@Override\npublic void updatePayStatus(String orderId, String transactionId) {\n    Order order = orderMapper.selectByPrimaryKey(orderId);\n    if(order!=null  && "0".equals(order.getPayStatus())){  //\u5b58\u5728\u8ba2\u5355\u4e14\u72b6\u6001\u4e3a0\n        order.setPayStatus("1");\n        order.setOrderStatus("1");\n        order.setUpdateTime(new Date());\n        order.setPayTime(new Date());\n        order.setTransactionId(transactionId);//\u5fae\u4fe1\u8fd4\u56de\u7684\u4ea4\u6613\u6d41\u6c34\u53f7\n        orderMapper.updateByPrimaryKeySelective(order);\n        //\u8bb0\u5f55\u8ba2\u5355\u53d8\u52a8\u65e5\u5fd7\n        OrderLog orderLog=new OrderLog();\n        orderLog.setId( idWorker.nextId()+"" );\n        orderLog.setOperater("system");// \u7cfb\u7edf\n        orderLog.setOperateTime(new Date());//\u5f53\u524d\u65e5\u671f\n        orderLog.setOrderStatus("1");\n        orderLog.setPayStatus("1");\n        orderLog.setRemarks("\u652f\u4ed8\u6d41\u6c34\u53f7"+transactionId);\n        orderLog.setOrderId(order.getId());\n        orderLogMapper.insertSelective(orderLog);\n    }\n}\n')),(0,l.kt)("h4",{id:"339-\u6574\u4e2a\u6d41\u7a0b\u6d4b\u8bd5"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-9-%E6%95%B4%E4%B8%AA%E6%B5%81%E7%A8%8B%E6%B5%8B%E8%AF%95"},"#"),"3.3.9 \u6574\u4e2a\u6d41\u7a0b\u6d4b\u8bd5"),(0,l.kt)("p",null,"1\u91cd\u542fydles_service_pay ydles_service_order"),(0,l.kt)("p",null,"2\u6dfb\u52a0\u5546\u54c1\uff1a ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/cart/addCart?skuId=100000006163&num=10"},"http://localhost:8001/api/cart/addCart?skuId=100000006163&num=10open in new window")),(0,l.kt)("p",null,"3\u67e5\u770b\u8d2d\u7269\u8f66\uff1a ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/list"},"http://localhost:8001/api/wcart/listopen in new window")),(0,l.kt)("p",null,"4\u70b9\u51fb\uff1a\u7ed3\u7b97---\u300b\u63d0\u4ea4\u8ba2\u5355--\u300b\u9009\u62e9\u5fae\u4fe1\u652f\u4ed8--\u300b\u8df3\u5230\u4e8c\u7ef4\u7801\u9875\u9762--\u300b\u626b\u63cf\u4e8c\u7ef4\u7801"),(0,l.kt)("p",null,"4.1\u626b\u7801\u652f\u4ed8\u4e4b\u524d\uff0c\u67e5\u770b\u8ba2\u5355\u72b6\u6001"),(0,l.kt)("p",null,"4.1\u626b\u7801\u652f\u4ed8\u4e4b\u540e\uff0c\u67e5\u770b\u8ba2\u5355\u72b6\u6001"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222003719250-574a7d55.png",alt:"image-20211222003719250"}),"image-20211222003719250"),(0,l.kt)("p",null,"\u8ba2\u5355\u65e5\u5fd7\u8868\uff0c\u4e5f\u6709\u4e00\u6761\u6570\u636e\u4e86"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222003728955-4ad46170.png",alt:"image-20211222003728955"}),"image-20211222003728955"),(0,l.kt)("h2",{id:"4-\u63a8\u9001\u652f\u4ed8\u901a\u77e5"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-%E6%8E%A8%E9%80%81%E6%94%AF%E4%BB%98%E9%80%9A%E7%9F%A5"},"#"),"4. \u63a8\u9001\u652f\u4ed8\u901a\u77e5"),(0,l.kt)("h3",{id:"41-\u9700\u6c42\u5206\u6790"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"},"#"),"4.1 \u9700\u6c42\u5206\u6790"),(0,l.kt)("p",null,"\u5f53\u7528\u6237\u5b8c\u6210\u626b\u7801\u652f\u4ed8\u540e\uff0c\u8df3\u8f6c\u5230\u652f\u4ed8\u6210\u529f\u9875\u9762"),(0,l.kt)("h3",{id:"42-\u670d\u52a1\u7aef\u63a8\u9001\u65b9\u6848"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%8E%A8%E9%80%81%E6%96%B9%E6%A1%88"},"#"),"4.2 \u670d\u52a1\u7aef\u63a8\u9001\u65b9\u6848"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a\u6211\u4eec\u9700\u8981\u5c06\u652f\u4ed8\u7684\u7ed3\u679c\u901a\u77e5\u524d\u7aef\u9875\u9762\uff0c\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u901a\u8fc7\u6240\u8bf4\u7684\u670d\u52a1\u5668\u7aef\u63a8\u9001\uff0c\u4e3b\u8981\u6709\u4e09\u79cd\u5b9e\u73b0\u65b9\u6848"),(0,l.kt)("p",null,"\uff081\uff09Ajax \u77ed\u8f6e\u8be2 setInterval Ajax \u8f6e\u8be2\u4e3b\u8981\u901a\u8fc7\u9875\u9762\u7aef\u7684 JS \u5b9a\u65f6\u5f02\u6b65\u5237\u65b0\u4efb\u52a1\u6765\u5b9e\u73b0\u6570\u636e\u7684\u52a0\u8f7d"),(0,l.kt)("p",null,"\u5982\u679c\u6211\u4eec\u4f7f\u7528ajax\u77ed\u8f6e\u8be2\u65b9\u5f0f\uff0c\u9700\u8981\u540e\u7aef\u63d0\u4f9b\u65b9\u6cd5\uff0c\u901a\u8fc7\u8c03\u7528\u5fae\u4fe1\u652f\u4ed8\u63a5\u53e3\u5b9e\u73b0\u6839\u636e\u8ba2\u5355\u53f7\u67e5\u8be2\u652f\u4ed8\u72b6\u6001\u7684\u65b9\u6cd5\uff08\u53c2\u89c1\u67e5\u8be2\u8ba2\u5355API\uff09 \u3002 \u524d\u7aef\u6bcf\u95f4\u9694\u4e09\u79d2\u67e5\u8be2\u4e00\u6b21\uff0c\u5982\u679c\u540e\u7aef\u8fd4\u56de\u652f\u4ed8\u6210\u529f\u5219\u6267\u884c\u9875\u9762\u8df3\u8f6c\u3002"),(0,l.kt)("p",null,"\u7f3a\u70b9\uff1a\u8fd9\u79cd\u65b9\u5f0f\u5b9e\u65f6\u6548\u679c\u8f83\u5dee\uff0c\u800c\u4e14\u5bf9\u670d\u52a1\u7aef\u7684\u538b\u529b\u4e5f\u8f83\u5927\u3002"),(0,l.kt)("p",null,"\uff082\uff09\u957f\u8f6e\u8be2"),(0,l.kt)("p",null,"\u957f\u8f6e\u8be2\u4e3b\u8981\u4e5f\u662f\u901a\u8fc7 Ajax \u673a\u5236\uff0c\u4f46\u533a\u522b\u4e8e\u4f20\u7edf\u7684 Ajax \u5e94\u7528\uff0c\u957f\u8f6e\u8be2\u7684\u670d\u52a1\u5668\u7aef\u4f1a\u5728\u6ca1\u6709\u6570\u636e\u65f6\u963b\u585e\u8bf7\u6c42\u76f4\u5230\u6709\u65b0\u7684\u6570\u636e\u4ea7\u751f\u6216\u8005\u8bf7\u6c42\u8d85\u65f6\u624d\u8fd4\u56de\uff0c\u4e4b\u540e\u5ba2\u6237\u7aef\u518d\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\u83b7\u53d6\u6570\u636e\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u4f7f\u7528\u957f\u8f6e\u8be2\uff0c\u4e5f\u540c\u6837\u9700\u8981\u540e\u7aef\u63d0\u4f9b\u65b9\u6cd5\uff0c\u901a\u8fc7\u8c03\u7528\u5fae\u4fe1\u652f\u4ed8\u63a5\u53e3\u5b9e\u73b0\u6839\u636e\u8ba2\u5355\u53f7\u67e5\u8be2\u652f\u4ed8\u72b6\u6001\u7684\u65b9\u6cd5\uff0c\u53ea\u4e0d\u8fc7\u5faa\u73af\u662f\u5199\u5728\u540e\u7aef\u7684\u3002"),(0,l.kt)("p",null,"\u7f3a\u70b9\uff1a\u957f\u8f6e\u8be2\u670d\u52a1\u7aef\u4f1a\u957f\u65f6\u95f4\u5730\u5360\u7528\u8d44\u6e90\uff0c\u5982\u679c\u6d88\u606f\u9891\u7e41\u53d1\u9001\u7684\u8bdd\u4f1a\u7ed9\u670d\u52a1\u7aef\u5e26\u6765\u8f83\u5927\u7684\u538b\u529b\u3002"),(0,l.kt)("p",null,"\uff083\uff09WebSocket \u53cc\u5411\u901a\u4fe1 WebSocket \u662f HTML5 \u4e2d\u4e00\u79cd\u65b0\u7684\u901a\u4fe1\u534f\u8bae\uff0c\u80fd\u591f\u5b9e\u73b0\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u5168\u53cc\u5de5\u901a\u4fe1\u3002\u5982\u679c\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u7aef\u90fd\u652f\u6301 WebSocket \u534f\u8bae\u7684\u8bdd\uff0c\u8be5\u65b9\u5f0f\u5b9e\u73b0\u7684\u6d88\u606f\u63a8\u9001\u65e0\u7591\u662f\u6700\u9ad8\u6548\u3001\u7b80\u6d01\u7684\u3002\u5e76\u4e14\u6700\u65b0\u7248\u672c\u7684 IE\u3001Firefox\u3001Chrome \u7b49\u6d4f\u89c8\u5668\u90fd\u5df2\u7ecf\u652f\u6301 WebSocket \u534f\u8bae\uff0cApache Tomcat 7.0.27 \u4ee5\u540e\u7684\u7248\u672c\u4e5f\u5f00\u59cb\u652f\u6301 WebSocket\u3002"),(0,l.kt)("h3",{id:"43-rabbitmq-web-stomp-\u63d2\u4ef6"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-3-rabbitmq-web-stomp-%E6%8F%92%E4%BB%B6"},"#"),"4.3 RabbitMQ Web STOMP \u63d2\u4ef6"),(0,l.kt)("p",null,"\u501f\u52a9\u4e8e RabbitMQ \u7684 Web STOMP \u63d2\u4ef6\uff0c\u5b9e\u73b0\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u7aef\u7684\u5168\u53cc\u5de5\u901a\u4fe1\u3002\u4ece\u672c\u8d28\u4e0a\u8bf4\uff0cRabbitMQ \u7684 Web STOMP \u63d2\u4ef6\u4e5f\u662f\u5229\u7528 WebSocket \u5bf9 STOMP \u534f\u8bae\u8fdb\u884c\u4e86\u4e00\u6b21\u6865\u63a5\uff0c\u4ece\u800c\u5b9e\u73b0\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u7aef\u7684\u53cc\u5411\u901a\u4fe1\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/10-5-adc33b76.png",alt:"img"})),(0,l.kt)("h4",{id:"431-stomp\u534f\u8bae"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-3-1-stomp%E5%8D%8F%E8%AE%AE"},"#"),"4.3.1 STOMP\u534f\u8bae"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"STOMP\u5373Simple (or Streaming) Text Orientated Messaging Protocol"),"\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u7b80\u5355(\u6d41)\u6587\u672c\u5b9a\u5411\u6d88\u606f\u534f\u8bae"),"\u3002\u524d\u8eab\u662fTTMP\u534f\u8bae\uff08\u4e00\u4e2a\u7b80\u5355\u7684\u57fa\u4e8e\u6587\u672c\u7684\u534f\u8bae\uff09\uff0c\u4e13\u4e3a\u6d88\u606f\u4e2d\u95f4\u4ef6\u8bbe\u8ba1\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u4e92\u64cd\u4f5c\u7684\u8fde\u63a5\u683c\u5f0f\uff0c\u5141\u8bb8STOMP\u5ba2\u6237\u7aef\u4e0e\u4efb\u610fSTOMP\u6d88\u606f\u4ee3\u7406\uff08Broker\uff09\u8fdb\u884c\u4ea4\u4e92\u3002STOMP\u534f\u8bae\u7531\u4e8e\u8bbe\u8ba1\u7b80\u5355\uff0c\u6613\u4e8e\u5f00\u53d1\u5ba2\u6237\u7aef\uff0c\u56e0\u6b64\u5728\u591a\u79cd\u8bed\u8a00\u548c\u591a\u79cd\u5e73\u53f0\u4e0a\u5f97\u5230\u5e7f\u6cdb\u5730\u5e94\u7528\u3002"),(0,l.kt)("h4",{id:"432-\u63d2\u4ef6\u5b89\u88c5"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-3-2-%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85"},"#"),"4.3.2 \u63d2\u4ef6\u5b89\u88c5"),(0,l.kt)("p",null,"1\u67e5\u8be2\u6240\u6709docker \u5bb9\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"docker ps\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200305023436779-f59f618b.png",alt:"image-20200305023436779"}),"image-20200305023436779"),(0,l.kt)("p",null,"2\u6211\u4eec\u8fdb\u5165rabbitmq\u5bb9\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"docker exec -it 410a37e15588 /bin/bash\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200305023655720-57f7c2cb.png",alt:"image-20200305023655720"}),"image-20200305023655720"),(0,l.kt)("p",null,"\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5f00\u542fstomp\u63d2\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"rabbitmq-plugins enable rabbitmq_web_stomp rabbitmq_web_stomp_examples\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200305023810038-3d7f2413.png",alt:"image-20200305023810038"}),"image-20200305023810038"),(0,l.kt)("p",null,"\u9000\u51fa\u5bb9\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"exit\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"data:image/png;base64,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",alt:"image-20200305023840612"}),"image-20200305023840612"),(0,l.kt)("p",null,"\u5c06\u5f53\u524d\u7684\u5bb9\u5668\u63d0\u4ea4\u4e3a\u65b0\u7684\u955c\u50cf"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"docker commit 410a37e15588 rabbitmq:stomp\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200305024558360-e35417d3.png",alt:"image-20200305024558360"}),"image-20200305024558360"),(0,l.kt)("p",null,"\u505c\u6b62\u5f53\u524d\u7684\u5bb9\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"docker stop 410a37e15588\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"data:image/png;base64,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",alt:"image-20200305024622094"}),"image-20200305024622094"),(0,l.kt)("p",null,"\u5220\u9664\u5f53\u524d\u7684\u5bb9\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"docker rm 410a37e15588\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"data:image/png;base64,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",alt:"image-20200305024639584"}),"image-20200305024639584"),(0,l.kt)("p",null,"\u6839\u636e\u65b0\u7684\u955c\u50cf\u91cd\u65b0\u521b\u5efa\u5bb9\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -di --name=ydles_rabbitmq1 -p 5671:5617 -p 5672:5672 -p 4369:4369 -p 15671:15671 -p 15672:15672 -p 25672:25672 -p 15670:15670 -p 15674:15674 rabbitmq:stomp\n")),(0,l.kt)("p",null,"\u8bbe\u7f6e\u5bb9\u5668\u5f00\u673a\u81ea\u52a8\u542f\u52a8"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"docker update --restart=always 54b0eea9edbb #\u6839\u636e\u4e0a\u9762\u751f\u6210\u7684\u5bb9\u5668\u53f7\u6539\u53d8\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200305024852480-ea9a3885.png",alt:"image-20200305024852480"}),"image-20200305024852480"),(0,l.kt)("p",null,"\u63d2\u4ef6\u5df2\u7ecf\u5b89\u8f6c\u597d\u4e86",(0,l.kt)("a",{parentName:"p",href:"http://192.168.200.128:15670/"},"http://192.168.200.128:15670/open in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222005732519-a1963786.png",alt:"image-20211222005732519"}),"image-20211222005732519"),(0,l.kt)("h4",{id:"433-\u6d88\u606f\u63a8\u9001\u6d4b\u8bd5"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-3-3-%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E6%B5%8B%E8%AF%95"},"#"),"4.3.3 \u6d88\u606f\u63a8\u9001\u6d4b\u8bd5"),(0,l.kt)("p",null,"1\u89c2\u5bdfwxpay.html"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<script src="/js/plugins/qrcode.min.js"><\/script>\n<script src="/js/plugins/stomp.min.js"><\/script>\n<script type="text/javascript" th:inline="javascript">\nlet qrcode = new QRCode(document.getElementById("qrcode"), {\n    width : 240,\n    height : 240\n});\nqrcode.makeCode("weixin://wxpay/bizpayurl?pr=XzofHwG");\n\nlet client = Stomp.client(\'ws://192.168.200.128:15674/ws\');\nlet on_connect = function(x) {\n    id = client.subscribe("/exchange/paynotify", function(d) {\n        \n    });\n};\nlet on_error =  function() {\n    console.log(\'error\');\n};\nclient.connect(\'guest\', \'guest\', on_connect, on_error, \'/\');\n\n<\/script>\n')),(0,l.kt)("p",null,"\u6240\u4ee5\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u4ea4\u6362\u673apaynotify"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"destination \u5728 RabbitMQ Web STOM \u4e2d\u8fdb\u884c\u4e86\u76f8\u5173\u7684\u5b9a\u4e49\uff0c\u6839\u636e\u4f7f\u7528\u573a\u666f\u7684\u4e0d\u540c\uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b 4 \u79cd\uff1a"),(0,l.kt)("ul",{parentName:"blockquote"},(0,l.kt)("li",{parentName:"ul"},"1./exchange/",(0,l.kt)("inlineCode",{parentName:"li"},"<exchangeName>"))),(0,l.kt)("p",{parentName:"blockquote"},"\u5bf9\u4e8e SUBCRIBE frame\uff0cdestination \u4e00\u822c\u4e3a/exchange/ ",(0,l.kt)("inlineCode",{parentName:"p"},"<exchangeName>"),"/","[/pattern]"," \u7684\u5f62\u5f0f\u3002\u8be5 destination \u4f1a\u521b\u5efa\u4e00\u4e2a\u552f\u4e00\u7684\u3001\u81ea\u52a8\u5220\u9664\u7684\u3001\u540d\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"<exchangeName>"),"\u7684 queue\uff0c\u5e76\u6839\u636e pattern \u5c06\u8be5 queue \u7ed1\u5b9a\u5230\u6240\u7ed9\u7684 exchange\uff0c\u5b9e\u73b0\u5bf9\u8be5\u961f\u5217\u7684\u6d88\u606f\u8ba2\u9605\u3002 \u5bf9\u4e8e SEND frame\uff0cdestination \u4e00\u822c\u4e3a/exchange/",(0,l.kt)("inlineCode",{parentName:"p"},"<exchangeName>"),"/","[/routingKey]"," \u7684\u5f62\u5f0f\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6d88\u606f\u5c31\u4f1a\u88ab\u53d1\u9001\u5230\u5b9a\u4e49\u7684 exchange \u4e2d\uff0c\u5e76\u4e14\u6307\u5b9a\u4e86 routingKey\u3002"),(0,l.kt)("ul",{parentName:"blockquote"},(0,l.kt)("li",{parentName:"ul"},"2./queue/ ",(0,l.kt)("inlineCode",{parentName:"li"},"<queueName>")," \u5bf9\u4e8e SUBCRIBE frame\uff0cdestination \u4f1a\u5b9a\u4e49 ",(0,l.kt)("inlineCode",{parentName:"li"},"<queueName>"),"\u7684\u5171\u4eab queue\uff0c\u5e76\u4e14\u5b9e\u73b0\u5bf9\u8be5\u961f\u5217\u7684\u6d88\u606f\u8ba2\u9605\u3002 \u5bf9\u4e8e SEND frame\uff0cdestination \u53ea\u4f1a\u5728\u7b2c\u4e00\u6b21\u53d1\u9001\u6d88\u606f\u7684\u65f6\u5019\u4f1a\u5b9a\u4e49 ",(0,l.kt)("inlineCode",{parentName:"li"},"<queueName>"),"\u7684\u5171\u4eab queue\u3002\u8be5\u6d88\u606f\u4f1a\u88ab\u53d1\u9001\u5230\u9ed8\u8ba4\u7684 exchange \u4e2d\uff0croutingKey \u5373\u4e3a ",(0,l.kt)("inlineCode",{parentName:"li"},"<queueName>"),"\u3002"),(0,l.kt)("li",{parentName:"ul"},"3./amq/queue/",(0,l.kt)("inlineCode",{parentName:"li"},"<queueName>")," \u8fd9\u79cd\u60c5\u51b5\u4e0b\u65e0\u8bba\u662f SUBCRIBE frame \u8fd8\u662f SEND frame \u90fd\u4e0d\u4f1a\u4ea7\u751f queue\u3002\u4f46\u5982\u679c\u8be5 queue \u4e0d\u5b58\u5728\uff0cSUBCRIBE frame \u4f1a\u62a5\u9519\u3002 \u5bf9\u4e8e SUBCRIBE frame\uff0cdestination \u4f1a\u5b9e\u73b0\u5bf9\u961f\u5217",(0,l.kt)("inlineCode",{parentName:"li"},"<queueName>"),"\u7684\u6d88\u606f\u8ba2\u9605\u3002 \u5bf9\u4e8e SEND frame\uff0c\u6d88\u606f\u4f1a\u901a\u8fc7\u9ed8\u8ba4\u7684 exhcange \u76f4\u63a5\u88ab\u53d1\u9001\u5230\u961f\u5217",(0,l.kt)("inlineCode",{parentName:"li"},"<queueName>"),"\u4e2d\u3002"),(0,l.kt)("li",{parentName:"ul"},"4./topic/",(0,l.kt)("inlineCode",{parentName:"li"},"<topicName>")," \u5bf9\u4e8e SUBCRIBE frame\uff0cdestination \u521b\u5efa\u51fa\u81ea\u52a8\u5220\u9664\u7684\u3001\u975e\u6301\u4e45\u7684 queue \u5e76\u6839\u636e routingkey \u4e3a",(0,l.kt)("inlineCode",{parentName:"li"},"<topicName>"),"\u7ed1\u5b9a\u5230 amq.topic exchange \u4e0a\uff0c\u540c\u65f6\u5b9e\u73b0\u5bf9\u8be5 queue \u7684\u8ba2\u9605\u3002 \u5bf9\u4e8e SEND frame\uff0c\u6d88\u606f\u4f1a\u88ab\u53d1\u9001\u5230 amq.topic exchange \u4e2d\uff0croutingKey \u4e3a",(0,l.kt)("inlineCode",{parentName:"li"},"<topicName>"),"\u3002"))),(0,l.kt)("p",null,"2 ",(0,l.kt)("a",{parentName:"p",href:"http://192.168.200.128:15672/#/exchanges"},"http://192.168.200.128:15672/#/exchangesopen in new window")," \u65b0\u5efa\u4ea4\u6362\u673a\u3002\u540d\u5b57\uff1apaynotify \u3002\u7c7b\u578b \uff1afanout\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200305025600949-da1a31f6.png",alt:"image-20200305025600949"}),"image-20200305025600949"),(0,l.kt)("p",null,"3\u4fee\u6539wxpay.html"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<script src="/js/plugins/qrcode.min.js"><\/script>\n<script src="/js/plugins/stomp.min.js"><\/script>\n<script type="text/javascript" th:inline="javascript">\nlet qrcode = new QRCode(document.getElementById("qrcode"), {\n    width : 240,\n    height : 240\n});\nqrcode.makeCode("weixin://wxpay/bizpayurl?pr=XzofHwG"); //\u81ea\u5df1\u7684\u5fae\u4fe1\u56fe\u7247\n\nlet client = Stomp.client(\'ws://192.168.200.128:15674/ws\');\nlet on_connect = function(x) {\n    id = client.subscribe("/exchange/paynotify", function(d) {\n         alert(d.body);\n    });\n};\nlet on_error =  function() {\n    console.log(\'error\');\n};\nclient.connect(\'guest\', \'guest\', on_connect, on_error, \'/\');\n<\/script>\n')),(0,l.kt)("p",null,"4\u5c06wxpay.html\u653e\u5230static\u4e2d\u3002\u56e0\u4e3a\u5bf9\u6bd4\u9759\u6001\u9875\u9762\u6587\u4ef6\u5939\uff0c\u9875\u9762\u83b7\u53d6\u7684\u662f\u5e73\u7ea7\u7684js\u3002\u6253\u5f00\u9875\u9762\uff0c\u89c2\u5bdfconsole\u3002\u5982\u679c\u6709\u9519\uff0c\u5c06static\u6253\u5305\uff0c\u53d1\u7ed9\u5927\u5bb6\u3002"),(0,l.kt)("p",null,"\u9875\u9762\u6548\u679c"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222012152665-81c35747.png",alt:"image-20211222012152665"}),"image-20211222012152665"),(0,l.kt)("p",null,"5\u5c1d\u8bd5\u53d1\u9001\u4e00\u6761\u6d88\u606f"),(0,l.kt)("p",null,"\u70b9\u51fbrabbitMQ\u961f\u5217\u4ea4\u6362\u673a\u9875\u9762\u7684paynotify"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222012132026-ccd25173.png",alt:"image-20211222012132026"}),"image-20211222012132026"),(0,l.kt)("p",null,"\u70b9\u51fb\u53d1\u9001\u6d88\u606f"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222012123305-a8281baf.png",alt:"image-20211222012123305"}),"image-20211222012123305"),(0,l.kt)("p",null,"\u6548\u679c"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222012108075-e6e3776e.png",alt:"image-20211222012108075"}),"image-20211222012108075"),(0,l.kt)("p",null,"6\u65b0\u5efa\u7528\u6237"),(0,l.kt)("p",null,"\u4e3a\u4e86\u5b89\u5168\uff0c\u6211\u4eec\u5728\u9875\u9762\u4e0a\u4e0d\u80fd\u7528\u6211\u4eec\u7684rabbitmq\u7684\u8d85\u7ea7\u7ba1\u7406\u5458\u7528\u6237guest\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728rabbitmq\u4e2d\u65b0\u5efa\u4e00\u4e2a\u666e\u901a\u7528\u6237webguest\uff08\u666e\u901a\u7528\u6237\u65e0\u6cd5\u767b\u5f55\u7ba1\u7406\u540e\u53f0\uff09"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200306075452263-a700224f.png",alt:"image-20200306075452263"}),"image-20200306075452263"),(0,l.kt)("p",null,"\u8bbe\u7f6e\u865a\u62df\u76ee\u5f55\u6743\u9650\uff0c\u6253\u5f00\u8fd9\u4e2a\u7528\u6237\u6743\u9650\u9875\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200306075534030-6667d3b8.png",alt:"image-20200306075534030"}),"image-20200306075534030"),(0,l.kt)("p",null,"\u70b9\u51fb\u8bbe\u7f6e\u6743\u9650"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/13-3-9801a07a.png",alt:"img"})),(0,l.kt)("p",null,"\u9875\u9762\u7528\u6237\u540d\u548c\u5bc6\u7801\u4fee\u6539"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"client.connect('webguest', 'webguest', on_connect, on_error, '/');\n")),(0,l.kt)("p",null,"\u5237\u65b0\u9875\u9762\uff0c\u8fd8\u53ef\u4ee5\u770b\u5230\u8fde\u63a5\u4fe1\u606f\u5373\u53ef\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200306075942810-3fedba8a.png",alt:"image-20200306075942810"}),"image-20200306075942810"),(0,l.kt)("h3",{id:"44-\u4ee3\u7801\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-4-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"},"#"),"4.4 \u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("p",null,"\u5b9e\u73b0\u601d\u8def\uff1a\u540e\u7aef\u5728\u6536\u5230\u56de\u8c03\u901a\u77e5\u540e\u53d1\u9001\u8ba2\u5355\u53f7\u7ed9mq\uff08paynotify\u4ea4\u6362\u5668\uff09\uff0c\u524d\u7aef\u901a\u8fc7stomp\u8fde\u63a5\u5230mq\u8ba2\u9605"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222013147811-6fc7baa2.png",alt:"image-20211222013147811"}),"image-20211222013147811"),(0,l.kt)("p",null,"1 \u4fee\u6539notifyLogic\u65b9\u6cd5\uff0c\u5728",(0,l.kt)("inlineCode",{parentName:"p"},'"SUCCESS".equals(result.get("result_code"))')," \u540e\u6dfb\u52a0"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'if ("SUCCESS".equals(result.get("result_code"))) {\n    //\u5c06\u8ba2\u5355\u7684\u6d88\u606f\u53d1\u9001\u5230mq\'\n    Map message = new HashMap();\n    message.put("orderId", result.get("out_trade_no"));\n    message.put("transactionId", result.get("transaction_id"));\n    //\u6d88\u606f\u7684\u53d1\u9001\n    rabbitTemplate.convertAndSend("", RabbitMQConfig.ORDER_PAY, JSON.toJSONString(message));\n\n    //\u5b8c\u6210\u53cc\u5411\u901a\u4fe1\n    rabbitTemplate.convertAndSend("paynotify","", result.get("out_trade_no"));\n}\n')),(0,l.kt)("p",null,"2 ydles_web_order\u7684PayController\u4e2d\u65b0\u589e\u8df3\u8f6c\u652f\u4ed8\u6210\u529f\u63a5\u53e3"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'//\u652f\u4ed8\u6210\u529f\u8df3\u8f6c\n@GetMapping("/topaysuccess")\npublic String topaysuccess(String payMoney, Model model) {\n    model.addAttribute("payMoney", payMoney);\n    return "paysuccess";\n}\n')),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200423120048804-8b52dc0a.png",alt:"image-20200423120048804"}),"image-20200423120048804"),(0,l.kt)("p",null,"3 \u4fee\u6539ydles_web_order\u9879\u76ee\u7684wxpay.html \uff0c\u6e32\u67d3js\u4ee3\u7801\u8ba2\u5355\u53f7\u548c\u652f\u4ed8\u91d1\u989d\u90e8\u5206"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'<script src="/js/plugins/qrcode.min.js"><\/script>\n<script src="/js/plugins/stomp.min.js"><\/script>\n<script type="text/javascript" th:inline="javascript">\n    let qrcode = new QRCode(document.getElementById("qrcode"), {\n        width: 240,\n        height: 240\n    });\n    qrcode.makeCode([[${code_url}]]);\n\n\n    let client = Stomp.client(\'ws://192.168.200.128:15674/ws\');\n    let on_connect = function (x) {\n        id = client.subscribe("/exchange/paynotify", function (d) {\n            alert(d.body);\n            let orderId = [[${orderId}]]\n            if (d.body == orderId) {\n                //\u8df3\u8f6c\u9875\u9762\n                location.href = "/api/wxpay/toPaySuccess?payMoney=" + [[${payMoney}]]\n            }\n        });\n    };\n    let on_error = function () {\n        console.log(\'error\');\n    };\n    client.connect(\'webguest\', \'webguest\', on_connect, on_error, \'/\');\n<\/script>\n')),(0,l.kt)("p",null,"\uff083\uff09\u5c06paysuccess.html\u62f7\u8d1d\u5230templates\u6587\u4ef6\u5939 \u3002"),(0,l.kt)("h2",{id:"5-\u6d4b\u8bd5\u8bbf\u95ee\u8def\u5f84"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_5-%E6%B5%8B%E8%AF%95%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84"},"#"),"5. \u6d4b\u8bd5\u8bbf\u95ee\u8def\u5f84"),(0,l.kt)("p",null,"1\u91cd\u542fydles_service_pay ydles_service_order"),(0,l.kt)("p",null,"2\u6dfb\u52a0\u5546\u54c1\uff1a ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/cart/addCart?skuId=100000006163&num=10"},"http://localhost:8001/api/cart/addCart?skuId=100000006163&num=10open in new window")),(0,l.kt)("p",null,"3\u67e5\u770b\u8d2d\u7269\u8f66\uff1a ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wcart/list"},"http://localhost:8001/api/wcart/listopen in new window")),(0,l.kt)("p",null,"4\u70b9\u51fb\uff1a\u7ed3\u7b97---\u300b\u63d0\u4ea4\u8ba2\u5355--\u300b\u9009\u62e9\u5fae\u4fe1\u652f\u4ed8--\u300b\u8df3\u5230\u4e8c\u7ef4\u7801\u9875\u9762--\u300b\u626b\u63cf\u4e8c\u7ef4\u7801"),(0,l.kt)("p",null,"5 \u652f\u4ed8\u5b8c\u6210 \u56de\u4f20\u8ba2\u5355\u6570\u636e"),(0,l.kt)("p",null,"6\u786e\u5b9a\u540e\uff0c\u8df3\u8f6c\u81f3\u652f\u4ed8\u6210\u529f\u9875\u9762"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222014108729-e4521203.png",alt:"image-20211222014108729"}),"image-20211222014108729"),(0,l.kt)("p",null,"\u603b\u7ed3\uff1a"),(0,l.kt)("p",null,"1\u4e86\u89e3\u5fae\u4fe1\u652f\u4ed8\u600e\u4e48\u505a"),(0,l.kt)("p",null,"\u7b2c\u4e09\u65b9\u63a5\u53e3\u5e73\u53f0\u5bf9\u63a5\uff1a\u7b2c\u4e09\u65b9\u5b98\u7f51\u6587\u6863\u4e00\u6b65\u4e00\u6b65\u505a"),(0,l.kt)("p",null,"2\u7533\u8bf7\u652f\u4ed8\u7684\u4e8c\u7ef4\u7801"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221144256113-e80b69c9.png",alt:"image-20211221144256113"}),"image-20211221144256113"),(0,l.kt)("p",null,"3\u652f\u4ed8\u56de\u63a8"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221203416360-61d74041.png",alt:"image-20211221203416360"}),"image-20211221203416360"),(0,l.kt)("p",null,"natapp \u5185\u7f51\u7a7f\u900f"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211221235105274-6db9cee5.png",alt:"image-20211221235105274"}),"image-20211221235105274"),(0,l.kt)("p",null,"4\u7528\u6237\u56de\u63a8 \u652f\u4ed8\u6210\u529f\u6d88\u606f"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222013147811-6fc7baa2.png",alt:"image-20211222013147811"}),"image-20211222013147811"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211222014807522-f05b12ce.png",alt:"image-20211222014807522"}),"image-20211222014807522"),(0,l.kt)("h1",{id:"\u7b2c14\u7ae0-\u8ba2\u5355\u5904\u7406"},(0,l.kt)("a",{parentName:"h1",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E7%AC%AC14%E7%AB%A0-%E8%AE%A2%E5%8D%95%E5%A4%84%E7%90%86"},"#"),"\u7b2c14\u7ae0 \u8ba2\u5355\u5904\u7406"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u89d2\u8272"),":\u8fd8\u662f\u8ba2\u5355\u7ec4\uff0c\u8d44\u6df1\u67b6\u6784\u5e08\u3002"),(0,l.kt)("h2",{id:"\u8bfe\u7a0b\u5185\u5bb9-1"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9-1"},"#"),"\u8bfe\u7a0b\u5185\u5bb9\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u901a\u8fc7rabbitmq\u7684\u5ef6\u8fdf\u6d88\u606f\u5b8c\u6210\u8d85\u65f6\u8ba2\u5355\u5904\u7406"),(0,l.kt)("li",{parentName:"ul"},"\u5b8c\u6210\u6279\u91cf\u53d1\u8d27\u529f\u80fd\uff0c\u4e86\u89e3\u7b2c\u4e09\u65b9\u7269\u6d41\u7cfb\u7edf"),(0,l.kt)("li",{parentName:"ul"},"\u5b8c\u6210\u81ea\u52a8\u6536\u8d27\u529f\u80fd")),(0,l.kt)("h2",{id:"1-\u8d85\u65f6\u672a\u652f\u4ed8\u8ba2\u5355\u5904\u7406-\u91cd\u70b9"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-%E8%B6%85%E6%97%B6%E6%9C%AA%E6%94%AF%E4%BB%98%E8%AE%A2%E5%8D%95%E5%A4%84%E7%90%86-%E9%87%8D%E7%82%B9"},"#"),"1. \u8d85\u65f6\u672a\u652f\u4ed8\u8ba2\u5355\u5904\u7406-\u91cd\u70b9"),(0,l.kt)("h3",{id:"11-\u9700\u6c42\u5206\u6790"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"},"#"),"1.1 \u9700\u6c42\u5206\u6790"),(0,l.kt)("p",null,"\u8d85\u8fc7\u9650\u5b9a\u65f6\u95f4\u5e76\u672a\u652f\u4ed8\u7684\u8ba2\u5355\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u8d85\u65f6\u8ba2\u5355\u7684\u5904\u7406\uff1a\u5148\u8c03\u7528\u5fae\u4fe1\u652f\u4ed8api\uff0c\u67e5\u8be2\u8be5\u8ba2\u5355\u7684\u652f\u4ed8\u72b6\u6001\u3002\u5982\u679c\u672a\u652f\u4ed8\u8c03\u7528\u5173\u95ed\u8ba2\u5355\u7684api\uff0c\u5e76\u4fee\u6539\u8ba2\u5355\u72b6\u6001\u4e3a\u5df2\u5173\u95ed\uff0c\u5e76\u56de\u6eda\u5e93\u5b58\u6570\u3002\u5982\u679c\u8be5\u8ba2\u5355\u5df2\u7ecf\u652f\u4ed8\uff0c\u5219\u505a\u8865\u507f\u64cd\u4f5c\uff08\u4fee\u6539\u8ba2\u5355\u72b6\u6001\u548c\u8bb0\u5f55\uff09\u3002"),(0,l.kt)("h3",{id:"12-\u5b9e\u73b0\u601d\u8def"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-2-%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"},"#"),"1.2 \u5b9e\u73b0\u601d\u8def"),(0,l.kt)("p",null,"\u5982\u4f55\u83b7\u53d6\u8d85\u8fc7\u9650\u5b9a\u65f6\u95f4\u7684\u8ba2\u5355\uff1f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528",(0,l.kt)("strong",{parentName:"p"},"\u5ef6\u8fdf\u6d88\u606f"),"\u961f\u5217\uff08\u6b7b\u4fe1\u961f\u5217\uff09\u6765\u5b9e\u73b0\u3002"),(0,l.kt)("p",null,"\u6240\u8c13\u5ef6\u8fdf\u6d88\u606f\u961f\u5217\uff0c\u5c31\u662f\u6d88\u606f\u7684\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\u5e76\u4e0d\u4f1a\u7acb\u523b\u88ab\u6d88\u8d39\uff0c\u800c\u662f\u5728\u8bbe\u5b9a\u7684\u65f6\u95f4\u4e4b\u540e\u624d\u53ef\u4ee5\u6d88\u8d39\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u5728\u8ba2\u5355\u521b\u5efa\u65f6\u53d1\u9001\u4e00\u4e2a\u5ef6\u8fdf\u6d88\u606f\uff0c\u6d88\u606f\u4e3a\u8ba2\u5355\u53f7\uff0c\u7cfb\u7edf\u4f1a\u5728\u9650\u5b9a\u65f6\u95f4\u4e4b\u540e\u53d6\u51fa\u8fd9\u4e2a\u6d88\u606f\uff0c\u7136\u540e\u67e5\u8be2\u8ba2\u5355\u7684\u652f\u4ed8\u72b6\u6001\uff0c\u6839\u636e\u7ed3\u679c\u505a\u51fa\u76f8\u5e94\u7684\u5904\u7406\u3002"),(0,l.kt)("h3",{id:"13-rabbitmq\u5ef6\u8fdf\u6d88\u606f"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-rabbitmq%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF"},"#"),"1.3 rabbitmq\u5ef6\u8fdf\u6d88\u606f"),(0,l.kt)("p",null,"\u4f7f\u7528RabbitMQ\u6765\u5b9e\u73b0\u5ef6\u8fdf\u6d88\u606f\u5fc5\u987b\u5148\u4e86\u89e3RabbitMQ\u7684\u4e24\u4e2a\u6982\u5ff5\uff1a\u6d88\u606f\u7684",(0,l.kt)("strong",{parentName:"p"},"TTL"),"\u548c",(0,l.kt)("strong",{parentName:"p"},"\u6b7b\u4fe1Exchange"),"\uff0c\u901a\u8fc7\u8fd9\u4e24\u8005\u7684\u7ec4\u5408\u6765\u5b9e\u73b0\u4e0a\u8ff0\u9700\u6c42\u3002"),(0,l.kt)("h4",{id:"131-\u6d88\u606f\u7684ttltime-to-live"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-1-%E6%B6%88%E6%81%AF%E7%9A%84ttl-time-to-live"},"#"),"1.3.1 \u6d88\u606f\u7684TTL\uff08Time To Live\uff09"),(0,l.kt)("p",null,"\u6d88\u606f\u7684TTL\u5c31\u662f\u6d88\u606f\u7684\u5b58\u6d3b\u65f6\u95f4\u3002RabbitMQ\u53ef\u4ee5\u5bf9\u961f\u5217\u548c\u6d88\u606f\u5206\u522b\u8bbe\u7f6eTTL\u3002\u5bf9\u961f\u5217\u8bbe\u7f6e\u5c31\u662f\u961f\u5217\u6ca1\u6709\u6d88\u8d39\u8005\u8fde\u7740\u7684\u4fdd\u7559\u65f6\u95f4\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u6bcf\u4e00\u4e2a\u5355\u72ec\u7684\u6d88\u606f\u505a\u5355\u72ec\u7684\u8bbe\u7f6e\u3002\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u65f6\u95f4\uff0c\u6211\u4eec\u8ba4\u4e3a\u8fd9\u4e2a\u6d88\u606f\u5c31\u6b7b\u4e86\uff0c\u79f0\u4e4b\u4e3a\u6b7b\u4fe1\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u961f\u5217queue.temp\uff0c\u5728Arguments \u4e2d\u6dfb\u52a0x-message-ttl \u4e3a5000 \uff08\u5355\u4f4d\u662f\u6beb\u79d2\uff09\uff0c\u90a3\u6bcf\u4e00\u4e2a\u8fdb\u5165\u8fd9\u4e2a\u961f\u5217\u7684\u6d88\u606f\u57285\u79d2\u540e\u4f1a\u6d88\u5931\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227105923204-9990ae46.png",alt:"image-20211227105923204"}),"image-20211227105923204"),(0,l.kt)("h4",{id:"132-\u6b7b\u4fe1\u4ea4\u6362\u5668-dead-letter-exchanges"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-2-%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E5%99%A8-dead-letter-exchanges"},"#"),"1.3.2 \u6b7b\u4fe1\u4ea4\u6362\u5668 Dead Letter Exchanges"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u9762\u8bd5\uff1a\u4ec0\u4e48\u65f6\u5019\u6b7b\u4fe1\uff1f")),(0,l.kt)("p",null,"\u4e00\u4e2a\u6d88\u606f\u5728\u6ee1\u8db3\u5982\u4e0b\u6761\u4ef6\u4e0b\uff0c\u4f1a\u8fdb\u6b7b\u4fe1\u4ea4\u6362\u673a\uff0c\u8bb0\u4f4f\u8fd9\u91cc\u662f\u4ea4\u6362\u673a\u800c\u4e0d\u662f\u961f\u5217\uff0c\u4e00\u4e2a\u4ea4\u6362\u673a\u53ef\u4ee5\u5bf9\u5e94\u5f88\u591a\u961f\u5217\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff081\uff09")," \u4e00\u4e2a\u6d88\u606f\u88abConsumer\u62d2\u6536\u4e86\uff0c\u5e76\u4e14reject\u65b9\u6cd5\u7684\u53c2\u6570\u91ccrequeue\u662ffalse\u3002\u4e5f\u5c31\u662f\u8bf4\u4e0d\u4f1a\u88ab\u518d\u6b21\u653e\u5728\u961f\u5217\u91cc\uff0c\u88ab\u5176\u4ed6\u6d88\u8d39\u8005\u4f7f\u7528\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff082\uff09**"),"\u4e0a\u9762\u7684\u6d88\u606f\u7684TTL\u5230\u4e86\uff0c\u6d88\u606f\u8fc7\u671f\u4e86**\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff083\uff09"),"\u961f\u5217\u7684\u957f\u5ea6\u9650\u5236\u6ee1\u4e86\u3002\u6392\u5728\u524d\u9762\u7684\u6d88\u606f\u4f1a\u88ab\u4e22\u5f03\u6216\u8005\u6254\u5230\u6b7b\u4fe1\u4ea4\u6362\u673a\u4e0a\u3002"),(0,l.kt)("p",null,"Dead Letter Exchange\u5176\u5b9e\u5c31\u662f\u4e00\u79cd\u666e\u901a\u7684exchange\uff0c\u548c\u521b\u5efa\u5176\u4ed6exchange\u6ca1\u6709\u4e24\u6837\u3002\u53ea\u662f\u5728\u67d0\u4e00\u4e2a\u8bbe\u7f6eDead Letter Exchange\u7684\u961f\u5217\u4e2d\u6709\u6d88\u606f\u8fc7\u671f\u4e86\uff0c\u4f1a\u81ea\u52a8\u89e6\u53d1\u6d88\u606f\u7684\u8f6c\u53d1\uff0c\u53d1\u9001\u5230Dead Letter Exchange\u4e2d\u53bb\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227111258327-ccd7a72a.png",alt:"image-20211227111258327"}),"image-20211227111258327"),(0,l.kt)("p",null,"\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u6d4b\u8bd5\u4e00\u4e0b\u5ef6\u8fdf\u961f\u5217\u3002"),(0,l.kt)("p",null,"\uff081\uff09\u521b\u5efa\u6b7b\u4fe1\u4ea4\u6362\u5668 exchange.ordertimeout \uff08",(0,l.kt)("strong",{parentName:"p"},"fanout"),"\uff09"),(0,l.kt)("p",null,"\uff082\uff09\u521b\u5efa\u961f\u5217queue.ordertimeout"),(0,l.kt)("p",null,"\uff083\uff09\u5efa\u7acb\u6b7b\u4fe1\u4ea4\u6362\u5668 exchange.ordertimeout \u4e0e\u961f\u5217queue.ordertimeout \u4e4b\u95f4\u7684\u7ed1\u5b9a"),(0,l.kt)("p",null,"\uff084\uff09\u521b\u5efa\u961f\u5217queue.ordercreate\uff0cArguments\u6dfb\u52a0"),(0,l.kt)("p",null,"x-message-ttl=10000"),(0,l.kt)("p",null,"x-dead-letter-exchange\uff1a exchange.ordertimeout"),(0,l.kt)("p",null,"\uff085\uff09\u6d4b\u8bd5\uff1a\u5411queue.ordercreate\u961f\u5217\u6dfb\u52a0\u6d88\u606f\uff0c\u7b49\u5f8510\u79d2\u540e\u6d88\u606f\u4ecequeue.ordercreate\u961f\u5217\u6d88\u5931\uff0c"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227111214185-813f14aa.png",alt:"image-20211227111214185"}),"image-20211227111214185"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227111247704-898b8747.png",alt:"image-20211227111247704"}),"image-20211227111247704"),(0,l.kt)("h3",{id:"14-\u4ee3\u7801\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-4-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"},"#"),"1.4 \u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227113439128-8d798b5d.png",alt:"image-20211227113439128"}),"image-20211227113439128"),(0,l.kt)("h4",{id:"141-\u5fae\u4fe1\u652f\u4ed8-\u5173\u95ed\u8ba2\u5355"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-4-1-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98-%E5%85%B3%E9%97%AD%E8%AE%A2%E5%8D%95"},"#"),"1.4.1 \u5fae\u4fe1\u652f\u4ed8-\u5173\u95ed\u8ba2\u5355"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227114511089-80618cbc.png",alt:"image-20211227114511089"}),"image-20211227114511089"),(0,l.kt)("p",null,"\uff081\uff09WxPayController\u65b0\u589e\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u5173\u95ed\u5fae\u4fe1\u8ba2\u5355\n * @param orderId\n * @return\n */\n@PutMapping("/close/{orderId}")\npublic Result closeOrder(@PathVariable String orderId){\n    Map map = wxPayService.closeOrder( orderId );\n    return new Result( true,StatusCode.OK,"",map );\n}\n')),(0,l.kt)("p",null,"\uff082\uff09ydles_service_pay\u7684WxPayService\u65b0\u589e\u65b9\u6cd5\u5b9a\u4e49"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n * \u5173\u95ed\u8ba2\u5355\n * @param orderId\n * @return\n */\nMap closeOrder(String orderId);\n")),(0,l.kt)("p",null,"\uff083\uff09ydles_service_pay\u7684 WxPayServiceImpl\u5b9e\u73b0\u8be5\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Override\npublic Map closeOrder(String orderId) {\n    Map map=new HashMap(  );\n    map.put( "out_trade_no",orderId );\n    try {\n        return  wxPay.closeOrder( map );\n    } catch (Exception e) {\n        e.printStackTrace();\n        return null;\n    }\n}\n')),(0,l.kt)("p",null,"\uff084\uff09ydles_service_pay_api\u7684WxPayFeign\u65b0\u589e\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u5173\u95ed\u5fae\u4fe1\u8ba2\u5355\n * @param orderId\n * @return\n */\n@PutMapping("/wxpay/close/{orderId}")\npublic Result closeOrder(@PathVariable("orderId") String orderId);\n')),(0,l.kt)("h4",{id:"142-\u5fae\u4fe1\u652f\u4ed8-\u67e5\u8be2\u8ba2\u5355"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-4-2-%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98-%E6%9F%A5%E8%AF%A2%E8%AE%A2%E5%8D%95"},"#"),"1.4.2 \u5fae\u4fe1\u652f\u4ed8-\u67e5\u8be2\u8ba2\u5355"),(0,l.kt)("p",null,"\uff081\uff09WxPayController\u65b0\u589e\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u67e5\u8be2\u5fae\u4fe1\u8ba2\u5355\n * @param orderId\n * @return\n */\n@GetMapping("/query/{orderId}")\npublic Result queryOrder(@PathVariable String orderId){\n    Map map = wxPayService.queryOrder( orderId );\n    return new Result( true,StatusCode.OK,"",map );\n}\n')),(0,l.kt)("p",null,"\uff082\uff09WxPayFeign\u65b0\u589e\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u67e5\u8be2\u5fae\u4fe1\u8ba2\u5355\n * @param orderId\n * @return\n */\n@GetMapping("/wxpay/query/{orderId}")\npublic Result queryOrder(@PathVariable("orderId") String orderId);\n')),(0,l.kt)("p",null,"\u5546\u54c1\u670d\u52a1\u56de\u6eda\u5e93\u5b58"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227115532726-7aca5071.png",alt:"image-20211227115532726"}),"image-20211227115532726"),(0,l.kt)("p",null,"\uff081\uff09dao"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'//\u56de\u6eda\u5e93\u5b58\n@Update("update tb_sku set num=num+#{num},sale_num=sale_num-#{num} where id=#{skuId}")\nvoid resumeStockNum(@Param("skuId") String skuId, @Param("num") Integer num);\n')),(0,l.kt)("p",null,"\uff082\uff09service"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"//\u56de\u6eda\u5e93\u5b58\nvoid resumeStockNum(String skuId,Integer num);\n")),(0,l.kt)("p",null,"\uff083\uff09serivceImpl"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Override\npublic void resumeStockNum(String skuId, Integer num) {\n    skuMapper.resumeStockNum(skuId,num);\n}\n")),(0,l.kt)("p",null,"(4)controller"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'//\u56de\u6eda\u5e93\u5b58\n    @PutMapping(value = "/resumeStockNum")\n    public Result resumeStockNum(@RequestParam("skuId") String skuId, @RequestParam("num")Integer num){\n        skuService.resumeStockNum(skuId,num);\n        return new Result(true,StatusCode.OK,"\u56de\u6eda\u5e93\u5b58\u6210\u529f\uff01");\n    }\n')),(0,l.kt)("p",null,"(4)skuFeign"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@PutMapping(value = "/sku/resumeStockNum")\npublic Result resumeStockNum(@RequestParam("skuId") String skuId, @RequestParam("num")Integer num);\n')),(0,l.kt)("h4",{id:"143-\u8ba2\u5355\u5173\u95ed\u903b\u8f91"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-4-3-%E8%AE%A2%E5%8D%95%E5%85%B3%E9%97%AD%E9%80%BB%E8%BE%91"},"#"),"1.4.3 \u8ba2\u5355\u5173\u95ed\u903b\u8f91"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227121318859-ad46fa80.png",alt:"image-20211227121318859"}),"image-20211227121318859"),(0,l.kt)("p",null,"\u5982\u679c\u4e3a\u672a\u652f\u4ed8\uff0c\u67e5\u8be2\u5fae\u4fe1\u8ba2\u5355"),(0,l.kt)("p",null,"\u5982\u679c\u786e\u8ba4\u4e3a\u672a\u652f\u4ed8\uff0c\u8c03\u7528\u5173\u95ed\u672c\u5730\u8ba2\u5355\uff08 \u4fee\u6539\u8ba2\u5355\u8868\u7684\u8ba2\u5355\u72b6\u6001\u3001\u8bb0\u5f55\u8ba2\u5355\u65e5\u5fd7\u3001\u6062\u590d\u5546\u54c1\u8868\u5e93\u5b58\uff09\u548c\u5fae\u4fe1\u8ba2\u5355\u7684\u903b\u8f91\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u4e3a\u5df2\u652f\u4ed8\u8fdb\u884c\u72b6\u6001\u8865\u507f\u3002"),(0,l.kt)("p",null,"\uff081\uff09ydles_service_order\u65b0\u589e\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>com.ydles</groupId>\n    <artifactId>ydles_service_pay_api</artifactId>\n    <version>1.0-SNAPSHOT</version>\n</dependency>\n")),(0,l.kt)("p",null,"\uff082\uff09ydles_service_order\u7684OrderService\u65b0\u589e\u65b9\u6cd5\u5b9a\u4e49"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n * \u5173\u95ed\u8ba2\u5355\n * @param orderId\n */\nvoid closeOrder(String orderId);\n")),(0,l.kt)("p",null,"\uff083\uff09OrderServiceImpl\u5b9e\u73b0\u8be5\u65b9\u6cd5"),(0,l.kt)("p",null,"\u5b9e\u73b0\u903b\u8f91\uff1a"),(0,l.kt)("p",null,"1\uff09\u6839\u636eid\u67e5\u8be2\u8ba2\u5355\u4fe1\u606f\uff0c\u5224\u65ad\u8ba2\u5355\u662f\u5426\u5b58\u5728\uff0c\u8ba2\u5355\u652f\u4ed8\u72b6\u6001\u662f\u5426\u4e3a\u672a\u652f\u4ed8"),(0,l.kt)("p",null,"2\uff09\u57fa\u4e8e\u5fae\u4fe1\u67e5\u8be2\u8ba2\u5355\u652f\u4ed8\u72b6\u6001"),(0,l.kt)("p",null,"2.1\uff09\u5982\u679c\u4e3asuccess\uff0c\u5219\u4fee\u6539\u8ba2\u5355\u72b6\u6001"),(0,l.kt)("p",null,"2.2\uff09\u5982\u679c\u4e3a\u672a\u652f\u4ed8\uff0c\u5219\u4fee\u6539\u8ba2\u5355\uff0c\u65b0\u589e\u65e5\u5fd7\uff0c\u6062\u590d\u5e93\u5b58\uff0c\u5173\u95ed\u8ba2\u5355"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Autowired\nPayFeign payFeign;\n//\u5173\u95ed\u8ba2\u5355\n@Override\n@Transactional\npublic void closeOrder(String orderId) {\n    System.out.println("\u5173\u95ed\u8ba2\u5355\u5f00\u542f\u4e86:"+orderId);\n\n    Order order = orderMapper.selectByPrimaryKey(orderId);\n    if(order==null){\n        throw new RuntimeException("\u8fd9\u7b14\u8ba2\u5355\u4e0d\u5b58\u5728\uff01");\n    }\n    if(!order.getOrderStatus().equals("0")){\n        System.out.println("\u8fd9\u7b14\u8ba2\u5355\u4e0d\u7528\u5173\u95ed");\n        return;\n    }\n    System.out.println("\u5173\u95ed\u8ba2\u5355\u903b\u8f91\u901a\u8fc7\u6821\u9a8c\uff1a"+orderId);\n\n\n    //1\u652f\u4ed8\u670d\u52a1 \u5fae\u4fe1\u67e5\u8be2\u8ba2\u5355\n    Map<String, String> wxQueryMap = payFeign.queryOrder(orderId).getData();\n\n    //2.1\u652f\u4ed8\u4e86 order\u8868\u4fee\u6539\n    if(wxQueryMap.get("trade_state").equals("SUCCESS")){\n        updatePayStatus(orderId,wxQueryMap.get("transaction_id"));\n        System.out.println("\u5df2\u652f\u4ed8"+orderId);\n    }\n\n    //2.2\u672a\u652f\u4ed8 \u5173\u95ed\u8ba2\u5355\u5fae\u4fe1 \u5185\u90e8\u56de\u6eda\u5e93\u5b58 \u8ba2\u5355\u72b6\u6001\u5173\u95ed\n    if(wxQueryMap.get("trade_state").equals("NOTPAY")){\n        //1\u5173\u95ed\u8ba2\u5355\u5fae\u4fe1\n        payFeign.closeOrder(orderId);\n\n        //2\u8ba2\u5355\u72b6\u6001\u5173\u95ed\n        System.out.println("\u672c\u9879\u76ee\u5173\u95ed\u8ba2\u5355\u4e86");\n        order.setOrderStatus("9");//\u8ba2\u5355\u72b6\u6001 0\u4e0b\u5355 1\u652f\u4ed8 2\u53d1\u8d27 3\u6536\u8d27 4\u9000\u8d27 9\u5173\u95ed\n        order.setCloseTime(new Date());\n        orderMapper.updateByPrimaryKeySelective(order);\n\n        //orderLog\u8868 \u65b0\u589e\u6570\u636e\n        OrderLog orderLog = new OrderLog();\n        orderLog.setId(idWorker.nextId()+"");\n        orderLog.setOperater("system");\n        orderLog.setOperateTime(new Date());\n        orderLog.setOrderId(orderId);\n        orderLog.setOrderStatus("9");\n        orderLog.setPayStatus("0");\n        orderLog.setConsignStatus("0");\n        orderLog.setRemarks("\u8d85\u65f6\u672a\u652f\u4ed8\uff01");\n        orderLogMapper.insertSelective(orderLog);\n\n\n        //3\u5185\u90e8\u56de\u6eda\u5e93\u5b58\n\n        //\u67e5\u51fa\u6765\u8fd9\u7b14\u8ba2\u5355\u7684\u6240\u6709\u8d2d\u7269\u9879\n        OrderItem orderItem=new OrderItem();\n        orderItem.setOrderId(orderId);\n        List<OrderItem> orderItemList = orderItemMapper.select(orderItem);\n\n        for (OrderItem orderItem1 : orderItemList) {\n            skuFeign.resumeStock(orderItem1.getSkuId(),orderItem1.getNum());\n        }\n\n    }\n\n    //\u8fd8\u6709\u5404\u79cd\u652f\u4ed8\u72b6\u6001 \u90fd\u9700\u8981\u8003\u8651\u3002REFUND CLOSED USERPAYING\n\n\n}\n')),(0,l.kt)("h4",{id:"144-\u5ef6\u8fdf\u6d88\u606f\u5904\u7406"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-4-4-%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86"},"#"),"1.4.4 \u5ef6\u8fdf\u6d88\u606f\u5904\u7406"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227170736337-59939cf9.png",alt:"image-20211227170736337"}),"image-20211227170736337"),(0,l.kt)("p",null,"\u4ece\u6d88\u606f\u961f\u5217queue.ordertimeout \u4e2d\u63d0\u53d6\u6d88\u606f"),(0,l.kt)("p",null,"\uff081\uff09\u4fee\u6539OrderServiceImpl\u7684add\u65b9\u6cd5\uff0c\u8ffd\u52a0\u4ee3\u7801\uff0c\u5b9e\u73b0mq\u53d1\u9001"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'rabbitTemplate.convertAndSend( "","queue.ordercreate", orderId);\n')),(0,l.kt)("p",null,"\uff082\uff09ydles_service_order\u65b0\u5efa\u76d1\u542c\u7c7b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class OrderTimeoutListener {\n\n    @Autowired\n    private OrderService orderService;\n\n    /**\n     * \u66f4\u65b0\u652f\u4ed8\u72b6\u6001\n     * @param orderId\n     */\n    @RabbitListener(queues = "queue.ordertimeout")\n    public void closeOrder(String orderId){\n        System.out.println("\u63a5\u6536\u5230\u5173\u95ed\u8ba2\u5355\u6d88\u606f\uff1a"+orderId);\n        try {\n            orderService.closeOrder( orderId );\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6d4b\u8bd5\u5173\u952e\u70b9"),"\uff1a"),(0,l.kt)("p",null,"1 10\u79d2\u540e\uff0c\u80fd\u4e0d\u80fdorder\u670d\u52a1\u63a5\u53d7\u6d88\u606f"),(0,l.kt)("p",null,"2 \u5fae\u4fe1\u652f\u4ed8\u4e86\uff0c\u672c\u5730order\u6ca1\u652f\u4ed8 ---\u300b\u4e0b\u5355\uff0c\u56de\u8c03\u63a5\u53e3\u5199\u9519\u3002"),(0,l.kt)("p",null,"3 \u6ca1\u652f\u4ed8---------\u300b\u4e8c\u7ef4\u7801\u9875\u9762\uff0c\u7b4910\u79d2\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"data:image/png;base64,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",alt:"image-20211227172604859"}),"image-20211227172604859"),(0,l.kt)("h2",{id:"2-\u8ba2\u5355\u6279\u91cf\u53d1\u8d27"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-%E8%AE%A2%E5%8D%95%E6%89%B9%E9%87%8F%E5%8F%91%E8%B4%A7"},"#"),"2. \u8ba2\u5355\u6279\u91cf\u53d1\u8d27"),(0,l.kt)("p",null,"\u89d2\u8272\uff1a\u5e97\u4e3b"),(0,l.kt)("h3",{id:"21-\u6279\u91cf\u53d1\u8d27\u4e1a\u52a1\u903b\u8f91"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-1-%E6%89%B9%E9%87%8F%E5%8F%91%E8%B4%A7%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91"},"#"),"2.1 \u6279\u91cf\u53d1\u8d27\u4e1a\u52a1\u903b\u8f91"),(0,l.kt)("h4",{id:"211-\u9700\u6c42\u5206\u6790"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"},"#"),"2.1.1 \u9700\u6c42\u5206\u6790"),(0,l.kt)("p",null,"\u5b9e\u73b0\u6279\u91cf\u53d1\u8d27\u7684\u4e1a\u52a1\u903b\u8f91"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227173827318-03d9a628.png",alt:"image-20211227173827318"}),"image-20211227173827318"),(0,l.kt)("h4",{id:"212-\u4ee3\u7801\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-1-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"},"#"),"2.1.2 \u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("p",null,"\uff081\uff09OrderController\u65b0\u589e\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},"[\n    {\n        orderId:8345,\n        shipping_name:\u987a\u4e30,\n        shipping_code:123,\n        .......\n    },{\n\n    },{\n\n    }\n]\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u6279\u91cf\u53d1\u8d27\n * @param orders  \u8ba2\u5355\u5217\u8868\n */\n@PostMapping("/batchSend")\npublic Result batchSend( @RequestBody List<Order> orders){\n    orderService.batchSend( orders );\n    return new Result( true,StatusCode.OK,"\u53d1\u8d27\u6210\u529f" );\n}\n')),(0,l.kt)("p",null,"\uff082\uff09OrderService\u65b0\u589e\u65b9\u6cd5\u5b9a\u4e49"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n * \u6279\u91cf\u53d1\u8d27\n * @param orders\n */\nvoid batchSend(List<Order> orders);\n")),(0,l.kt)("p",null,"\uff083\uff09OrderServiceImpl\u5b9e\u73b0\u8be5\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Override\n@Transactional\npublic void batchSend(List<Order> orderList) {\n    //\u5faa\u73af1 \u7269\u6d41\u516c\u53f8\u548c\u7269\u6d41\u5355\u53f7 \u4e0d\u80fd\u4e3a\u7a7a\n    for (Order order : orderList) {\n        if(order.getId()==null){\n            throw new RuntimeException("\u8ba2\u5355\u53f7\u4e3a\u7a7a\uff01");\n        }\n        if(order.getShippingName()==null||order.getShippingCode()==null){\n            throw new RuntimeException("\u7269\u6d41\u516c\u53f8\u6216\u5355\u53f7\u4e3a\u7a7a\uff01");\n        }\n    }\n\n    //\u5faa\u73af2 \u67e5\u8be2\u8ba2\u5355\u72b6\u6001 \u6821\u9a8c\n    for (Order order : orderList) {\n        Order queryOrder = orderMapper.selectByPrimaryKey(order.getId());\n        if(!queryOrder.getOrderStatus().equals("1")||!queryOrder.getConsignStatus().equals("0")){\n            throw new RuntimeException("\u8ba2\u5355\u72b6\u6001\u4e0d\u5bf9\uff0c\u4e0d\u80fd\u53d1\u8d27\uff01");\n        }\n    }\n\n    //\u5faa\u73af3 \u53d1\u8d27\n    for (Order order : orderList) {\n        order.setOrderStatus("2");\n        order.setConsignStatus("1");\n        order.setUpdateTime(new Date());\n        order.setConsignTime(new Date());\n        orderMapper.updateByPrimaryKeySelective(order);\n\n        //orderLog\u8868 \u65b0\u589e\u6570\u636e\n        OrderLog orderLog = new OrderLog();\n        orderLog.setId(idWorker.nextId()+"");\n        orderLog.setOperater("\u5e97\u5c0f\u4e8c");\n        orderLog.setOperateTime(new Date());\n        orderLog.setOrderId(order.getId());\n        orderLog.setOrderStatus("2");\n        orderLog.setPayStatus("1");\n        orderLog.setConsignStatus("1");\n        orderLog.setRemarks("\u6279\u91cf\u53d1\u8d27");\n        orderLogMapper.insertSelective(orderLog);\n    }\n\n}\n')),(0,l.kt)("h3",{id:"22-\u5bf9\u63a5\u7b2c\u4e09\u65b9\u7269\u6d41\u4e86\u89e3"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-%E5%AF%B9%E6%8E%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E7%89%A9%E6%B5%81-%E4%BA%86%E8%A7%A3"},"#"),"2.2 \u5bf9\u63a5\u7b2c\u4e09\u65b9\u7269\u6d41\uff08\u4e86\u89e3\uff09"),(0,l.kt)("p",null,"\u5f53\u6211\u4eec\u5728\u7535\u5546\u5e73\u53f0\u8d2d\u4e70\u4e86\u5546\u54c1\u540e\uff0c\u4e00\u822c\u4f1a\u975e\u5e38\u5173\u5fc3\u5546\u54c1\u7684\u7269\u6d41\u8f68\u8ff9\u3002\u90a3\u8fd9\u4e9b\u4fe1\u606f\u662f\u5982\u4f55\u83b7\u53d6\u7684\u5462\uff1f\u6211\u4eec\u9700\u8981\u5bf9\u63a5\u7b2c\u4e09\u65b9\u7684\u7269\u6d41\u7cfb\u7edf\u3002\u6bd4\u8f83\u5e38\u7528\u7684\u6709\u83dc\u9e1f\u7269\u6d41\u3001\u5feb\u9012\u9e1f\u7b49\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528\u5feb\u9012\u9e1f ",(0,l.kt)("a",{parentName:"p",href:"http://www.kdniao.com/"},"http://www.kdniao.comopen in new window")),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5feb\u9012\u9e1f\u63d0\u4f9b\u7684\u4ee5\u4e0b\u63a5\u53e3\uff1a"),(0,l.kt)("p",null,"\uff081\uff09\u9884\u7ea6\u53d6\u4ef6API"),(0,l.kt)("p",null,"\u9884\u7ea6\u53d6\u4ef6API\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86\u5728\u7ebf\u4e0b\u5355\uff0c\u9884\u7ea6\u5feb\u9012\u5458\u4e0a\u95e8\u63fd\u4ef6\u7684\u529f\u80fd\uff0c\u4e3a\u7528\u6237\u89e3\u51b3\u5728\u7ebf\u53d1\u8d27\u9700\u6c42\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u5728\u5b9e\u73b0\u6279\u91cf\u53d1\u8d27\u529f\u80fd\u540e\u8c03\u7528\u9884\u7ea6\u53d6\u4ef6API"),(0,l.kt)("p",null,"\uff082\uff09\u5373\u65f6\u67e5\u8be2API"),(0,l.kt)("p",null,"\u7269\u6d41\u67e5\u8be2API\u63d0\u4f9b\u5b9e\u65f6\u67e5\u8be2\u7269\u6d41\u8f68\u8ff9\u7684\u670d\u52a1\uff0c\u7528\u6237\u63d0\u4f9b\u8fd0\u5355\u53f7\u548c\u5feb\u9012\u516c\u53f8\uff0c\u5373\u53ef\u67e5\u8be2\u5f53\u524d\u65f6\u523b\u7684\u6700\u65b0\u7269\u6d41\u8f68\u8ff9\u3002"),(0,l.kt)("p",null,"\u7528\u6237\u53ef\u4ee5\u5728\u7528\u6237\u4e2d\u5fc3\u8c03\u7528\u6b64API\u5b8c\u6210\u7269\u6d41\u4fe1\u606f\u7684\u67e5\u8be2\uff0c\u7535\u5546\u5e73\u53f0\u4e5f\u53ef\u4ee5\u8c03\u7528\u6b64API\u5b8c\u6210\u8fd0\u5355\u7684\u8ddf\u8e2a\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227180923988-743ab9cb.png",alt:"image-20211227180923988"}),"image-20211227180923988"),(0,l.kt)("h2",{id:"3-\u786e\u8ba4\u6536\u8d27\u4e0e\u81ea\u52a8\u6536\u8d27"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-%E7%A1%AE%E8%AE%A4%E6%94%B6%E8%B4%A7%E4%B8%8E%E8%87%AA%E5%8A%A8%E6%94%B6%E8%B4%A7"},"#"),"3. \u786e\u8ba4\u6536\u8d27\u4e0e\u81ea\u52a8\u6536\u8d27"),(0,l.kt)("h3",{id:"31-\u786e\u8ba4\u6536\u8d27"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-1-%E7%A1%AE%E8%AE%A4%E6%94%B6%E8%B4%A7"},"#"),"3.1 \u786e\u8ba4\u6536\u8d27"),(0,l.kt)("h4",{id:"311-\u9700\u6c42\u5206\u6790\u4e0e\u5b9e\u73b0\u601d\u8def"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"},"#"),"3.1.1 \u9700\u6c42\u5206\u6790\u4e0e\u5b9e\u73b0\u601d\u8def"),(0,l.kt)("p",null,"\u5f53\u7269\u6d41\u516c\u53f8\u5c06\u8d27\u7269\u9001\u5230\u4e86\u7528\u6237\u6536\u8d27\u5730\u5740\u4e4b\u540e\uff0c\u9700\u8981\u7528\u6237\u70b9\u51fb\u786e\u8ba4\u6536\u8d27\uff0c\u5f53\u7528\u6237\u70b9\u51fb\u4e86\u786e\u8ba4\u6536\u8d27\u4e4b\u540e\uff0c\u4f1a\u4fee\u6539\u8ba2\u5355\u72b6\u6001\u4e3a\u5df2\u5b8c\u6210"),(0,l.kt)("h4",{id:"312-\u4ee3\u7801\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-1-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"},"#"),"3.1.2 \u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("p",null,"\uff081\uff09OrderController\u65b0\u589e\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u786e\u8ba4\u6536\u8d27 \n * @param orderId  \u8ba2\u5355\u53f7\n * @param operator \u64cd\u4f5c\u8005\n * @return\n */\n@PutMapping("/take/{orderId}/operator/{operator}")\npublic Result take(@PathVariable String orderId, @PathVariable String operator){\n    orderService.take( orderId,operator );\n    return new Result( true,StatusCode.OK,"" );\n}\n')),(0,l.kt)("p",null,"\uff082\uff09OrderService\u65b0\u589e\u65b9\u6cd5\u5b9a\u4e49"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n * \u786e\u8ba4\u6536\u8d27\n * @param orderId\n * @param operator\n */\nvoid confirmTask(String orderId,String operator);\n")),(0,l.kt)("p",null,"\uff083\uff09OrderServiceImpl\u5b9e\u73b0\u8be5\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Override\npublic void confirmTask(String orderId, String operator) {\n    Order order = orderMapper.selectByPrimaryKey( orderId );\n    if(order==null){\n        throw new RuntimeException( "\u8ba2\u5355\u4e0d\u5b58\u5728" );\n    }\n    if( !"1".equals( order.getConsignStatus() )){\n        throw new RuntimeException( "\u8ba2\u5355\u672a\u53d1\u8d27" );\n    }\n    order.setConsignStatus("2"); //\u5df2\u9001\u8fbe\n    order.setOrderStatus( "3" );//\u5df2\u5b8c\u6210\n    order.setUpdateTime( new Date() );\n    order.setEndTime( new Date() );//\u4ea4\u6613\u7ed3\u675f\n    orderMapper.updateByPrimaryKeySelective( order );\n    //\u8bb0\u5f55\u8ba2\u5355\u53d8\u52a8\u65e5\u5fd7\n    OrderLog orderLog=new OrderLog();\n    orderLog.setId( idWorker.nextId()+"" );\n    orderLog.setOperateTime(new Date());//\u5f53\u524d\u65e5\u671f\n    orderLog.setOperater( operator );//\u7cfb\u7edf\uff1f\u7ba1\u7406\u5458\uff1f\u7528\u6237\uff1f\n    orderLog.setOrderStatus("3");\n    orderLog.setOrderId(order.getId());\n    orderLogMapper.insertSelective(orderLog);\n}\n')),(0,l.kt)("h3",{id:"32-\u81ea\u52a8\u6536\u8d27\u5904\u7406"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-2-%E8%87%AA%E5%8A%A8%E6%94%B6%E8%B4%A7%E5%A4%84%E7%90%86"},"#"),"3.2 \u81ea\u52a8\u6536\u8d27\u5904\u7406"),(0,l.kt)("h4",{id:"321-\u9700\u6c42\u5206\u6790"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"},"#"),"3.2.1 \u9700\u6c42\u5206\u6790"),(0,l.kt)("p",null,"\u5982\u679c\u7528\u6237\u572815\u5929\uff08\u53ef\u4ee5\u5728\u8ba2\u5355\u914d\u7f6e\u8868\u4e2d\u914d\u7f6e\uff09\u6ca1\u6709\u786e\u8ba4\u6536\u8d27\uff0c\u7cfb\u7edf\u5c06\u81ea\u52a8\u6536\u8d27\u3002\u5982\u4f55\u5b9e\u73b0\uff1f\u6211\u4eec\u8fd9\u91cc\u91c7\u7528\u5b9a\u65f6\u4efb\u52a1springTask\u6765\u5b9e\u73b0\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227184231554-8ffec52a.png",alt:"image-20211227184231554"}),"image-20211227184231554"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u903b\u8f91"),"\uff1a\u6bcf\u5929\u51cc\u66682\u70b9\uff0c\u67e5\u8be2order,\u53d1\u8d2715\u5929\uff0c\u81ea\u52a8\u6536\u8d27\u3002"),(0,l.kt)("p",null," \u6bcf\u5929\u51cc\u66681\u70b9\uff0c\u5220\u9664\u751f\u4ea7\u73af\u5883\uff0c\u5220\u9664log\u3002"),(0,l.kt)("p",null,"\u6280\u672f\uff1a"),(0,l.kt)("p",null,"spring---\x3equartz"),(0,l.kt)("p",null,"spring task \u5b9a\u65f6\u4efb\u52a1"),(0,l.kt)("p",null,"xxl-job"),(0,l.kt)("h4",{id:"322-cron\u8868\u8fbe\u5f0f"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-2-2-cron%E8%A1%A8%E8%BE%BE%E5%BC%8F"},"#"),"3.2.2 Cron\u8868\u8fbe\u5f0f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'"0 * * * * *"\n')),(0,l.kt)("p",null,"Cron\u8868\u8fbe\u5f0f\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5b57\u7b26\u4e32\u5206\u4e3a\u4e03\u4e2a\u90e8\u5206\uff0c\u6bcf\u4e00\u4e2a\u57df\u4ee3\u8868\u4e00\u4e2a\u542b\u4e49\u3002"),(0,l.kt)("p",null,"Cron\u8868\u8fbe\u5f0f7\u4e2a\u57df\u683c\u5f0f\u4e3a\uff1a \u79d2 \u5206 \u5c0f\u65f6 \u65e5 \u6708 \u661f\u671f\u51e0 \u5e74"),(0,l.kt)("p",null,"Cron\u8868\u8fbe\u5f0f6\u4e2a\u57df\u683c\u5f0f\u4e3a\uff1a \u79d2 \u5206 \u5c0f\u65f6 \u65e5 \u6708 \u5468"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u5e8f\u53f7"),(0,l.kt)("th",{parentName:"tr",align:null},"\u8bf4\u660e"),(0,l.kt)("th",{parentName:"tr",align:null},"\u662f\u5426\u5fc5\u586b"),(0,l.kt)("th",{parentName:"tr",align:null},"\u5141\u8bb8\u586b\u5199\u7684\u503c"),(0,l.kt)("th",{parentName:"tr",align:null},"\u5141\u8bb8\u7684\u901a\u914d\u7b26"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1"),(0,l.kt)("td",{parentName:"tr",align:null},"\u79d2"),(0,l.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,l.kt)("td",{parentName:"tr",align:null},"0-59"),(0,l.kt)("td",{parentName:"tr",align:null},", - * /")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"2"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5206"),(0,l.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,l.kt)("td",{parentName:"tr",align:null},"0-59"),(0,l.kt)("td",{parentName:"tr",align:null},", - * /")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"3"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5c0f\u65f6"),(0,l.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,l.kt)("td",{parentName:"tr",align:null},"0-23"),(0,l.kt)("td",{parentName:"tr",align:null},", - * /")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"4"),(0,l.kt)("td",{parentName:"tr",align:null},"\u65e5"),(0,l.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,l.kt)("td",{parentName:"tr",align:null},"1-31"),(0,l.kt)("td",{parentName:"tr",align:null},", - * ? / L W")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"5"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6708"),(0,l.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,l.kt)("td",{parentName:"tr",align:null},"1-12\u6216JAN-DEC"),(0,l.kt)("td",{parentName:"tr",align:null},", - * /")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"6"),(0,l.kt)("td",{parentName:"tr",align:null},"\u661f\u671f\u51e0"),(0,l.kt)("td",{parentName:"tr",align:null},"\u662f"),(0,l.kt)("td",{parentName:"tr",align:null},"1-7\u6216SUN-SAT"),(0,l.kt)("td",{parentName:"tr",align:null},", - * ? / L W")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"7"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5e74"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5426"),(0,l.kt)("td",{parentName:"tr",align:null},"empty \u62161970-2099"),(0,l.kt)("td",{parentName:"tr",align:null},", - * /")))),(0,l.kt)("p",null,"\u4f7f\u7528\u8bf4\u660e\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'\u901a\u914d\u7b26\u8bf4\u660e:\n* \u8868\u793a\u6240\u6709\u503c. \u4f8b\u5982:\u5728\u5206\u7684\u5b57\u6bb5\u4e0a\u8bbe\u7f6e "*",\u8868\u793a\u6bcf\u4e00\u5206\u949f\u90fd\u4f1a\u89e6\u53d1\u3002\n\n? \u8868\u793a\u4e0d\u6307\u5b9a\u503c\u3002\u4f7f\u7528\u7684\u573a\u666f\u4e3a\u4e0d\u9700\u8981\u5173\u5fc3\u5f53\u524d\u8bbe\u7f6e\u8fd9\u4e2a\u5b57\u6bb5\u7684\u503c\u3002\n\n\u4f8b\u5982:\u8981\u5728\u6bcf\u6708\u768410\u53f7\u89e6\u53d1\u4e00\u4e2a\u64cd\u4f5c\uff0c\u4f46\u4e0d\u5173\u5fc3\u662f\u5468\u51e0\uff0c\u6240\u4ee5\u9700\u8981\u5468\u4f4d\u7f6e\u7684\u90a3\u4e2a\u5b57\u6bb5\u8bbe\u7f6e\u4e3a"?" \u5177\u4f53\u8bbe\u7f6e\u4e3a 0 0 0 10 * ?\n\n- \u8868\u793a\u533a\u95f4\u3002\u4f8b\u5982 \u5728\u5c0f\u65f6\u4e0a\u8bbe\u7f6e "10-12",\u8868\u793a 10,11,12\u70b9\u90fd\u4f1a\u89e6\u53d1\u3002\n\n, \u8868\u793a\u6307\u5b9a\u591a\u4e2a\u503c\uff0c\u4f8b\u5982\u5728\u5468\u5b57\u6bb5\u4e0a\u8bbe\u7f6e "MON,WED,FRI" \u8868\u793a\u5468\u4e00\uff0c\u5468\u4e09\u548c\u5468\u4e94\u89e6\u53d1\n\n/ \u7528\u4e8e\u9012\u589e\u89e6\u53d1\u3002\u5982\u5728\u79d2\u4e0a\u9762\u8bbe\u7f6e"5/15" \u8868\u793a\u4ece5\u79d2\u5f00\u59cb\uff0c\u6bcf\u589e15\u79d2\u89e6\u53d1(5,20,35,50)\u3002 \u5728\u6708\u5b57\u6bb5\u4e0a\u8bbe\u7f6e\'1/3\'\u6240\u793a\u6bcf\u67081\u53f7\u5f00\u59cb\uff0c\u6bcf\u9694\u4e09\u5929\u89e6\u53d1\u4e00\u6b21\u3002\n\nL \u8868\u793a\u6700\u540e\u7684\u610f\u601d\u3002\u5728\u65e5\u5b57\u6bb5\u8bbe\u7f6e\u4e0a\uff0c\u8868\u793a\u5f53\u6708\u7684\u6700\u540e\u4e00\u5929(\u4f9d\u636e\u5f53\u524d\u6708\u4efd\uff0c\u5982\u679c\u662f\u4e8c\u6708\u8fd8\u4f1a\u4f9d\u636e\u662f\u5426\u662f\u6da6\u5e74[leap]), \u5728\u5468\u5b57\u6bb5\u4e0a\u8868\u793a\u661f\u671f\u516d\uff0c\u76f8\u5f53\u4e8e"7"\u6216"SAT"\u3002\u5982\u679c\u5728"L"\u524d\u52a0\u4e0a\u6570\u5b57\uff0c\u5219\u8868\u793a\u8be5\u6570\u636e\u7684\u6700\u540e\u4e00\u4e2a\u3002\u4f8b\u5982\u5728\u5468\u5b57\u6bb5\u4e0a\u8bbe\u7f6e"6L"\u8fd9\u6837\u7684\u683c\u5f0f,\u5219\u8868\u793a\u201c\u672c\u6708\u6700\u540e\u4e00\u4e2a\u661f\u671f\u4e94"\n\nW \u8868\u793a\u79bb\u6307\u5b9a\u65e5\u671f\u7684\u6700\u8fd1\u90a3\u4e2a\u5de5\u4f5c\u65e5(\u5468\u4e00\u81f3\u5468\u4e94). \u4f8b\u5982\u5728\u65e5\u5b57\u6bb5\u4e0a\u8bbe\u7f6e"15W"\uff0c\u8868\u793a\u79bb\u6bcf\u670815\u53f7\u6700\u8fd1\u7684\u90a3\u4e2a\u5de5\u4f5c\u65e5\u89e6\u53d1\u3002\u5982\u679c15\u53f7\u6b63\u597d\u662f\u5468\u516d\uff0c\u5219\u627e\u6700\u8fd1\u7684\u5468\u4e94(14\u53f7)\u89e6\u53d1, \u5982\u679c15\u53f7\u662f\u5468\u672a\uff0c\u5219\u627e\u6700\u8fd1\u7684\u4e0b\u5468\u4e00(16\u53f7)\u89e6\u53d1.\u5982\u679c15\u53f7\u6b63\u597d\u5728\u5de5\u4f5c\u65e5(\u5468\u4e00\u81f3\u5468\u4e94)\uff0c\u5219\u5c31\u5728\u8be5\u5929\u89e6\u53d1\u3002\u5982\u679c\u6307\u5b9a\u683c\u5f0f\u4e3a "1W",\u5b83\u5219\u8868\u793a\u6bcf\u67081\u53f7\u5f80\u540e\u6700\u8fd1\u7684\u5de5\u4f5c\u65e5\u89e6\u53d1\u3002\u5982\u679c1\u53f7\u6b63\u662f\u5468\u516d\uff0c\u5219\u5c06\u57283\u53f7\u4e0b\u5468\u4e00\u89e6\u53d1\u3002(\u6ce8\uff0c"W"\u524d\u53ea\u80fd\u8bbe\u7f6e\u5177\u4f53\u7684\u6570\u5b57,\u4e0d\u5141\u8bb8\u533a\u95f4"-").\n\n# \u5e8f\u53f7(\u8868\u793a\u6bcf\u6708\u7684\u7b2c\u51e0\u4e2a\u5468\u51e0)\uff0c\u4f8b\u5982\u5728\u5468\u5b57\u6bb5\u4e0a\u8bbe\u7f6e"6#3"\u8868\u793a\u5728\u6bcf\u6708\u7684\u7b2c\u4e09\u4e2a\u5468\u516d.\u6ce8\u610f\u5982\u679c\u6307\u5b9a"#5",\u6b63\u597d\u7b2c\u4e94\u5468\u6ca1\u6709\u5468\u516d\uff0c\u5219\u4e0d\u4f1a\u89e6\u53d1\u8be5\u914d\u7f6e(\u7528\u5728\u6bcd\u4eb2\u8282\u548c\u7236\u4eb2\u8282\u518d\u5408\u9002\u4e0d\u8fc7\u4e86) \uff1b\n')),(0,l.kt)("p",null,"\u5e38\u7528\u8868\u8fbe\u5f0f"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'0 0 10,14,16 * * ? \u6bcf\u5929\u4e0a\u534810\u70b9\uff0c\u4e0b\u53482\u70b9\uff0c4\u70b9 \n0 0/30 9-17 * * ? \u671d\u4e5d\u665a\u4e94\u5de5\u4f5c\u65f6\u95f4\u5185\u6bcf\u534a\u5c0f\u65f6 \n0 0 12 ? * WED \u8868\u793a\u6bcf\u4e2a\u661f\u671f\u4e09\u4e2d\u534812\u70b9 \n"0 0 12 * * ?" \u6bcf\u5929\u4e2d\u534812\u70b9\u89e6\u53d1 \n"0 15 10 ? * *" \u6bcf\u5929\u4e0a\u534810:15\u89e6\u53d1 \n"0 15 10 * * ?" \u6bcf\u5929\u4e0a\u534810:15\u89e6\u53d1 \n"0 15 10 * * ? *" \u6bcf\u5929\u4e0a\u534810:15\u89e6\u53d1 \n"0 15 10 * * ? 2005" 2005\u5e74\u7684\u6bcf\u5929\u4e0a\u534810:15\u89e6\u53d1 \n"0 * 14 * * ?" \u5728\u6bcf\u5929\u4e0b\u53482\u70b9\u5230\u4e0b\u53482:59\u671f\u95f4\u7684\u6bcf1\u5206\u949f\u89e6\u53d1 \n"0 0/5 14 * * ?" \u5728\u6bcf\u5929\u4e0b\u53482\u70b9\u5230\u4e0b\u53482:55\u671f\u95f4\u7684\u6bcf5\u5206\u949f\u89e6\u53d1 \n"0 0/5 14,18 * * ?" \u5728\u6bcf\u5929\u4e0b\u53482\u70b9\u52302:55\u671f\u95f4\u548c\u4e0b\u53486\u70b9\u52306:55\u671f\u95f4\u7684\u6bcf5\u5206\u949f\u89e6\u53d1 \n"0 0-5 14 * * ?" \u5728\u6bcf\u5929\u4e0b\u53482\u70b9\u5230\u4e0b\u53482:05\u671f\u95f4\u7684\u6bcf1\u5206\u949f\u89e6\u53d1 \n"0 10,44 14 ? 3 WED" \u6bcf\u5e74\u4e09\u6708\u7684\u661f\u671f\u4e09\u7684\u4e0b\u53482:10\u548c2:44\u89e6\u53d1 \n"0 15 10 ? * MON-FRI" \u5468\u4e00\u81f3\u5468\u4e94\u7684\u4e0a\u534810:15\u89e6\u53d1 \n"0 15 10 15 * ?" \u6bcf\u670815\u65e5\u4e0a\u534810:15\u89e6\u53d1 \n"0 15 10 L * ?" \u6bcf\u6708\u6700\u540e\u4e00\u65e5\u7684\u4e0a\u534810:15\u89e6\u53d1 \n"0 15 10 ? * 6L" \u6bcf\u6708\u7684\u6700\u540e\u4e00\u4e2a\u661f\u671f\u4e94\u4e0a\u534810:15\u89e6\u53d1 \n"0 15 10 ? * 6L 2002-2005" 2002\u5e74\u81f32005\u5e74\u7684\u6bcf\u6708\u7684\u6700\u540e\u4e00\u4e2a\u661f\u671f\u4e94\u4e0a\u534810:15\u89e6\u53d1 \n"0 15 10 ? * 6#3" \u6bcf\u6708\u7684\u7b2c\u4e09\u4e2a\u661f\u671f\u4e94\u4e0a\u534810:15\u89e6\u53d1\n')),(0,l.kt)("h4",{id:"323-\u4ee3\u7801\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-2-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"},"#"),"3.2.3 \u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227195336675-340959bb.png",alt:"image-20211227195336675"}),"image-20211227195336675"),(0,l.kt)("h5",{id:"3231-\u53d1\u9001\u6d88\u606f"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-2-3-1-%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"},"#"),"3.2.3.1 \u53d1\u9001\u6d88\u606f"),(0,l.kt)("p",null,"\uff081\uff09\u521b\u5efaorder_tack\u961f\u5217 \u3002"),(0,l.kt)("p",null,"\uff082\uff09\u521b\u5efa\u5de5\u7a0bydles_task\uff0c\u5f15\u5165\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.amqp</groupId>\n            <artifactId>spring-rabbit</artifactId>\n        </dependency>\n    </dependencies>\n")),(0,l.kt)("p",null,"\uff083\uff09\u521b\u5efa\u914d\u7f6e\u6587\u4ef6 application.yml"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"server:\n  port: 9202\nspring:\n  application:\n    name: task\n  rabbitmq:\n    host: 192.168.200.128\n")),(0,l.kt)("p",null,"\uff084\uff09\u521b\u5efa\u542f\u52a8\u7c7b com.ydles.task"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@SpringBootApplication\n@EnableScheduling\npublic class TaskApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run( TaskApplication.class,args );\n    }\n}\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"@EnableScheduling")," \u6ce8\u89e3\u7528\u4e8e\u5f00\u542f\u4efb\u52a1\u8c03\u5ea6"),(0,l.kt)("p",null,"\uff085\uff09\u521b\u5efacom.ydles.task\u5305\uff0c\u5305\u4e0b\u521b\u5efa\u7c7bOrderTask"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class OrderTask {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    /**\n     * \u8ba2\u5355\u81ea\u52a8\u6536\u8d27\n     */\n    @Scheduled(cron = "0 0 0 * * ?")\n    public void autoTake(){\n        System.out.println(new Date(  ) );\n        rabbitTemplate.convertAndSend( "","order_tack","-" );\n    }\n\n}\n')),(0,l.kt)("h5",{id:"3232-\u63a5\u6536\u6d88\u606f"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-2-3-2-%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF"},"#"),"3.2.3.2 \u63a5\u6536\u6d88\u606f"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227200800397-029ab2a6.png",alt:"image-20211227200800397"}),"image-20211227200800397"),(0,l.kt)("p",null,"\uff081\uff09ydles_service_order\u5de5\u7a0b\uff0c\u7f16\u5199\u6d88\u606f\u76d1\u542c\u7c7b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class OrderTackListener {\n\n    @Autowired\n    private OrderService orderService;\n\n    @RabbitListener(queues = "order_tack")\n    public void autoTack(String message){\n        System.out.println("\u6536\u5230\u81ea\u52a8\u786e\u8ba4\u6536\u8d27\u6d88\u606f");\n        orderService.autoTack(); //\u81ea\u52a8\u786e\u8ba4\u6536\u8d27\n    }\n}\n')),(0,l.kt)("p",null,"\uff082\uff09OrderService\u65b0\u589e\u65b9\u6cd5\u5b9a\u4e49"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n * \u81ea\u52a8\u786e\u8ba4\u6536\u8d27\n */\nvoid autoTack();\n")),(0,l.kt)("p",null,"\uff083\uff09OrderServiceImpl\u5b9e\u73b0\u6b64\u65b9\u6cd5"),(0,l.kt)("p",null,"\u5b9e\u73b0\u601d\u8def\uff1a"),(0,l.kt)("p",null,"1\uff09\u4ece\u8ba2\u5355\u914d\u7f6e\u8868\u4e2d\u83b7\u53d6\u8ba2\u5355\u81ea\u52a8\u786e\u8ba4\u671f\u9650"),(0,l.kt)("p",null,"2\uff09\u5f97\u5230\u5f53\u524d\u65e5\u671f\u5411\u524d\u6570\uff08\u8ba2\u5355\u81ea\u52a8\u786e\u8ba4\u671f\u9650\uff09\u5929\u3002\u4f5c\u4e3a\u8fc7\u671f\u65f6\u95f4\u8282\u70b9"),(0,l.kt)("p",null,"3\uff09\u4ece\u8ba2\u5355\u8868\u4e2d\u83b7\u53d6\u8fc7\u671f\u8ba2\u5355\uff08\u53d1\u8d27\u65f6\u95f4\u5c0f\u4e8e\u8fc7\u671f\u65f6\u95f4\uff0c\u4e14\u4e3a\u672a\u786e\u8ba4\u6536\u8d27\u72b6\u6001\uff09"),(0,l.kt)("p",null,"4\uff09\u5faa\u73af\u6279\u91cf\u5904\u7406\uff0c\u6267\u884c\u786e\u8ba4\u6536\u8d27"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Autowired\nOrderConfigMapper orderConfigMapper;\n\n@Override\npublic void autoTack() {\n    //1 \u4ece\u914d\u7f6e\u8868\u4e2d\u83b7\u53d615\u5929\u503c\n    OrderConfig orderConfig = orderConfigMapper.selectByPrimaryKey("1");\n    Integer takeTimeout = orderConfig.getTakeTimeout();//15\n\n    //2 \u63a8\u7b97\u62ff\u51e0\u53f7\u4e4b\u524d\u53d1\u8d27\u7684\u8ba2\u5355\n    LocalDate now=LocalDate.now();//\u5f53\u524d\n    LocalDate date = now.plusDays(-takeTimeout);\n    System.out.println(date);\n\n    //3 \u67e5\u8be2\u53d1\u8d27\u8d85\u8fc715\u5929\u7684\u8ba2\u5355\n    Example example=new Example(Order.class);\n    Example.Criteria criteria = example.createCriteria();\n    criteria.andEqualTo("orderStatus","2");\n    criteria.andLessThan("consignTime", date);\n    List<Order> orderList = orderMapper.selectByExample(example);\n\n    //4 \u5faa\u73af \u628a\u8fd9\u4e9b\u8ba2\u5355 \u6536\u8d27\n    for (Order order : orderList) {\n        take(order.getId(),"system");\n    }\n}\n')),(0,l.kt)("p",null,"\u603b\u7ed3\uff1a"),(0,l.kt)("p",null,"1\u8d85\u65f6\u672a\u652f\u4ed8\u8ba2\u5355\u5904\u7406"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227113439128-8d798b5d.png",alt:"image-20211227113439128"}),"image-20211227113439128"),(0,l.kt)("p",null," 2\u8ba2\u5355\u6279\u91cf\u53d1\u8d27\uff08\u5e97\u4e3b\uff09"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227173827318-03d9a628.png",alt:"image-20211227173827318"}),"image-20211227173827318"),(0,l.kt)("p",null,"3\u786e\u8ba4\u6536\u8d27\u4e0e\u81ea\u52a8\u6536\u8d27"),(0,l.kt)("p",null,"\u624b\u52a8\uff1a/take/{orderId}/operator/"),(0,l.kt)("p",null,"\u81ea\u52a8\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227184231554-8ffec52a.png",alt:"image-20211227184231554"}),"image-20211227184231554"),(0,l.kt)("h1",{id:"\u7b2c15\u7ae0-\u79d2\u6740\u524d\u7aef"},(0,l.kt)("a",{parentName:"h1",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E7%AC%AC15%E7%AB%A0-%E7%A7%92%E6%9D%80%E5%89%8D%E7%AB%AF"},"#"),"\u7b2c15\u7ae0-\u79d2\u6740\u524d\u7aef"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u89d2\u8272"),"\uff1a\u72ec\u7acb\u6a21\u5757 \u79d2\u6740\u6a21\u5757\u3002",(0,l.kt)("strong",{parentName:"p"},"\u67b6\u6784\u5e08"),"\u3002"),(0,l.kt)("h2",{id:"\u8bfe\u7a0b\u5185\u5bb9-2"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E8%AF%BE%E7%A8%8B%E5%86%85%E5%AE%B9-2"},"#"),"\u8bfe\u7a0b\u5185\u5bb9:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u79d2\u6740\u4e1a\u52a1\u5206\u6790")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"```properties\n1.\u4ec0\u4e48\u662f\u79d2\u6740\n2.\u79d2\u6740\u5b9e\u73b0\u7684\u6d41\u7a0b->\u67b6\u6784\u5206\u6790\u6d41\u7a0b->\u91cd\u70b9\n3.\u4e1a\u52a1\u6d41\u7a0b\n```\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u79d2\u6740\u5546\u54c1\u538b\u5165Redis\u7f13\u5b58")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"```properties\n\u79d2\u6740\u5546\u54c1\u5b58\u5165\u5230Redis\u6765\u63d0\u5347\u8bbf\u95ee\u901f\u5ea6\n1.\u79d2\u6740\u5217\u8868\u6570\u636e\n2.\u79d2\u6740\u8be6\u60c5\u9875\u6570\u636e\n```\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Spring\u5b9a\u65f6\u4efb\u52a1\u4e86\u89e3-\u5b9a\u65f6\u5c06\u79d2\u6740\u5546\u54c1\u5b58\u5165\u5230Redis\u4e2d")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"```properties\n\u5b9a\u65f6\u5c06\u79d2\u6740\u5546\u54c1\u5b58\u5165\u5230Redis\u7f13\u5b58\n```\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u79d2\u6740\u5546\u54c1\u9891\u9053\u9875\u5b9e\u73b0-\u79d2\u6740\u5546\u54c1\u5217\u8868\u9875")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u79d2\u6740\u5546\u54c1\u8be6\u60c5\u9875\u5b9e\u73b0"))),(0,l.kt)("h2",{id:"1-\u79d2\u6740\u4e1a\u52a1\u5206\u6790"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-%E7%A7%92%E6%9D%80%E4%B8%9A%E5%8A%A1%E5%88%86%E6%9E%90"},"#"),"1 \u79d2\u6740\u4e1a\u52a1\u5206\u6790"),(0,l.kt)("h4",{id:"11-\u9700\u6c42\u5206\u6790-1"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"},"#"),"1.1 \u9700\u6c42\u5206\u6790"),(0,l.kt)("p",null,"\u6240\u8c13\u201c\u79d2\u6740\u201d\uff0c\u5c31\u662f\u7f51\u7edc\u5356\u5bb6\u53d1\u5e03\u4e00\u4e9b\u8d85\u4f4e\u4ef7\u683c\u7684\u5546\u54c1\uff0c\u6240\u6709\u4e70\u5bb6\u5728\u540c\u4e00\u65f6\u95f4\u7f51\u4e0a\u62a2\u8d2d\u7684\u4e00\u79cd\u9500\u552e\u65b9\u5f0f\u3002\u901a\u4fd7\u4e00\u70b9\u8bb2\u5c31\u662f\u7f51\u7edc\u5546\u5bb6\u4e3a\u4fc3\u9500\u7b49\u76ee\u7684\u7ec4\u7ec7\u7684\u7f51\u4e0a\u9650\u65f6\u62a2\u8d2d\u6d3b\u52a8\u3002\u7531\u4e8e\u5546\u54c1\u4ef7\u683c\u4f4e\u5ec9\uff0c\u5f80\u5f80\u4e00\u4e0a\u67b6\u5c31\u88ab\u62a2\u8d2d\u4e00\u7a7a\uff0c\u6709\u65f6\u53ea\u7528\u4e00\u79d2\u949f\u3002"),(0,l.kt)("p",null,"\u79d2\u6740\u5546\u54c1\u901a\u5e38\u6709",(0,l.kt)("strong",{parentName:"p"},"\u4e24\u79cd\u9650\u5236"),"\uff1a\u5e93\u5b58\u9650\u5236\u3001\u65f6\u95f4\u9650\u5236\u3002"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\uff081\uff09\u79d2\u6740\u9891\u9053\u9996\u9875\u5217\u51fa\u79d2\u6740\u5546\u54c1\n\uff084\uff09\u70b9\u51fb\u7acb\u5373\u62a2\u8d2d\u5b9e\u73b0\u79d2\u6740\u4e0b\u5355\uff0c\u4e0b\u5355\u65f6\u6263\u51cf\u5e93\u5b58\u3002\u5f53\u5e93\u5b58\u4e3a0\u6216\u4e0d\u5728\u6d3b\u52a8\u671f\u8303\u56f4\u5185\u65f6\u65e0\u6cd5\u79d2\u6740\u3002\n\uff085\uff09\u79d2\u6740\u4e0b\u5355\u6210\u529f\uff0c\u76f4\u63a5\u8df3\u8f6c\u5230\u652f\u4ed8\u9875\u9762\uff08\u5fae\u4fe1\u626b\u7801\uff09\uff0c\u652f\u4ed8\u6210\u529f\uff0c\u8df3\u8f6c\u5230\u6210\u529f\u9875\uff0c\u586b\u5199\u6536\u8d27\u5730\u5740\u3001\u7535\u8bdd\u3001\u6536\u4ef6\u4eba\u7b49\u4fe1\u606f\uff0c\u5b8c\u6210\u8ba2\u5355\u3002\n\uff086\uff09\u5f53\u7528\u6237\u79d2\u6740\u4e0b\u53555\u5206\u949f\u5185\u672a\u652f\u4ed8\uff0c\u53d6\u6d88\u9884\u8ba2\u5355\uff0c\u8c03\u7528\u5fae\u4fe1\u652f\u4ed8\u7684\u5173\u95ed\u8ba2\u5355\u63a5\u53e3\uff0c\u6062\u590d\u5e93\u5b58\u3002\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227221818494-8ebee597.png",alt:"image-20211227221818494"}),"image-20211227221818494"),(0,l.kt)("h4",{id:"12-\u8868\u7ed3\u6784\u8bf4\u660e"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-2-%E8%A1%A8%E7%BB%93%E6%9E%84%E8%AF%B4%E6%98%8E"},"#"),"1.2 \u8868\u7ed3\u6784\u8bf4\u660e"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u79d2\u6740\u5546\u54c1\u4fe1\u606f\u8868")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE `tb_seckill_goods` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `goods_id` bigint(20) DEFAULT NULL COMMENT 'spu ID',\n  `item_id` bigint(20) DEFAULT NULL COMMENT 'sku ID',\n  `title` varchar(100) DEFAULT NULL COMMENT '\u6807\u9898',\n  `small_pic` varchar(150) DEFAULT NULL COMMENT '\u5546\u54c1\u56fe\u7247',\n  `price` decimal(10,2) DEFAULT NULL COMMENT '\u539f\u4ef7\u683c',\n  `cost_price` decimal(10,2) DEFAULT NULL COMMENT '\u79d2\u6740\u4ef7\u683c',\n  `seller_id` varchar(100) DEFAULT NULL COMMENT '\u5546\u5bb6ID',\n  `create_time` datetime DEFAULT NULL COMMENT '\u6dfb\u52a0\u65e5\u671f',\n  `check_time` datetime DEFAULT NULL COMMENT '\u5ba1\u6838\u65e5\u671f',\n  `status` char(1) DEFAULT NULL COMMENT '\u5ba1\u6838\u72b6\u6001\uff0c0\u672a\u5ba1\u6838\uff0c1\u5ba1\u6838\u901a\u8fc7\uff0c2\u5ba1\u6838\u4e0d\u901a\u8fc7',\n  `start_time` datetime DEFAULT NULL COMMENT '\u5f00\u59cb\u65f6\u95f4',\n  `end_time` datetime DEFAULT NULL COMMENT '\u7ed3\u675f\u65f6\u95f4',\n  `num` int(11) DEFAULT NULL COMMENT '\u79d2\u6740\u5546\u54c1\u6570',\n  `stock_count` int(11) DEFAULT NULL COMMENT '\u5269\u4f59\u5e93\u5b58\u6570',\n  `introduction` varchar(2000) DEFAULT NULL COMMENT '\u63cf\u8ff0',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227221948208-fc0ab4b4.png",alt:"image-20211227221948208"}),"image-20211227221948208"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u79d2\u6740\u8ba2\u5355\u8868")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE `tb_seckill_order` (\n    `id` bigint(20) NOT NULL COMMENT '\u4e3b\u952e',\n    `seckill_id` bigint(20) DEFAULT NULL COMMENT '\u79d2\u6740\u5546\u54c1ID',\n    `money` decimal(10,2) DEFAULT NULL COMMENT '\u652f\u4ed8\u91d1\u989d',\n    `user_id` varchar(50) DEFAULT NULL COMMENT '\u7528\u6237',\n    `seller_id` varchar(50) DEFAULT NULL COMMENT '\u5546\u5bb6',\n    `create_time` datetime DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4',\n    `pay_time` datetime DEFAULT NULL COMMENT '\u652f\u4ed8\u65f6\u95f4',\n    `status` char(1) DEFAULT NULL COMMENT '\u72b6\u6001\uff0c0\u672a\u652f\u4ed8\uff0c1\u5df2\u652f\u4ed8',\n    `receiver_address` varchar(200) DEFAULT NULL COMMENT '\u6536\u8d27\u4eba\u5730\u5740',\n    `receiver_mobile` varchar(20) DEFAULT NULL COMMENT '\u6536\u8d27\u4eba\u7535\u8bdd',\n    `receiver` varchar(20) DEFAULT NULL COMMENT '\u6536\u8d27\u4eba',\n    `transaction_id` varchar(30) DEFAULT NULL COMMENT '\u4ea4\u6613\u6d41\u6c34',\n    PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227222002467-e63d1cd6.png",alt:"image-20211227222002467"}),"image-20211227222002467"),(0,l.kt)("h4",{id:"13-\u79d2\u6740\u9700\u6c42\u5206\u6790\u62d3\u5c55\u5185\u5bb9"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-%E7%A7%92%E6%9D%80%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-%E6%8B%93%E5%B1%95%E5%86%85%E5%AE%B9"},"#"),"1.3 \u79d2\u6740\u9700\u6c42\u5206\u6790==\u62d3\u5c55\u5185\u5bb9"),(0,l.kt)("p",null,"\u79d2\u6740\u6280\u672f\u5b9e\u73b0\u6838\u5fc3\u601d\u60f3\u662f\u8fd0\u7528\u7f13\u5b58\u51cf\u5c11\u6570\u636e\u5e93\u77ac\u95f4\u7684\u8bbf\u95ee\u538b\u529b\uff01\u8bfb\u53d6\u5546\u54c1\u8be6\u7ec6\u4fe1\u606f\u65f6\u8fd0\u7528\u7f13\u5b58\uff0c\u5f53\u7528\u6237\u70b9\u51fb\u62a2\u8d2d\u65f6\u51cf\u5c11\u7f13\u5b58\u4e2d\u7684\u5e93\u5b58\u6570\u91cf\uff0c\u5f53\u5e93\u5b58\u6570\u4e3a0\u65f6\u6216\u6d3b\u52a8\u671f\u7ed3\u675f\u65f6\uff0c\u540c\u6b65\u5230\u6570\u636e\u5e93\u3002 \u4ea7\u751f\u7684\u79d2\u6740\u9884\u8ba2\u5355\u4e5f\u4e0d\u4f1a\u7acb\u523b\u5199\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u800c\u662f\u5148\u5199\u5230\u7f13\u5b58\uff0c\u5f53\u7528\u6237\u4ed8\u6b3e\u6210\u529f\u540e\u518d\u5199\u5165\u6570\u636e\u5e93\u3002"),(0,l.kt)("p",null,"\u5f53\u7136\uff0c\u4e0a\u9762\u5b9e\u73b0\u7684\u601d\u8def\u53ea\u662f\u4e00\u79cd\u6700\u7b80\u5355\u7684\u65b9\u5f0f\uff0c\u5e76\u672a\u8003\u8651\u5176\u4e2d\u4e00\u4e9b\u95ee\u9898\uff0c\u4f8b\u5982\u5e76\u53d1\u72b6\u51b5\u5bb9\u6613\u4ea7\u751f\u7684\u95ee\u9898\u3002\u6211\u4eec\u770b\u770b\u4e0b\u9762\u8fd9\u5f20\u601d\u8def\u66f4\u4e25\u8c28\u7684\u56fe\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/1578267434606-d0a51b91.png",alt:"1578267434606"}),"1578267434606"),(0,l.kt)("h2",{id:"2-\u79d2\u6740\u5546\u54c1\u5b58\u5165\u7f13\u5b58-\u91cd\u70b9"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-%E7%A7%92%E6%9D%80%E5%95%86%E5%93%81%E5%AD%98%E5%85%A5%E7%BC%93%E5%AD%98-%E9%87%8D%E7%82%B9"},"#"),"2 \u79d2\u6740\u5546\u54c1\u5b58\u5165\u7f13\u5b58-\u91cd\u70b9"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228160425046-fa761d21.png",alt:"image-20211228160425046"}),"image-20211228160425046"),(0,l.kt)("p",null,"\u79d2\u6740\u5546\u54c1\u7531B\u7aef\u5b58\u5165Mysql\uff0c\u8bbe\u7f6e\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u5c31\u4eceMysql\u4e2d\u5c06\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u4eceMysql\u4e2d\u67e5\u8be2\u51fa\u6765\u5e76\u5b58\u5165\u7f13\u5b58\u4e2d\uff0credis\u4ee5Hash\u7c7b\u578b\u8fdb\u884c\u6570\u636e\u5b58\u50a8\u3002"),(0,l.kt)("p",null,"KEY\u7684\u8bbe\u8ba1\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"seckill_goods_2021122812 map\n                  id SecKillGoods\n                  1 Prada\u5305\u5305\n                  3  guccy\u5305\u5305\nseckill_goods_2021122814 map\n                  id SecKillGoods\n                  2 lv\u5305\u5305\nseckill_goods_2021122816 map          \nseckill_goods_2021122818 map\nseckill_goods_2021122820 map\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6211\u4eec\u8fd9\u91cc\u79d2\u6740\u5546\u54c1\u5217\u8868\u548c\u79d2\u6740\u5546\u54c1\u8be6\u60c5\u90fd\u662f\u4eceRedis\u4e2d\u53d6\u51fa\u6765\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9996\u5148\u8981\u5c06\u7b26\u5408\u53c2\u4e0e\u79d2\u6740\u7684\u5546\u54c1\u5b9a\u65f6\u67e5\u8be2\u51fa\u6765\uff0c\u5e76\u5c06\u6570\u636e\u5b58\u5165\u5230Redis\u7f13\u5b58\u4e2d\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u6570\u636e\u5b58\u50a8\u7c7b\u578b\u6211\u4eec\u53ef\u4ee5\u9009\u62e9Hash\u7c7b\u578b\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u79d2\u6740\u5206\u9875\u5217\u8868\u8fd9\u91cc\u53ef\u4ee5\u901a\u8fc7\u83b7\u53d6redisTemplate.boundHashOps(key).values()\u83b7\u53d6\u7ed3\u679c\u6570\u636e\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u79d2\u6740\u5546\u54c1\u8be6\u60c5\uff0c\u53ef\u4ee5\u901a\u8fc7redisTemplate.boundHashOps(key).get(key)\u83b7\u53d6\u8be6\u60c5\u3002")),(0,l.kt)("h3",{id:"21-\u79d2\u6740\u670d\u52a1\u642d\u5efa"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-1-%E7%A7%92%E6%9D%80%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA"},"#"),"2.1 \u79d2\u6740\u670d\u52a1\u642d\u5efa"),(0,l.kt)("p",null,"\u6211\u4eec\u5c06\u5546\u54c1\u6570\u636e\u538b\u5165\u5230Reids\u7f13\u5b58\uff0c\u53ef\u4ee5\u5728\u79d2\u6740\u5de5\u7a0b\u7684\u670d\u52a1\u5de5\u7a0b\u4e2d\u5b8c\u6210\uff0c\u53ef\u4ee5\u6309\u7167\u5982\u4e0b\u6b65\u9aa4\u5b9e\u73b0\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-properties"},"1.\u67e5\u8be2\u6d3b\u52a8\u6ca1\u7ed3\u675f\u7684\u6240\u6709\u79d2\u6740\u5546\u54c1\n    1)\u72b6\u6001\u5fc5\u987b\u4e3a\u5ba1\u6838\u901a\u8fc7 status=1\n    2)\u5546\u54c1\u5e93\u5b58\u4e2a\u6570>0\n    3)\u6d3b\u52a8\u6ca1\u6709\u7ed3\u675f  endTime>=now()\n    4)\u5728Redis\u4e2d\u6ca1\u6709\u8be5\u5546\u54c1\u7684\u7f13\u5b58\n    5)\u6267\u884c\u67e5\u8be2\u83b7\u53d6\u5bf9\u5e94\u7684\u7ed3\u679c\u96c6\n2.\u5c06\u6d3b\u52a8\u6ca1\u6709\u7ed3\u675f\u7684\u79d2\u6740\u5546\u54c1\u5165\u5e93\n")),(0,l.kt)("p",null,"\u6211\u4eec\u9996\u5148\u642d\u5efa\u4e00\u4e2a\u79d2\u6740\u670d\u52a1\u5de5\u7a0b\uff0c\u7136\u540e\u6309\u7167\u4e0a\u9762\u6b65\u9aa4\u5b9e\u73b0\u3002"),(0,l.kt)("p",null,"\u642d\u5efaydles-service-seckill\uff0c\u4f5c\u4e3a\u79d2\u6740\u5de5\u7a0b\u7684\u670d\u52a1\u63d0\u4f9b\u5de5\u7a0b\u3002"),(0,l.kt)("p",null,"1\uff09\u65b0\u5efa\u670d\u52a1ydles_service_seckill"),(0,l.kt)("p",null,"2\uff09\u6dfb\u52a0\u4f9d\u8d56\u4fe1\u606f\uff0c\u8be6\u60c5\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependencies>\n    <dependency>\n        <groupId>com.ydles</groupId>\n        <artifactId>ydles_common_db</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>com.ydles</groupId>\n        <artifactId>ydles_service_order_api</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </dependency>\n    <dependency>\n        <groupId>com.ydles</groupId>\n        <artifactId>ydles_service_seckill_api</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </dependency>\n    <dependency>\n        <groupId>com.ydles</groupId>\n        <artifactId>ydles_service_goods_api</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.amqp</groupId>\n        <artifactId>spring-rabbit</artifactId>\n    </dependency>\n    \x3c!--oauth\u4f9d\u8d56--\x3e\n    <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-starter-oauth2</artifactId>\n    </dependency>\n</dependencies>\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"ydles_service_seckill_api\u521b\u5efa")),(0,l.kt)("p",null,"\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"    <dependencies>\n        <dependency>\n            <groupId>com.ydles</groupId>\n            <artifactId>ydles_common</artifactId>\n            <version>1.0-SNAPSHOT</version>\n        </dependency>\n    </dependencies>\n")),(0,l.kt)("p",null,"\u6dfb\u52a0\u5305 com.ydles.seckill.feign com.ydles.seckill.pojo"),(0,l.kt)("p",null,"pojo\u4e2d\u5c06\u8d44\u6599\u4e2d\u7684\u4e24\u4e2a\u5b9e\u4f53\u7c7b\u653e\u5165\uff0c\u5bf9\u5e94\u6570\u636e\u5e93\u7684\u4e24\u5f20\u8868"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228161100576-817ff531.png",alt:"image-20211228161100576"}),"image-20211228161100576"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u56de\u5230ydles_service_seckill\u5de5\u7a0b\u3002\u6dfb\u52a0\u542f\u52a8\u7c7b com.ydles.seckill")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@SpringBootApplication\n@EnableEurekaClient\n@EnableFeignClients\n@MapperScan(basePackages = {"com.ydles.seckill.dao"})\n@EnableScheduling\npublic class SeckillApplication {\n\n\n    public static void main(String[] args) {\n        SpringApplication.run(SeckillApplication.class,args);\n    }\n\n    @Bean\n    public IdWorker idWorker(){\n        return new IdWorker(1,1);\n    }\n    \n    //\u8bbe\u7f6eredistemplate\u7684\u5e8f\u5217\u5316\n    @Bean\n    public RedisTemplate<Object, Object> redisTemplate(RedisConnectionFactory redisConnectionFactory) {\n        // 1.\u521b\u5efa redisTemplate \u6a21\u7248\n        RedisTemplate<Object, Object> template = new RedisTemplate<>();\n        // 2.\u5173\u8054 redisConnectionFactory\n        template.setConnectionFactory(redisConnectionFactory);\n        // 3.\u521b\u5efa \u5e8f\u5217\u5316\u7c7b\n        GenericToStringSerializer genericToStringSerializer = new GenericToStringSerializer(Object.class);\n        // 6.\u5e8f\u5217\u5316\u7c7b\uff0c\u5bf9\u8c61\u6620\u5c04\u8bbe\u7f6e\n        // 7.\u8bbe\u7f6e value \u7684\u8f6c\u5316\u683c\u5f0f\u548c key \u7684\u8f6c\u5316\u683c\u5f0f\n        template.setValueSerializer(genericToStringSerializer);\n        template.setKeySerializer(new StringRedisSerializer());\n        template.afterPropertiesSet();\n        return template;\n    }\n}\n')),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6dfb\u52a0dao\u5c42\u7684\u4e24\u4e2amapper")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public interface SeckillGoodsMapper extends Mapper<SeckillGoods> {\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public interface SeckillOrderMapper extends Mapper<SeckillOrder> {\n}\n")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6dfb\u52a0application.yml")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"server:\n  port: 9016\nspring:\n  jackson:\n    time-zone: GMT+8\n  application:\n    name: seckill\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://192.168.200.128:3306/ydles_seckill?useUnicode=true&characterEncoding=utf-8&useSSL=false&allowMultiQueries=true&serverTimezone=GMT%2b8\n    username: root\n    password: root\n  main:\n    allow-bean-definition-overriding: true #\u5f53\u9047\u5230\u540c\u6837\u540d\u5b57\u7684\u65f6\u5019\uff0c\u662f\u5426\u5141\u8bb8\u8986\u76d6\u6ce8\u518c\n  redis:\n    host: 192.168.200.128\n  rabbitmq:\n    host: 192.168.200.128\neureka:\n  client:\n    service-url:\n      defaultZone: http://127.0.0.1:6868/eureka\n  instance:\n    prefer-ip-address: true\nfeign:\n  hystrix:\n    enabled: true\n  client:\n    config:\n      default:   #\u914d\u7f6e\u5168\u5c40\u7684feign\u7684\u8c03\u7528\u8d85\u65f6\u65f6\u95f4  \u5982\u679c \u6709\u6307\u5b9a\u7684\u670d\u52a1\u914d\u7f6e \u9ed8\u8ba4\u7684\u914d\u7f6e\u4e0d\u4f1a\u751f\u6548\n        connectTimeout: 60000 # \u6307\u5b9a\u7684\u662f \u6d88\u8d39\u8005 \u8fde\u63a5\u670d\u52a1\u63d0\u4f9b\u8005\u7684\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 \u662f\u5426\u80fd\u8fde\u63a5  \u5355\u4f4d\u662f\u6beb\u79d2\n        readTimeout: 20000  # \u6307\u5b9a\u7684\u662f\u8c03\u7528\u670d\u52a1\u63d0\u4f9b\u8005\u7684 \u670d\u52a1 \u7684\u8d85\u65f6\u65f6\u95f4\uff08\uff09  \u5355\u4f4d\u662f\u6beb\u79d2\n#hystrix \u914d\u7f6e\nhystrix:\n  command:\n    default:\n      execution:\n        timeout:\n          #\u5982\u679cenabled\u8bbe\u7f6e\u4e3afalse\uff0c\u5219\u8bf7\u6c42\u8d85\u65f6\u4ea4\u7ed9ribbon\u63a7\u5236\n          enabled: true\n        isolation:\n          strategy: SEMAPHORE\n          thread:\n            # \u7194\u65ad\u5668\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\uff1a1000/\u6beb\u79d2\n            timeoutInMilliseconds: 20000\n")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6dfb\u52a0\u516c\u94a5 copy\u8ba4\u8bc1\u670d\u52a1\u7684\u516c\u94a5"),(0,l.kt)("li",{parentName:"ol"},"\u6dfb\u52a0Oauth\u914d\u7f6e\u7c7b config\u5305")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Configuration\n@EnableResourceServer\n//\u5f00\u542f\u65b9\u6cd5\u4e0a\u7684PreAuthorize\u6ce8\u89e3\n@EnableGlobalMethodSecurity(prePostEnabled = true, securedEnabled = true)\npublic class ResourceServerConfig extends ResourceServerConfigurerAdapter {\n\n    //\u516c\u94a5\n    private static final String PUBLIC_KEY = "public.key";\n\n    /***\n     * \u5b9a\u4e49JwtTokenStore\n     * @param jwtAccessTokenConverter\n     * @return\n     */\n    @Bean\n    public TokenStore tokenStore(JwtAccessTokenConverter jwtAccessTokenConverter) {\n        return new JwtTokenStore(jwtAccessTokenConverter);\n    }\n\n    /***\n     * \u5b9a\u4e49JJwtAccessTokenConverter\n     * @return\n     */\n    @Bean\n    public JwtAccessTokenConverter jwtAccessTokenConverter() {\n        JwtAccessTokenConverter converter = new JwtAccessTokenConverter();\n        converter.setVerifierKey(getPubKey());\n        return converter;\n    }\n    /**\n     * \u83b7\u53d6\u975e\u5bf9\u79f0\u52a0\u5bc6\u516c\u94a5 Key\n     * @return \u516c\u94a5 Key\n     */\n    private String getPubKey() {\n        Resource resource = new ClassPathResource(PUBLIC_KEY);\n        try {\n            InputStreamReader inputStreamReader = new InputStreamReader(resource.getInputStream());\n            BufferedReader br = new BufferedReader(inputStreamReader);\n            return br.lines().collect(Collectors.joining("\\n"));\n        } catch (IOException ioe) {\n            return null;\n        }\n    }\n\n    /***\n     * Http\u5b89\u5168\u914d\u7f6e\uff0c\u5bf9\u6bcf\u4e2a\u5230\u8fbe\u7cfb\u7edf\u7684http\u8bf7\u6c42\u94fe\u63a5\u8fdb\u884c\u6821\u9a8c\n     * @param http\n     * @throws Exception\n     */\n    @Override\n    public void configure(HttpSecurity http) throws Exception {\n        //\u6240\u6709\u8bf7\u6c42\u5fc5\u987b\u8ba4\u8bc1\u901a\u8fc7\n        http.authorizeRequests()\n                .anyRequest().\n                authenticated();    //\u5176\u4ed6\u5730\u5740\u9700\u8981\u8ba4\u8bc1\u6388\u6743\n    }\n}\n')),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u66f4\u6539\u7f51\u5173\u8def\u5f84\u8fc7\u6ee4\u7c7b\uff0c\u6dfb\u52a0\u79d2\u6740\u5de5\u7a0b\u8fc7\u6ee4\u4fe1\u606f")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228162810677-a4fbb12f.png",alt:"image-20211228162810677"}),"image-20211228162810677"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u66f4\u6539\u7f51\u5173\u914d\u7f6e\u6587\u4ef6\uff0c\u6dfb\u52a0\u8bf7\u6c42\u8def\u7531\u8f6c\u53d1")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"        #\u79d2\u6740\u5fae\u670d\u52a1\n        - id: ydles_seckill_route\n          uri: lb://seckill\n          predicates:\n            - Path=/api/seckill/**\n          filters:\n            - StripPrefix=1\n")),(0,l.kt)("h3",{id:"22-\u65f6\u95f4\u64cd\u4f5c"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-%E6%97%B6%E9%97%B4%E6%93%8D%E4%BD%9C"},"#"),"2.2 \u65f6\u95f4\u64cd\u4f5c"),(0,l.kt)("h4",{id:"221-\u79d2\u6740\u5546\u54c1\u65f6\u95f4\u6bb5\u5206\u6790"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-1-%E7%A7%92%E6%9D%80%E5%95%86%E5%93%81%E6%97%B6%E9%97%B4%E6%AE%B5%E5%88%86%E6%9E%90"},"#"),"2.2.1 \u79d2\u6740\u5546\u54c1\u65f6\u95f4\u6bb5\u5206\u6790"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228171058257-0677530e.png",alt:"image-20211228171058257"}),"image-20211228171058257"),(0,l.kt)("p",null,"\u6839\u636e\u4ea7\u54c1\u539f\u578b\u56fe\u7ed3\u5408\u79d2\u6740\u5546\u54c1\u8868\u8bbe\u8ba1\u53ef\u4ee5\u5f97\u77e5\uff0c\u79d2\u6740\u5546\u54c1\u662f\u5b58\u5728\u5f00\u59cb\u65f6\u95f4\u4e0e\u7ed3\u675f\u65f6\u95f4\u7684\uff0c\u5f53\u524d\u79d2\u6740\u5546\u54c1\u662f\u6309\u7167\u79d2\u6740\u65f6\u95f4\u6bb5\u8fdb\u884c\u663e\u793a\uff0c\u5982\u679c\u5f53\u524d\u65f6\u95f4\u5728\u7b26\u5408\u6761\u4ef6\u7684\u65f6\u95f4\u6bb5\u8303\u56f4\u4e4b\u5185\uff0c\u5219\u7528\u6237\u53ef\u4ee5\u79d2\u6740\u8d2d\u4e70\u5f53\u524d\u65f6\u95f4\u6bb5\u4e4b\u5185\u7684\u79d2\u6740\u5546\u54c1\u3002"),(0,l.kt)("p",null,"\u7f13\u5b58\u6570\u636e\u52a0\u8f7d\u601d\u8def\uff1a\u5b9a\u4e49\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bcf\u5929\u51cc\u6668\u4f1a\u8fdb\u884c\u5f53\u5929\u6240\u6709\u65f6\u95f4\u6bb5\u79d2\u6740\u5546\u54c1\u9884\u52a0\u8f7d\u3002\u5e76\u4e14\u5728B\u7aef\u8fdb\u884c\u9650\u5236\uff0c\u6dfb\u52a0\u79d2\u6740\u5546\u54c1\u7684\u8bdd\uff0c\u53ea\u80fd\u6dfb\u52a0\u5f53\u524d\u65e5\u671f+1\u7684\u65f6\u95f4\u9650\u5236\uff0c\u6bd4\u5982\u8bf4\uff1a\u5f53\u524d\u65e5\u671f\u4e3a8\u67085\u65e5\uff0c\u5219\u6dfb\u52a0\u79d2\u6740\u5546\u54c1\u65f6\uff0c\u5f00\u59cb\u65f6\u95f4\u5fc5\u987b\u4e3a6\u65e5\u7684\u67d0\u4e00\u4e2a\u65f6\u95f4\u6bb5\uff0c\u5426\u5219\u4e0d\u80fd\u6dfb\u52a0\u3002"),(0,l.kt)("h4",{id:"222-\u79d2\u6740\u5546\u54c1\u65f6\u95f4\u6bb5\u8ba1\u7b97"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-2-%E7%A7%92%E6%9D%80%E5%95%86%E5%93%81%E6%97%B6%E9%97%B4%E6%AE%B5%E8%AE%A1%E7%AE%97"},"#"),"2.2.2 \u79d2\u6740\u5546\u54c1\u65f6\u95f4\u6bb5\u8ba1\u7b97"),(0,l.kt)("p",null,"\u5c06",(0,l.kt)("inlineCode",{parentName:"p"},"\u8d44\u6e90/DateUtil.java"),"\u6dfb\u52a0\u5230\u516c\u5171\u670d\u52a1\u4e2d\u3002\u57fa\u4e8e\u5f53\u524d\u5de5\u5177\u7c7b\u53ef\u4ee5\u8fdb\u884c\u65f6\u95f4\u6bb5\u7684\u8ba1\u7b97\u3002"),(0,l.kt)("p",null,"\u5728\u8be5\u5de5\u5177\u7c7b\u4e2d\uff0c\u8fdb\u884c\u65f6\u95f4\u8ba1\u7b97\u6d4b\u8bd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public static void main(String[] args) {\n    //\u5b9a\u4e49\u5b58\u50a8\u7ed3\u679c\u7684\u96c6\u5408\n    List<Date> dateList = new ArrayList<>();\n\n    //\u83b7\u53d6\u672c\u65e5\u51cc\u6668\u65f6\u95f4\u70b9\n    Date currentData = toDayStartHour(new Date());\n\n    //\u5faa\u73af12\u6b21 \uff08\u56e0\u4e3a\u8981\u83b7\u53d6\u6bcf\u9694\u4e24\u4e2a\u65f6\u95f4\u4e3a\u4e00\u4e2a\u65f6\u95f4\u6bb5\u7684\u503c\uff09\n    for (int i=0;i<12;i++){\n        dateList.add(addDateHour(currentData,i*2));\n    }\n\n    for (Date date : dateList) {\n        SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");\n        String format = simpleDateFormat.format(date);\n        System.out.println(format);\n    }\n}\n')),(0,l.kt)("p",null,"\u6d4b\u8bd5\u7ed3\u679c\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228171813908-6e66583f.png",alt:"image-20211228171813908"}),"image-20211228171813908"),(0,l.kt)("h4",{id:"223-\u5f53\u524d\u4e1a\u52a1\u6574\u4f53\u6d41\u7a0b\u5206\u6790"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-3-%E5%BD%93%E5%89%8D%E4%B8%9A%E5%8A%A1%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"},"#"),"2.2.3 \u5f53\u524d\u4e1a\u52a1\u6574\u4f53\u6d41\u7a0b\u5206\u6790"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-properties"},"1.\u5b9a\u65f6\u4efb\u52a1\uff1a\u67e5\u8be2\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684\u79d2\u6740\u5546\u54c1\n    1) \u83b7\u53d6\u65f6\u95f4\u6bb5\u96c6\u5408\u5e76\u5faa\u73af\u904d\u5386\u51fa\u6bcf\u4e00\u4e2a\u65f6\u95f4\u6bb5\n    2) \u83b7\u53d6\u6bcf\u4e00\u4e2a\u65f6\u95f4\u6bb5\u540d\u79f0,\u7528\u4e8e\u540e\u7eedredis\u4e2dkey\u7684\u8bbe\u7f6e\n    3) \u72b6\u6001\u5fc5\u987b\u4e3a\u5ba1\u6838\u901a\u8fc7 status=1\n    4) \u5546\u54c1\u5e93\u5b58\u4e2a\u6570>0 \n    5) \u79d2\u6740\u5546\u54c1\u5f00\u59cb\u65f6\u95f4>=\u5f53\u524d\u65f6\u95f4\u6bb5\n    6) \u79d2\u6740\u5546\u54c1\u7ed3\u675f<\u5f53\u524d\u65f6\u95f4\u6bb5+2\u5c0f\u65f6\n    7) \u6392\u9664\u4e4b\u524d\u5df2\u7ecf\u52a0\u8f7d\u5230Redis\u7f13\u5b58\u4e2d\u7684\u5546\u54c1\u6570\u636e\n    8) \u6267\u884c\u67e5\u8be2\u83b7\u53d6\u5bf9\u5e94\u7684\u7ed3\u679c\u96c6\n2.\u5c06\u79d2\u6740\u5546\u54c1\u5b58\u5165\u7f13\u5b58\n")),(0,l.kt)("h3",{id:"23-\u4ee3\u7801\u5b9e\u73b0-1"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1"},"#"),"2.3 \u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("h4",{id:"231-\u66f4\u6539\u542f\u52a8\u7c7b\u6dfb\u52a0\u5f00\u542f\u5b9a\u65f6\u4efb\u52a1\u6ce8\u89e3"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-1-%E6%9B%B4%E6%94%B9%E5%90%AF%E5%8A%A8%E7%B1%BB-%E6%B7%BB%E5%8A%A0%E5%BC%80%E5%90%AF%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%B3%A8%E8%A7%A3"},"#"),"2.3.1 \u66f4\u6539\u542f\u52a8\u7c7b\uff0c\u6dfb\u52a0\u5f00\u542f\u5b9a\u65f6\u4efb\u52a1\u6ce8\u89e3"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@EnableScheduling\n")),(0,l.kt)("h4",{id:"232-\u65f6\u95f4\u83dc\u5355\u5206\u6790"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-2-%E6%97%B6%E9%97%B4%E8%8F%9C%E5%8D%95%E5%88%86%E6%9E%90"},"#"),"2.3.2 \u65f6\u95f4\u83dc\u5355\u5206\u6790"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227224705978-2b56d226.png",alt:"image-20211227224705978"}),"image-20211227224705978"),(0,l.kt)("p",null,"\u6211\u4eec\u5c06\u5546\u54c1\u6570\u636e\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u51fa\u6765\uff0c\u5e76\u5b58\u5165Redis\u7f13\u5b58\uff0c\u4f46\u9875\u9762\u6bcf\u6b21\u663e\u793a\u7684\u65f6\u5019\uff0c\u53ea\u663e\u793a\u5f53\u524d\u6b63\u5728\u79d2\u6740\u4ee5\u53ca\u5f80\u540e\u5ef6\u65f62\u4e2a\u5c0f\u65f6\u30014\u4e2a\u5c0f\u65f6\u30016\u4e2a\u5c0f\u65f6\u30018\u4e2a\u5c0f\u65f6\u7684\u79d2\u6740\u5546\u54c1\u6570\u636e\u3002\u6211\u4eec\u8981\u505a\u7684\u7b2c\u4e00\u4e2a\u4e8b\u662f\u8ba1\u7b97\u51fa\u79d2\u6740\u65f6\u95f4\u83dc\u5355\uff0c\u8fd9\u4e2a\u83dc\u5355\u662f\u4ece\u540e\u53f0\u83b7\u53d6\u7684\u3002"),(0,l.kt)("p",null,"\u8fd9\u4e2a\u65f6\u95f4\u83dc\u5355\u7684\u8ba1\u7b97\u6211\u4eec\u6765\u5206\u6790\u4e0b\uff0c\u53ef\u4ee5\u5148\u6c42\u51fa\u5f53\u524d\u65f6\u95f4\u7684\u51cc\u6668\uff0c\u7136\u540e\u6bcf2\u4e2a\u5c0f\u65f6\u540e\u4f5c\u4e3a\u4e0b\u4e00\u4e2a\u62a2\u8d2d\u7684\u5f00\u59cb\u65f6\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u5206\u51fa12\u4e2a\u62a2\u8d2d\u65f6\u95f4\u6bb5,\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-properties"},"00:00-02:00\n02:00-04:00\n04:00-06:00\n06:00-08:00\n08:00-10:00\n10:00-12:00\n12:00-14:00\n14:00-16:00\n16:00-18:00\n18:00-20:00\n20:00-22:00\n22:00-00:00\n")),(0,l.kt)("p",null,"\u800c\u73b0\u5b9e\u7684\u83dc\u5355\u53ea\u9700\u8981\u8ba1\u7b97\u51fa\u5f53\u524d\u65f6\u95f4\u5728\u54ea\u4e2a\u65f6\u95f4\u6bb5\u8303\u56f4\uff0c\u8be5\u65f6\u95f4\u6bb5\u8303\u56f4\u5c31\u5c5e\u4e8e\u6b63\u5728\u79d2\u6740\u7684\u65f6\u95f4\u6bb5\uff0c\u800c\u540e\u9762\u5373\u5c06\u5f00\u59cb\u7684\u79d2\u6740\u65f6\u95f4\u6bb5\u7684\u8ba1\u7b97\u4e5f\u5c31\u51fa\u6765\u4e86\uff0c\u53ef\u4ee5\u5728\u5f53\u524d\u65f6\u95f4\u6bb5\u57fa\u7840\u4e4b\u4e0a+2\u5c0f\u65f6\u3001+4\u5c0f\u65f6\u3001+6\u5c0f\u65f6\u3001+8\u5c0f\u65f6\u3002"),(0,l.kt)("p",null,"\u5173\u4e8e\u65f6\u95f4\u83dc\u5355\u7684\u8fd0\u7b97\uff0c\u5728\u7ed9\u51fa\u7684DateUtil\u5305\u91cc\u5df2\u7ecf\u5b9e\u73b0\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/***\n * \u83b7\u53d6\u65f6\u95f4\u83dc\u5355\n * @return\n */\npublic static List<Date> getDateMenus(){\n    //\u5b9a\u4e49\u4e00\u4e2aList<Date>\u96c6\u5408\uff0c\u5b58\u50a8\u6240\u6709\u65f6\u95f4\u6bb5\n    List<Date> dates = getDates(12);\n    //\u5224\u65ad\u5f53\u524d\u65f6\u95f4\u5c5e\u4e8e\u54ea\u4e2a\u65f6\u95f4\u8303\u56f4\n    Date now = new Date();\n    for (Date cdate : dates) {\n        //\u5f00\u59cb\u65f6\u95f4<=\u5f53\u524d\u65f6\u95f4<\u5f00\u59cb\u65f6\u95f4+2\u5c0f\u65f6\n        if(cdate.getTime()<=now.getTime() && now.getTime()<addDateHour(cdate,2).getTime()){\n            now = cdate;\n            break;\n        }\n    }\n\n    //\u5f53\u524d\u9700\u8981\u663e\u793a\u7684\u65f6\u95f4\u83dc\u5355\n    List<Date> dateMenus = new ArrayList<Date>();\n    for (int i = 0; i <5 ; i++) {\n        dateMenus.add(addDateHour(now,i*2));\n    }\n    return dateMenus;\n}\n\n/***\n * \u6307\u5b9a\u65f6\u95f4\u5f80\u540eN\u4e2a\u65f6\u95f4\u95f4\u9694\n * @param hours\n * @return\n */\npublic static List<Date> getDates(int hours) {\n    List<Date> dates = new ArrayList<Date>();\n    //\u5faa\u73af12\u6b21\n    Date date = toDayStartHour(new Date()); //\u51cc\u6668\n    for (int i = 0; i <hours ; i++) {\n        //\u6bcf\u6b21\u9012\u589e2\u5c0f\u65f6,\u5c06\u6bcf\u6b21\u9012\u589e\u7684\u65f6\u95f4\u5b58\u5165\u5230List<Date>\u96c6\u5408\u4e2d\n        dates.add(addDateHour(date,i*2));\n    }\n    return dates;\n}\n")),(0,l.kt)("h4",{id:"232-\u5b9a\u4e49\u5b9a\u65f6\u4efb\u52a1\u7c7b"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-3-2-%E5%AE%9A%E4%B9%89%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%B1%BB"},"#"),"2.3.2 \u5b9a\u4e49\u5b9a\u65f6\u4efb\u52a1\u7c7b"),(0,l.kt)("p",null,"\u79d2\u6740\u5de5\u7a0b\u65b0\u5efatask\u5305\uff0c\u5e76\u65b0\u5efa\u4efb\u52a1\u7c7bSeckillGoodsPushTask"),(0,l.kt)("p",null,"\u4e1a\u52a1\u903b\u8f91\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n         * 1.\u67e5\u8be2\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684\u79d2\u6740\u5546\u54c1\n         *  1) \u83b7\u53d6\u65f6\u95f4\u6bb5\u96c6\u5408\u5e76\u5faa\u73af\u904d\u5386\u51fa\u6bcf\u4e00\u4e2a\u65f6\u95f4\u6bb5\n         *  2) \u83b7\u53d6\u6bcf\u4e00\u4e2a\u65f6\u95f4\u6bb5\u540d\u79f0,\u7528\u4e8e\u540e\u7eedredis\u4e2dkey\u7684\u8bbe\u7f6e\n         *  3) \u72b6\u6001\u5fc5\u987b\u4e3a\u5ba1\u6838\u901a\u8fc7 status=1\n         *  4) \u5546\u54c1\u5e93\u5b58\u4e2a\u6570>0\n         *  5) \u79d2\u6740\u5546\u54c1\u5f00\u59cb\u65f6\u95f4>=\u5f53\u524d\u65f6\u95f4\u6bb5\n         *  6) \u79d2\u6740\u5546\u54c1\u7ed3\u675f<\u5f53\u524d\u65f6\u95f4\u6bb5+2\u5c0f\u65f6\n         *  7) \u6392\u9664\u4e4b\u524d\u5df2\u7ecf\u52a0\u8f7d\u5230Redis\u7f13\u5b58\u4e2d\u7684\u5546\u54c1\u6570\u636e\n         *  8) \u6267\u884c\u67e5\u8be2\u83b7\u53d6\u5bf9\u5e94\u7684\u7ed3\u679c\u96c6\n         * 2.\u5c06\u79d2\u6740\u5546\u54c1\u5b58\u5165\u7f13\u5b58\n         */\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6ce8\u610f"),"\uff1a\u7528\u5230\u5f88\u591a\u5de5\u5177\u7c7b\uff0c\u4e86\u89e3\u529f\u80fd\u5373\u53ef"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * \u6dfb\u52a0\u79d2\u6740\u79d2\u4f24\u5b9a\u65f6\u4efb\u52a1\n */\n@Component\npublic class SeckillGoodsPushTask {\n\n    @Autowired\n    private SeckillGoodsMapper seckillGoodsMapper;\n\n    @Autowired\n    private RedisTemplate redisTemplate;\n\n    //redis key\u5f00\u5934\n    public static final String SECKILL_GOODS_KEY = "seckill_goods_";\n\n    /**\n     * \u5b9a\u65f6\u5c06\u79d2\u6740\u5546\u54c1\u5b58\u5165redis\n     * \u6682\u5b9a\u4e3a30\u79d2\u4e00\u6b21\uff0c\u6b63\u5e38\u4e1a\u52a1\u4e3a\u6bcf\u5929\u51cc\u6668\u89e6\u53d1\n     */\n    @Scheduled(cron = "0/30 * * * * ?")\n    public void loadSecKillGoodsToRedis() {\n        /**\n         * 1.\u67e5\u8be2\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684\u79d2\u6740\u5546\u54c1\n         *  1) \u83b7\u53d6\u65f6\u95f4\u6bb5\u96c6\u5408\u5e76\u5faa\u73af\u904d\u5386\u51fa\u6bcf\u4e00\u4e2a\u65f6\u95f4\u6bb5\n         *  2) \u83b7\u53d6\u6bcf\u4e00\u4e2a\u65f6\u95f4\u6bb5\u540d\u79f0,\u7528\u4e8e\u540e\u7eedredis\u4e2dkey\u7684\u8bbe\u7f6e\n         *  3) \u72b6\u6001\u5fc5\u987b\u4e3a\u5ba1\u6838\u901a\u8fc7 status=1\n         *  4) \u5546\u54c1\u5e93\u5b58\u4e2a\u6570>0\n         *  5) \u79d2\u6740\u5546\u54c1\u5f00\u59cb\u65f6\u95f4>=\u5f53\u524d\u65f6\u95f4\u6bb5\n         *  6) \u79d2\u6740\u5546\u54c1\u7ed3\u675f<\u5f53\u524d\u65f6\u95f4\u6bb5+2\u5c0f\u65f6\n         *  7) \u6392\u9664\u4e4b\u524d\u5df2\u7ecf\u52a0\u8f7d\u5230Redis\u7f13\u5b58\u4e2d\u7684\u5546\u54c1\u6570\u636e\n         *  8) \u6267\u884c\u67e5\u8be2\u83b7\u53d6\u5bf9\u5e94\u7684\u7ed3\u679c\u96c6\n         * 2.\u5c06\u79d2\u6740\u5546\u54c1\u5b58\u5165\u7f13\u5b58\n         */\n\n        //1) \u83b7\u53d6\u65f6\u95f4\u6bb5\u96c6\u5408\u5e76\u5faa\u73af\u904d\u5386\u51fa\u6bcf\u4e00\u4e2a\u65f6\u95f4\u6bb5\n        List<Date> dateMenus = DateUtil.getDateMenus(); // 5\u4e2a\n\n        for (Date dateMenu : dateMenus) {\n            SimpleDateFormat simpleDateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");\n\n            // 2) \u83b7\u53d6\u6bcf\u4e00\u4e2a\u65f6\u95f4\u6bb5\u540d\u79f0,\u7528\u4e8e\u540e\u7eedredis\u4e2dkey\u7684\u8bbe\u7f6e\n            String redisExtName = DateUtil.date2Str(dateMenu);\n\n            Example example = new Example(SeckillGoods.class);\n            Example.Criteria criteria = example.createCriteria();\n            // 3) \u72b6\u6001\u5fc5\u987b\u4e3a\u5ba1\u6838\u901a\u8fc7 status=1\n            criteria.andEqualTo("status", "1");\n            // 4) \u5546\u54c1\u5e93\u5b58\u4e2a\u6570>0 gt\n            criteria.andGreaterThan("stockCount", 0);\n            // 5) \u79d2\u6740\u5546\u54c1\u5f00\u59cb\u65f6\u95f4>=\u5f53\u524d\u65f6\u95f4\u6bb5 gte\n            criteria.andGreaterThanOrEqualTo("startTime", simpleDateFormat.format(dateMenu));\n            // 6) \u79d2\u6740\u5546\u54c1\u7ed3\u675f<\u5f53\u524d\u65f6\u95f4\u6bb5+2\u5c0f\u65f6 lt\n            criteria.andLessThan("endTime", simpleDateFormat.format(DateUtil.addDateHour(dateMenu, 2)));\n\n            // 7) \u6392\u9664\u4e4b\u524d\u5df2\u7ecf\u52a0\u8f7d\u5230Redis\u7f13\u5b58\u4e2d\u7684\u5546\u54c1\u6570\u636e\n            Set keys = redisTemplate.boundHashOps(SECKILL_GOODS_KEY + redisExtName).keys();//key field value\n            if (keys != null && keys.size() > 0) {\n                criteria.andNotIn("id", keys);\n            }\n\n            // 8) \u6267\u884c\u67e5\u8be2\u83b7\u53d6\u5bf9\u5e94\u7684\u7ed3\u679c\u96c6\n            List<SeckillGoods> seckillGoodsList = seckillGoodsMapper.selectByExample(example);\n\n            //2.\u5c06\u79d2\u6740\u5546\u54c1\u5b58\u5165\u7f13\u5b58\n            for (SeckillGoods seckillGoods : seckillGoodsList) {\n                redisTemplate.opsForHash().put(SECKILL_GOODS_KEY + redisExtName, seckillGoods.getId(), seckillGoods);\n            }\n        }\n\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6d4b\u8bd5"),"\uff1a"),(0,l.kt)("p",null,"1\u4fee\u6539\u4e00\u6761\u6570\u636e\uff0c\u6ee1\u8db3\u641c\u7d22\u6761\u4ef6"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228180524421-d1c0979e.png",alt:"image-20211228180524421"}),"image-20211228180524421"),(0,l.kt)("p",null,"2\u7ed3\u679c\u67e5\u770bredis"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228180537463-722f9d9d.png",alt:"image-20211228180537463"}),"image-20211228180537463"),(0,l.kt)("h2",{id:"3-\u79d2\u6740\u5546\u54c1-\u9996\u9875-\u4e86\u89e3"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-%E7%A7%92%E6%9D%80%E5%95%86%E5%93%81-%E9%A6%96%E9%A1%B5-%E4%BA%86%E8%A7%A3"},"#"),"3 \u79d2\u6740\u5546\u54c1-\u9996\u9875-\u4e86\u89e3"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228181401546-345566b4.png",alt:"image-20211228181401546"}),"image-20211228181401546"),(0,l.kt)("p",null,"\u79d2\u6740\u5546\u54c1\u9996\u9875\u4f1a\u663e\u793a\u5904\u4e8e\u79d2\u6740\u4e2d\u4ee5\u53ca\u672a\u5f00\u59cb\u79d2\u6740\u7684\u5546\u54c1\u3002"),(0,l.kt)("h3",{id:"31-\u79d2\u6740\u9996\u9875\u5b9e\u73b0\u5206\u6790"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-1-%E7%A7%92%E6%9D%80%E9%A6%96%E9%A1%B5%E5%AE%9E%E7%8E%B0%E5%88%86%E6%9E%90"},"#"),"3.1 \u79d2\u6740\u9996\u9875\u5b9e\u73b0\u5206\u6790"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227224737382-409ca1b9.png",alt:"image-20211227224737382"}),"image-20211227224737382"),(0,l.kt)("p",null,"\u79d2\u6740\u9996\u9875\u9700\u8981\u663e\u793a\u4e0d\u540c\u65f6\u95f4\u6bb5\u7684\u79d2\u6740\u5546\u54c1\u4fe1\u606f\uff0c\u7136\u540e\u5f53\u7528\u6237\u9009\u62e9\u4e0d\u540c\u7684\u65f6\u95f4\u6bb5\uff0c\u67e5\u8be2\u8be5\u65f6\u95f4\u6bb5\u4e0b\u7684\u79d2\u6740\u5546\u54c1\uff0c\u5b9e\u73b0\u8fc7\u7a0b\u5206\u4e3a\u4e24\u5927\u8fc7\u7a0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"1) \u52a0\u8f7d\u65f6\u95f4\u83dc\u5355\n2\uff09\u52a0\u8f7d\u65f6\u95f4\u83dc\u5355\u4e0b\u79d2\u6740\u5546\u54c1\u4fe1\u606f\n")),(0,l.kt)("h4",{id:"311-\u52a0\u8f7d\u65f6\u95f4\u83dc\u5355\u5206\u6790"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-1-1-%E5%8A%A0%E8%BD%BD%E6%97%B6%E9%97%B4%E8%8F%9C%E5%8D%95%E5%88%86%E6%9E%90"},"#"),"3.1.1 \u52a0\u8f7d\u65f6\u95f4\u83dc\u5355\u5206\u6790"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228181433725-37340631.png",alt:"image-20211228181433725"}),"image-20211228181433725"),(0,l.kt)("p",null,"\u6bcf2\u4e2a\u5c0f\u65f6\u5c31\u4f1a\u5207\u6362\u4e00\u6b21\u62a2\u8d2d\u6d3b\u52a8\uff0c\u6240\u4ee5\u5546\u54c1\u53d1\u5e03\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c06\u65f6\u95f4\u5b9a\u683c\u57282\u5c0f\u65f6\u5185\u62a2\u8d2d\uff0c\u6bcf\u6b21\u53d1\u5e03\u5546\u54c1\u7684\u65f6\u5019\uff0c\u5546\u54c1\u62a2\u8d2d\u5f00\u59cb\u65f6\u95f4\u548c\u7ed3\u675f\u65f6\u95f4\u662f\u8fd92\u5c0f\u65f6\u7684\u8fb9\u754c\u3002"),(0,l.kt)("p",null,"\u6bcf2\u5c0f\u65f6\u4f1a\u6709\u4e00\u6279\u5546\u54c1\u53c2\u4e0e\u62a2\u8d2d\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c0624\u5c0f\u65f6\u5207\u5206\u4e3a12\u4e2a\u83dc\u5355\uff0c\u6bcf\u4e2a\u83dc\u5355\u90fd\u662f\u4e2a2\u5c0f\u65f6\u7684\u65f6\u95f4\u6bb5\uff0c\u5f53\u524d\u9009\u4e2d\u7684\u65f6\u95f4\u83dc\u5355\u9700\u8981\u6839\u636e\u5f53\u524d\u65f6\u95f4\u5224\u65ad\uff0c\u5224\u65ad\u5f53\u524d\u65f6\u95f4\u5c5e\u4e8e\u54ea\u4e2a\u79d2\u6740\u65f6\u95f4\u6bb5\uff0c\u7136\u540e\u5c06\u8be5\u65f6\u95f4\u6bb5\u4f5c\u4e3a\u9009\u4e2d\u7684\u7b2c1\u4e2a\u65f6\u95f4\u83dc\u5355\u3002"),(0,l.kt)("h4",{id:"312-\u52a0\u8f7d\u5bf9\u5e94\u79d2\u6740\u5546\u54c1\u5206\u6790"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-1-2-%E5%8A%A0%E8%BD%BD%E5%AF%B9%E5%BA%94%E7%A7%92%E6%9D%80%E5%95%86%E5%93%81%E5%88%86%E6%9E%90"},"#"),"3.1.2 \u52a0\u8f7d\u5bf9\u5e94\u79d2\u6740\u5546\u54c1\u5206\u6790"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228181441279-fab14fd1.png",alt:"image-20211228181441279"}),"image-20211228181441279"),(0,l.kt)("p",null,"\u8fdb\u5165\u9996\u9875\u65f6\uff0c\u5230\u540e\u53f0\u67e5\u8be2\u65f6\u95f4\u83dc\u5355\u4fe1\u606f\uff0c\u7136\u540e\u5c06\u7b2c1\u4e2a\u83dc\u5355\u7684\u65f6\u95f4\u6bb5\u4f5c\u4e3akey\uff0c\u5728Redis\u4e2d\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u96c6\u5408\uff0c\u5e76\u663e\u793a\u5230\u9875\u9762\uff0c\u9875\u9762\u6bcf\u6b21\u70b9\u51fb\u5207\u6362\u4e0d\u540c\u65f6\u95f4\u6bb5\u83dc\u5355\u7684\u65f6\u5019\uff0c\u90fd\u5c06\u65f6\u95f4\u6bb5\u4f20\u5165\u5230\u540e\u53f0\uff0c\u540e\u53f0\u6839\u636e\u65f6\u95f4\u6bb5\u83b7\u53d6\u5bf9\u5e94\u7684\u79d2\u6740\u5546\u54c1\u96c6\u5408\u3002"),(0,l.kt)("h3",{id:"32-\u79d2\u6740\u6e32\u67d3\u670d\u52a1---\u6e32\u67d3\u79d2\u6740\u9996\u9875"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-2-%E7%A7%92%E6%9D%80%E6%B8%B2%E6%9F%93%E6%9C%8D%E5%8A%A1-%E6%B8%B2%E6%9F%93%E7%A7%92%E6%9D%80%E9%A6%96%E9%A1%B5"},"#"),"3.2 \u79d2\u6740\u6e32\u67d3\u670d\u52a1 - \u6e32\u67d3\u79d2\u6740\u9996\u9875"),(0,l.kt)("h4",{id:"321-\u65b0\u5efa\u79d2\u6740\u6e32\u67d3\u670d\u52a1"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-2-1-%E6%96%B0%E5%BB%BA%E7%A7%92%E6%9D%80%E6%B8%B2%E6%9F%93%E6%9C%8D%E5%8A%A1"},"#"),"3.2.1 \u65b0\u5efa\u79d2\u6740\u6e32\u67d3\u670d\u52a1"),(0,l.kt)("p",null,"1\uff09\u521b\u5efa\u5de5\u7a0bydles_web_seckill,\u7528\u4e8e\u79d2\u6740\u9875\u9762\u6e32\u67d3"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6dfb\u52a0\u4f9d\u8d56")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependencies>\n    <dependency>\n        <groupId>com.ydles</groupId>\n        <artifactId>ydles_service_seckill_api</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-thymeleaf</artifactId>\n    </dependency>\n</dependencies>\n")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6dfb\u52a0\u542f\u52a8\u7c7b ",(0,l.kt)("a",{parentName:"li",href:"http://com.ydles.seckill.web/"},"com.ydles.seckill.webopen in new window"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@SpringBootApplication\n@EnableDiscoveryClient\n@EnableFeignClients(basePackages = "com.ydles.seckill.feign")\npublic class WebSecKillApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(WebSecKillApplication.class,args);\n    }\n\n    @Bean\n    public FeignInterceptor feignInterceptor(){\n        return new FeignInterceptor();\n    }\n\n    /**\n     * \u8bbe\u7f6e redisTemplate \u7684\u5e8f\u5217\u5316\u8bbe\u7f6e\n     * @param redisConnectionFactory\n     * @return\n     */\n    @Bean\n    public RedisTemplate<Object, Object> redisTemplate(RedisConnectionFactory redisConnectionFactory) {\n        // 1.\u521b\u5efa redisTemplate \u6a21\u7248\n        RedisTemplate<Object, Object> template = new RedisTemplate<>();\n        // 2.\u5173\u8054 redisConnectionFactory\n        template.setConnectionFactory(redisConnectionFactory);\n        // 3.\u521b\u5efa \u5e8f\u5217\u5316\u7c7b\n        GenericToStringSerializer genericToStringSerializer = new GenericToStringSerializer(Object.class);\n        // 6.\u5e8f\u5217\u5316\u7c7b\uff0c\u5bf9\u8c61\u6620\u5c04\u8bbe\u7f6e\n        // 7.\u8bbe\u7f6e value \u7684\u8f6c\u5316\u683c\u5f0f\u548c key \u7684\u8f6c\u5316\u683c\u5f0f\n        template.setValueSerializer(genericToStringSerializer);\n        template.setKeySerializer(new StringRedisSerializer());\n        template.afterPropertiesSet();\n        return template;\n    }\n}\n')),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6dfb\u52a0application.yml")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"server:\n  port: 9104\neureka:\n  client:\n    service-url:\n      defaultZone: http://127.0.0.1:6868/eureka\n  instance:\n    prefer-ip-address: true\nfeign:\n  hystrix:\n    enabled: true\nspring:\n  jackson:\n    time-zone: GMT+8\n  thymeleaf:\n    cache: false\n  application:\n    name: seckill-web\n  main:\n    allow-bean-definition-overriding: true\n  redis:\n    host: 192.168.200.128\n#hystrix \u914d\u7f6e\nhystrix:\n  command:\n    default:\n      execution:\n        timeout:\n          #\u5982\u679cenabled\u8bbe\u7f6e\u4e3afalse\uff0c\u5219\u8bf7\u6c42\u8d85\u65f6\u4ea4\u7ed9ribbon\u63a7\u5236\n          enabled: true\n        isolation:\n          strategy: SEMAPHORE\n          thread:\n            timeoutInMilliseconds: 60000\n#\u8bf7\u6c42\u5904\u7406\u7684\u8d85\u65f6\u65f6\u95f4\nribbon:\n  ReadTimeout: 4000\n  #\u8bf7\u6c42\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\n  ConnectTimeout: 3000\n")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6dfb\u52a0\u9759\u6001\u5316\u8d44\u6e90")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228181821971-e398a676.png",alt:"image-20211228181821971"}),"image-20211228181821971"),(0,l.kt)("p",null,"6\uff09\u5bf9\u63a5\u7f51\u5173"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"        #\u79d2\u6740\u6e32\u67d3\u5fae\u670d\u52a1\n        - id: ydles_seckill_web_route\n          uri: lb://seckill-web\n          predicates:\n            - Path=/api/wseckillgoods/**\n          filters:\n            - StripPrefix=1\n")),(0,l.kt)("h3",{id:"33-\u65f6\u95f4\u83dc\u5355\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-%E6%97%B6%E9%97%B4%E8%8F%9C%E5%8D%95%E5%AE%9E%E7%8E%B0"},"#"),"3.3 \u65f6\u95f4\u83dc\u5355\u5b9e\u73b0"),(0,l.kt)("p",null,"\u65f6\u95f4\u83dc\u5355\u663e\u793a\uff0c\u5148\u8fd0\u7b97\u51fa\u6bcf2\u5c0f\u65f6\u4e00\u4e2a\u62a2\u8d2d\uff0c\u5c31\u9700\u8981\u5b9e\u73b012\u4e2a\u83dc\u5355\uff0c\u53ef\u4ee5\u5148\u8ba1\u7b97\u51fa\u6bcf\u4e2a\u65f6\u95f4\u7684\u4e34\u754c\u503c\uff0c\u7136\u540e\u6839\u636e\u5f53\u524d\u65f6\u95f4\u5224\u65ad\u9700\u8981\u663e\u793a12\u4e2a\u65f6\u95f4\u6bb5\u83dc\u5355\u4e2d\u7684\u54ea\u4e2a\u83dc\u5355\uff0c\u518d\u5728\u8be5\u65f6\u95f4\u83dc\u5355\u7684\u57fa\u7840\u4e4b\u4e0a\u5f80\u540e\u632a4\u4e2a\u83dc\u5355\uff0c\u4e00\u76f4\u663e\u793a5\u4e2a\u65f6\u95f4\u83dc\u5355\u3002"),(0,l.kt)("h4",{id:"331-\u65f6\u95f4\u83dc\u5355\u83b7\u53d6"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-1-%E6%97%B6%E9%97%B4%E8%8F%9C%E5%8D%95%E8%8E%B7%E5%8F%96"},"#"),"3.3.1 \u65f6\u95f4\u83dc\u5355\u83b7\u53d6"),(0,l.kt)("p",null,"ydles_web_seckill com.ydles.seckill.web.controller \u65b0\u589e\u63a7\u5236\u7c7bSecKillGoodsController"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Controller\n@RequestMapping("/wseckillgoods")\npublic class SecKillGoodsController {\n\n    @Autowired\n    private SecKillGoodsFeign secKillGoodsFeign;\n\n    //\u8df3\u8f6c\u79d2\u6740\u9996\u9875\n    @RequestMapping("/toIndex")\n    public String toIndex(){\n        return "seckill-index";\n    }\n\n    //\u83b7\u53d6\u79d2\u6740\u65f6\u95f4\u6bb5\u96c6\u5408\u4fe1\u606f\n    @RequestMapping("/timeMenus")\n    @ResponseBody\n    public List<String> dateMenus(){\n\n        //\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u6bb5\u76f8\u5173\u7684\u4fe1\u606f\u96c6\u5408\n        List<Date> dateMenus = DateUtil.getDateMenus(); //5\u4e2a\n        //\u8fd4\u56de\u503c\n        List<String> result = new ArrayList<>();\n\n        SimpleDateFormat simpleDateFormat  = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");\n        //\u683c\u5f0f\u5316\u65f6\u95f4\u6bb5\n        for (Date dateMenu : dateMenus) {\n            String format = simpleDateFormat.format(dateMenu);\n            result.add(format);\n        }\n\n        return  result;\n\n    }\n\n}\n')),(0,l.kt)("h4",{id:"332-\u9875\u9762\u52a0\u8f7d\u65f6\u95f4\u83dc\u5355"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-2-%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E6%97%B6%E9%97%B4%E8%8F%9C%E5%8D%95"},"#"),"3.3.2 \u9875\u9762\u52a0\u8f7d\u65f6\u95f4\u83dc\u5355"),(0,l.kt)("p",null,"\u4fee\u6539seckill-index.html"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228183316377-9385b4e4.png",alt:"image-20211228183316377"}),"image-20211228183316377"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"var app = new Vue({\n    el: '#app',\n    data() {\n        return {\n            goodslist: [],\n            dateMenus:[]\n        }\n    },\n    methods:{\n        loadMenus:function () {\n            axios.get(\"/api/wseckillgoods/timeMenus\").then(function (response) {\n                app.dateMenus=response.data;\n\n                //\u67e5\u8be2\u5f53\u524d\u65f6\u95f4\u6bb5\u5bf9\u5e94\u7684\u79d2\u6740\u5546\u54c1\n            })\n        }\n    },\n    created:function () {\n        this.loadMenus();\n    }\n})\n")),(0,l.kt)("p",null,"1\u67e5\u770b\u4ee5\u4e0b\u4ee3\u7801"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div class="item-time active"\n     v-for="(item,index) in dateMenus">\n    <div class="time-clock">{{item}}</div>\n    <div class="time-state-on">\n        <span class="on-text" v-if="index==0">\u5feb\u62a2\u4e2d</span>\n        <span class="on-over" v-if="index==0">\u8ddd\u79bb\u7ed3\u675f\uff1a01:02:03</span>\n\n        <span class="on-text" v-if="index>0">\u5373\u5c06\u5f00\u59cb</span>\n        <span class="on-over" v-if="index>0">\u8ddd\u79bb\u5f00\u59cb\uff1a03:02:01</span>\n    </div>\n</div>\n')),(0,l.kt)("p",null,"2\u901a\u8fc7\u7f51\u5173\u8bbf\u95ee\uff0c\u9700\u8981\u5c06 moment.min.js \u653e\u5165\u7f51\u5173\u7684\u9759\u6001\u8d44\u6e90\u4e2d"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228183457892-72e70fbf.png",alt:"image-20211228183457892"}),"image-20211228183457892"),(0,l.kt)("p",null,"3\u542f\u52a8web-seckill \u91cd\u542f,\u8bbf\u95ee ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wseckillgoods/toIndex"},"http://localhost:8001/api/wseckillgoods/toIndexopen in new window")),(0,l.kt)("p",null,"\u6548\u679c\u5982\u4e0b\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228184523710-39f0d525.png",alt:"image-20211228184523710"}),"image-20211228184523710"),(0,l.kt)("h4",{id:"333-\u65f6\u95f4\u683c\u5f0f\u5316"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-3-%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E5%8C%96"},"#"),"3.3.3 \u65f6\u95f4\u683c\u5f0f\u5316"),(0,l.kt)("p",null,"\u4e0a\u9762\u83dc\u5355\u5faa\u73af\u8f93\u51fa\u540e\uff0c\u4f1a\u51fa\u73b0\u5982\u4e0a\u56fe\u6548\u679c\uff0c\u65f6\u95f4\u683c\u5f0f\u5168\u90e8\u4e0d\u5bf9\uff0c\u6211\u4eec\u9700\u8981\u5f15\u5165\u4e00\u4e2amoment.min.js\u6765\u683c\u5f0f\u5316\u65f6\u95f4\u3002"),(0,l.kt)("p",null,"1\uff09\u5f15\u5165moment.min.js"),(0,l.kt)("p",null,"2\uff09\u6dfb\u52a0\u8fc7\u6ee4\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'//\u8fc7\u6ee4\u5668\nVue.filter("dateFilter", function(date, formatPattern){\n    return moment(date).format(formatPattern || "YYYY-MM-DD HH:mm:ss");\n});\n')),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u53d6\u503c\u683c\u5f0f\u5316")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<div class=\"time-clock\">{{item | dateFilter('HH:mm')}}</div>\n")),(0,l.kt)("p",null,"\u91cd\u542fwebseckill,\u91cd\u65b0\u8bbf\u95ee\uff1a",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wseckillgoods/toIndex"},"http://localhost:8001/api/wseckillgoods/toIndexopen in new window")," \u3002\u65f6\u95f4\u83dc\u5355\u6548\u679c\u5982\u4e0b"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228220700312-51c6c1f3.png",alt:"image-20211228220700312"}),"image-20211228220700312"),(0,l.kt)("h4",{id:"334-\u9009\u4e2d\u5b9e\u73b0--\u4e86\u89e3"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-4-%E9%80%89%E4%B8%AD%E5%AE%9E%E7%8E%B0-%E4%BA%86%E8%A7%A3"},"#"),"3.3.4 \u9009\u4e2d\u5b9e\u73b0 -\u4e86\u89e3"),(0,l.kt)("h5",{id:"3341-\u601d\u8def\u5206\u6790"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-4-1-%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90"},"#"),"3.3.4.1 \u601d\u8def\u5206\u6790"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211227225123244-a6b4bd7b.png",alt:"image-20211227225123244"}),"image-20211227225123244"),(0,l.kt)("p",null,"\u6839\u636e\u539f\u578b\u56fe\uff0c\u662f\u8ba9\u5f53\u524d\u7b2c\u4e00\u4e2a\u65f6\u95f4\u83dc\u5355\u4e3a\u9009\u4e2d\u72b6\u6001\uff0c\u5e76\u4e14\u52a0\u8f7d\u7b2c\u4e00\u4e2a\u83dc\u5355\u5bf9\u5e94\u7684\u6570\u636e\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u5148\u5b9a\u4e49\u4e00\u4e2actime=0\uff0c\u7528\u6765\u8bb0\u5f55\u5f53\u524d\u9009\u4e2d\u7684\u83dc\u5355\u4e0b\u6807\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u7b2c\u4e00\u4e2a\u9009\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u4e0b\u6807\u4e3a0\uff0c\u6240\u4ee5\u521d\u59cb\u503c\u4e3a0\uff0c\u6bcf\u6b21\u70b9\u51fb\u5bf9\u5e94\u83dc\u5355\u7684\u65f6\u5019\uff0c\u5c06\u88ab\u70b9\u51fb\u7684\u83dc\u5355\u7684\u4e0b\u6807\u503c\u8d4b\u503c\u7ed9ctime,\u7136\u540e\u5728\u6bcf\u4e2a\u83dc\u5355\u4e0a\u5224\u65ad\uff0c\u4e0b\u6807=ctime\u5219\u8ba9\u8be5\u83dc\u5355\u9009\u4e2d\u3002"),(0,l.kt)("h5",{id:"3342-\u4ee3\u7801\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-4-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"},"#"),"3.3.4.2 \u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("p",null,"1\uff09\u5b9a\u4e49ctime=0"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"var app = new Vue({\n    el: '#app',\n    data() {\n        return {\n            goodslist: [],\n            dateMenus:[],\n            ctime:0     //\u5f53\u524d\u65f6\u95f4\u83dc\u5355\u9009\u4e2d\u7684\u4e0b\u6807\n        }\n    }\n})\n")),(0,l.kt)("p",null,"2\uff09\u9875\u9762\u6837\u5f0f\u63a7\u5236\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div class="item-time " v-for="(item,index) in dateMenus" :class="[\'item-time\',index==ctime?\'active\':\'\']" @click="ctime=index;">\n    <div class="time-clock">{{item | dateFilter(\'HH:mm\')}}</div>\n    <div class="time-state-on">\n        <span class="on-text" v-if="index==0">\u5feb\u62a2\u4e2d</span>\n        <span class="on-over" v-if="index==0">\u8ddd\u79bb\u7ed3\u675f\uff1a01:02:34</span>\n\n        <span class="on-text" v-if="index>0">\u5373\u5c06\u5f00\u59cb</span>\n        <span class="on-over" v-if="index>0">\u8ddd\u79bb\u5f00\u59cb\uff1a01:02:34</span>\n    </div>\n</div>\n')),(0,l.kt)("p",null,"\u91cd\u542fwebseckill,\u91cd\u65b0\u8bbf\u95ee\uff1a",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wseckillgoods/toIndex"},"http://localhost:8001/api/wseckillgoods/toIndexopen in new window")," \u3002\u65f6\u95f4\u83dc\u5355\u6548\u679c\u5982\u4e0b"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228221742713-c804fc90.png",alt:"image-20211228221742713"}),"image-20211228221742713"),(0,l.kt)("h4",{id:"335-\u5012\u8ba1\u65f6\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-5-%E5%80%92%E8%AE%A1%E6%97%B6%E5%AE%9E%E7%8E%B0"},"#"),"3.3.5 \u5012\u8ba1\u65f6\u5b9e\u73b0"),(0,l.kt)("h5",{id:"3351-\u5012\u8ba1\u65f6\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-5-1-%E5%80%92%E8%AE%A1%E6%97%B6%E5%AE%9E%E7%8E%B0"},"#"),"3.3.5.1 \u5012\u8ba1\u65f6\u5b9e\u73b0"),(0,l.kt)("h6",{id:"33511-\u57fa\u7840\u6570\u636e\u663e\u793a"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-5-1-1-%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E6%98%BE%E7%A4%BA"},"#"),"3.3.5.1.1 \u57fa\u7840\u6570\u636e\u663e\u793a"),(0,l.kt)("p",null,"\u5b9a\u4e49\u4e00\u4e2a\u96c6\u5408\uff0c\u7528\u4e8e\u5b58\u653e\u4e94\u4e2a\u65f6\u95f4\u6bb5\u7684\u5012\u8ba1\u65f6\u65f6\u95f4\u5dee\uff0c\u96c6\u5408\u4e2d\u6bcf\u4e00\u4e2a\u89d2\u6807\u90fd\u5bf9\u5e94\u4e00\u4e2a\u5012\u8ba1\u65f6\u65f6\u95f4\u5dee\uff0c\u6bd4\u5982\uff1a\u96c6\u5408\u89d2\u6807\u4e3a0\uff0c\u5bf9\u5e94\u7b2c\u4e00\u4e2a\u5012\u8ba1\u65f6\u65f6\u95f4\u5dee\u3002\u96c6\u5408\u89d2\u6807\u4e3a1\uff0c\u5bf9\u5e94\u7b2c\u4e8c\u4e2a\u5012\u8ba1\u65f6\u65f6\u95f4\u5dee\uff0c\u4f9d\u6b21\u7c7b\u63a8\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228233511074-5642d26d.png",alt:"image-20211228233511074"}),"image-20211228233511074"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"alltimes:[5555555,66666666,77777777,888888888,9999999999]\n")),(0,l.kt)("p",null,"2\u4ece\u8be5\u96c6\u5408\u4e2d\u83b7\u53d6\u5185\u5bb9\uff0c\u5e76\u66f4\u65b0\u5012\u8ba1\u65f6\u65f6\u95f4"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228233617374-a6178690.png",alt:"image-20211228233617374"}),"image-20211228233617374"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'<span class="on-over" v-if="index==0">\u8ddd\u79bb\u7ed3\u675f\uff1a{{alltimes[index]}}</span>\n<span class="on-over" v-if="index>0">\u8ddd\u79bb\u5f00\u59cb\uff1a{{alltimes[index]}}</span>\n')),(0,l.kt)("p",null,"\u91cd\u542fwebseckill,\u91cd\u65b0\u8bbf\u95ee\uff1a",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wseckillgoods/toIndex"},"http://localhost:8001/api/wseckillgoods/toIndexopen in new window")," \u3002\u65f6\u95f4\u83dc\u5355\u6548\u679c\u5982\u4e0b"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228222758434-8465bb69.png",alt:"image-20211228222758434"}),"image-20211228222758434"),(0,l.kt)("h6",{id:"33512-\u6bcf\u4e2a\u65f6\u95f4\u5dee\u5012\u8ba1\u65f6\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-5-1-2-%E6%AF%8F%E4%B8%AA%E6%97%B6%E9%97%B4%E5%B7%AE%E5%80%92%E8%AE%A1%E6%97%B6%E5%AE%9E%E7%8E%B0"},"#"),"3.3.5.1.2 \u6bcf\u4e2a\u65f6\u95f4\u5dee\u5012\u8ba1\u65f6\u5b9e\u73b0"),(0,l.kt)("p",null,"\u5468\u671f\u6267\u884c\u51fd\u6570\u7528\u6cd5\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"window.setInterval(function(){//\u8981\u505a\u7684\u4e8b},1000);\n")),(0,l.kt)("p",null,"\u7ed3\u675f\u6267\u884c\u5468\u671f\u51fd\u6570\u7528\u6cd5\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"window.clearInterval(timers);\n")),(0,l.kt)("p",null,"\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228233649926-2b77aac3.png",alt:"image-20211228233649926"}),"image-20211228233649926"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"//\u65f6\u95f4\u5dee\u9012\u51cf\nlet timers = window.setInterval(function () {\n    for(var i=0;i<app.alltimes.length;i++){\n        //\u65f6\u95f4\u9012\u51cf\n        app.$set(app.alltimes,i,app.alltimes[i]-1000);\n        if(app.alltimes[i]<=0){\n            //\u505c\u6b62\u5012\u8ba1\u65f6\n            window.clearInterval(timers);\n            //\u5f53\u4efb\u610f\u4e00\u4e2a\u65f6\u95f4<=0\u7684\u65f6\u5019\uff0c\u9700\u8981\u91cd\u65b0\u5237\u65b0\u83dc\u5355\uff0c\u5e76\u5237\u65b0\u5bf9\u5e94\u7684\u6570\u636e\n            app.loadMenus();\n        }\n    }\n},1000);\n")),(0,l.kt)("p",null,"\u91cd\u542fwebseckill,\u91cd\u65b0\u8bbf\u95ee\uff1a",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wseckillgoods/toIndex"},"http://localhost:8001/api/wseckillgoods/toIndexopen in new window")," \u3002\u65f6\u95f4\u83dc\u5355\u6548\u679c\u5982\u4e0b\u53ef\u4ee5\u53d1\u73b0\u6bcf\u4e00\u4e2a\u65f6\u95f4\u6bb5\u7684\u65f6\u95f4\u90fd\u5728\u6bcf\u79d2\u9012\u51cf\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228223420084-224a7a1f.png",alt:"image-20211228223420084"}),"image-20211228223420084"),(0,l.kt)("h6",{id:"33513-\u5012\u8ba1\u65f6\u65f6\u95f4\u683c\u5f0f\u5316"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-5-1-3-%E5%80%92%E8%AE%A1%E6%97%B6%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E5%8C%96"},"#"),"3.3.5.1.3 \u5012\u8ba1\u65f6\u65f6\u95f4\u683c\u5f0f\u5316"),(0,l.kt)("p",null,"\u5c06\u6b64\u5de5\u5177\u5f15\u5165\u9875\u9762js\u65b9\u6cd5\u4e2d\uff0c\u7528\u4e8e\u65f6\u95f4\u8ba1\u7b97\u3002\u6ce8\u610f\u548cloadMenus\u65b9\u6cd5\u5e73\u884c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"//\u5c06\u6beb\u79d2\u8f6c\u6362\u6210\u65f6\u5206\u79d2\ntimedown:function(num) {\n    var oneSecond = 1000;\n    var oneMinute=oneSecond*60;\n    var oneHour=oneMinute*60\n    //\u5c0f\u65f6\n    var hours =Math.floor(num/oneHour);\n    //\u5206\u949f\n    var minutes=Math.floor((num%oneHour)/oneMinute);\n    //\u79d2\n    var seconds=Math.floor((num%oneMinute)/oneSecond);\n    //\u62fc\u63a5\u65f6\u95f4\u683c\u5f0f\n    var str = hours+':'+minutes+':'+seconds;\n    return str;\n}\n")),(0,l.kt)("p",null,"\u4fee\u6539\u65f6\u95f4\u5dee\u663e\u793a\u8bbe\u7f6e"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228233710801-d1626944.png",alt:"image-20211228233710801"}),"image-20211228233710801"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},'<div class="time-state-on">\n    <span class="on-text" v-if="index==0">\u5feb\u62a2\u4e2d</span>\n    <span class="on-over" v-if="index==0">\u8ddd\u79bb\u7ed3\u675f\uff1a{{timedown(alltimes[index])}}</span>\n\n    <span class="on-text" v-if="index>0">\u5373\u5c06\u5f00\u59cb</span>\n    <span class="on-over" v-if="index>0">\u8ddd\u79bb\u5f00\u59cb\uff1a{{timedown(alltimes[index])}}</span>\n</div>\n')),(0,l.kt)("p",null,"\u91cd\u65b0\u8bbf\u95ee\u8fdb\u884c\u6d4b\u8bd5\u3002\u6548\u679c\u5982\u4e0b\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228223724484-7663f5b3.png",alt:"image-20211228223724484"}),"image-20211228223724484"),(0,l.kt)("h6",{id:"33514-\u6b63\u786e\u5012\u8ba1\u65f6\u65f6\u95f4\u663e\u793a"},(0,l.kt)("a",{parentName:"h6",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-3-5-1-4-%E6%AD%A3%E7%A1%AE%E5%80%92%E8%AE%A1%E6%97%B6%E6%97%B6%E9%97%B4%E6%98%BE%E7%A4%BA"},"#"),"3.3.5.1.4 \u6b63\u786e\u5012\u8ba1\u65f6\u65f6\u95f4\u663e\u793a"),(0,l.kt)("p",null,"\u73b0\u5728\u9875\u9762\u4e2d\uff0c\u5bf9\u4e8e\u5012\u8ba1\u65f6\u65f6\u95f4\u96c6\u5408\u5185\u7684\u6570\u636e\uff0c\u6682\u65f6\u5199\u7684\u4e3a\u5047\u6570\u636e\uff0c\u73b0\u5728\u9700\u8981\u8ba9\u96c6\u5408\u5185\u5bb9\u7684\u6570\u636e\u662f\u7ecf\u8fc7\u8ba1\u7b97\u5f97\u51fa\u7684\u3002\u7b2c\u4e00\u4e2a\u662f\u8ddd\u79bb\u7ed3\u675f\u65f6\u95f4\u5012\u8ba1\u65f6\uff0c\u540e\u9762\u76844\u4e2a\u90fd\u662f\u8ddd\u79bb\u5f00\u59cb\u5012\u8ba1\u65f6\uff0c\u6bcf\u4e2a\u5012\u8ba1\u65f6\u5176\u5b9e\u5c31\u662f2\u4e2a\u65f6\u5dee\uff0c\u8ba1\u7b97\u65b9\u5f0f\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"\u7b2c1\u4e2a\u65f6\u5dee\uff1a\u7b2c2\u4e2a\u62a2\u8d2d\u5f00\u59cb\u65f6\u95f4-\u5f53\u524d\u65f6\u95f4\uff0c\u8ddd\u79bb\u7ed3\u675f\u65f6\u95f4\n\u7b2c2\u4e2a\u65f6\u5dee\uff1a\u7b2c2\u4e2a\u62a2\u8d2d\u5f00\u59cb\u65f6\u95f4-\u5f53\u524d\u65f6\u95f4\uff0c\u8ddd\u79bb\u5f00\u59cb\u65f6\u95f4\n\u7b2c3\u4e2a\u65f6\u5dee\uff1a\u7b2c3\u4e2a\u62a2\u8d2d\u5f00\u59cb\u65f6\u95f4-\u5f53\u524d\u65f6\u95f4\uff0c\u8ddd\u79bb\u5f00\u59cb\u65f6\u95f4\n\u7b2c4\u4e2a\u65f6\u5dee\uff1a\u7b2c4\u4e2a\u62a2\u8d2d\u5f00\u59cb\u65f6\u95f4-\u5f53\u524d\u65f6\u95f4\uff0c\u8ddd\u79bb\u5f00\u59cb\u65f6\u95f4\n\u7b2c5\u4e2a\u65f6\u5dee\uff1a\u7b2c5\u4e2a\u62a2\u8d2d\u5f00\u59cb\u65f6\u95f4-\u5f53\u524d\u65f6\u95f4\uff0c\u8ddd\u79bb\u5f00\u59cb\u65f6\u95f4\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228233749415-e772a6da.png",alt:"image-20211228233749415"}),"image-20211228233749415"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'loadMenus:function () {\n    axios.get("/wseckill/timeMenus").then(function (response) {\n        app.dateMenus=response.data;\n\n        //\u67e5\u8be2\u5f53\u524d\u65f6\u95f4\u6bb5\u5bf9\u5e94\u7684\u79d2\u6740\u5546\u54c1\n\n353-362 //\u5faa\u73af\u6240\u6709\u65f6\u95f4\u83dc\u5355\n        for(var i=0;i<app.dateMenus.length;i++){\n            //\u8fd0\u7b97\u6bcf\u4e2a\u65f6\u95f4\u83dc\u5355\u5012\u8ba1\u65f6\u65f6\u95f4\u5dee\n            if (i==0){\n                //\u8ddd\u79bb\u7ed3\u675f\u65f6\u95f4\n                var x =i+1;\n                app.$set(app.alltimes,i,new Date(app.dateMenus[x]).getTime()-new Date().getTime());\n            } else{\n                //\u8ddd\u79bb\u5f00\u59cb\u65f6\u95f4\n                app.$set(app.alltimes,i,new Date(app.dateMenus[i]).getTime()-new Date().getTime());\n            }\n        }\n\n        //\u65f6\u95f4\u5dee\u9012\u51cf\n        let timers = window.setInterval(function () {\n            for(var i=0;i<app.alltimes.length;i++){\n                //\u65f6\u95f4\u9012\u51cf\n                app.$set(app.alltimes,i,app.alltimes[i]-1000);\n            }\n        },1000);\n    })\n}\n')),(0,l.kt)("p",null,"\u6e05\u7a7aalltimes\u6570\u636e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"alltimes:[]\n")),(0,l.kt)("p",null,"\u91cd\u542fwebseckill,\u91cd\u65b0\u8bbf\u95ee\uff1a",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wseckillgoods/toIndex"},"http://localhost:8001/api/wseckillgoods/toIndexopen in new window")," \u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228224140244-15daa036.png",alt:"image-20211228224140244"}),"image-20211228224140244"),(0,l.kt)("h3",{id:"34-\u52a0\u8f7d\u79d2\u6740\u5546\u54c1\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-%E5%8A%A0%E8%BD%BD%E7%A7%92%E6%9D%80%E5%95%86%E5%93%81%E5%AE%9E%E7%8E%B0"},"#"),"3.4 \u52a0\u8f7d\u79d2\u6740\u5546\u54c1\u5b9e\u73b0"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228224817607-0818abad.png",alt:"image-20211228224817607"}),"image-20211228224817607"),(0,l.kt)("p",null,"\u5f53\u524d\u5df2\u7ecf\u5b8c\u6210\u4e86\u79d2\u6740\u65f6\u95f4\u6bb5\u83dc\u5355\u7684\u663e\u793a\uff0c\u90a3\u4e48\u5f53\u7528\u6237\u5728\u5207\u6362\u4e0d\u540c\u7684\u65f6\u95f4\u6bb5\u7684\u65f6\u5019\uff0c\u9700\u8981\u6309\u7167\u7528\u6237\u6240\u9009\u62e9\u7684\u65f6\u95f4\u53bb\u663e\u793a\u76f8\u5bf9\u5e94\u65f6\u95f4\u6bb5\u4e0b\u7684\u79d2\u6740\u5546\u54c1\u3002"),(0,l.kt)("h4",{id:"341-\u79d2\u6740\u670d\u52a1-\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-1-%E7%A7%92%E6%9D%80%E6%9C%8D%E5%8A%A1-%E6%9F%A5%E8%AF%A2%E7%A7%92%E6%9D%80%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"},"#"),"3.4.1 \u79d2\u6740\u670d\u52a1-\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228224907652-9b80f640.png",alt:"image-20211228224907652"}),"image-20211228224907652"),(0,l.kt)("h5",{id:"3411-\u79d2\u6740\u670d\u52a1--service"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-1-1-%E7%A7%92%E6%9D%80%E6%9C%8D%E5%8A%A1-service"},"#"),"3.4.1.1 \u79d2\u6740\u670d\u52a1- service"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public interface SecKillGoodsService {\n     //\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868\n    List<SeckillGoods> list(String time);\n}\n")),(0,l.kt)("p",null,"\u5b9e\u73b0\u7c7b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Service\npublic class SecKillGoodsServiceImpl implements SecKillGoodsService {\n\n    @Autowired\n    private RedisTemplate redisTemplate;\n\n    private static final String SECKILL_KEY = "seckill_goods_";\n\n    /**\n     * \u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868\n     * @param time\n     * @return\n     */\n    @Override\n    public List<SeckillGoods> list(String time) {\n        return redisTemplate.boundHashOps(SECKILL_KEY+time).values();\n    }\n}\n')),(0,l.kt)("h5",{id:"3412-\u79d2\u6740\u670d\u52a1-controller"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-1-2-%E7%A7%92%E6%9D%80%E6%9C%8D%E5%8A%A1-controller"},"#"),"3.4.1.2 \u79d2\u6740\u670d\u52a1-controller"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\n@RequestMapping("/seckillgoods")\npublic class SecKillController {\n\n    @Autowired\n    private SecKillGoodsService secKillGoodsService;\n\n    /**\n     * \u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868\n     * @param time\n     * @return\n     */\n    @RequestMapping("/list")\n    public Result<List<SeckillGoods>> list(@RequestParam("time") String time){\n        List<SeckillGoods> seckillGoodsList  = secKillGoodsService.list(time);\n        return new Result<List<SeckillGoods>>(true, StatusCode.OK,"\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u6210\u529f",seckillGoodsList);\n    }\n}\n')),(0,l.kt)("h5",{id:"3413-\u6740\u670d\u52a1api--feign\u63a5\u53e3\u5b9a\u4e49"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-1-3-%E6%9D%80%E6%9C%8D%E5%8A%A1api-feign%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"},"#"),"3.4.1.3 \u6740\u670d\u52a1Api- feign\u63a5\u53e3\u5b9a\u4e49"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@FeignClient(name="seckill")\npublic interface SecKillFeign {\n\n    /**\n     * \u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868\n     * @param time\n     * @return\n     */\n    @RequestMapping("/seckillgoods/list")\n    public Result<List<SeckillGoods>> list(@RequestParam("time") String time);\n}\n')),(0,l.kt)("h5",{id:"3414-\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u653e\u884c-\u60f3\u60f3\u4e3a\u4ec0\u4e48"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-1-4-%E6%9F%A5%E8%AF%A2%E7%A7%92%E6%9D%80%E5%95%86%E5%93%81%E6%94%BE%E8%A1%8C-%E6%83%B3%E6%83%B3%E4%B8%BA%E4%BB%80%E4%B9%88"},"#"),"3.4.1.4 \u67e5\u8be2\u79d2\u6740\u5546\u54c1\u653e\u884c-\u60f3\u60f3\u4e3a\u4ec0\u4e48"),(0,l.kt)("p",null,"\u66f4\u6539\u79d2\u6740\u5fae\u670d\u52a1\u7684ResourceServerConfig\u7c7b\uff0c\u5bf9\u67e5\u8be2\u65b9\u6cd5\u653e\u884c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Override\npublic void configure(HttpSecurity http) throws Exception {\n    //\u6240\u6709\u8bf7\u6c42\u5fc5\u987b\u8ba4\u8bc1\u901a\u8fc7\n    http.authorizeRequests()\n        //\u4e0b\u8fb9\u7684\u8def\u5f84\u653e\u884c\n        .antMatchers(\n        "/seckillgoods/list/**"). //\u914d\u7f6e\u5730\u5740\u653e\u884c\n        permitAll()\n        .anyRequest().\n        authenticated();    //\u5176\u4ed6\u5730\u5740\u9700\u8981\u8ba4\u8bc1\u6388\u6743\n}\n')),(0,l.kt)("h4",{id:"342-\u79d2\u6740\u6e32\u67d3\u670d\u52a1-\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-2-%E7%A7%92%E6%9D%80%E6%B8%B2%E6%9F%93%E6%9C%8D%E5%8A%A1-%E6%9F%A5%E8%AF%A2%E7%A7%92%E6%9D%80%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"},"#"),"3.4.2 \u79d2\u6740\u6e32\u67d3\u670d\u52a1-\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"data:image/png;base64,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",alt:"image-20211228230009990"}),"image-20211228230009990"),(0,l.kt)("p",null,"oauth2 :1 \u5bfc\u5305 2\u516c\u94a5 3\u914d\u7f6e\u7c7b"),(0,l.kt)("p",null,"\u8c03\u7528feign\uff1a1\u5bfc\u5305 api 2EnableFeignClients 3feign\u62e6\u622a\u5668"),(0,l.kt)("h5",{id:"3421-\u66f4\u65b0ydles_web_seckill\u7684\u542f\u52a8\u7c7b"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-2-1-%E6%9B%B4%E6%96%B0ydles-web-seckill%E7%9A%84%E5%90%AF%E5%8A%A8%E7%B1%BB"},"#"),"3.4.2.1 \u66f4\u65b0ydles_web_seckill\u7684\u542f\u52a8\u7c7b"),(0,l.kt)("p",null,"\u6dfb\u52a0feign\u63a5\u53e3\u626b\u63cf"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@EnableFeignClients(basePackages = "com.ydles.seckill.feign")\n')),(0,l.kt)("h5",{id:"3422-\u66f4\u65b0ydles_web_seckill\u7684seckillgoodscontroller"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-2-2-%E6%9B%B4%E6%96%B0ydles-web-seckill%E7%9A%84seckillgoodscontroller"},"#"),"3.4.2.2 \u66f4\u65b0ydles_web_seckill\u7684SecKillGoodsController"),(0,l.kt)("p",null,"\u6ce8\u5165secKillFeign\uff0c\u5e76\u6dfb\u52a0\u83b7\u53d6\u79d2\u6740\u5546\u54c1\u5217\u8868\u65b9\u6cd5\u5b9e\u73b0"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n     * \u83b7\u53d6\u79d2\u6740\u5546\u54c1\u5217\u8868\n     * \u9ed8\u8ba4\u5f53\u524d\u65f6\u95f4\n     */\n@RequestMapping("/list")\n@ResponseBody\npublic Result<List<SeckillGoods>> list(String time){\n        String timeStr = DateUtil.formatStr(time);\n        System.out.println(timeStr);\n        return secKillGoodsFeign.list(timeStr);\n}\n')),(0,l.kt)("h5",{id:"3423-\u66f4\u65b0seckill-indexhtml\u6dfb\u52a0\u6309\u7167\u65f6\u95f4\u67e5\u8be2\u65b9\u6cd5"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-2-3-%E6%9B%B4%E6%96%B0seckill-index-html%E3%80%82%E6%B7%BB%E5%8A%A0%E6%8C%89%E7%85%A7%E6%97%B6%E9%97%B4%E6%9F%A5%E8%AF%A2%E6%96%B9%E6%B3%95"},"#"),"3.4.2.3 \u66f4\u65b0secKill-index.html\u3002\u6dfb\u52a0\u6309\u7167\u65f6\u95f4\u67e5\u8be2\u65b9\u6cd5"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20200310181130832-b7ad38fc.png",alt:"image-20200310181130832"}),"image-20200310181130832"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"//\u6309\u7167\u65f6\u95f4\u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868\nsearchList:function (time) {\n    axios.get('/api/wseckillgoods/list?time='+time).then(function (response) {\n        if (response.data.flag){\n            app.goodslist = response.data.data;\n        }\n    })\n}\n")),(0,l.kt)("h5",{id:"3424-\u66f4\u65b0seckill-indexhtml-\u52a0\u8f7d\u9875\u9762\u65f6\u9ed8\u8ba4\u5f53\u524d\u65f6\u95f4\u67e5\u8be2"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-2-4-%E6%9B%B4%E6%96%B0seckill-index-html%E3%80%82-%E5%8A%A0%E8%BD%BD%E9%A1%B5%E9%9D%A2%E6%97%B6-%E9%BB%98%E8%AE%A4%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%E6%9F%A5%E8%AF%A2"},"#"),"3.4.2.4 \u66f4\u65b0secKill-index.html\u3002 \u52a0\u8f7d\u9875\u9762\u65f6\uff0c\u9ed8\u8ba4\u5f53\u524d\u65f6\u95f4\u67e5\u8be2"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228233810290-2e074c3a.png",alt:"image-20211228233810290"}),"image-20211228233810290"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"//\u67e5\u8be2\u5f53\u524d\u65f6\u95f4\u6bb5\u5bf9\u5e94\u7684\u79d2\u6740\u5546\u54c1\napp.searchList(app.dateMenus[0]);\n")),(0,l.kt)("h5",{id:"3425-\u66f4\u65b0seckill-indexhtml\u5207\u6362\u65f6\u95f4\u83dc\u5355\u67e5\u8be2\u79d2\u6740\u5546\u54c1"},(0,l.kt)("a",{parentName:"h5",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-4-2-5-%E6%9B%B4%E6%96%B0seckill-index-html%E3%80%82%E5%88%87%E6%8D%A2%E6%97%B6%E9%97%B4%E8%8F%9C%E5%8D%95-%E6%9F%A5%E8%AF%A2%E7%A7%92%E6%9D%80%E5%95%86%E5%93%81"},"#"),"3.4.2.5 \u66f4\u65b0secKill-index.html\u3002\u5207\u6362\u65f6\u95f4\u83dc\u5355,\u67e5\u8be2\u79d2\u6740\u5546\u54c1"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228233831720-d51ed71c.png",alt:"image-20211228233831720"}),"image-20211228233831720"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<div class="item-time "\n     v-for="(item,index) in dateMenus"\n     :class="[\'item-time\',index==ctime?\'active\':\'\']"\n     @click="ctime=index;searchList(item)">\n</div>\n')),(0,l.kt)("p",null,"\u91cd\u542f\u79d2\u6740\u548c\u79d2\u6740\u9875\u9762\u670d\u52a1\uff0c ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wseckillgoods/toIndex"},"http://localhost:8001/api/wseckillgoods/toIndexopen in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228232748991-0450b613.png",alt:"image-20211228232748991"}),"image-20211228232748991"),(0,l.kt)("h3",{id:"35-\u62a2\u8d2d\u6309\u94ae"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-5-%E6%8A%A2%E8%B4%AD%E6%8C%89%E9%92%AE"},"#"),"3.5 \u62a2\u8d2d\u6309\u94ae"),(0,l.kt)("p",null,"\u56e0\u4e3a\u5f53\u524d\u4e1a\u52a1\u8bbe\u5b9a\u4e3a\u7528\u6237\u79d2\u6740\u5546\u54c1\u4e3asku\uff0c\u6240\u4ee5\u5f53\u7528\u6237\u70b9\u51fb\u7acb\u5373\u62a2\u8d2d\u6309\u94ae\u7684\u65f6\u5019\uff0c\u5219\u76f4\u63a5\u8fdb\u884c\u4e0b\u5355\u64cd\u4f5c\u3002"),(0,l.kt)("h4",{id:"351-js\u5b9a\u4e49"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-5-1-js%E5%AE%9A%E4%B9%89"},"#"),"3.5.1 js\u5b9a\u4e49"),(0,l.kt)("p",null,"\u5728\u79d2\u6740\u9996\u9875\u6dfb\u52a0\u4e0b\u5355\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"//\u79d2\u6740\u4e0b\u5355\nadd:function(id){\n    app.msg ='\u6b63\u5728\u4e0b\u5355';\n    axios.get(\"/api/wseckillorder/add?time=\"+moment(app.dateMenus[0]).format(\"YYYYMMDDHH\")+\"&id=\"+id).then(function (response) {\n        if (response.data.flag){\n            app.msg='\u62a2\u5355\u6210\u529f\uff0c\u5373\u5c06\u8fdb\u5165\u652f\u4ed8!';\n        }else{\n            app.msg='\u62a2\u5355\u5931\u8d25';\n        }\n    })\n}\n")),(0,l.kt)("h4",{id:"352-\u8c03\u7528\u4e0b\u5355\u65b9\u6cd5"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-5-2-%E8%B0%83%E7%94%A8%E4%B8%8B%E5%8D%95%E6%96%B9%E6%B3%95"},"#"),"3.5.2 \u8c03\u7528\u4e0b\u5355\u65b9\u6cd5"),(0,l.kt)("p",null,"\u4fee\u6539\u62a2\u8d2d\u6309\u94ae\uff0c\u6dfb\u52a0\u4e8b\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<a class='sui-btn btn-block btn-buy'  href='javascript:void(0)' @click=\"add(item.id)\">\u7acb\u5373\u62a2\u8d2d</a>\n")),(0,l.kt)("h4",{id:"353-\u79d2\u6740web\u9875\u9762-\u65b0\u589econtroller"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-5-3-%E7%A7%92%E6%9D%80web%E9%A1%B5%E9%9D%A2-%E6%96%B0%E5%A2%9Econtroller"},"#"),"3.5.3 \u79d2\u6740web\u9875\u9762 \u65b0\u589eController"),(0,l.kt)("p",null,"SecKillOrderController"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\n@RequestMapping("/wseckillorder")\npublic class SecKillOrderController {\n\n    @RequestMapping("/add")\n    public Result add(@RequestParam("time") String time, @RequestParam("id")Long id){\n        System.out.println("\u8fdb\u5165\u79d2\u6740\u8ba2\u5355\u903b\u8f91\u4e86\uff01");\n        return null;\n    }\n}\n')),(0,l.kt)("p",null,"\u7f51\u5173\u914d\u7f6e\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"        #\u79d2\u6740\u6e32\u67d3\u5fae\u670d\u52a1\n        - id: ydles_seckill_web_route\n          uri: lb://seckill-web\n          predicates:\n            - Path=/api/wseckillgoods/**,/api/wseckillorder/**\n          filters:\n            - StripPrefix=1\n")),(0,l.kt)("p",null,"\u6d4b\u8bd5\uff1a\u91cd\u542f\u79d2\u6740\u9875\u9762\uff0c\u7f51\u5173\u670d\u52a1\uff0c \u8bbf\u95ee",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wseckillgoods/toIndex"},"http://localhost:8001/api/wseckillgoods/toIndexopen in new window")," \uff0c\u70b9\u51fb\u7acb\u5373\u62a2\u8d2d"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228235033816-c450b648.png",alt:"image-20211228235033816"}),"image-20211228235033816"),(0,l.kt)("p",null,"\u540e\u53f0\u6253\u5370\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"data:image/png;base64,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",alt:"image-20211228235038565"}),"image-20211228235038565"),(0,l.kt)("p",null,"\u603b\u7ed3\uff1a"),(0,l.kt)("p",null,"1\u79d2\u6740\u4e1a\u52a1"),(0,l.kt)("p",null,"\u4e09\u9ad8\uff1a"),(0,l.kt)("p",null,"\u63a7\u5236\uff1a\u65f6\u95f4\u6bb5 \u6570\u91cf"),(0,l.kt)("p",null,"\u5355\u72ec\uff1a\u6570\u636e\u5e93 \u5fae\u670d\u52a1 \u9875\u9762"),(0,l.kt)("p",null,"2\u79d2\u6740\u5546\u54c1 \u5b58\u5165\u7f13\u5b58"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228160425046-fa761d21.png",alt:"image-20211228160425046"}),"image-20211228160425046"),(0,l.kt)("p",null,"3\u9996\u9875"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211228235345701-9bfef3d0.png",alt:"image-20211228235345701"}),"image-20211228235345701"),(0,l.kt)("h1",{id:"\u7b2c16\u7ae0-\u79d2\u6740\u540e\u7aef"},(0,l.kt)("a",{parentName:"h1",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#%E7%AC%AC16%E7%AB%A0-%E7%A7%92%E6%9D%80%E5%90%8E%E7%AB%AF"},"#"),"\u7b2c16\u7ae0-\u79d2\u6740\u540e\u7aef"),(0,l.kt)("p",null,"\u89d2\u8272\uff1a",(0,l.kt)("strong",{parentName:"p"},"\u67b6\u6784\u5e08")),(0,l.kt)("p",null,"\u6d4b\u8bd5\uff1a\u529f\u80fd\u6d4b\u8bd5 \u538b\u529b\u6d4b\u8bd5 1\u4e07/s 20\u4e07/s"),(0,l.kt)("p",null,"1\u5b9e\u73b0\u79d2\u6740",(0,l.kt)("strong",{parentName:"p"},"\u5f02\u6b65"),"\u4e0b\u5355,\u638c\u63e1\u5982\u4f55\u4fdd\u8bc1\u751f\u4ea7\u8005&\u6d88\u8d39\u8005\u6d88\u606f\u4e0d\u4e22\u5931"),(0,l.kt)("p",null,"2\u5b9e\u73b0\u9632\u6b62\u6076\u610f\u5237\u5355"),(0,l.kt)("p",null,"3\u5b9e\u73b0\u9632\u6b62\u76f8\u540c\u5546\u54c1\u91cd\u590d\u79d2\u6740"),(0,l.kt)("p",null,"4\u5b9e\u73b0\u79d2\u6740\u4e0b\u5355\u63a5\u53e3\u9690\u85cf"),(0,l.kt)("p",null,"5\u5b9e\u73b0\u4e0b\u5355\u63a5\u53e3\u9650\u6d41"),(0,l.kt)("h2",{id:"1-\u79d2\u6740\u5f02\u6b65\u4e0b\u5355-\u91cd\u70b9-\u96be\u70b9"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-%E7%A7%92%E6%9D%80%E5%BC%82%E6%AD%A5%E4%B8%8B%E5%8D%95-%E9%87%8D%E7%82%B9-%E9%9A%BE%E7%82%B9"},"#"),"1 \u79d2\u6740\u5f02\u6b65\u4e0b\u5355-\u91cd\u70b9-\u96be\u70b9"),(0,l.kt)("p",null,"\u7528\u6237\u5728\u4e0b\u5355\u7684\u65f6\u5019\uff0c\u9700\u8981\u57fa\u4e8eJWT\u4ee4\u724c\u4fe1\u606f\u8fdb\u884c\u767b\u9646\u4eba\u4fe1\u606f\u8ba4\u8bc1\uff0c\u786e\u5b9a\u5f53\u524d\u8ba2\u5355\u662f\u5c5e\u4e8e\u8c01\u7684\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4e3a\u4ec0\u4e48\u8981\u5f02\u6b65\u4e0b\u5355"),"\uff1a\u9488\u5bf9\u79d2\u6740\u7684\u7279\u6b8a\u4e1a\u52a1\u573a\u666f\uff0c\u4ec5\u4ec5\u4f9d\u9760\u5bf9\u8c61\u7f13\u5b58\u6216\u8005\u9875\u9762\u9759\u6001\u5316\u7b49\u6280\u672f\u53bb\u89e3\u51b3\u670d\u52a1\u7aef\u538b\u529b\u8fd8\u662f\u8fdc\u8fdc\u4e0d\u591f\u3002\u5bf9\u4e8e\u6570\u636e\u5e93\u538b\u529b\u8fd8\u662f\u5f88\u5927\uff0c\u6240\u4ee5\u9700\u8981\u5f02\u6b65\u4e0b\u5355\uff0c\u5f02\u6b65\u662f\u6700\u597d\u7684\u89e3\u51b3\u529e\u6cd5\uff0c\u4f46\u4f1a\u5e26\u6765\u4e00\u4e9b\u989d\u5916\u7684\u7a0b\u5e8f\u4e0a\u7684",(0,l.kt)("strong",{parentName:"p"},"\u590d\u6742\u6027"),"\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6d41\u7a0b\uff1a\u5f02\u6b65 service_seckill\u63a5\u6536\u4e0b\u5355\u6d88\u606f---\u300bMQ ------\u300bservice_consume \u5b8c\u6210\u5269\u4f59\u64cd\u4f5c")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102104824795-0202d8c0.png",alt:"image-20220102104824795"}),"image-20220102104824795"),(0,l.kt)("h3",{id:"11-\u79d2\u6740\u670d\u52a1-\u4e0b\u5355\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-1-%E7%A7%92%E6%9D%80%E6%9C%8D%E5%8A%A1-%E4%B8%8B%E5%8D%95%E5%AE%9E%E7%8E%B0"},"#"),"1.1 \u79d2\u6740\u670d\u52a1-\u4e0b\u5355\u5b9e\u73b0"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102115218841-29301bad.png",alt:"image-20220102115218841"}),"image-20220102115218841"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"1\uff09\u5c06tokenDecode\u5de5\u5177\u7c7b\u4eceorder\u5de5\u7a0b\u653e\u5165\u79d2\u6740\u670d\u52a1\u5e76\u58f0\u660eBean, ydles_service_seckill\u670d\u52a1")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102115503524-416a3769.png",alt:"image-20220102115503524"}),"image-20220102115503524"),(0,l.kt)("p",null,"\u542f\u52a8\u7c7b\u6dfb\u52a0"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Bean\npublic TokenDecode tokenDecode(){\n    return new TokenDecode();\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"2\uff09\u65b0\u5efa\u4e0b\u5355controller\u5e76\u58f0\u660e\u65b9\u6cd5")),(0,l.kt)("p",null,"ydles_service_seckill\u670d\u52a1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\n@CrossOrigin\n@RequestMapping("/seckillorder")\npublic class SecKillOrderController {\n\n    @Autowired\n    private TokenDecode tokenDecode;\n\n    @Autowired\n    private SecKillOrderService secKillOrderService;\n\n    /**\n     * \u79d2\u6740\u4e0b\u5355\n     * @param time \u5f53\u524d\u65f6\u95f4\u6bb5\n     * @param id \u79d2\u6740\u5546\u54c1id\n     * @return\n     */\n    @RequestMapping("/add")\n    public Result add(@RequestParam("time") String time, @RequestParam("id") Long id){\n        //\u83b7\u53d6\u5f53\u524d\u767b\u9646\u4eba\n        String username = tokenDecode.getUserInfo().get("username");\n        boolean result = secKillOrderService.add(id,time,username);\n        if (result){\n            return new Result(true, StatusCode.OK,"\u4e0b\u5355\u6210\u529f");\n        }else{\n            return new Result(false,StatusCode.ERROR,"\u4e0b\u5355\u5931\u8d25");\n        }\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"3) \u65b0\u5efaservice\u63a5\u53e3")),(0,l.kt)("p",null,"ydles_service_seckill\u670d\u52a1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public interface SecKillOrderService {\n    /**\n     * \u79d2\u6740\u4e0b\u5355\n     * @param id \u5546\u54c1id\n     * @param time \u65f6\u95f4\u6bb5\n     * @param username \u767b\u9646\u4eba\u59d3\u540d\n     * @return\n     */\n    boolean add(Long id, String time, String username);\n}\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102121935545-f2a178a8.png",alt:"image-20220102121935545"}),"image-20220102121935545"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"4\uff09\u66f4\u6539\u9884\u52a0\u8f7d\u79d2\u6740\u5546\u54c1")),(0,l.kt)("p",null,"\u5f53\u9884\u52a0\u8f7d\u79d2\u6740\u5546\u54c1\u7684\u65f6\u5019\uff0c\u63d0\u524d\u52a0\u8f7d\u6bcf\u4e00\u4e2a\u5546\u54c1\u7684\u5e93\u5b58\u4fe1\u606f\uff0c\u540e\u7eed\u51cf\u5e93\u5b58\u64cd\u4f5c\u4e5f\u4f1a\u5148",(0,l.kt)("strong",{parentName:"p"},"\u9884\u6263\u51cf\u7f13\u5b58\u4e2d\u7684\u5e93\u5b58\u518d\u5f02\u6b65\u6263\u51cfmysql\u6570\u636e"),"\u3002"),(0,l.kt)("p",null,"\u9884\u6263\u51cf\u5e93\u5b58\u4f1a\u57fa\u4e8eredis\u539f\u5b50\u6027\u64cd\u4f5c\u5b9e\u73b0"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102122324659-08477586.png",alt:"image-20220102122324659"}),"image-20220102122324659"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'//\u79d2\u6740\u5546\u54c1\u5e93\u5b58\u5934\npublic static final String SECKILL_GOODS_STOCK_COUNT_KEY="seckill_goods_stock_count_";\n\n\n//\u52a0\u8f7d\u79d2\u6740\u5546\u54c1\u7684\u5e93\u5b58\nredisTemplate.opsForValue().set(SECKILL_GOODS_STOCK_COUNT_KEY + seckillGoods.getId(), seckillGoods.getStockCount());\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"5\uff09\u79d2\u6740\u4e0b\u5355\u4e1a\u52a1\u5c42\u5b9e\u73b0")),(0,l.kt)("p",null,"\u4e1a\u52a1\u903b\u8f91\uff1a"),(0,l.kt)("p",null,"\u83b7\u53d6\u79d2\u6740\u5546\u54c1\u6570\u636e\u4e0e\u5e93\u5b58\u91cf\u6570\u636e\uff0c\u5982\u679c\u6ca1\u6709\u5e93\u5b58\u5219\u629b\u51fa\u5f02\u5e38"),(0,l.kt)("p",null,"\u9884\u6263\u51cf\u5e93\u5b58\uff0c\u5982\u679c\u6263\u5b8c\u5e93\u5b58\u91cf<0\uff0c\u5220\u9664\u5546\u54c1\u6570\u636e\u4e0e\u5e93\u5b58\u6570\u636e"),(0,l.kt)("p",null,"\u5982\u679c\u5e93\u5b58\u91cf>=0\uff0c\u521b\u5efa\u79d2\u6740\u8ba2\u5355\uff0c\u5e76\u5b58\u5165redis"),(0,l.kt)("p",null,"\u57fa\u4e8emq\u5f02\u6b65\u65b9\u5f0f\u5b8c\u6210\u4e0emysql\u6570\u636e\u540c\u6b65\uff08\u6700\u7ec8\u4e00\u81f4\u6027\uff09"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6ce8\u610f\uff1a\u5e93\u5b58\u6570\u636e\u4eceredis\u4e2d\u53d6\u51fa\uff0c\u8f6c\u6362\u6210String")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201cIT\u674e\u54e5\u4ea4\u670b\u53cb\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@Service\npublic class SecKillOrderServiceImpl implements SecKillOrderService {\n    @Autowired\n    RedisTemplate redisTemplate;\n    @Autowired\n    IdWorker idWorker;\n    //redis \u79d2\u6740\u5546\u54c1key\u5f00\u5934\n    public static final String SECKILL_GOODS_KEY = "seckill_goods_";\n    //\u79d2\u6740\u5546\u54c1\u5e93\u5b58key\u5934\n    public static final String SECKILL_GOODS_STOCK_COUNT_KEY = "seckill_goods_stock_count_";\n\n    //\u79d2\u6740\u4e0b\u5355\n    @Override\n    public boolean add(Long id, String time, String username) {\n        //1redis\u83b7\u53d6\u5546\u54c1\u7684\u6570\u636e\u4ee5\u53ca\u5e93\u5b58\u91cf\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u629b\u51fa\u5f02\u5e38\n        SeckillGoods seckillGoods = (SeckillGoods) redisTemplate.boundHashOps(SECKILL_GOODS_KEY + time).get(id);\n        if (seckillGoods == null) {\n            return false;\n        }\n        //redisTemplate\u7528\u7684\u662fstring\u5e8f\u5217\u5316\n        String redisStock = (String) redisTemplate.boundValueOps(SECKILL_GOODS_STOCK_COUNT_KEY + id).get();\n        if (StringUtils.isEmpty(redisStock)) {\n            return false;\n        }\n        int stock = Integer.parseInt(redisStock);\n        if (stock <= 0) {\n            return false;\n        }\n\n        //2\u9884\u6263\u51cf\u5e93\u5b58\uff0c\u5982\u679c\u6263\u62100\uff0c\u5220\u9664\u5546\u54c1\u4fe1\u606f\u548c\u5e93\u5b58\u4fe1\u606f\n        //Integer integer = (Integer) redisTemplate.opsForValue().get(SECKILL_GOODS_STOCK_COUNT_KEY + id);//100\n        //integer=integer-1;//99\n        //redisTemplate.boundValueOps(SECKILL_GOODS_STOCK_COUNT_KEY + id).set(integer);//99\n        Long decrement = redisTemplate.opsForValue().decrement(SECKILL_GOODS_STOCK_COUNT_KEY + id);\n        if(decrement<=0){\n            //\u5982\u679c\u6263\u62100\uff0c\u5220\u9664\u5546\u54c1\u4fe1\u606f\n            redisTemplate.boundHashOps(SECKILL_GOODS_KEY + time).delete(id);\n            //\u5e93\u5b58\u4fe1\u606f\n            redisTemplate.delete(SECKILL_GOODS_STOCK_COUNT_KEY + id);\n        }\n\n        //3\u751f\u6210\u79d2\u6740\u8ba2\u5355\n        SeckillOrder seckillOrder=new SeckillOrder();\n        seckillOrder.setId(idWorker.nextId());\n        seckillOrder.setSeckillId(id);\n        seckillOrder.setMoney(seckillGoods.getCostPrice());\n        seckillOrder.setUserId(username);\n        seckillOrder.setSeckillId(Long.parseLong(seckillGoods.getSellerId()));\n        seckillOrder.setCreateTime(new Date());\n        seckillOrder.setStatus("0");\n\n        //4\u8ba2\u5355\u6570\u636e\u5f80mq\u53d1\n        return false;\n    }\n}\n')),(0,l.kt)("h3",{id:"12-\u751f\u4ea7\u8005\u4fdd\u8bc1\u6d88\u606f\u4e0d\u4e22\u5931--\u9762\u8bd5\u5e38\u95ee\u95ee\u9898-\u91cd\u70b9"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-2-%E7%94%9F%E4%BA%A7%E8%80%85%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E4%B8%8D%E4%B8%A2%E5%A4%B1-%E9%9D%A2%E8%AF%95%E5%B8%B8%E9%97%AE%E9%97%AE%E9%A2%98-%E9%87%8D%E7%82%B9"},"#"),"1.2 \u751f\u4ea7\u8005\u4fdd\u8bc1\u6d88\u606f\u4e0d\u4e22\u5931--\u9762\u8bd5\u5e38\u95ee\u95ee\u9898-\u91cd\u70b9"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102172807666-221fc969.png",alt:"image-20220102172807666"}),"image-20220102172807666"),(0,l.kt)("p",null,"1rabbitMQ \u5de5\u4f5c\u6d41\u7a0b\u3002"),(0,l.kt)("p",null,"\u751f\u4ea7\u8005\uff1atcp ---\x3echannel--\x3e exchang"),(0,l.kt)("p",null,"\u6d88\u8d39\u8005\uff1atcp ------\x3echannal------\x3equeue \u4e00\u4e2a\u6d88\u8d39\u8005\u76d1\u542c",(0,l.kt)("strong",{parentName:"p"},"\u4e00\u4e2a")," ",(0,l.kt)("strong",{parentName:"p"},"\u961f\u5217")),(0,l.kt)("p",null,"\u7ed1\u5b9a\u5173\u7cfb\uff1a\u4ea4\u6362\u673a\u7c7b\u578b----\u7ed1\u5b9a\u5230\u961f\u5217----routingkey"),(0,l.kt)("p",null,"2\u6301\u4e45\u5316"),(0,l.kt)("p",null,"\u6309\u7167\u73b0\u6709rabbitMQ\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u751f\u4ea7\u8005\u4f1a\u53d1\u9001\u6d88\u606f\u5230\u8fbe\u6d88\u606f\u670d\u52a1\u5668\u3002\u4f46\u662f\u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e0b\uff0c\u6d88\u606f\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\u5f88\u6709\u53ef\u80fd\u5f53\u5230\u8fbe\u4e86\u6d88\u606f\u670d\u52a1\u5668\u4e4b\u540e\uff0c\u7531\u4e8e\u6d88\u606f\u670d\u52a1\u5668\u7684\u95ee\u9898\u5bfc\u81f4\u6d88\u606f\u4e22\u5931\uff0c\u5982\u5b95\u673a\u3002\u56e0\u4e3a\u6d88\u606f\u670d\u52a1\u5668\u9ed8\u8ba4\u4f1a\u5c06\u6d88\u606f\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\u3002\u4e00\u65e6\u6d88\u606f\u670d\u52a1\u5668\u5b95\u673a\uff0c\u5219\u6d88\u606f\u4f1a\u4ea7\u751f\u4e22\u5931\u3002\u56e0\u6b64\u8981\u4fdd\u8bc1\u751f\u4ea7\u8005\u7684\u6d88\u606f\u4e0d\u4e22\u5931\uff0c\u8981\u5f00\u59cb",(0,l.kt)("strong",{parentName:"p"},"\u6301\u4e45\u5316\u7b56\u7565"),"\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-properties"},"rabbitMQ\u6301\u4e45\u5316\uff1a\n    1. \u4ea4\u6362\u673a\u6301\u4e45\u5316\n    2. \u961f\u5217\u6301\u4e45\u5316\n    3. \u6d88\u606f\u6301\u4e45\u5316\n")),(0,l.kt)("p",null,"3rabbitmq\u6570\u636e\u4fdd\u62a4\u673a\u5236"),(0,l.kt)("p",null,"\u4f46\u662f\u5982\u679c\u4ec5\u4ec5\u53ea\u662f\u5f00\u542f\u8fd9\u4e24\u90e8\u5206\u7684\u6301\u4e45\u5316\uff0c\u4e5f\u5f88\u6709\u53ef\u80fd\u9020\u6210\u6d88\u606f\u4e22\u5931\u3002\u56e0\u4e3a\u6d88\u606f\u670d\u52a1\u5668\u5f88\u6709\u53ef\u80fd\u5728\u6301\u4e45\u5316\u7684\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u5b95\u673a\u3002\u56e0\u6b64\u9700\u8981\u901a\u8fc7\u6570\u636e\u4fdd\u62a4\u673a\u5236\u6765\u4fdd\u8bc1\u6d88\u606f\u4e00\u5b9a\u4f1a\u6210\u529f\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u5426\u5219\u5c06\u4e00\u76f4\u8fdb\u884c\u6d88\u606f\u53d1\u9001\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-properties"},"RabbitMQ\u6570\u636e\u4fdd\u62a4\u673a\u5236\n  1 \u4e8b\u52a1\u673a\u5236\n    \u4e8b\u52a1\u673a\u5236\u91c7\u7528\u7c7b\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u673a\u5236\u8fdb\u884c\u6570\u636e\u4fdd\u62a4\uff0c\u5f53\u6d88\u606f\u5230\u8fbe\u6d88\u606f\u670d\u52a1\u5668\uff0c\u9996\u5148\u4f1a\u5f00\u542f\u4e00\u4e2a\u4e8b\u52a1\uff0c\u63a5\u7740\u8fdb\u884c\u6570\u636e\u78c1\u76d8\u6301\u4e45\u5316\uff0c\u53ea\u6709\u6301\u4e45\u5316\u6210\u529f\u624d\u4f1a\u8fdb\u884c\u4e8b\u52a1\u63d0\u4ea4\uff0c\u5411\u6d88\u606f\u751f\u4ea7\u8005\u8fd4\u56de\u6210\u529f\u901a\u77e5\uff0c\u6d88\u606f\u751f\u4ea7\u8005\u4e00\u65e6\u63a5\u6536\u6210\u529f\u901a\u77e5\u5219\u4e0d\u4f1a\u518d\u53d1\u9001\u6b64\u6761\u6d88\u606f\u3002\u5f53\u51fa\u73b0\u5f02\u5e38\uff0c\u5219\u8fd4\u56de\u5931\u8d25\u901a\u77e5.\u6d88\u606f\u751f\u4ea7\u8005\u4e00\u65e6\u63a5\u6536\u5931\u8d25\u901a\u77e5\uff0c\u5219\u7ee7\u7eed\u53d1\u9001\u8be5\u6761\u6d88\u606f\u3002\n    \u4e8b\u52a1\u673a\u5236\u867d\u7136\u80fd\u591f\u4fdd\u8bc1\u6570\u636e\u5b89\u5168\uff0c\u4f46\u662f\u6b64\u673a\u5236\u91c7\u7528\u7684\u662f\u540c\u6b65\u673a\u5236\uff0c\u4f1a\u4ea7\u751f\u7cfb\u7edf\u95f4\u6d88\u606f\u963b\u585e\uff0c\u5f71\u54cd\u6574\u4e2a\u7cfb\u7edf\u7684\u6d88\u606f\u541e\u5410\u91cf\u3002\u4ece\u800c\u5bfc\u81f4\u6574\u4e2a\u7cfb\u7edf\u7684\u6027\u80fd\u4e0b\u964d\uff0c\u56e0\u6b64\u4e0d\u5efa\u8bae\u4f7f\u7528\u3002\n    \n  2 confirm\u673a\u5236\n    confirm\u6a21\u5f0f\u9700\u8981\u57fa\u4e8echannel\u8fdb\u884c\u8bbe\u7f6e, \u4e00\u65e6\u67d0\u6761\u6d88\u606f\u88ab\u6295\u9012\u5230\u961f\u5217\u4e4b\u540e,\u6d88\u606f\u961f\u5217\u5c31\u4f1a\u53d1\u9001\u4e00\u4e2a\u786e\u8ba4\u4fe1\u606f\u7ed9\u751f\u4ea7\u8005,\u5982\u679c\u961f\u5217\u4e0e\u6d88\u606f\u662f\u53ef\u6301\u4e45\u5316\u7684, \u90a3\u4e48\u786e\u8ba4\u6d88\u606f\u4f1a\u7b49\u5230\u6d88\u606f\u6210\u529f\u5199\u5165\u5230\u78c1\u76d8\u4e4b\u540e\u53d1\u51fa.\n    confirm\u7684\u6027\u80fd\u9ad8,\u4e3b\u8981\u5f97\u76ca\u4e8e\u5b83\u662f\u5f02\u6b65\u7684.\u751f\u4ea7\u8005\u5728\u5c06\u7b2c\u4e00\u6761\u6d88\u606f\u53d1\u51fa\u4e4b\u540e\u7b49\u5f85\u786e\u8ba4\u6d88\u606f\u7684\u540c\u65f6\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u53d1\u9001\u540e\u7eed\u7684\u6d88\u606f.\u5f53\u786e\u8ba4\u6d88\u606f\u5230\u8fbe\u4e4b\u540e,\u5c31\u53ef\u4ee5\u901a\u8fc7\u56de\u8c03\u65b9\u6cd5\u5904\u7406\u8fd9\u6761\u786e\u8ba4\u6d88\u606f. \u5982\u679cMQ\u670d\u52a1\u5b95\u673a\u4e86,\u5219\u4f1a\u8fd4\u56denack\u6d88\u606f. \u751f\u4ea7\u8005\u540c\u6837\u5728\u56de\u8c03\u65b9\u6cd5\u4e2d\u8fdb\u884c\u540e\u7eed\u5904\u7406\u3002\n")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102174038302-d741825a.png",alt:"image-20220102174038302"}),"image-20220102174038302"),(0,l.kt)("p",null,"\u62d3\u5c55\u8d44\u6599\uff1a ",(0,l.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/vipstone/p/9350075.html"},"https://www.cnblogs.com/vipstone/p/9350075.htmlopen in new window")),(0,l.kt)("p",null,"4\u5373\u4f7f\u6211\u4eec\u8bbe\u8ba1\u5f97\u8fd9\u4e48\u5b8c\u7f8e\uff0c\u4e5f\u4e0d\u80fd\u4fdd\u8bc1\u6570\u636e100%\u5168\u90e8\u53d1\u9001\u3001\u63a5\u53d7\u3002"),(0,l.kt)("p",null,"99.9999999% \u673a\u5668\u8fd0\u884c\u6210\u529f\u7387\u3002 aws---\x3epaypal youtube"),(0,l.kt)("h4",{id:"121-\u5f00\u542fconfirm\u673a\u5236"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-2-1-%E5%BC%80%E5%90%AFconfirm%E6%9C%BA%E5%88%B6"},"#"),"1.2.1 \u5f00\u542fconfirm\u673a\u5236"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"ydles_service_seckill\u670d\u52a1")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"1\uff09\u66f4\u6539\u79d2\u6740\u670d\u52a1\u914d\u7f6e\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"rabbitmq:\n    host: 192.168.200.128\n    publisher-confirms: true #\u5f00\u542fconfirm\u673a\u5236\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"2\uff09\u5f00\u542f\u961f\u5217\u6301\u4e45\u5316")," rabbit\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("p",null,"rabbitMq\u4f7f\u7528\uff1a1\u5bfc\u5305 2\u914d\u7f6e\u6587\u4ef6 3\u914d\u7f6e\u7c7b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Configuration\npublic class RabbitMQConfig {\n\n    //\u79d2\u6740\u5546\u54c1\u8ba2\u5355\u6d88\u606f\n    public static final String SECKILL_ORDER_QUEUE="seckill_order";\n\n    //\u58f0\u660e\u961f\u5217\uff0c\u5e76\u5f00\u542f\u6301\u4e45\u5316\n    @Bean\n    public Queue queue(){\n        /**\n         * \u7b2c\u4e00\u4e2a\u53c2\u6570\uff1a\u961f\u5217\u540d\u79f0\n         * \u7b2c\u4e8c\u4e2a\u53c2\u6570\uff1a\u662f\u5426\u5f00\u542f\u961f\u5217\u6301\u4e45\u5316\n         */\n        return new Queue(SECKILL_ORDER_QUEUE,true);\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"3\uff09\u6d88\u606f\u6301\u4e45\u5316\u6e90\u7801\u67e5\u770b")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102175146418-9c7a01b4.png",alt:"image-20220102175146418"}),"image-20220102175146418"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102175205923-5f2f320e.png",alt:"image-20220102175205923"}),"image-20220102175205923"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102180304161-ea2c6fb5.png",alt:"image-20220102180304161"}),"image-20220102180304161"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102180334328-9edf9ec6.png",alt:"image-20220102180334328"}),"image-20220102180334328"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102180355716-3b529d86.png",alt:"image-20220102180355716"}),"image-20220102180355716"),(0,l.kt)("p",null,"\u7684\u786e\uff0c\u5728\u6d88\u606fconvert\u8f6c\u6362\u7684\u65f6\u5019\uff0c\u8bbe\u7f6e\u5c5e\u6027\u662f\u6301\u4e45\u5316\u7684\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"4\uff09\u589e\u5f3arabbitTemplate ")," config\u5305\u4e0b\u65b0\u5efa\u3002\u91cd\u8981\uff1a\u6b64\u7c7b\u76f8\u5f53\u4e8e\u6211\u4eec\u624b\u52a8\u5b8c\u6210confirm\u903b\u8f91\uff01"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201cIT\u674e\u54e5\u4ea4\u670b\u53cb\u201d\n * \u4e2a\u4eba\u5fae itlils\n * \u6d88\u606f\u5f85\u53d1\u5668\n */\n@Component\npublic class ConfirmMessageSender implements RabbitTemplate.ConfirmCallback{\n    @Autowired\n    RabbitTemplate rabbitTemplate;\n    @Autowired\n    RedisTemplate redisTemplate;\n\n    //redis \u653e\u7684\u65f6\u5019 \u5f00\u5934\u7684key\n    public static final String MESSAGE_CONFIRM_KEY="message_confirm_";\n\n    //\u89c4\u5b9a \u6709\u4e2a\u6784\u9020\u5668\n    public ConfirmMessageSender(RabbitTemplate rabbitTemplate){\n        //\u672c\u7c7b\u548c\u5bb9\u5668\u4e2d\u7684rabbitTemplate \u5efa\u7acb\u8054\u7cfb\n        this.rabbitTemplate=rabbitTemplate;\n        //\u4f7f\u7528rabbitTemplate\u53d1\u7684\u6d88\u606f\uff0c\u5fc5\u987b\u6709\u56de\u8c03\uff0c\u56de\u8c03\u7ed9\u672c\u7c7b\n        rabbitTemplate.setConfirmCallback(this);\n    }\n\n    //\u56de\u8c03\u65b9\u6cd5 exchange\u5f02\u6b65\u544a\u77e5\u8fd9\u6761\u6d88\u606f\u53d1\u9001\u6210\u529f\n    @Override\n    public void confirm(CorrelationData correlationData, boolean ack, String cause) {\n        if(ack){\n            //\u53d1\u9001\u6210\u529f  \u5220\u9664\u6389\u5b58\u50a8\u7a7a\u95f4\u7684\u6570\u636e\n            redisTemplate.delete(correlationData.getId());\n            redisTemplate.delete(MESSAGE_CONFIRM_KEY+correlationData.getId());\n        }else {\n            //\u53d1\u9001\u5931\u8d25  \u91cd\u53d1\n            Map<String, String> map = redisTemplate.boundHashOps(MESSAGE_CONFIRM_KEY + correlationData.getId()).entries();\n            String exchange = map.get("exchange");\n            String routingKey = map.get("routingKey");\n            String message = map.get("message");\n\n            //\u91cd\u53d1\n            rabbitTemplate.convertAndSend(exchange,routingKey,message);\n            //\u9884\u8b66 \u8c03\u7528\u7b2c\u4e09\u65b9\u63a5\u53e3\uff1a\u53d1\u77ed\u4fe1\uff0c\u53d1\u90ae\u4ef6\u7ed9\u5230\u8fd0\u7ef4\u6280\u672f\u7ec4\u957f\u3002log.warn\n        }\n    }\n\n    //\u81ea\u5b9a\u4e49\u53d1\u9001\u7684\u65b9\u6cd5\n    public void send(String exchange,String routingKey,String message){\n        //\u8bbe\u7f6e\u6d88\u606f\u7684\u552f\u4e00id\n        CorrelationData correlationData=new CorrelationData(UUID.randomUUID().toString());\n        //\u8fd0\u7ef4\u5feb\u901f\u7684\u770b\u54ea\u4e2amsg\u6709\u95ee\u9898\u4e86\n        redisTemplate.boundValueOps(correlationData.getId()).set(message);\n\n        //\u4fdd\u5b58\u53d1\u9001\u7684\u4fe1\u606f\u5230 redis\n        Map<String, String> map=new HashMap<>();\n        map.put("exchange",exchange);\n        map.put("routingKey",routingKey);\n        map.put("message",message);\n        redisTemplate.boundHashOps(MESSAGE_CONFIRM_KEY+correlationData.getId()).putAll(map);\n\n        //\u771f\u6b63\u53d1\u9001\n        rabbitTemplate.convertAndSend(exchange,routingKey,message,correlationData);\n    }\n\n\n\n}\n')),(0,l.kt)("h4",{id:"122\u53d1\u9001\u6d88\u606f"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-2-2%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"},"#"),(0,l.kt)("strong",{parentName:"h4"},"1.2.2\u53d1\u9001\u6d88\u606f")),(0,l.kt)("p",null,"\u66f4\u6539\u4e0b\u5355\u4e1a\u52a1\u5c42\u5b9e\u73b0"),(0,l.kt)("p",null,"ydles_service_seckill\u670d\u52a1SecKillOrderServiceImpl\u7c7b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Autowired\nprivate ConfirmMessageSender confirmMessageSender;      \n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'//\u53d1\u9001\u6d88\u606f\nconfirmMessageSender.sendMessage("", RabbitMQConfig.SECKILL_ORDER_KEY, JSON.toJSONString(seckillOrder));\n')),(0,l.kt)("p",null,"\u6d4b\u8bd5\uff1a\u4e09\u4e2a\u5173\u952e\u4f4d\u7f6e\u6253\u65ad\u70b9\uff1a"),(0,l.kt)("p",null,"1add\u65b9\u6cd5"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102183240326-2c17e172.png",alt:"image-20220102183240326"}),"image-20220102183240326"),(0,l.kt)("p",null,"2confirmSender \u7684send"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102183257423-337a507e.png",alt:"image-20220102183257423"}),"image-20220102183257423"),(0,l.kt)("p",null,"3confirmSender \u56de\u8c03\u65b9\u6cd5"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102183310057-583b8381.png",alt:"image-20220102183310057"}),"image-20220102183310057"),(0,l.kt)("p",null,"4\u57fa\u4e8e\u7f51\u5173\u8bbf\u95ee \u4fee\u6539\u7f51\u5173\u8def\u7531"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},"        #\u79d2\u6740\u5fae\u670d\u52a1\n        - id: ydles_seckill_route\n          uri: lb://seckill\n          predicates:\n            - Path=/api/seckill/**,/api/seckillorder/**\n          filters:\n            - StripPrefix=1\n")),(0,l.kt)("p",null,"5\u91cd\u542f\u7f51\u5173\u3001\u79d2\u6740\u670d\u52a1\u3002"),(0,l.kt)("p",null,"\u767b\u9646\uff1a ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/oauth/toLogin"},"http://localhost:8001/api/oauth/toLoginopen in new window")),(0,l.kt)("p",null,"\u6839\u636e\u65f6\u95f4 \u6a21\u62df\u79d2\u6740\uff1a ","[http://localhost:8001/api/seckillorder/add?time=2022-01-02 18:00:00&id=1open in new window]","(http://localhost:8001/api/seckillorder/add?time=2022-01-02 18:00:00&id=1)"),(0,l.kt)("h3",{id:"13-\u79d2\u6740\u4e0b\u5355\u670d\u52a1-\u66f4\u65b0\u5e93\u5b58\u5e93"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-%E7%A7%92%E6%9D%80%E4%B8%8B%E5%8D%95%E6%9C%8D%E5%8A%A1-%E6%9B%B4%E6%96%B0%E5%BA%93%E5%AD%98%E5%BA%93"},"#"),"1.3 \u79d2\u6740\u4e0b\u5355\u670d\u52a1-\u66f4\u65b0\u5e93\u5b58\u5e93"),(0,l.kt)("h4",{id:"131-\u5f02\u6b65\u4e0b\u5355\u670d\u52a1ydles_service_consume"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-1-%E5%BC%82%E6%AD%A5%E4%B8%8B%E5%8D%95%E6%9C%8D%E5%8A%A1ydles-service-consume"},"#"),"1.3.1 \u5f02\u6b65\u4e0b\u5355\u670d\u52a1ydles_service_consume"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"1\uff09\u6dfb\u52a0\u4f9d\u8d56")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependencies>\n    <dependency>\n        <groupId>com.ydles</groupId>\n        <artifactId>ydles_common_db</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>com.ydles</groupId>\n        <artifactId>ydles_service_order_api</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </dependency>\n    <dependency>\n        <groupId>com.ydles</groupId>\n        <artifactId>ydles_service_seckill_api</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </dependency>\n    <dependency>\n        <groupId>com.ydles</groupId>\n        <artifactId>ydles_service_goods_api</artifactId>\n        <version>1.0-SNAPSHOT</version>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.amqp</groupId>\n        <artifactId>spring-rabbit</artifactId>\n    </dependency>\n</dependencies>\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"2\uff09\u65b0\u5efaapplication.yml")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"server:\n  port: 9022\nspring:\n  jackson:\n    time-zone: GMT+8\n  application:\n    name: sec-consume\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://192.168.200.128:3306/ydles_seckill?useUnicode=true&characterEncoding=utf-8&useSSL=false&allowMultiQueries=true&serverTimezone=GMT%2b8\n    username: root\n    password: root\n  main:\n    allow-bean-definition-overriding: true #\u5f53\u9047\u5230\u540c\u6837\u540d\u5b57\u7684\u65f6\u5019\uff0c\u662f\u5426\u5141\u8bb8\u8986\u76d6\u6ce8\u518c\n  redis:\n    host: 192.168.200.128\n  rabbitmq:\n    host: 192.168.200.128\neureka:\n  client:\n    service-url:\n      defaultZone: http://127.0.0.1:6868/eureka\n  instance:\n    prefer-ip-address: true\nfeign:\n  hystrix:\n    enabled: true\n  client:\n    config:\n      default:   #\u914d\u7f6e\u5168\u5c40\u7684feign\u7684\u8c03\u7528\u8d85\u65f6\u65f6\u95f4  \u5982\u679c \u6709\u6307\u5b9a\u7684\u670d\u52a1\u914d\u7f6e \u9ed8\u8ba4\u7684\u914d\u7f6e\u4e0d\u4f1a\u751f\u6548\n        connectTimeout: 60000 # \u6307\u5b9a\u7684\u662f \u6d88\u8d39\u8005 \u8fde\u63a5\u670d\u52a1\u63d0\u4f9b\u8005\u7684\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 \u662f\u5426\u80fd\u8fde\u63a5  \u5355\u4f4d\u662f\u6beb\u79d2\n        readTimeout: 20000  # \u6307\u5b9a\u7684\u662f\u8c03\u7528\u670d\u52a1\u63d0\u4f9b\u8005\u7684 \u670d\u52a1 \u7684\u8d85\u65f6\u65f6\u95f4\uff08\uff09  \u5355\u4f4d\u662f\u6beb\u79d2\n#hystrix \u914d\u7f6e\nhystrix:\n  command:\n    default:\n      execution:\n        timeout:\n          #\u5982\u679cenabled\u8bbe\u7f6e\u4e3afalse\uff0c\u5219\u8bf7\u6c42\u8d85\u65f6\u4ea4\u7ed9ribbon\u63a7\u5236\n          enabled: true\n        isolation:\n          strategy: SEMAPHORE\n          thread:\n            # \u7194\u65ad\u5668\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\uff1a1000/\u6beb\u79d2\n            timeoutInMilliseconds: 20000\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"3\uff09\u65b0\u5efa\u542f\u52a8\u7c7b")," com.ydles.consume"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@SpringBootApplication\n@EnableDiscoveryClient\n@MapperScan(basePackages = {"com.ydles.consume.dao"})\npublic class OrderConsumerApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(OrderConsumerApplication.class,args);\n    }\n}\n')),(0,l.kt)("h4",{id:"132-\u6d88\u8d39\u8005\u624b\u52a8ack\u4e0b\u5355\u5b9e\u73b0--\u9762\u8bd5\u91cd\u70b9-\u8ba4\u771f\u542c"},(0,l.kt)("a",{parentName:"h4",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-3-2-%E6%B6%88%E8%B4%B9%E8%80%85%E6%89%8B%E5%8A%A8ack%E4%B8%8B%E5%8D%95%E5%AE%9E%E7%8E%B0-%E9%9D%A2%E8%AF%95%E9%87%8D%E7%82%B9-%E8%AE%A4%E7%9C%9F%E5%90%AC"},"#"),"1.3.2 \u6d88\u8d39\u8005\u624b\u52a8ACK\u4e0b\u5355\u5b9e\u73b0--\u9762\u8bd5\u91cd\u70b9-\u8ba4\u771f\u542c"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220102191752824-887214db.png",alt:"image-20220102191752824"}),"image-20220102191752824"),(0,l.kt)("p",null," \u6309\u7167\u73b0\u6709RabbitMQ\u77e5\u8bc6\uff0c\u53ef\u4ee5\u5f97\u77e5\u5f53\u6d88\u606f\u6d88\u8d39\u8005\u6210\u529f\u63a5\u6536\u5230\u6d88\u606f\u540e\uff0c\u4f1a\u8fdb\u884c\u6d88\u8d39\u5e76\u81ea\u52a8\u901a\u77e5\u6d88\u606f\u670d\u52a1\u5668\u5c06\u8be5\u6761\u6d88\u606f\u5220\u9664\u3002\u6b64\u79cd\u65b9\u5f0f\u7684\u5b9e\u73b0\u4f7f\u7528\u7684\u662f\u6d88\u8d39\u8005\u81ea\u52a8\u5e94\u7b54\u673a\u5236\u3002\u4f46\u662f\u6b64\u79cd\u65b9\u5f0f\u975e\u5e38\u7684\u4e0d\u5b89\u5168\u3002"),(0,l.kt)("p",null," \u5728\u751f\u4ea7\u73af\u5883\u4e0b\uff0c\u5f53\u6d88\u606f\u6d88\u8d39\u8005\u63a5\u6536\u5230\u6d88\u606f\uff0c\u5f88\u6709\u53ef\u80fd\u5728\u5904\u7406\u6d88\u606f\u7684\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u610f\u5916\u60c5\u51b5\u4ece\u800c\u5bfc\u81f4\u6d88\u606f\u4e22\u5931\uff0c\u56e0\u4e3a\u5982\u679c\u4f7f\u7528\u81ea\u52a8\u5e94\u7b54\u673a\u5236\u662f\u975e\u5e38\u4e0d\u5b89\u5168\u3002"),(0,l.kt)("p",null," \u6211\u4eec\u9700\u8981\u786e\u4fdd\u6d88\u8d39\u8005\u5f53\u628a\u6d88\u606f\u6210\u529f\u5904\u7406\u5b8c\u6210\u4e4b\u540e\uff0c\u6d88\u606f\u670d\u52a1\u5668\u624d\u4f1a\u5c06\u8be5\u6761\u6d88\u606f\u5220\u9664\u3002\u6b64\u65f6\u8981\u5b9e\u73b0\u8fd9\u79cd\u6548\u679c\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u5c06",(0,l.kt)("strong",{parentName:"p"},"\u81ea\u52a8\u5e94\u7b54\u8f6c\u6362\u4e3a\u624b\u52a8\u5e94\u7b54"),",\u53ea\u6709\u5728\u6d88\u606f\u6d88\u8d39\u8005\u5c06\u6d88\u606f\u5904\u7406\u5b8c\uff0c\u624d\u4f1a\u901a\u77e5\u6d88\u606f\u670d\u52a1\u5668\u5c06\u8be5\u6761\u6d88\u606f\u5220\u9664\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"1\uff09\u66f4\u6539\u914d\u7f6e\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"rabbitmq:\n    host: 192.168.200.128\n    listener:\n      simple:\n        acknowledge-mode: manual #\u624b\u52a8\n")),(0,l.kt)("p",null,"mq\u914d\u7f6e\u7c7b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Configuration\npublic class RabbitMQConfig {\n\n    //\u79d2\u6740\u5546\u54c1\u8ba2\u5355\u6d88\u606f\n    public static final String SECKILL_ORDER_QUEUE="seckill_order";\n\n    //\u58f0\u660e\u961f\u5217\uff0c\u5e76\u5f00\u542f\u6301\u4e45\u5316\n    @Bean\n    public Queue queue(){\n        /**\n         * \u7b2c\u4e00\u4e2a\u53c2\u6570\uff1a\u961f\u5217\u540d\u79f0\n         * \u7b2c\u4e8c\u4e2a\u53c2\u6570\uff1a\u662f\u5426\u5f00\u542f\u961f\u5217\u6301\u4e45\u5316\n         */\n        return new Queue(SECKILL_ORDER_QUEUE,true);\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"2\uff09\u5b9a\u4e49\u76d1\u542c\u7c7b")," ",(0,l.kt)("strong",{parentName:"p"},"\u56de\u987e"),"rabbitMQ\u4e0espringboot\u6574\u5408\u65f6\uff0c\u5f62\u53c2Channel channel, Message message\u610f\u4e49\u3002"),(0,l.kt)("p",null,"com.ydles.consumer.listener"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201cIT\u674e\u54e5\u4ea4\u670b\u53cb\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@Component\npublic class SecKillOrderListener {\n    @Autowired\n    SeckillOrderService seckillOrderService;\n\n    @RabbitListener(queues = RabbitMQConfig.SECKILL_ORDER_QUEUE)\n    public void receiveMsg(Message message, Channel channel){\n        String msgStr = new String(message.getBody());\n        System.out.println("\u63a5\u53d7\u5230\u4e86\u79d2\u6740\u8ba2\u5355"+msgStr);\n        //1\u76d1\u542c order\n        SeckillOrder seckillOrder = JSON.parseObject(message.getBody(), SeckillOrder.class);\n        //2\u5148\u505a\u4e1a\u52a1\u903b\u8f91\n        int result = seckillOrderService.createOrder(seckillOrder);\n\n        if(result>0){\n            //2.1\u6ca1\u95ee\u9898    \u544a\u8bc9mq\u6536\u5230\u6d88\u606f\u4e86\uff0c\u53ef\u5220\n            try {\n                channel.basicAck(message.getMessageProperties().getDeliveryTag(),false);\n            } catch (IOException e) {\n                e.printStackTrace();\n                //log.error\n            }\n        }else {\n            //2.2\u6709\u95ee\u9898    \u544a\u8bc9mq\u6ca1\u6536\u5230\u6d88\u606f\uff0c\u91cd\u56de\u961f\u5217\n            try {\n                channel.basicNack(message.getMessageProperties().getDeliveryTag(),false,true);\n            } catch (IOException e) {\n                e.printStackTrace();\n                //log.error\n            }\n        }\n\n    }\n\n}\n')),(0,l.kt)("p",null,"3\uff09\u5b9a\u4e49\u4e1a\u52a1\u5c42\u63a5\u53e3\u4e0e\u5b9e\u73b0\u7c7b"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103094738284-38962074.png",alt:"image-20220103094738284"}),"image-20220103094738284"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public interface SecKillOrderService {\n    int createOrder(SeckillOrder seckillOrder);\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Service\npublic class SecKillOrderServiceImpl implements SecKillOrderService  {\n\n    @Autowired\n    private SeckillGoodsMapper seckillGoodsMapper;\n\n    @Autowired\n    private SeckillOrderMapper seckillOrderMapper;\n\n    /**\n     * \u540c\u6b65\u6570\u636e\u5e93\uff0c\u66f4\u6539\u5e93\u5b58\uff0c\u6dfb\u52a0\u8ba2\u5355\n     * @param seckillOrder\n     * @return\n     */\n    @Override\n    @Transactional\n    public int createOrder(SeckillOrder seckillOrder) {\n\n        //\u66f4\u6539\u5e93\u5b58\n        int result = seckillGoodsMapper.updateStockCountById(seckillOrder.getId());\n        if (result<=0){\n            return result;\n        }\n\n        //\u6dfb\u52a0\u8ba2\u5355\n        result = seckillOrderMapper.insertSelective(seckillOrder);\n        if (result<=0){\n            return result;\n        }\n        return result;\n    }\n}\n")),(0,l.kt)("p",null,"4\uff09dao\u5c42\u4e24\u4e2amapper\u4ece\u79d2\u6740\u670d\u52a1copy"),(0,l.kt)("p",null,"5\uff09\u542f\u52a8\u7c7b\u626b\u5305"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@MapperScan(basePackages = {"com.ydles.consumer.dao"})\n')),(0,l.kt)("p",null,"6)\u5b8c\u5584 SeckillGoodsMapper"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public interface SeckillGoodsMapper extends Mapper<SeckillGoods> {\n    @Update("update tb_seckill_goods set stock_count=stock_count-1 where id=#{id} and stock_count>=1")\n   int updateStockCount(@Param("id") Long id);\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-properties"},"\u6570\u636e\u5e93\u5b57\u6bb5unsigned\u4ecb\u7ecd\n    unsigned-----\u65e0\u7b26\u53f7\uff0c\u4fee\u9970int \u3001char\n    \nALTER TABLE tb_seckill_goods MODIFY COLUMN stock_count int(11) UNSIGNED DEFAULT NULL COMMENT '\u5269\u4f59\u5e93\u5b58\u6570';\n")),(0,l.kt)("h3",{id:"15-\u6d41\u91cf\u524a\u5cf0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-5-%E6%B5%81%E9%87%8F%E5%89%8A%E5%B3%B0"},"#"),"1.5 \u6d41\u91cf\u524a\u5cf0"),(0,l.kt)("p",null,"\u5728\u79d2\u6740\u8fd9\u79cd\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u4e0b\uff0c\u6bcf\u79d2\u90fd\u6709\u53ef\u80fd\u4ea7\u751f\u51e0\u4e07\u751a\u81f3\u5341\u51e0\u4e07\u6761\u6d88\u606f\uff0c\u5982\u679c\u6ca1\u6709\u5bf9\u6d88\u606f\u5904\u7406\u91cf\u8fdb\u884c\u4efb\u4f55\u9650\u5236\u7684\u8bdd\uff0c\u5f88\u6709\u53ef\u80fd\u56e0\u4e3a\u8fc7\u591a\u7684\u6d88\u606f\u5806\u79ef\u4ece\u800c\u5bfc\u81f4\u6d88\u8d39\u8005\u5b95\u673a\u7684\u60c5\u51b5\u3002\u56e0\u6b64\u5b98\u7f51\u5efa\u8bae\u5bf9\u6bcf\u4e00\u4e2a\u6d88\u606f\u6d88\u8d39\u8005\u90fd\u8bbe\u7f6e\u5904\u7406\u6d88\u606f\u603b\u6570\uff08",(0,l.kt)("strong",{parentName:"p"},"\u6d88\u606f\u6293\u53d6\u603b\u6570"),"\uff09\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103100123839-ca9d552f.png",alt:"image-20220103100123839"}),"image-20220103100123839"),(0,l.kt)("p",null,"\u6d88\u606f\u6293\u53d6\u603b\u6570\u7684\u503c\uff0c\u8bbe\u7f6e\u8fc7\u5927\u6216\u8005\u8fc7\u5c0f\u90fd\u4e0d\u597d\uff0c\u8fc7\u5c0f\u7684\u8bdd\uff0c\u4f1a\u5bfc\u81f4\u6574\u4e2a\u7cfb\u7edf\u6d88\u606f\u541e\u5410\u80fd\u529b\u4e0b\u964d\uff0c\u9020\u6210\u6027\u80fd\u6d6a\u8d39\u3002\u8fc7\u5927\u7684\u8bdd\uff0c\u5219\u5f88\u6709\u53ef\u80fd\u5bfc\u81f4\u6d88\u606f\u8fc7\u591a\uff0c\u5bfc\u81f4\u6574\u4e2a\u7cfb\u7edfOOM(out of memory)\u5185\u5b58\u6ea2\u51fa\u3002\u56e0\u6b64\u5b98\u7f51\u5efa\u8bae\u6bcf\u4e00\u4e2a\u6d88\u8d39\u8005\u5c06\u8be5\u503c\u8bbe\u7f6e\u5728",(0,l.kt)("strong",{parentName:"p"},"100-300"),"\u4e4b\u95f4\u3002"),(0,l.kt)("p",null,"1\uff09\u66f4\u65b0\u6d88\u8d39\u8005\u3002"),(0,l.kt)("p",null,"ydles_service_consume\u670d\u52a1SecKillOrderListener\u76d1\u542c\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n  * \u9884\u6293\u53d6\u603b\u6570\n  */\ntry {\n    channel.basicQos(300);\n} catch (IOException e) {\n    e.printStackTrace();\n}\n")),(0,l.kt)("h3",{id:"16-\u79d2\u6740\u6e32\u67d3\u670d\u52a1-\u4e0b\u5355\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-6-%E7%A7%92%E6%9D%80%E6%B8%B2%E6%9F%93%E6%9C%8D%E5%8A%A1-%E4%B8%8B%E5%8D%95%E5%AE%9E%E7%8E%B0"},"#"),"1.6 \u79d2\u6740\u6e32\u67d3\u670d\u52a1-\u4e0b\u5355\u5b9e\u73b0"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103100219129-96d23b1d.png",alt:"image-20220103100219129"}),"image-20220103100219129"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"1\uff09ydles_service_seckill_api\u670d\u52a1\u5b9a\u4e49feign\u63a5\u53e3")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@FeignClient(name="seckill")\npublic interface SecKillOrderFeign {\n\n    /**\n     * \u79d2\u6740\u4e0b\u5355\n     * @param time \u5f53\u524d\u65f6\u95f4\u6bb5\n     * @param id \u79d2\u6740\u5546\u54c1id\n     * @return\n     */\n    @RequestMapping("/seckillorder/add")\n    public Result add(@RequestParam("time") String time, @RequestParam("id") Long id);\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"2\uff09ydles_web_seckill\u670d\u52a1\u5b9a\u4e49controller")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\n@RequestMapping("/wseckillorder")\npublic class SecKillOrderController {\n    @Autowired\n    private SecKillOrderFeign secKillOrderFeign;\n\n    @RequestMapping("/add")\n    public Result add(@RequestParam("time") String time, @RequestParam("id")Long id){\n        // System.out.println("\u8fdb\u5165\u79d2\u6740\u8ba2\u5355\u903b\u8f91\u4e86\uff01");\n\n        Result result = secKillOrderFeign.add(time, id);\n        return result;\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6d4b\u8bd5\uff1a")," \u91cd\u542f\u76f8\u5173\u670d\u52a1\uff0c\u767b\u9646\uff0c\u79d2\u6740 ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wseckillgoods/toIndex"},"http://localhost:8001/api/wseckillgoods/toIndexopen in new window")),(0,l.kt)("p",null,"\u67e5\u770b\u79d2\u6740\u5546\u54c1\u8868\u548c\u79d2\u6740\u8ba2\u5355\u8868\u6570\u636e\u53d8\u5316\u3002redis\u53d8\u5316\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGoAAAAxCAYAAAAyaDyjAAADQElEQVR4nO2cP27bMBTGPxbdc4jIKRqkB6ByAhsZOmVMN2mMM2Tsli2D6NEeM2bKUIgniHOAFCkKMndwTvA6yJFkWRLdIrbE9P0AAZYf+R6JT/xjPcKCiAhLnp+fsb+/D6Z7qlp86LAtzF/QoVAWKhSIdXct8AareET5wj8I9b+MhB71MxjziPKFVqGsCiGEWF4xNDRiMcDFAzAbCYhQwQIANOK83GvZMqv2UNm6YAiFgGh9hJv8tMS3CmHjvUYsQigVV3w29bMjrAKohLW2uDEJSUSUUhVDiQRFuSGlCCCZmKJIGhHyujX2qp80IkDSWpEVmvw44lf7sXKf1cVrZ0xCMm9HtZ+7papF84gKPuELZhiJEHUDIEffYSYT3IyD4rvhJRI5w51usJe5iyFGQEpzNBVpjLNJfCcSyeUw+xic4FRuUmf3tEx9Q0yJQHQDnAkIl2BrSHweuEvNHh8h8Yjfbz63bBbfF5qFsgpKA0CA8dwgkQ/4ZWrKDb8ierjAWVlFfY0LnOIkKOzX+dOtoUplo+9zzM0pbgeOHVaTH1d8ACg9CPbHLR5awvSWxnmRiNIIBCyv0mRtEpl9JxPKVoblXJ9flbXNJCTXbPVr3Vpdpx93/Ly9AMkoqqxR5bXRUCKL+/V+7o7qGiWI+F1fH+F3fZ7SQ6Gqv4myqxdvCDrkY9cNWCfbbU67bkbP6OGIYupgoTxBWGvJXYzpmpXt+cvLC/b29rpsD7OkqgVPfZ7AQnkCC+UJLJQnsFCewEJtCzvBcf4K7BgTu6Gt3hkLtR004sEYRymBiEDpEcbfJsX5kkZbC+UcyGKx2F3C5T2TRoRQlXJYhlQYkjIOW4lVLUzLmQnmjZnjqS5D7rRlsFDbYHCIcD4ujg3oa4znG9ha6GGa4x0QnOM+fYIYCcwAIFRQUQgMHLYWeERti+E02ywQge4P8DQ7wkGwga0BHlE7QMcj/FSmNhnaZivDI2orWEyOi2MEV4cG9+fBBrZmOM3RUzjN4SkslCewUJ7AQnkCC+UJYrFY8CkkD+DteU/h7bmnsFCewEJ5AgvlCSyUJ7BQ28J10kjHLX+gsuaMhdoOjpNGOoa4OoR5TR7SFEOHxz/LV5VGiZTmHAAAAABJRU5ErkJggg==",alt:"image-20220103101942966"}),"image-20220103101942966"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103101928814-908ea721.png",alt:"image-20220103101928814"}),"image-20220103101928814"),(0,l.kt)("h3",{id:"17\u79d2\u6740\u5546\u54c1\u771f\u5b9e\u6570\u91cf\u83b7\u53d6"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1-7%E7%A7%92%E6%9D%80%E5%95%86%E5%93%81%E7%9C%9F%E5%AE%9E%E6%95%B0%E9%87%8F%E8%8E%B7%E5%8F%96"},"#"),"1.7\u79d2\u6740\u5546\u54c1\u771f\u5b9e\u6570\u91cf\u83b7\u53d6"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103102444911-d2a2be49.png",alt:"image-20220103102444911"}),"image-20220103102444911"),(0,l.kt)("p",null,"1\u4ece\u79d2\u6740\u4efb\u52a1\u7c7b\u4e2d\u62ff\u51fa redis\u79d2\u6740\u5546\u54c1\u5e93\u5b58\u5934"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'//\u79d2\u6740\u5546\u54c1\u5e93\u5b58\u5934\npublic static final String SECKILL_GOODS_STOCK_COUNT_KEY="seckill_goods_stock_count_";\n')),(0,l.kt)("p",null,"2\u4fee\u6539\u83b7\u53d6\u6570\u636e\u7684\u4e1a\u52a1\u65b9\u6cd5 SecKillGoodsServiceImpl"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Service\npublic class SecKillGoodsServiceImpl implements SecKillGoodsService {\n\n    @Autowired\n    private RedisTemplate redisTemplate;\n\n    private static final String SECKILL_KEY = "seckill_goods_";\n\n    //\u79d2\u6740\u5546\u54c1\u5e93\u5b58\u5934\n    public static final String SECKILL_GOODS_STOCK_COUNT_KEY="seckill_goods_stock_count_";\n    /**\n     * \u67e5\u8be2\u79d2\u6740\u5546\u54c1\u5217\u8868\n     *\n     * @param time\n     * @return\n     */\n    @Override\n    public List<SeckillGoods> list(String time) {\n        List<SeckillGoods> list = redisTemplate.boundHashOps(SECKILL_KEY + time).values();\n\n        //\u66f4\u65b0\u5e93\u5b58\u6570\u636e\u7684\u6765\u6e90\n        for (SeckillGoods seckillGoods : list) {\n            String value = (String) redisTemplate.opsForValue().get(SECKILL_GOODS_STOCK_COUNT_KEY+seckillGoods.getId());\n            seckillGoods.setStockCount(Integer.parseInt(value));\n        }\n        return list;\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6d4b\u8bd5\uff1a")," \u91cd\u542f\u76f8\u5173\u670d\u52a1\uff0c\u767b\u9646\uff0c\u79d2\u6740 ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:8001/api/wseckillgoods/toIndex"},"http://localhost:8001/api/wseckillgoods/toIndexopen in new window")),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103102806192-aefb2901.png",alt:"image-20220103102806192"}),"image-20220103102806192"),(0,l.kt)("h2",{id:"2-\u9632\u6b62\u6076\u610f\u5237\u5355\u89e3\u51b3"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-%E9%98%B2%E6%AD%A2%E6%81%B6%E6%84%8F%E5%88%B7%E5%8D%95%E8%A7%A3%E5%86%B3"},"#"),"2 \u9632\u6b62\u6076\u610f\u5237\u5355\u89e3\u51b3"),(0,l.kt)("p",null," \u5728\u751f\u4ea7\u573a\u666f\u4e0b\uff0c\u5f88\u6709\u53ef\u80fd\u4f1a\u5b58\u5728\u67d0\u4e9b\u7528\u6237\u6076\u610f\u5237\u5355\u7684\u60c5\u51b5\u51fa\u73b0\u3002\u8fd9\u6837\u7684\u64cd\u4f5c\u5bf9\u4e8e\u7cfb\u7edf\u800c\u8a00\uff0c\u4f1a\u5bfc\u81f4\u4e1a\u52a1\u51fa\u9519\u3001\u810f\u6570\u636e\u3001\u540e\u7aef\u8bbf\u95ee\u538b\u529b\u5927\u7b49\u95ee\u9898\u7684\u51fa\u73b0\u3002"),(0,l.kt)("p",null," \u4e00\u822c\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u8bdd\uff0c\u9700\u8981\u524d\u7aef\u8fdb\u884c\u63a7\u5236\uff0c\u540c\u65f6\u540e\u7aef\u4e5f\u9700\u8981\u8fdb\u884c\u63a7\u5236\u3002\u540e\u7aef\u5b9e\u73b0\u53ef\u4ee5\u901a\u8fc7Redis incrde \u539f\u5b50\u6027\u9012\u589e\u6765\u8fdb\u884c\u89e3\u51b3\u3002"),(0,l.kt)("h3",{id:"21-\u66f4\u65b0\u79d2\u6740\u670d\u52a1\u4e0b\u5355"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-1-%E6%9B%B4%E6%96%B0%E7%A7%92%E6%9D%80%E6%9C%8D%E5%8A%A1%E4%B8%8B%E5%8D%95"},"#"),"2.1 \u66f4\u65b0\u79d2\u6740\u670d\u52a1\u4e0b\u5355"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103111001121-b3235ca9.png",alt:"image-20220103111001121"}),"image-20220103111001121"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"ydles_service_seckill\u670d\u52a1\u7684SecKillOrderServiceImpl\u7c7b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Override\npublic boolean add(Long id, String time, String username) {\n    //\u9632\u6b62\u7528\u6237\u6076\u610f\u5237\u5355\n    String result = this.preventRepeatCommit(username, id);\n    if ("fail".equals(result)){\n        return false;\n    }\n}\n')),(0,l.kt)("h3",{id:"22-\u9632\u91cd\u65b9\u6cd5\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2-2-%E9%98%B2%E9%87%8D%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"},"#"),"2.2 \u9632\u91cd\u65b9\u6cd5\u5b9e\u73b0"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n  * \u9632\u6b62\u7528\u6237\u6076\u610f\u5237\u5355\n  * @param username  \u7528\u6237\u540d\n  * @param id        \u79d2\u6740\u5546\u54c1id\n  * @return\n  */\nprivate String preventRepeatCommit(String username,Long id){\n    String redis_key = "seckill_user_"+username+"_id_"+id;\n\n    long count = redisTemplate.opsForValue().increment(redis_key, 1);\n    if (count == 1){\n        //\u4ee3\u8868\u5f53\u524d\u7528\u6237\u662f\u7b2c\u4e00\u6b21\u8bbf\u95ee.\n        //\u5bf9\u5f53\u524d\u7684key\u8bbe\u7f6e\u4e00\u4e2a\u4e94\u5206\u949f\u7684\u6709\u6548\u671f\n        redisTemplate.expire(redis_key,5, TimeUnit.MINUTES);\n        return "success";\n    }\n\n    if (count>1){\n        return "fail";\n    }\n\n    return "fail";\n}\n}\n')),(0,l.kt)("h2",{id:"3-\u9632\u6b62\u76f8\u540c\u5546\u54c1\u91cd\u590d\u79d2\u6740"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-%E9%98%B2%E6%AD%A2%E7%9B%B8%E5%90%8C%E5%95%86%E5%93%81%E9%87%8D%E5%A4%8D%E7%A7%92%E6%9D%80"},"#"),"3 \u9632\u6b62\u76f8\u540c\u5546\u54c1\u91cd\u590d\u79d2\u6740"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a\u4e00\u4e2auserID,\u53ea\u80fd\u4e70\u4e00\u4e2a\u79d2\u6740\u5546\u54c1\u3002"),(0,l.kt)("p",null,"\u89e3\u51b3\uff1a\u79d2\u6740\u8ba2\u5355\u8868\u6839\u636euserName\u548c\u79d2\u6740\u5546\u54c1Id\u63a7\u5236\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103112122408-25328d6b.png",alt:"image-20220103112122408"}),"image-20220103112122408"),(0,l.kt)("h3",{id:"31-\u4fee\u6539\u4e0b\u5355\u4e1a\u52a1\u5c42\u5b9e\u73b0"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-1-%E4%BF%AE%E6%94%B9%E4%B8%8B%E5%8D%95%E4%B8%9A%E5%8A%A1%E5%B1%82%E5%AE%9E%E7%8E%B0"},"#"),"3.1 \u4fee\u6539\u4e0b\u5355\u4e1a\u52a1\u5c42\u5b9e\u73b0"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"ydles_service_seckill\u670d\u52a1\u7684SecKillOrderServiceImpl\u7c7b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"//\u9632\u6b62\u91cd\u590d\u8d2d\u4e70\nSeckillOrder querySeckillOrder=seckillOrderMapper.getOrderInfoByUserNameAndGoodsId(username,id);\nif(querySeckillOrder!=null){\n    return false;\n}\n")),(0,l.kt)("h3",{id:"32-dao\u5c42\u65b0\u589e\u67e5\u8be2\u65b9\u6cd5"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3-2-dao%E5%B1%82%E6%96%B0%E5%A2%9E%E6%9F%A5%E8%AF%A2%E6%96%B9%E6%B3%95"},"#"),"3.2 dao\u5c42\u65b0\u589e\u67e5\u8be2\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public interface SeckillOrderMapper extends Mapper<SeckillOrder> {\n\n    /**\n     * \u67e5\u8be2\u79d2\u6740\u8ba2\u5355\u4fe1\u606f\n     * @param username\n     * @param id\n     * @return\n     */\n    @Select("select * from tb_seckill_order where user_id=#{username} and seckill_id=#{id}")\n    SeckillOrder getSecKillOrderByUserNameAndGoodsId(String username, Long id);\n}\n')),(0,l.kt)("h2",{id:"4-\u79d2\u6740\u4e0b\u5355\u63a5\u53e3\u9690\u85cf"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-%E7%A7%92%E6%9D%80%E4%B8%8B%E5%8D%95%E6%8E%A5%E5%8F%A3%E9%9A%90%E8%97%8F"},"#"),"4 \u79d2\u6740\u4e0b\u5355\u63a5\u53e3\u9690\u85cf"),(0,l.kt)("p",null,"\u80cc\u666f\uff1a\u5f53\u524d\u867d\u7136\u53ef\u4ee5\u786e\u4fdd\u7528\u6237\u53ea\u6709\u5728\u767b\u5f55\u7684\u60c5\u51b5\u4e0b\u624d\u53ef\u4ee5\u8fdb\u884c\u79d2\u6740\u4e0b\u5355\uff0c\u4f46\u662f\u65e0\u6cd5\u65b9\u6cd5\u6709\u4e00\u4e9b\u6076\u610f\u7684\u7528\u6237\u5728\u767b\u5f55\u4e86\u4e4b\u540e\uff0c\u731c\u6d4b\u79d2\u6740\u4e0b\u5355\u7684\u63a5\u53e3\u5730\u5740\u8fdb\u884c\u6076\u610f\u5237\u5355\u3002\u6240\u4ee5\u9700\u8981\u5bf9\u79d2\u6740\u63a5\u53e3\u5730\u5740\u8fdb\u884c\u9690\u85cf\u3002"),(0,l.kt)("p",null,"\u9700\u6c42\uff1a\u5728\u7528\u6237\u6bcf\u4e00\u6b21\u70b9\u51fb\u62a2\u8d2d\u7684\u65f6\u5019\uff0c\u90fd\u9996\u5148\u53bb\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6570\u5e76\u5b58\u5165redis\uff0c\u63a5\u7740\u7528\u6237\u643a\u5e26\u7740\u8fd9\u4e2a\u968f\u673a\u6570\u53bb\u8bbf\u95ee\u79d2\u6740\u4e0b\u5355\uff0c\u4e0b\u5355\u63a5\u53e3\u9996\u5148\u4f1a\u4eceredis\u4e2d\u83b7\u53d6\u8be5\u968f\u673a\u6570\u8fdb\u884c\u5339\u914d\uff0c\u5982\u679c\u5339\u914d\u6210\u529f\uff0c\u5219\u8fdb\u884c\u540e\u7eed\u4e0b\u5355\u64cd\u4f5c\uff0c\u5982\u679c\u5339\u914d\u4e0d\u6210\u529f\uff0c\u5219\u8ba4\u5b9a\u4e3a\u975e\u6cd5\u8bbf\u95ee\u3002"),(0,l.kt)("p",null,"\u8fd9\u6837\u53ef\u6709\u9632\u6b62\u9ed1\u5ba2\u6076\u610f\u5927\u91cf\u8c03\u53d6\u540e\u7aef\u7684\u79d2\u6740\u4e0b\u5355\u63a5\u53e3\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103114529621-70063599.png",alt:"image-20220103114529621"}),"image-20220103114529621"),(0,l.kt)("h3",{id:"41-\u5c06\u968f\u673a\u6570\u5de5\u5177\u7c7b\u653e\u5165common\u5de5\u7a0b\u4e2d"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-1-%E5%B0%86%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%B7%A5%E5%85%B7%E7%B1%BB%E6%94%BE%E5%85%A5common%E5%B7%A5%E7%A8%8B%E4%B8%AD"},"#"),"4.1 \u5c06\u968f\u673a\u6570\u5de5\u5177\u7c7b\u653e\u5165common\u5de5\u7a0b\u4e2d"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103114547263-8affaa09.png",alt:"image-20220103114547263"}),"image-20220103114547263"),(0,l.kt)("p",null,"RandomUtil.java\u653e\u5165util\u5305\u4e0b"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103114754530-a5482486.png",alt:"image-20220103114754530"}),"image-20220103114754530"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class RandomUtil {\n    public static String getRandomString() {\n        int length = 15;\n        String base = "abcdefghijklmnopqrstuvwxyz0123456789";\n        Random random = new Random();\n        StringBuffer sb = new StringBuffer();\n        for (int i = 0; i < length; i++) {\n            int number = random.nextInt(base.length());\n            sb.append(base.charAt(number));\n        }\n        return sb.toString();\n    }\n\n    public static void main(String[] args) {\n        String randomString = RandomUtil.getRandomString();\n        System.out.println(randomString);\n    }\n}\n')),(0,l.kt)("h3",{id:"42-\u79d2\u6740\u6e32\u67d3\u670d\u52a1\u5b9a\u4e49\u968f\u673a\u6570\u63a5\u53e3"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-2-%E7%A7%92%E6%9D%80%E6%B8%B2%E6%9F%93%E6%9C%8D%E5%8A%A1%E5%AE%9A%E4%B9%89%E9%9A%8F%E6%9C%BA%E6%95%B0%E6%8E%A5%E5%8F%A3"},"#"),"4.2 \u79d2\u6740\u6e32\u67d3\u670d\u52a1\u5b9a\u4e49\u968f\u673a\u6570\u63a5\u53e3"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"1ydles_web_seckill\u670d\u52a1 util\u5305\u4e0b\u653e\u5165\u8d44\u6599\u4e2d\u7684CookieUtil.java\u5de5\u5177\u7c7b")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"2ydles_web_seckill\u670d\u52a1WSecKillOrderController\u7c7b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@Autowired\nRedisTemplate redisTemplate;\n/**\n  * \u751f\u6210\u968f\u673a\u6570\u4f5c\u4e3a\u63a5\u53e3\u4ee4\u724c, \u6709\u6548\u671f10\u79d2\n  * @return\n  */\n@GetMapping("/getToken")\n@ResponseBody\npublic String getToken() {\n    //\u83b7\u53d6\u968f\u673a\u5b57\u7b26\u4e32\n    String randomString = RandomUtil.getRandomString();\n    //\u83b7\u53d6jti\n    String cookieValue = this.readCookie();\n    //\u77ed\u4ee4\u724c\u4f5c\u4e3akey, \u968f\u673a\u5b57\u7b26\u4e32\u4f5c\u4e3avalue\n    redisTemplate.opsForValue().set("randomcode_" + cookieValue, randomString, 10, TimeUnit.SECONDS);\n    //\u8fd4\u56de\u968f\u673a\u5b57\u7b26\u4e32\n    return randomString;\n}\n\n/**\n     * \u8bfb\u53d6cookie\u83b7\u53d6jti\u77ed\u4ee4\u724c\n     *\n     * @return\n     */\nprivate String readCookie() {\n    HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();\n    String jti = CookieUtil.readCookie(request, "uid").get("uid");\n    return jti;\n}\n')),(0,l.kt)("h3",{id:"43-js\u4fee\u6539"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-3-js%E4%BF%AE%E6%94%B9"},"#"),"4.3 js\u4fee\u6539"),(0,l.kt)("p",null,"\u4fee\u6539js\u4e0b\u5355\u65b9\u6cd5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},'//\u79d2\u6740\u4e0b\u5355\nadd:function (id) {\n    axios.get("/api/wseckillorder/getToken").then(function (response) {\n        var random =response.data;\n        axios.get("/api/wseckillorder/add?time="+moment(app.dateMenus[0]).format("YYYYMMDDHH")+"&id="+id+"&random="+random).then(function (response) {\n            if (response.data.flag){\n                alert("\u62a2\u5355\u6210\u529f,\u5373\u5c06\u8fdb\u5165\u652f\u4ed8");\n            } else{\n                alert("\u62a2\u5355\u5931\u8d25");\n            }\n        })\n    })\n}\n')),(0,l.kt)("h3",{id:"44-\u79d2\u6740\u6e32\u67d3\u670d\u52a1\u66f4\u6539"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4-4-%E7%A7%92%E6%9D%80%E6%B8%B2%E6%9F%93%E6%9C%8D%E5%8A%A1%E6%9B%B4%E6%94%B9"},"#"),"4.4 \u79d2\u6740\u6e32\u67d3\u670d\u52a1\u66f4\u6539"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103153812440-ff015957.png",alt:"image-20220103153812440"}),"image-20220103153812440"),(0,l.kt)("p",null,"\u4fee\u6539\u79d2\u6740\u6e32\u67d3\u670d\u52a1\u4e0b\u5355\u63a5\u53e3"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\n@RequestMapping("/wseckillorder")\npublic class WSecKillOrderController {\n\n    @Autowired\n    private SecKillOrderFeign secKillOrderFeign;\n\n    @Autowired\n    private RedisTemplate redisTemplate;\n\n    /**\n     * \u79d2\u6740\u4e0b\u5355\n     * @param time\n     * @param id\n     * @return\n     */\n    @RequestMapping("/add")\n    public Result add(@RequestParam("time") String time, @RequestParam("id") Long id, String random) {\n\n        String cookieValue = this.readCookie();\n        String redisRandomCode = (String) redisTemplate.opsForValue().get("randomcode_" + cookieValue);\n        if (StringUtils.isEmpty(redisRandomCode)) {\n            return new Result(false, StatusCode.ERROR, "\u4e0b\u5355\u5931\u8d25");\n        }\n        if (!random.equals(redisRandomCode)) {\n            return new Result(false, StatusCode.ERROR, "\u4e0b\u5355\u5931\u8d25");\n        }\n\n        Result result = secKillOrderFeign.add(time, id);\n        return result;\n    }\n}\n')),(0,l.kt)("h2",{id:"5\u79d2\u6740\u4e0b\u5355\u63a5\u53e3\u9650\u6d41-\u96be\u70b9-\u4e0d\u662f\u91cd\u70b9"},(0,l.kt)("a",{parentName:"h2",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_5%E7%A7%92%E6%9D%80%E4%B8%8B%E5%8D%95%E6%8E%A5%E5%8F%A3%E9%99%90%E6%B5%81-%E9%9A%BE%E7%82%B9-%E4%B8%8D%E6%98%AF%E9%87%8D%E7%82%B9"},"#"),"5\u79d2\u6740\u4e0b\u5355\u63a5\u53e3\u9650\u6d41-\u96be\u70b9-\u4e0d\u662f\u91cd\u70b9"),(0,l.kt)("p",null,"\u56e0\u4e3a\u79d2\u6740\u7684\u7279\u6b8a\u4e1a\u52a1\u573a\u666f\uff0c\u751f\u4ea7\u573a\u666f\u4e0b\uff0c\u8fd8\u6709\u53ef\u80fd\u8981\u5bf9\u79d2\u6740\u4e0b\u5355\u63a5\u53e3\u8fdb\u884c\u8bbf\u95ee\u6d41\u91cf\u63a7\u5236\uff0c\u9632\u6b62\u8fc7\u591a\u7684\u8bf7\u6c42\u8fdb\u5165\u5230\u540e\u7aef\u670d\u52a1\u5668\u3002\u5bf9\u4e8e\u9650\u6d41\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u6211\u4eec\u4e4b\u524d\u5df2\u7ecf\u63a5\u89e6\u8fc7\u901a\u8fc7",(0,l.kt)("strong",{parentName:"p"},"nginx\u9650\u6d41"),"\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u7f51\u5173\u9650\u6d41"),"\u3002\u4f46\u662f\u4ed6\u4eec\u90fd\u662f\u5bf9\u4e00\u4e2a\u5927\u7684\u670d\u52a1\u8fdb\u884c\u8bbf\u95ee\u9650\u6d41\uff0c\u5982\u679c\u73b0\u5728\u53ea\u662f\u8981\u5bf9\u67d0\u4e00\u4e2a\u670d\u52a1\u4e2d\u7684",(0,l.kt)("strong",{parentName:"p"},"\u63a5\u53e3\u65b9\u6cd5\u8fdb\u884c\u9650\u6d41"),"\u5462\uff1f\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528google\u63d0\u4f9b\u7684",(0,l.kt)("strong",{parentName:"p"},"guava\u5de5\u5177\u5305"),"\u4e2d\u7684",(0,l.kt)("strong",{parentName:"p"},"RateLimiter"),"\u8fdb\u884c\u5b9e\u73b0\uff0c\u5176\u5185\u90e8\u662f\u57fa\u4e8e\u4ee4\u724c\u6876\u7b97\u6cd5\u8fdb\u884c\u9650\u6d41\u8ba1\u7b97\u3002"),(0,l.kt)("p",null,"1\u9650\u6d41 \u6280\u672f\uff1aguava"),(0,l.kt)("p",null,"2\u81ea\u5b9a\u4e49\u6ce8\u89e3\uff1a@interface \u57fa\u7840\u7684\u5143\u6ce8\u89e3\u4fe1\u606f"),(0,l.kt)("p",null,"3aop \u6ce8\u89e3\u65b9\u5f0f\u9762\u5411\u5207\u9762\u7f16\u7a0b\uff1a\u524d\u7f6e\u589e\u5f3a\u3001\u540e\u7f6e\u589e\u5f3a\u3001\u73af\u7ed5\u589e\u5f3a\u3001\u6700\u7ec8\u589e\u5f3a"),(0,l.kt)("p",null,"4springmvc \u81ea\u5e26 HttpServletResponse response"),(0,l.kt)("p",null,"5\u6d41 \u9996\u5148\u5b9a\u4e49\u51fa\u6765\uff0c\u6700\u540e\u5173\u6d41"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"ydles_web_seckill\u670d\u52a1"),"\uff1a"),(0,l.kt)("h3",{id:"1\u6dfb\u52a0\u4f9d\u8d56"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_1%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"},"#"),"1\u6dfb\u52a0\u4f9d\u8d56"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>com.google.guava</groupId>\n    <artifactId>guava</artifactId>\n    <version>28.0-jre</version>\n</dependency>\n")),(0,l.kt)("h3",{id:"2\u81ea\u5b9a\u4e49\u9650\u6d41\u6ce8\u89e3"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_2%E8%87%AA%E5%AE%9A%E4%B9%89%E9%99%90%E6%B5%81%E6%B3%A8%E8%A7%A3"},"#"),"2\u81ea\u5b9a\u4e49\u9650\u6d41\u6ce8\u89e3"),(0,l.kt)("p",null,"com.ydles.seckill.web.aspect"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Inherited\n@Documented\n@Target({ElementType.FIELD,ElementType.METHOD,ElementType.TYPE})\n@Retention(RetentionPolicy.RUNTIME) //\u4e0d\u4ec5\u4fdd\u5b58\u5230class\u6587\u4ef6\u4e2d,\u5e76\u4e14jvm\u52a0\u8f7dclass\u4e4b\u540e,\u8be5\u6ce8\u89e3\u4ecd\u7136\u5b58\u5728\npublic @interface AccessLimit {\n}\n")),(0,l.kt)("h3",{id:"3\u81ea\u5b9a\u4e49\u5207\u9762\u7c7b"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_3%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%87%E9%9D%A2%E7%B1%BB"},"#"),"3\u81ea\u5b9a\u4e49\u5207\u9762\u7c7b"),(0,l.kt)("p",null,"com.ydles.seckill.web.aspect\u5305\u4e0b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201cIT\u674e\u54e5\u4ea4\u670b\u53cb\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@Component\n@Scope\n@Aspect //\u6807\u660e\u5207\u9762\u7c7b\npublic class AccessLimitAop {\n    @Autowired\n    private HttpServletResponse response;\n    //\u8bbe\u7f6e\u4ee4\u724c\u7684\u751f\u6210\u901f\u7387\n    private RateLimiter rateLimiter = RateLimiter.create(2.0); //\u6bcf\u79d2\u751f\u6210\u4e24\u4e2a\u4ee4\u724c\u5b58\u5165\u6876\u4e2d\n\n    @Pointcut("@annotation(com.ydles.seckill.web.aspect.AccessLimit)")\n    public void limit(){\n    }\n\n    @Around("limit()")\n    public Object around(ProceedingJoinPoint proceedingJoinPoint){\n        //\u9650\u6d41\u903b\u8f91\n        //\u62ff\u4ee4\u724c\n        boolean result = rateLimiter.tryAcquire();\n        Object object = null;\n        if(result){\n            //\u62ff\u5230\u4ee4\u724c\u4e86\n            try {\n                //\u5207\u9762\u5f80\u540e\u8d70\n                object = proceedingJoinPoint.proceed();\n            } catch (Throwable throwable) {\n                throwable.printStackTrace();\n            }\n        }else {\n            //\u62ff\u4e0d\u5230\u4ee4\u724c\n            Result<Object> objectResult = new Result<>(false, StatusCode.ACCESSLIMIT, "\u9650\u6d41\u4e86\uff0c\u8bf7\u552e\u540e\u518d\u8bd5");\n            String msg = JSON.toJSONString(objectResult);\n            //\u5c06\u4fe1\u606f\u5199\u56de\u5230\u7528\u6237\u7684\u6d4f\u89c8\u5668\n            writeMsg(response,msg);\n        }\n        return object;\n    }\n\n    //\u7ed9\u7528\u6237\u5199\u56de\u6570\u636e\n    public void  writeMsg(HttpServletResponse response,String msg){\n        ServletOutputStream outputStream=null;\n        try {\n            response.setContentType("application/json;charset=utf-8");\n            outputStream = response.getOutputStream();\n            outputStream.write(msg.getBytes("utf-8"));\n        } catch (IOException e) {\n            e.printStackTrace();\n        }finally {\n            try {\n                outputStream.close();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n')),(0,l.kt)("h3",{id:"4\u4f7f\u7528\u81ea\u5b9a\u4e49\u9650\u6d41\u6ce8\u89e3"},(0,l.kt)("a",{parentName:"h3",href:"https://www.ydlclass.com/doc21xnv/java/fifth/2%E3%80%81%E4%BA%8C%E5%A5%A2%E4%BA%A4%E6%98%93/03/#_4%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E9%99%90%E6%B5%81%E6%B3%A8%E8%A7%A3"},"#"),"4\u4f7f\u7528\u81ea\u5b9a\u4e49\u9650\u6d41\u6ce8\u89e3"),(0,l.kt)("p",null,"@AccessLimit\u653e\u5728\u4e0b\u5355\u65b9\u6cd5\u4e0a\u5373\u53ef"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103165242789-9ed396eb.png",alt:"image-20220103165242789"}),"image-20220103165242789"),(0,l.kt)("p",null,"\u603b\u7ed3\uff1a"),(0,l.kt)("p",null,"1\u79d2\u6740\u540e\u53f0\u5f02\u6b65\u4e0b\u5355"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103165527365-ac106a3b.png",alt:"image-20220103165527365"}),"image-20220103165527365"),(0,l.kt)("p",null,"mq \u4fdd\u8bc1\u6d88\u606f\u4e0d\u4e22"),(0,l.kt)("p",null," 1\u4ea4\u6362\u673a \u961f\u5217 \u6d88\u606f \u6301\u4e45\u5316"),(0,l.kt)("p",null," 2\u751f\u4ea7\u8005\uff1acomfirm\u673a\u5236"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103165641227-970bbdbf.png",alt:"image-20220103165641227"}),"image-20220103165641227"),(0,l.kt)("p",null," 3\u6d88\u8d39\u8005\uff1a\u624b\u52a8ack"),(0,l.kt)("p",null,"2\u9632\u6b62\u6076\u610f\u5237\u5355"),(0,l.kt)("p",null,"redis\uff1akey username_id 5min"),(0,l.kt)("p",null,"3\u9632\u6b62\u76f8\u540c\u5546\u54c1\u79d2\u6740"),(0,l.kt)("p",null,"\u6570\u636e\u5e93order\u67e5\u8be2 \u62d2\u7edd"),(0,l.kt)("p",null,"4\u79d2\u6740\u63a5\u53e3\u9690\u85cf"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220103170003264-851d4508.png",alt:"image-20220103170003264"}),"image-20220103170003264"),(0,l.kt)("p",null,"5\u79d2\u6740 \u63a5\u53e3\u9650\u6d41"),(0,l.kt)("p",null,"\u81ea\u5b9a\u4e49\u6ce8\u89e3 aop"))}c.isMDXComponent=!0}}]);