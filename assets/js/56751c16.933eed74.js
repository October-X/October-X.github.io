"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4406],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>m});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=a.createContext({}),u=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=u(e.components);return a.createElement(o.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},g=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(t),g=r,m=p["".concat(o,".").concat(g)]||p[g]||d[g]||l;return t?a.createElement(m,i(i({ref:n},c),{},{components:t})):a.createElement(m,i({ref:n},c))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=g;var s={};for(var o in n)hasOwnProperty.call(n,o)&&(s[o]=n[o]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var u=2;u<l;u++)i[u]=t[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}g.displayName="MDXCreateElement"},5074:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>u});var a=t(7462),r=(t(7294),t(3905));const l={},i="2.2 ELK\u8fdb\u9636",s={unversionedId:"Java/\u4e2d\u95f4\u4ef6/2.2 ELK\u8fdb\u9636",id:"Java/\u4e2d\u95f4\u4ef6/2.2 ELK\u8fdb\u9636",title:"2.2 ELK\u8fdb\u9636",description:"\u7b2c\u5341\u4e00\u7ae0 \u7d22\u5f15Index\u5165\u95e8",source:"@site/docs/Java/7.\u4e2d\u95f4\u4ef6/2.2 ELK\u8fdb\u9636.md",sourceDirName:"Java/7.\u4e2d\u95f4\u4ef6",slug:"/Java/\u4e2d\u95f4\u4ef6/2.2 ELK\u8fdb\u9636",permalink:"/docs/Java/\u4e2d\u95f4\u4ef6/2.2 ELK\u8fdb\u9636",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Java/7.\u4e2d\u95f4\u4ef6/2.2 ELK\u8fdb\u9636.md",tags:[],version:"current",frontMatter:{},sidebar:"Java",previous:{title:"2.1 ELK\u5165\u95e8",permalink:"/docs/Java/\u4e2d\u95f4\u4ef6/2.1 ELK\u5165\u95e8"},next:{title:"3.1 RabbitMQ\u5165\u95e8",permalink:"/docs/Java/\u4e2d\u95f4\u4ef6/3.1 RabbitMQ\u5165\u95e8"}},o={},u=[{value:"\u7b2c\u5341\u4e00\u7ae0 \u7d22\u5f15Index\u5165\u95e8",id:"\u7b2c\u5341\u4e00\u7ae0-\u7d22\u5f15index\u5165\u95e8",level:2},{value:"\u4e00\u3001\u7d22\u5f15\u7ba1\u7406",id:"\u4e00\u7d22\u5f15\u7ba1\u7406",level:3},{value:"1\u3001\u4e3a\u4ec0\u4e48\u6211\u4eec\u8981\u624b\u52a8\u521b\u5efa\u7d22\u5f15",id:"1\u4e3a\u4ec0\u4e48\u6211\u4eec\u8981\u624b\u52a8\u521b\u5efa\u7d22\u5f15",level:4},{value:"2\u3001\u7d22\u5f15\u7ba1\u7406",id:"2\u7d22\u5f15\u7ba1\u7406",level:4},{value:"\uff081\uff09\u521b\u5efa\u7d22\u5f15",id:"1\u521b\u5efa\u7d22\u5f15",level:5},{value:"\uff082\uff09\u67e5\u8be2\u7d22\u5f15",id:"2\u67e5\u8be2\u7d22\u5f15",level:5},{value:"\uff083\uff09\u4fee\u6539\u7d22\u5f15",id:"3\u4fee\u6539\u7d22\u5f15",level:5},{value:"\uff084\uff09\u5220\u9664\u7d22\u5f15",id:"4\u5220\u9664\u7d22\u5f15",level:5},{value:"\u4e8c\u3001\u5b9a\u5236\u5206\u8bcd\u5668",id:"\u4e8c\u5b9a\u5236\u5206\u8bcd\u5668",level:3},{value:"1\u3001\u9ed8\u8ba4\u7684\u5206\u8bcd\u5668",id:"1\u9ed8\u8ba4\u7684\u5206\u8bcd\u5668",level:4},{value:"2\u3001\u4fee\u6539\u5206\u8bcd\u5668\u7684\u8bbe\u7f6e",id:"2\u4fee\u6539\u5206\u8bcd\u5668\u7684\u8bbe\u7f6e",level:4},{value:"3\u3001\u5b9a\u5236\u5316\u81ea\u5df1\u7684\u5206\u8bcd\u5668",id:"3\u5b9a\u5236\u5316\u81ea\u5df1\u7684\u5206\u8bcd\u5668",level:4},{value:"\u4e09\u3001type\u5e95\u5c42\u7ed3\u6784\u53ca\u5f03\u7528\u539f\u56e0",id:"\u4e09type\u5e95\u5c42\u7ed3\u6784\u53ca\u5f03\u7528\u539f\u56e0",level:3},{value:"1\u3001type\u662f\u4ec0\u4e48",id:"1type\u662f\u4ec0\u4e48",level:4},{value:"2\u3001es\u4e2d\u4e0d\u540ctype\u5b58\u50a8\u673a\u5236",id:"2es\u4e2d\u4e0d\u540ctype\u5b58\u50a8\u673a\u5236",level:4},{value:"3\u3001type\u5f03\u7528",id:"3type\u5f03\u7528",level:4},{value:"\u56db\u3001\u5b9a\u5236dynamic mapping",id:"\u56db\u5b9a\u5236dynamic-mapping",level:3},{value:"1\u3001\u5b9a\u5236dynamic\u7b56\u7565",id:"1\u5b9a\u5236dynamic\u7b56\u7565",level:4},{value:"2\u3001\u81ea\u5b9a\u4e49 dynamic mapping\u7b56\u7565",id:"2\u81ea\u5b9a\u4e49-dynamic-mapping\u7b56\u7565",level:4},{value:"date_detection \u65e5\u671f\u63a2\u6d4b",id:"date_detection-\u65e5\u671f\u63a2\u6d4b",level:4},{value:"\u81ea\u5b9a\u4e49\u65e5\u671f\u683c\u5f0f",id:"\u81ea\u5b9a\u4e49\u65e5\u671f\u683c\u5f0f",level:4},{value:"numeric_detection \u6570\u5b57\u63a2\u6d4b",id:"numeric_detection-\u6570\u5b57\u63a2\u6d4b",level:4},{value:"3\u3001\u5b9a\u5236\u81ea\u5df1\u7684dynamic mapping template",id:"3\u5b9a\u5236\u81ea\u5df1\u7684dynamic-mapping-template",level:4},{value:"\u6a21\u677f\u5199\u6cd5",id:"\u6a21\u677f\u5199\u6cd5",level:4},{value:"\u573a\u666f",id:"\u573a\u666f",level:4},{value:"\u4e94\u3001\u96f6\u505c\u673a\u91cd\u5efa\u7d22\u5f15",id:"\u4e94\u96f6\u505c\u673a\u91cd\u5efa\u7d22\u5f15",level:3},{value:"1\u3001\u96f6\u505c\u673a\u91cd\u5efa\u7d22\u5f15",id:"1\u96f6\u505c\u673a\u91cd\u5efa\u7d22\u5f15",level:4},{value:"2\u3001\u751f\u4ea7\u5b9e\u8df5\uff1a\u57fa\u4e8ealias\u5bf9client\u900f\u660e\u5207\u6362index",id:"2\u751f\u4ea7\u5b9e\u8df5\u57fa\u4e8ealias\u5bf9client\u900f\u660e\u5207\u6362index",level:4},{value:"\u7b2c\u5341\u4e8c\u7ae0 \u4e2d\u6587\u5206\u8bcd\u5668 IK\u5206\u8bcd\u5668",id:"\u7b2c\u5341\u4e8c\u7ae0-\u4e2d\u6587\u5206\u8bcd\u5668-ik\u5206\u8bcd\u5668",level:2},{value:"\u4e00\u3001Ik\u5206\u8bcd\u5668\u5b89\u88c5\u4f7f\u7528",id:"\u4e00ik\u5206\u8bcd\u5668\u5b89\u88c5\u4f7f\u7528",level:3},{value:"1\u3001\u4e2d\u6587\u5206\u8bcd\u5668",id:"1\u4e2d\u6587\u5206\u8bcd\u5668",level:4},{value:"2\u3001\u5b89\u88c5",id:"2\u5b89\u88c5",level:4},{value:"3\u3001ik\u5206\u8bcd\u5668\u57fa\u7840\u77e5\u8bc6",id:"3ik\u5206\u8bcd\u5668\u57fa\u7840\u77e5\u8bc6",level:4},{value:"4\u3001ik\u5206\u8bcd\u5668\u7684\u4f7f\u7528",id:"4ik\u5206\u8bcd\u5668\u7684\u4f7f\u7528",level:4},{value:"\u4e8c\u3001 ik\u914d\u7f6e\u6587\u4ef6",id:"\u4e8c-ik\u914d\u7f6e\u6587\u4ef6",level:3},{value:"1\u3001 ik\u914d\u7f6e\u6587\u4ef6",id:"1-ik\u914d\u7f6e\u6587\u4ef6",level:4},{value:"2\u3001\u81ea\u5b9a\u4e49\u8bcd\u5e93",id:"2\u81ea\u5b9a\u4e49\u8bcd\u5e93",level:4},{value:"\u4e09\u3001\u4f7f\u7528mysql\u70ed\u66f4\u65b0 \u8bcd\u5e93",id:"\u4e09\u4f7f\u7528mysql\u70ed\u66f4\u65b0-\u8bcd\u5e93",level:3},{value:"1\u3001\u70ed\u66f4\u65b0",id:"1\u70ed\u66f4\u65b0",level:4},{value:"2\u3001\u6b65\u9aa4",id:"2\u6b65\u9aa4",level:4},{value:"\u7b2c\u5341\u4e09\u7ae0 java api \u5b9e\u73b0\u7d22\u5f15\u7ba1\u7406",id:"\u7b2c\u5341\u4e09\u7ae0-java-api-\u5b9e\u73b0\u7d22\u5f15\u7ba1\u7406",level:2},{value:"\u7b2c\u5341\u56db\u7ae0 search\u641c\u7d22\u5165\u95e8",id:"\u7b2c\u5341\u56db\u7ae0-search\u641c\u7d22\u5165\u95e8",level:2},{value:"\u4e00\u3001\u641c\u7d22\u8bed\u6cd5\u5165\u95e8",id:"\u4e00\u641c\u7d22\u8bed\u6cd5\u5165\u95e8",level:3},{value:"1\u3001query string search",id:"1query-string-search",level:4},{value:"2\u3001\u4f20\u53c2",id:"2\u4f20\u53c2",level:4},{value:"3\u3001\u56fe\u89e3timeout",id:"3\u56fe\u89e3timeout",level:4},{value:"\u4e8c\u3001multi-index \u591a\u7d22\u5f15\u641c\u7d22",id:"\u4e8cmulti-index-\u591a\u7d22\u5f15\u641c\u7d22",level:3},{value:"1\u3001multi-index\u641c\u7d22\u6a21\u5f0f",id:"1multi-index\u641c\u7d22\u6a21\u5f0f",level:4},{value:"2\u3001\u521d\u6b65\u56fe\u89e3\u4e00\u4e0b\u7b80\u5355\u7684\u641c\u7d22\u539f\u7406",id:"2\u521d\u6b65\u56fe\u89e3\u4e00\u4e0b\u7b80\u5355\u7684\u641c\u7d22\u539f\u7406",level:4},{value:"\u4e09\u3001\u5206\u9875\u641c\u7d22",id:"\u4e09\u5206\u9875\u641c\u7d22",level:3},{value:"1\u3001\u5206\u9875\u641c\u7d22\u7684\u8bed\u6cd5",id:"1\u5206\u9875\u641c\u7d22\u7684\u8bed\u6cd5",level:4},{value:"2\u3001deep paging",id:"2deep-paging",level:4},{value:"\u4ec0\u4e48\u662fdeep paging",id:"\u4ec0\u4e48\u662fdeep-paging",level:5},{value:"deep paging \u6027\u80fd\u95ee\u9898",id:"deep-paging-\u6027\u80fd\u95ee\u9898",level:5},{value:"\u56db\u3001 query string\u57fa\u7840\u8bed\u6cd5",id:"\u56db-query-string\u57fa\u7840\u8bed\u6cd5",level:3},{value:"1\u3001query string\u57fa\u7840\u8bed\u6cd5",id:"1query-string\u57fa\u7840\u8bed\u6cd5",level:4},{value:"2\u3001_all metadata\u7684\u539f\u7406\u548c\u4f5c\u7528",id:"2_all-metadata\u7684\u539f\u7406\u548c\u4f5c\u7528",level:4},{value:"\u4e94\u3001query DSL\u5165\u95e8",id:"\u4e94query-dsl\u5165\u95e8",level:3},{value:"1\u3001DSL",id:"1dsl",level:4},{value:"2\u3001 Query DSL\u8bed\u6cd5",id:"2-query-dsl\u8bed\u6cd5",level:4},{value:"3\u3001\u7ec4\u5408\u591a\u4e2a\u641c\u7d22\u6761\u4ef6",id:"3\u7ec4\u5408\u591a\u4e2a\u641c\u7d22\u6761\u4ef6",level:4},{value:"\u516d\u3001full-text search \u5168\u6587\u68c0\u7d22",id:"\u516dfull-text-search-\u5168\u6587\u68c0\u7d22",level:3},{value:"1\u3001\u5168\u6587\u68c0\u7d22",id:"1\u5168\u6587\u68c0\u7d22",level:4},{value:"2\u3001_score\u521d\u63a2",id:"2_score\u521d\u63a2",level:4},{value:"\u4e03\u3001DSL \u8bed\u6cd5\u7ec3\u4e60",id:"\u4e03dsl-\u8bed\u6cd5\u7ec3\u4e60",level:3},{value:"1\u3001match_all",id:"1match_all",level:4},{value:"2\u3001match",id:"2match",level:4},{value:"3\u3001multi_match",id:"3multi_match",level:4},{value:"4\u3001range query \u8303\u56f4\u67e5\u8be2",id:"4range-query-\u8303\u56f4\u67e5\u8be2",level:4},{value:"5\u3001term query",id:"5term-query",level:4},{value:"6\u3001terms query",id:"6terms-query",level:4},{value:"7\u3001exist query \u67e5\u8be2\u6709\u67d0\u4e9b\u5b57\u6bb5\u503c\u7684\u6587\u6863",id:"7exist-query-\u67e5\u8be2\u6709\u67d0\u4e9b\u5b57\u6bb5\u503c\u7684\u6587\u6863",level:4},{value:"8\u3001Fuzzy query",id:"8fuzzy-query",level:4},{value:"9\u3001IDs",id:"9ids",level:4},{value:"10\u3001prefix \u524d\u7f00\u67e5\u8be2",id:"10prefix-\u524d\u7f00\u67e5\u8be2",level:4},{value:"11\u3001regexp query \u6b63\u5219\u67e5\u8be2",id:"11regexp-query-\u6b63\u5219\u67e5\u8be2",level:4},{value:"\u516b\u3001 Filter",id:"\u516b-filter",level:3},{value:"1\u3001 filter\u4e0equery\u793a\u4f8b",id:"1-filter\u4e0equery\u793a\u4f8b",level:4},{value:"2\u3001filter\u4e0equery\u5bf9\u6bd4",id:"2filter\u4e0equery\u5bf9\u6bd4",level:4},{value:"3\u3001filter\u4e0equery\u6027\u80fd",id:"3filter\u4e0equery\u6027\u80fd",level:4},{value:"\u4e5d\u3001\u5b9a\u4f4d\u9519\u8bef\u8bed\u6cd5",id:"\u4e5d\u5b9a\u4f4d\u9519\u8bef\u8bed\u6cd5",level:3},{value:"\u5341\u3001\u5b9a\u5236\u6392\u5e8f\u89c4\u5219",id:"\u5341\u5b9a\u5236\u6392\u5e8f\u89c4\u5219",level:3},{value:"1\u3001\u9ed8\u8ba4\u6392\u5e8f\u89c4\u5219",id:"1\u9ed8\u8ba4\u6392\u5e8f\u89c4\u5219",level:4},{value:"2\u3001\u5b9a\u5236\u6392\u5e8f\u89c4\u5219",id:"2\u5b9a\u5236\u6392\u5e8f\u89c4\u5219",level:4},{value:"\u5341\u4e00\u3001 Text\u5b57\u6bb5\u6392\u5e8f\u95ee\u9898",id:"\u5341\u4e00-text\u5b57\u6bb5\u6392\u5e8f\u95ee\u9898",level:3},{value:"\u5341\u4e8c\u3001Scroll\u5206\u6279\u67e5\u8be2",id:"\u5341\u4e8cscroll\u5206\u6279\u67e5\u8be2",level:3},{value:"\u7b2c\u5341\u4e94\u7ae0 java api\u5b9e\u73b0\u641c\u7d22",id:"\u7b2c\u5341\u4e94\u7ae0-java-api\u5b9e\u73b0\u641c\u7d22",level:2},{value:"\u7b2c\u5341\u516d\u7ae0 \u8bc4\u5206\u673a\u5236\u8be6\u89e3",id:"\u7b2c\u5341\u516d\u7ae0-\u8bc4\u5206\u673a\u5236\u8be6\u89e3",level:2},{value:"\u4e00\u3001\u8bc4\u5206\u673a\u5236 TFIDF",id:"\u4e00\u8bc4\u5206\u673a\u5236-tfidf",level:3},{value:"1\u3001\u7b97\u6cd5\u4ecb\u7ecd",id:"1\u7b97\u6cd5\u4ecb\u7ecd",level:4},{value:"2\u3001_score\u662f\u5982\u4f55\u88ab\u8ba1\u7b97\u51fa\u6765\u7684",id:"2_score\u662f\u5982\u4f55\u88ab\u8ba1\u7b97\u51fa\u6765\u7684",level:4},{value:"3\u3001\u5206\u6790\u4e00\u4e2adocument\u662f\u5982\u4f55\u88ab\u5339\u914d\u4e0a\u7684",id:"3\u5206\u6790\u4e00\u4e2adocument\u662f\u5982\u4f55\u88ab\u5339\u914d\u4e0a\u7684",level:4},{value:"\u4e8c\u3001Doc value",id:"\u4e8cdoc-value",level:3},{value:"\u4e09\u3001query phase",id:"\u4e09query-phase",level:3},{value:"1\u3001query phase",id:"1query-phase",level:4},{value:"2\u3001replica shard\u5982\u4f55\u63d0\u5347\u641c\u7d22\u541e\u5410\u91cf",id:"2replica-shard\u5982\u4f55\u63d0\u5347\u641c\u7d22\u541e\u5410\u91cf",level:4},{value:"\u56db\u3001 fetch phase",id:"\u56db-fetch-phase",level:3},{value:"1\u3001fetch phbase\u5de5\u4f5c\u6d41\u7a0b",id:"1fetch-phbase\u5de5\u4f5c\u6d41\u7a0b",level:4},{value:"2\u3001\u4e00\u822c\u641c\u7d22\uff0c\u5982\u679c\u4e0d\u52a0from\u548csize\uff0c\u5c31\u9ed8\u8ba4\u641c\u7d22\u524d10\u6761\uff0c\u6309\u7167_score\u6392\u5e8f",id:"2\u4e00\u822c\u641c\u7d22\u5982\u679c\u4e0d\u52a0from\u548csize\u5c31\u9ed8\u8ba4\u641c\u7d22\u524d10\u6761\u6309\u7167_score\u6392\u5e8f",level:4},{value:"\u4e94\u3001\u641c\u7d22\u53c2\u6570\u5c0f\u603b\u7ed3",id:"\u4e94\u641c\u7d22\u53c2\u6570\u5c0f\u603b\u7ed3",level:3},{value:"1\u3001preference",id:"1preference",level:4},{value:"2\u3001timeout",id:"2timeout",level:4},{value:"3\u3001routing",id:"3routing",level:4},{value:"4\u3001search_type",id:"4search_type",level:4},{value:"\u7b2c\u5341\u4e03\u7ae0 \u805a\u5408\u5165\u95e8",id:"\u7b2c\u5341\u4e03\u7ae0-\u805a\u5408\u5165\u95e8",level:2},{value:"\u4e00\u3001\u805a\u5408\u793a\u4f8b",id:"\u4e00\u805a\u5408\u793a\u4f8b",level:3},{value:"1\u3001\u9700\u6c42\uff1a\u8ba1\u7b97\u6bcf\u4e2astudymodel\u4e0b\u7684\u5546\u54c1\u6570\u91cf",id:"1\u9700\u6c42\u8ba1\u7b97\u6bcf\u4e2astudymodel\u4e0b\u7684\u5546\u54c1\u6570\u91cf",level:4},{value:"2\u3001\u9700\u6c42\uff1a\u8ba1\u7b97\u6bcf\u4e2atags\u4e0b\u7684\u5546\u54c1\u6570\u91cf",id:"2\u9700\u6c42\u8ba1\u7b97\u6bcf\u4e2atags\u4e0b\u7684\u5546\u54c1\u6570\u91cf",level:4},{value:"3\u3001\u9700\u6c42\uff1a\u52a0\u4e0a\u641c\u7d22\u6761\u4ef6\uff0c\u8ba1\u7b97\u6bcf\u4e2atags\u4e0b\u7684\u5546\u54c1\u6570\u91cf",id:"3\u9700\u6c42\u52a0\u4e0a\u641c\u7d22\u6761\u4ef6\u8ba1\u7b97\u6bcf\u4e2atags\u4e0b\u7684\u5546\u54c1\u6570\u91cf",level:4},{value:"4\u3001\u9700\u6c42\uff1a\u5148\u5206\u7ec4\uff0c\u518d\u7b97\u6bcf\u7ec4\u7684\u5e73\u5747\u503c\uff0c\u8ba1\u7b97\u6bcf\u4e2atag\u4e0b\u7684\u5546\u54c1\u7684\u5e73\u5747\u4ef7\u683c",id:"4\u9700\u6c42\u5148\u5206\u7ec4\u518d\u7b97\u6bcf\u7ec4\u7684\u5e73\u5747\u503c\u8ba1\u7b97\u6bcf\u4e2atag\u4e0b\u7684\u5546\u54c1\u7684\u5e73\u5747\u4ef7\u683c",level:4},{value:"5\u3001\u9700\u6c42\uff1a\u8ba1\u7b97\u6bcf\u4e2atag\u4e0b\u7684\u5546\u54c1\u7684\u5e73\u5747\u4ef7\u683c\uff0c\u5e76\u4e14\u6309\u7167\u5e73\u5747\u4ef7\u683c\u964d\u5e8f\u6392\u5e8f",id:"5\u9700\u6c42\u8ba1\u7b97\u6bcf\u4e2atag\u4e0b\u7684\u5546\u54c1\u7684\u5e73\u5747\u4ef7\u683c\u5e76\u4e14\u6309\u7167\u5e73\u5747\u4ef7\u683c\u964d\u5e8f\u6392\u5e8f",level:4},{value:"6\u3001\u9700\u6c42\uff1a\u6309\u7167\u6307\u5b9a\u7684\u4ef7\u683c\u8303\u56f4\u533a\u95f4\u8fdb\u884c\u5206\u7ec4\uff0c\u7136\u540e\u5728\u6bcf\u7ec4\u5185\u518d\u6309\u7167tag\u8fdb\u884c\u5206\u7ec4\uff0c\u6700\u540e\u518d\u8ba1\u7b97\u6bcf\u7ec4\u7684\u5e73\u5747\u4ef7\u683c",id:"6\u9700\u6c42\u6309\u7167\u6307\u5b9a\u7684\u4ef7\u683c\u8303\u56f4\u533a\u95f4\u8fdb\u884c\u5206\u7ec4\u7136\u540e\u5728\u6bcf\u7ec4\u5185\u518d\u6309\u7167tag\u8fdb\u884c\u5206\u7ec4\u6700\u540e\u518d\u8ba1\u7b97\u6bcf\u7ec4\u7684\u5e73\u5747\u4ef7\u683c",level:4},{value:"\u4e8c\u3001\u4e24\u4e2a\u6838\u5fc3\u6982\u5ff5\uff1abucket\u548cmetric",id:"\u4e8c\u4e24\u4e2a\u6838\u5fc3\u6982\u5ff5bucket\u548cmetric",level:3},{value:"1\u3001bucket\uff1a\u4e00\u4e2a\u6570\u636e\u5206\u7ec4",id:"1bucket\u4e00\u4e2a\u6570\u636e\u5206\u7ec4",level:4},{value:"2\u3001metric\uff1a\u5bf9\u4e00\u4e2a\u6570\u636e\u5206\u7ec4\u6267\u884c\u7684\u7edf\u8ba1",id:"2metric\u5bf9\u4e00\u4e2a\u6570\u636e\u5206\u7ec4\u6267\u884c\u7684\u7edf\u8ba1",level:4},{value:"3\u3001\u7535\u89c6\u6848\u4f8b",id:"3\u7535\u89c6\u6848\u4f8b",level:4},{value:"\u9700\u6c421 \u7edf\u8ba1\u54ea\u79cd\u989c\u8272\u7684\u7535\u89c6\u9500\u91cf\u6700\u9ad8",id:"\u9700\u6c421-\u7edf\u8ba1\u54ea\u79cd\u989c\u8272\u7684\u7535\u89c6\u9500\u91cf\u6700\u9ad8",level:5},{value:"\u9700\u6c422 \u7edf\u8ba1\u6bcf\u79cd\u989c\u8272\u7535\u89c6\u5e73\u5747\u4ef7\u683c",id:"\u9700\u6c422-\u7edf\u8ba1\u6bcf\u79cd\u989c\u8272\u7535\u89c6\u5e73\u5747\u4ef7\u683c",level:5},{value:"\u9700\u6c423 \u7ee7\u7eed\u4e0b\u94bb\u5206\u6790",id:"\u9700\u6c423-\u7ee7\u7eed\u4e0b\u94bb\u5206\u6790",level:5},{value:"\u9700\u6c424\uff1a\u66f4\u591a\u7684metric",id:"\u9700\u6c424\u66f4\u591a\u7684metric",level:5},{value:"\u9700\u6c425\uff1a\u5212\u5206\u8303\u56f4 histogram",id:"\u9700\u6c425\u5212\u5206\u8303\u56f4-histogram",level:5},{value:"\u9700\u6c426\uff1a\u6309\u7167\u65e5\u671f\u5206\u7ec4\u805a\u5408",id:"\u9700\u6c426\u6309\u7167\u65e5\u671f\u5206\u7ec4\u805a\u5408",level:5},{value:"\u9700\u6c427 \u7edf\u8ba1\u6bcf\u5b63\u5ea6\u6bcf\u4e2a\u54c1\u724c\u7684\u9500\u552e\u989d",id:"\u9700\u6c427-\u7edf\u8ba1\u6bcf\u5b63\u5ea6\u6bcf\u4e2a\u54c1\u724c\u7684\u9500\u552e\u989d",level:5},{value:"\u9700\u6c428 \uff1a\u641c\u7d22\u4e0e\u805a\u5408\u7ed3\u5408\uff0c\u67e5\u8be2\u67d0\u4e2a\u54c1\u724c\u6309\u989c\u8272\u9500\u91cf",id:"\u9700\u6c428-\u641c\u7d22\u4e0e\u805a\u5408\u7ed3\u5408\u67e5\u8be2\u67d0\u4e2a\u54c1\u724c\u6309\u989c\u8272\u9500\u91cf",level:5},{value:"\u9700\u6c429 global bucket\uff1a\u5355\u4e2a\u54c1\u724c\u4e0e\u6240\u6709\u54c1\u724c\u9500\u91cf\u5bf9\u6bd4",id:"\u9700\u6c429-global-bucket\u5355\u4e2a\u54c1\u724c\u4e0e\u6240\u6709\u54c1\u724c\u9500\u91cf\u5bf9\u6bd4",level:5},{value:"\u9700\u6c4210\uff1a\u8fc7\u6ee4+\u805a\u5408\uff1a\u7edf\u8ba1\u4ef7\u683c\u5927\u4e8e1200\u7684\u7535\u89c6\u5e73\u5747\u4ef7\u683c",id:"\u9700\u6c4210\u8fc7\u6ee4\u805a\u5408\u7edf\u8ba1\u4ef7\u683c\u5927\u4e8e1200\u7684\u7535\u89c6\u5e73\u5747\u4ef7\u683c",level:5},{value:"\u9700\u6c4211 bucket filter\uff1a\u7edf\u8ba1\u54c1\u724c\u6700\u8fd1\u4e00\u4e2a\u6708\u7684\u5e73\u5747\u4ef7\u683c",id:"\u9700\u6c4211-bucket-filter\u7edf\u8ba1\u54c1\u724c\u6700\u8fd1\u4e00\u4e2a\u6708\u7684\u5e73\u5747\u4ef7\u683c",level:5},{value:"\u9700\u6c4212 \u6392\u5e8f\uff1a\u6309\u6bcf\u79cd\u989c\u8272\u7684\u5e73\u5747\u9500\u552e\u989d\u964d\u5e8f\u6392\u5e8f",id:"\u9700\u6c4212-\u6392\u5e8f\u6309\u6bcf\u79cd\u989c\u8272\u7684\u5e73\u5747\u9500\u552e\u989d\u964d\u5e8f\u6392\u5e8f",level:5},{value:"\u9700\u6c4213 \u6392\u5e8f\uff1a\u6309\u6bcf\u79cd\u989c\u8272\u7684\u6bcf\u79cd\u54c1\u724c\u5e73\u5747\u9500\u552e\u989d\u964d\u5e8f\u6392\u5e8f",id:"\u9700\u6c4213-\u6392\u5e8f\u6309\u6bcf\u79cd\u989c\u8272\u7684\u6bcf\u79cd\u54c1\u724c\u5e73\u5747\u9500\u552e\u989d\u964d\u5e8f\u6392\u5e8f",level:5},{value:"\u7b2c\u5341\u516b\u7ae0 java api\u5b9e\u73b0\u805a\u5408",id:"\u7b2c\u5341\u516b\u7ae0-java-api\u5b9e\u73b0\u805a\u5408",level:2},{value:"\u7b2c\u5341\u4e5d\u7ae0 es7 sql\u65b0\u7279\u6027",id:"\u7b2c\u5341\u4e5d\u7ae0-es7-sql\u65b0\u7279\u6027",level:2},{value:"\u4e00\u3001\u5feb\u901f\u5165\u95e8",id:"\u4e00\u5feb\u901f\u5165\u95e8",level:3},{value:"\u4e8c\u3001\u542f\u52a8\u65b9\u5f0f",id:"\u4e8c\u542f\u52a8\u65b9\u5f0f",level:3},{value:"\u4e09\u3001\u663e\u793a\u65b9\u5f0f",id:"\u4e09\u663e\u793a\u65b9\u5f0f",level:3},{value:"\u56db\u3001sql \u7ffb\u8bd1",id:"\u56dbsql-\u7ffb\u8bd1",level:3},{value:"\u4e94\u3001\u4e0e\u5176\u4ed6DSL\u7ed3\u5408",id:"\u4e94\u4e0e\u5176\u4ed6dsl\u7ed3\u5408",level:3},{value:"\u516d\u3001 java \u4ee3\u7801\u5b9e\u73b0sql\u529f\u80fd",id:"\u516d-java-\u4ee3\u7801\u5b9e\u73b0sql\u529f\u80fd",level:3},{value:"\u7b2c\u4e8c\u5341\u7ae0 Logstash\u5b66\u4e60",id:"\u7b2c\u4e8c\u5341\u7ae0-logstash\u5b66\u4e60",level:2},{value:"\u4e00\u3001Logstash\u57fa\u672c\u8bed\u6cd5\u7ec4\u6210",id:"\u4e00logstash\u57fa\u672c\u8bed\u6cd5\u7ec4\u6210",level:3},{value:"1\u3001\u4ec0\u4e48\u662fLogstash",id:"1\u4ec0\u4e48\u662flogstash",level:4},{value:"2\u3001\u914d\u7f6e\u6587\u4ef6\uff1a",id:"2\u914d\u7f6e\u6587\u4ef6",level:4},{value:"3\u3001\u542f\u52a8\u64cd\u4f5c\uff1a",id:"3\u542f\u52a8\u64cd\u4f5c",level:4},{value:"\u4e8c\u3001Logstash\u8f93\u5165\u63d2\u4ef6\uff08input\uff09",id:"\u4e8clogstash\u8f93\u5165\u63d2\u4ef6input",level:3},{value:"1\u3001\u6807\u51c6\u8f93\u5165(Stdin)",id:"1\u6807\u51c6\u8f93\u5165stdin",level:4},{value:"2\u3001\u8bfb\u53d6\u6587\u4ef6(File)",id:"2\u8bfb\u53d6\u6587\u4ef6file",level:4},{value:"3\u3001\u8bfb\u53d6TCP\u7f51\u7edc\u6570\u636e",id:"3\u8bfb\u53d6tcp\u7f51\u7edc\u6570\u636e",level:4},{value:"\u4e09\u3001Logstash\u8fc7\u6ee4\u5668\u63d2\u4ef6(Filter)",id:"\u4e09logstash\u8fc7\u6ee4\u5668\u63d2\u4ef6filter",level:3},{value:"1\u3001Grok \u6b63\u5219\u6355\u83b7",id:"1grok-\u6b63\u5219\u6355\u83b7",level:4},{value:"2\u3001\u65f6\u95f4\u5904\u7406(Date)",id:"2\u65f6\u95f4\u5904\u7406date",level:4},{value:"3\u3001\u6570\u636e\u4fee\u6539(Mutate)",id:"3\u6570\u636e\u4fee\u6539mutate",level:4},{value:"\uff081\uff09\u6b63\u5219\u8868\u8fbe\u5f0f\u66ff\u6362\u5339\u914d\u5b57\u6bb5",id:"1\u6b63\u5219\u8868\u8fbe\u5f0f\u66ff\u6362\u5339\u914d\u5b57\u6bb5",level:5},{value:"\uff082\uff09\u5206\u9694\u7b26\u5206\u5272\u5b57\u7b26\u4e32\u4e3a\u6570\u7ec4",id:"2\u5206\u9694\u7b26\u5206\u5272\u5b57\u7b26\u4e32\u4e3a\u6570\u7ec4",level:5},{value:"\uff083\uff09\u91cd\u547d\u540d\u5b57\u6bb5",id:"3\u91cd\u547d\u540d\u5b57\u6bb5",level:5},{value:"\uff084\uff09\u5220\u9664\u5b57\u6bb5",id:"4\u5220\u9664\u5b57\u6bb5",level:5},{value:"\uff085\uff09GeoIP \u5730\u5740\u67e5\u8be2\u5f52\u7c7b",id:"5geoip-\u5730\u5740\u67e5\u8be2\u5f52\u7c7b",level:5},{value:"\u7efc\u5408\u4f8b\u5b50\uff1a",id:"\u7efc\u5408\u4f8b\u5b50",level:5},{value:"\u56db\u3001Logstash\u8f93\u51fa\u63d2\u4ef6\uff08output\uff09",id:"\u56dblogstash\u8f93\u51fa\u63d2\u4ef6output",level:3},{value:"\u4e94\u3001\u7efc\u5408\u6848\u4f8b",id:"\u4e94\u7efc\u5408\u6848\u4f8b",level:3},{value:"\u7b2c\u4e8c\u5341\u4e00\u7ae0 kibana\u5b66\u4e60",id:"\u7b2c\u4e8c\u5341\u4e00\u7ae0-kibana\u5b66\u4e60",level:2},{value:"\u4e00\u3001\u57fa\u672c\u67e5\u8be2",id:"\u4e00\u57fa\u672c\u67e5\u8be2",level:3},{value:"\u4e8c\u3001\u53ef\u89c6\u5316",id:"\u4e8c\u53ef\u89c6\u5316",level:3},{value:"\u4e09\u3001\u4eea\u8868\u76d8",id:"\u4e09\u4eea\u8868\u76d8",level:3},{value:"\u56db\u3001\u4f7f\u7528\u6a21\u677f\u6570\u636e\u6307\u5bfc\u7ed8\u56fe",id:"\u56db\u4f7f\u7528\u6a21\u677f\u6570\u636e\u6307\u5bfc\u7ed8\u56fe",level:3},{value:"\u4e94\u3001\u5176\u4ed6\u529f\u80fd",id:"\u4e94\u5176\u4ed6\u529f\u80fd",level:3},{value:"\u7b2c\u4e8c\u5341\u4e8c\u7ae0 \u96c6\u7fa4\u90e8\u7f72",id:"\u7b2c\u4e8c\u5341\u4e8c\u7ae0-\u96c6\u7fa4\u90e8\u7f72",level:2},{value:"\u7ed3\u70b9\u7684\u4e09\u4e2a\u89d2\u8272",id:"\u7ed3\u70b9\u7684\u4e09\u4e2a\u89d2\u8272",level:3},{value:"\u7b2c\u4e8c\u5341\u4e09\u7ae0 \u9879\u76ee\u5b9e\u6218",id:"\u7b2c\u4e8c\u5341\u4e09\u7ae0-\u9879\u76ee\u5b9e\u6218",level:2},{value:"\u4e00\u3001\u9879\u76ee\u4e00\uff1aELK\u7528\u4e8e\u65e5\u5fd7\u5206\u6790",id:"\u4e00\u9879\u76ee\u4e00elk\u7528\u4e8e\u65e5\u5fd7\u5206\u6790",level:3},{value:"\u4e8c\u3001\u9879\u76ee\u4e8c\uff1a\u5b66\u6210\u5728\u7ebf\u7ad9\u5185\u641c\u7d22\u6a21\u5757",id:"\u4e8c\u9879\u76ee\u4e8c\u5b66\u6210\u5728\u7ebf\u7ad9\u5185\u641c\u7d22\u6a21\u5757",level:3},{value:"1\u3001mysql\u5bfc\u5165course_pub\u8868",id:"1mysql\u5bfc\u5165course_pub\u8868",level:4},{value:"2\u3001\u521b\u5efa\u7d22\u5f15xc_course",id:"2\u521b\u5efa\u7d22\u5f15xc_course",level:4},{value:"3\u3001\u521b\u5efa\u6620\u5c04",id:"3\u521b\u5efa\u6620\u5c04",level:4},{value:"4\u3001logstash\u521b\u5efa\u6a21\u677f\u6587\u4ef6",id:"4logstash\u521b\u5efa\u6a21\u677f\u6587\u4ef6",level:4},{value:"5\u3001logstash\u914d\u7f6emysql.conf",id:"5logstash\u914d\u7f6emysqlconf",level:4},{value:"6\u3001\u542f\u52a8",id:"6\u542f\u52a8",level:4},{value:"7\u3001\u540e\u7aef\u4ee3\u7801",id:"7\u540e\u7aef\u4ee3\u7801",level:4}],c={toc:u};function p(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"22-elk\u8fdb\u9636"},"2.2 ELK\u8fdb\u9636"),(0,r.kt)("h2",{id:"\u7b2c\u5341\u4e00\u7ae0-\u7d22\u5f15index\u5165\u95e8"},"\u7b2c\u5341\u4e00\u7ae0 \u7d22\u5f15Index\u5165\u95e8"),(0,r.kt)("h3",{id:"\u4e00\u7d22\u5f15\u7ba1\u7406"},"\u4e00\u3001\u7d22\u5f15\u7ba1\u7406"),(0,r.kt)("h4",{id:"1\u4e3a\u4ec0\u4e48\u6211\u4eec\u8981\u624b\u52a8\u521b\u5efa\u7d22\u5f15"},"1\u3001\u4e3a\u4ec0\u4e48\u6211\u4eec\u8981\u624b\u52a8\u521b\u5efa\u7d22\u5f15"),(0,r.kt)("p",null,"\u76f4\u63a5put\u6570\u636e PUT index/_doc/1,es\u4f1a\u81ea\u52a8\u751f\u6210\u7d22\u5f15\uff0c\u5e76\u5efa\u7acb\u52a8\u6001\u6620\u5c04dynamic mapping\u3002"),(0,r.kt)("p",null,"\u5728\u751f\u4ea7\u4e0a\uff0c\u6211\u4eec\u9700\u8981\u81ea\u5df1\u624b\u52a8\u5efa\u7acb\u7d22\u5f15\u548c\u6620\u5c04\uff0c\u4e3a\u4e86\u66f4\u597d\u5730\u7ba1\u7406\u7d22\u5f15\u3002\u5c31\u50cf\u6570\u636e\u5e93\u7684\u5efa\u8868\u8bed\u53e5\u4e00\u6837\u3002"),(0,r.kt)("h4",{id:"2\u7d22\u5f15\u7ba1\u7406"},"2\u3001\u7d22\u5f15\u7ba1\u7406"),(0,r.kt)("h5",{id:"1\u521b\u5efa\u7d22\u5f15"},"\uff081\uff09\u521b\u5efa\u7d22\u5f15"),(0,r.kt)("p",null,"\u521b\u5efa\u7d22\u5f15\u7684\u8bed\u6cd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /index\n{\n    "settings": { ... any settings ... },\n    "mappings": {\n       "properties" : {\n            "field1" : { "type" : "text" }\n        }\n    },\n    "aliases": {\n        "default_index": {}\n  } \n}\n')),(0,r.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index\n{\n  "settings": {\n    "number_of_shards": 1,\n    "number_of_replicas": 1\n  },\n  "mappings": {\n    "properties": {\n      "field1":{\n        "type": "text"\n      },\n      "field2":{\n        "type": "text"\n      }\n    }\n  },\n  "aliases": {\n    "default_index": {}\n  } \n}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u7d22\u5f15\u522b\u540d")),(0,r.kt)("p",null,"\u63d2\u5165\u6570\u636e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'POST /my_index/_doc/1\n{\n    "field1":"java",\n    "field2":"js"\n}\n')),(0,r.kt)("p",null,"\u67e5\u8be2\u6570\u636e \u90fd\u53ef\u4ee5\u67e5\u5230"),(0,r.kt)("p",null,"GET /my_index/_doc/1"),(0,r.kt)("p",null,"GET /default_index/_doc/1"),(0,r.kt)("h5",{id:"2\u67e5\u8be2\u7d22\u5f15"},"\uff082\uff09\u67e5\u8be2\u7d22\u5f15"),(0,r.kt)("p",null,"GET /my_index/_mapping"),(0,r.kt)("p",null,"GET /my_index/_setting"),(0,r.kt)("h5",{id:"3\u4fee\u6539\u7d22\u5f15"},"\uff083\uff09\u4fee\u6539\u7d22\u5f15"),(0,r.kt)("p",null,"\u4fee\u6539\u526f\u672c\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},'PUT /my_index/_settings\n{\n    "index" : {\n        "number_of_replicas" : 2\n    }\n}\n')),(0,r.kt)("h5",{id:"4\u5220\u9664\u7d22\u5f15"},"\uff084\uff09\u5220\u9664\u7d22\u5f15"),(0,r.kt)("p",null,"DELETE /my_index"),(0,r.kt)("p",null,"DELETE /index_one,index_two"),(0,r.kt)("p",null,"DELETE /index_*"),(0,r.kt)("p",null,"DELETE /_all"),(0,r.kt)("p",null,"\u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c\u9632\u6b62\u6076\u610f\u5220\u9664\u7d22\u5f15\uff0c\u5220\u9664\u65f6\u5fc5\u987b\u6307\u5b9a\u7d22\u5f15\u540d\uff1a"),(0,r.kt)("p",null,"elasticsearch.yml"),(0,r.kt)("p",null,"action.destructive_requires_name: true"),(0,r.kt)("h3",{id:"\u4e8c\u5b9a\u5236\u5206\u8bcd\u5668"},"\u4e8c\u3001\u5b9a\u5236\u5206\u8bcd\u5668"),(0,r.kt)("h4",{id:"1\u9ed8\u8ba4\u7684\u5206\u8bcd\u5668"},"1\u3001\u9ed8\u8ba4\u7684\u5206\u8bcd\u5668"),(0,r.kt)("p",null,"standard"),(0,r.kt)("p",null,"\u5206\u8bcd\u4e09\u4e2a\u7ec4\u4ef6\uff0ccharacter filter\uff0ctokenizer\uff0ctoken filter"),(0,r.kt)("p",null,"standard tokenizer\uff1a\u4ee5\u5355\u8bcd\u8fb9\u754c\u8fdb\u884c\u5207\u5206"),(0,r.kt)("p",null,"standard token filter\uff1a\u4ec0\u4e48\u90fd\u4e0d\u505a"),(0,r.kt)("p",null,"lowercase token filter\uff1a\u5c06\u6240\u6709\u5b57\u6bcd\u8f6c\u6362\u4e3a\u5c0f\u5199"),(0,r.kt)("p",null,"stop token filer\uff08\u9ed8\u8ba4\u88ab\u7981\u7528\uff09\uff1a\u79fb\u9664\u505c\u7528\u8bcd\uff0c\u6bd4\u5982a the it\u7b49\u7b49"),(0,r.kt)("h4",{id:"2\u4fee\u6539\u5206\u8bcd\u5668\u7684\u8bbe\u7f6e"},"2\u3001\u4fee\u6539\u5206\u8bcd\u5668\u7684\u8bbe\u7f6e"),(0,r.kt)("p",null,"\u542f\u7528english\u505c\u7528\u8bcdtoken filter"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'PUT /my_index\n{\n  "settings": {\n    "analysis": {\n      "analyzer": {\n        "es_std": {\n          "type": "standard",\n          "stopwords": "_english_"\n        }\n      }\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u6d4b\u8bd5\u5206\u8bcd"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'GET /my_index/_analyze\n{\n  "analyzer": "standard", \n  "text": "a dog is in the house"\n}\n\nGET /my_index/_analyze\n{\n  "analyzer": "es_std",\n  "text":"a dog is in the house"\n}\n')),(0,r.kt)("h4",{id:"3\u5b9a\u5236\u5316\u81ea\u5df1\u7684\u5206\u8bcd\u5668"},"3\u3001\u5b9a\u5236\u5316\u81ea\u5df1\u7684\u5206\u8bcd\u5668"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index\n{\n  "settings": {\n    "analysis": {\n      "char_filter": {\n        "&_to_and": {\n          "type": "mapping",\n          "mappings": ["&=> and"]\n        }\n      },\n      "filter": {\n        "my_stopwords": {\n          "type": "stop",\n          "stopwords": ["the", "a"]\n        }\n      },\n      "analyzer": {\n        "my_analyzer": {\n          "type": "custom",\n          "char_filter": ["html_strip", "&_to_and"],\n          "tokenizer": "standard",\n          "filter": ["lowercase", "my_stopwords"]\n        }\n      }\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u6d4b\u8bd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'GET /my_index/_analyze\n{\n  "analyzer": "my_analyzer",\n  "text": "tom&jerry are a friend in the house, <a>, HAHA!!"\n}\n')),(0,r.kt)("p",null,"\u8bbe\u7f6e\u5b57\u6bb5\u4f7f\u7528\u81ea\u5b9a\u4e49\u5206\u8bcd\u5668"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index/_mapping/\n{\n  "properties": {\n    "content": {\n      "type": "text",\n      "analyzer": "my_analyzer"\n    }\n  }\n}\n')),(0,r.kt)("h3",{id:"\u4e09type\u5e95\u5c42\u7ed3\u6784\u53ca\u5f03\u7528\u539f\u56e0"},"\u4e09\u3001type\u5e95\u5c42\u7ed3\u6784\u53ca\u5f03\u7528\u539f\u56e0"),(0,r.kt)("h4",{id:"1type\u662f\u4ec0\u4e48"},"1\u3001type\u662f\u4ec0\u4e48"),(0,r.kt)("p",null,"type\uff0c\u662f\u4e00\u4e2aindex\u4e2d\u7528\u6765\u533a\u5206\u7c7b\u4f3c\u7684\u6570\u636e\u7684\uff0c\u7c7b\u4f3c\u7684\u6570\u636e\uff0c\u4f46\u662f\u53ef\u80fd\u6709\u4e0d\u540c\u7684fields\uff0c\u800c\u4e14\u6709\u4e0d\u540c\u7684\u5c5e\u6027\u6765\u63a7\u5236\u7d22\u5f15\u5efa\u7acb\u3001\u5206\u8bcd\u5668. field\u7684value\uff0c\u5728\u5e95\u5c42\u7684lucene\u4e2d\u5efa\u7acb\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u5168\u90e8\u662fopaque bytes\u7c7b\u578b\uff0c\u4e0d\u533a\u5206\u7c7b\u578b\u7684\u3002 lucene\u662f\u6ca1\u6709type\u7684\u6982\u5ff5\u7684\uff0c\u5728document\u4e2d\uff0c\u5b9e\u9645\u4e0a\u5c06type\u4f5c\u4e3a\u4e00\u4e2adocument\u7684field\u6765\u5b58\u50a8\uff0c\u5373_type\uff0ces\u901a\u8fc7_type\u6765\u8fdb\u884ctype\u7684\u8fc7\u6ee4\u548c\u7b5b\u9009\u3002"),(0,r.kt)("h4",{id:"2es\u4e2d\u4e0d\u540ctype\u5b58\u50a8\u673a\u5236"},"2\u3001es\u4e2d\u4e0d\u540ctype\u5b58\u50a8\u673a\u5236"),(0,r.kt)("p",null,"\u4e00\u4e2aindex\u4e2d\u7684\u591a\u4e2atype\uff0c\u5b9e\u9645\u4e0a\u662f\u653e\u5728\u4e00\u8d77\u5b58\u50a8\u7684\uff0c\u56e0\u6b64\u4e00\u4e2aindex\u4e0b\uff0c\u4e0d\u80fd\u6709\u591a\u4e2atype\u91cd\u540d\uff0c\u800c\u7c7b\u578b\u6216\u8005\u5176\u4ed6\u8bbe\u7f6e\u4e0d\u540c\u7684\uff0c\u56e0\u4e3a\u90a3\u6837\u662f\u65e0\u6cd5\u5904\u7406\u7684"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "goods": {\n      "mappings": {\n         "electronic_goods": {\n            "properties": {\n               "name": {\n                  "type": "string",\n               },\n               "price": {\n                  "type": "double"\n               },\n               "service_period": {\n                  "type": "string"\n                   }            \n                }\n         },\n         "fresh_goods": {\n            "properties": {\n               "name": {\n                  "type": "string",\n               },\n               "price": {\n                  "type": "double"\n               },\n               "eat_period": {\n                    "type": "string"\n               }\n                }\n         }\n      }\n   }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /goods/electronic_goods/1\n{\n  "name": "\u5c0f\u7c73\u7a7a\u8c03",\n  "price": 1999.0,\n  "service_period": "one year"\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /goods/fresh_goods/1\n{\n  "name": "\u6fb3\u6d32\u9f99\u867e",\n  "price": 199.0,\n  "eat_period": "one week"\n}\n')),(0,r.kt)("p",null,"es\u6587\u6863\u5728\u5e95\u5c42\u7684\u5b58\u50a8\u662f\u8fd9\u6837\u5b50\u7684"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "goods": {\n      "mappings": {\n        "_type": {\n          "type": "string",\n          "index": "false"\n        },\n        "name": {\n          "type": "string"\n        }\n        "price": {\n          "type": "double"\n        }\n        "service_period": {\n          "type": "string"\n        },\n        "eat_period": {\n          "type": "string"\n        }\n      }\n   }\n}\n')),(0,r.kt)("p",null,"\u5e95\u5c42\u6570\u636e\u5b58\u50a8\u683c\u5f0f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "_type": "electronic_goods",\n  "name": "\u5c0f\u7c73\u7a7a\u8c03",\n  "price": 1999.0,\n  "service_period": "one year",\n  "eat_period": ""\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "_type": "fresh_goods",\n  "name": "\u6fb3\u6d32\u9f99\u867e",\n  "price": 199.0,\n  "service_period": "",\n  "eat_period": "one week"\n}\n')),(0,r.kt)("h4",{id:"3type\u5f03\u7528"},"3\u3001type\u5f03\u7528"),(0,r.kt)("p",null,"\u540c\u4e00\u7d22\u5f15\u4e0b\uff0c\u4e0d\u540ctype\u7684\u6570\u636e\u5b58\u50a8\u5176\u4ed6type\u7684field \u5927\u91cf\u7a7a\u503c\uff0c\u9020\u6210\u8d44\u6e90\u6d6a\u8d39\u3002"),(0,r.kt)("p",null,"\u6240\u4ee5\uff0c\u4e0d\u540c\u7c7b\u578b\u6570\u636e\uff0c\u8981\u653e\u5230\u4e0d\u540c\u7684\u7d22\u5f15\u4e2d\u3002"),(0,r.kt)("p",null,"es9\u4e2d\uff0c\u5c06\u4f1a\u5f7b\u5e95\u5220\u9664type\u3002"),(0,r.kt)("h3",{id:"\u56db\u5b9a\u5236dynamic-mapping"},"\u56db\u3001\u5b9a\u5236dynamic mapping"),(0,r.kt)("h4",{id:"1\u5b9a\u5236dynamic\u7b56\u7565"},"1\u3001\u5b9a\u5236dynamic\u7b56\u7565"),(0,r.kt)("p",null,"true\uff1a\u9047\u5230\u964c\u751f\u5b57\u6bb5\uff0c\u5c31\u8fdb\u884cdynamic mapping"),(0,r.kt)("p",null,"false\uff1a\u65b0\u68c0\u6d4b\u5230\u7684\u5b57\u6bb5\u5c06\u88ab\u5ffd\u7565\u3002\u8fd9\u4e9b\u5b57\u6bb5\u5c06\u4e0d\u4f1a\u88ab\u7d22\u5f15\uff0c\u56e0\u6b64\u5c06\u65e0\u6cd5\u641c\u7d22\uff0c\u4f46\u4ecd\u5c06\u51fa\u73b0\u5728\u8fd4\u56de\u70b9\u51fb\u7684\u6e90\u5b57\u6bb5\u4e2d\u3002\u8fd9\u4e9b\u5b57\u6bb5\u4e0d\u4f1a\u6dfb\u52a0\u5230\u6620\u5c04\u4e2d\uff0c\u5fc5\u987b\u663e\u5f0f\u6dfb\u52a0\u65b0\u5b57\u6bb5\u3002"),(0,r.kt)("p",null,"strict\uff1a\u9047\u5230\u964c\u751f\u5b57\u6bb5\uff0c\u5c31\u62a5\u9519"),(0,r.kt)("p",null,"\u521b\u5efamapping"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index\n{\n    "mappings": {\n      "dynamic": "strict",\n       "properties": {\n        "title": {\n          "type": "text"\n        },\n        "address": {\n          "type": "object",\n          "dynamic": "true"\n        }\n        }\n    }\n}\n')),(0,r.kt)("p",null,"\u63d2\u5165\u6570\u636e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index/_doc/1\n{\n  "title": "my article",\n  "content": "this is my article",\n  "address": {\n    "province": "guangdong",\n    "city": "guangzhou"\n  }\n}\n')),(0,r.kt)("p",null,"\u62a5\u9519"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'{\n  "error": {\n    "root_cause": [\n      {\n        "type": "strict_dynamic_mapping_exception",\n        "reason": "mapping set to strict, dynamic introduction of [content] within [_doc] is not allowed"\n      }\n    ],\n    "type": "strict_dynamic_mapping_exception",\n    "reason": "mapping set to strict, dynamic introduction of [content] within [_doc] is not allowed"\n  },\n  "status": 400\n}\n')),(0,r.kt)("h4",{id:"2\u81ea\u5b9a\u4e49-dynamic-mapping\u7b56\u7565"},"2\u3001\u81ea\u5b9a\u4e49 dynamic mapping\u7b56\u7565"),(0,r.kt)("p",null,"es\u4f1a\u6839\u636e\u4f20\u5165\u7684\u503c\uff0c\u63a8\u65ad\u7c7b\u578b\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/1569123478530-b00805a3.png",alt:"1569123478530"}),"1569123478530"),(0,r.kt)("h4",{id:"date_detection-\u65e5\u671f\u63a2\u6d4b"},"date_detection \u65e5\u671f\u63a2\u6d4b"),(0,r.kt)("p",null,'\u9ed8\u8ba4\u4f1a\u6309\u7167\u4e00\u5b9a\u683c\u5f0f\u8bc6\u522bdate\uff0c\u6bd4\u5982yyyy-MM-dd\u3002\u4f46\u662f\u5982\u679c\u67d0\u4e2afield\u5148\u8fc7\u6765\u4e00\u4e2a2017-01-01\u7684\u503c\uff0c\u5c31\u4f1a\u88ab\u81ea\u52a8dynamic mapping\u6210date\uff0c\u540e\u9762\u5982\u679c\u518d\u6765\u4e00\u4e2a"hello world"\u4e4b\u7c7b\u7684\u503c\uff0c\u5c31\u4f1a\u62a5\u9519\u3002\u53ef\u4ee5\u624b\u52a8\u5173\u95ed\u67d0\u4e2atype\u7684date_detection\uff0c\u5982\u679c\u6709\u9700\u8981\uff0c\u81ea\u5df1\u624b\u52a8\u6307\u5b9a\u67d0\u4e2afield\u4e3adate\u7c7b\u578b\u3002'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index\n{\n    "mappings": {\n      "date_detection": false,\n       "properties": {\n        "title": {\n          "type": "text"\n        },\n        "address": {\n          "type": "object",\n          "dynamic": "true"\n        }\n        }\n    }\n}\n')),(0,r.kt)("p",null,"\u6d4b\u8bd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index/_doc/1\n{\n  "title": "my article",\n  "content": "this is my article",\n  "address": {\n    "province": "guangdong",\n    "city": "guangzhou"\n  },\n  "post_date":"2019-09-10"\n}\n')),(0,r.kt)("p",null,"\u67e5\u770b\u6620\u5c04"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"GET /my_index/_mapping\n")),(0,r.kt)("h4",{id:"\u81ea\u5b9a\u4e49\u65e5\u671f\u683c\u5f0f"},"\u81ea\u5b9a\u4e49\u65e5\u671f\u683c\u5f0f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT my_index\n{\n  "mappings": {\n    "dynamic_date_formats": ["MM/dd/yyyy"]\n  }\n}\n')),(0,r.kt)("p",null,"\u63d2\u5165\u6570\u636e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT my_index/_doc/1\n{\n  "create_date": "09/25/2019"\n}\n')),(0,r.kt)("h4",{id:"numeric_detection-\u6570\u5b57\u63a2\u6d4b"},"numeric_detection \u6570\u5b57\u63a2\u6d4b"),(0,r.kt)("p",null,"\u867d\u7136json\u652f\u6301\u672c\u673a\u6d6e\u70b9\u548c\u6574\u6570\u6570\u636e\u7c7b\u578b\uff0c\u4f46\u67d0\u4e9b\u5e94\u7528\u7a0b\u5e8f\u6216\u8bed\u8a00\u6709\u65f6\u53ef\u80fd\u5c06\u6570\u5b57\u5448\u73b0\u4e3a\u5b57\u7b26\u4e32\u3002\u901a\u5e38\u6b63\u786e\u7684\u89e3\u51b3\u65b9\u6848\u662f\u663e\u5f0f\u5730\u6620\u5c04\u8fd9\u4e9b\u5b57\u6bb5\uff0c\u4f46\u662f\u53ef\u4ee5\u542f\u7528\u6570\u5b57\u68c0\u6d4b\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u7981\u7528\uff09\u6765\u81ea\u52a8\u5b8c\u6210\u8fd9\u4e9b\u64cd\u4f5c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT my_index\n{\n  "mappings": {\n    "numeric_detection": true\n  }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT my_index/_doc/1\n{\n  "my_float":   "1.0", \n  "my_integer": "1" \n}\n')),(0,r.kt)("h4",{id:"3\u5b9a\u5236\u81ea\u5df1\u7684dynamic-mapping-template"},"3\u3001\u5b9a\u5236\u81ea\u5df1\u7684dynamic mapping template"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index\n{\n    "mappings": {\n            "dynamic_templates": [\n                { \n                  "en": {\n                      "match":              "*_en", \n                      "match_mapping_type": "string",\n                      "mapping": {\n                          "type":           "text",\n                          "analyzer":       "english"\n                      }\n                }                  \n            }\n        ]\n    }\n}\n')),(0,r.kt)("p",null,"\u63d2\u5165\u6570\u636e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index/_doc/1\n{\n  "title": "this is my first article"\n}\n\nPUT /my_index/_doc/2\n{\n  "title_en": "this is my first article"\n}\n')),(0,r.kt)("p",null,"\u641c\u7d22"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"GET my_index/_search?q=first\nGET my_index/_search?q=is\n")),(0,r.kt)("p",null,"title\u6ca1\u6709\u5339\u914d\u5230\u4efb\u4f55\u7684dynamic\u6a21\u677f\uff0c\u9ed8\u8ba4\u5c31\u662fstandard\u5206\u8bcd\u5668\uff0c\u4e0d\u4f1a\u8fc7\u6ee4\u505c\u7528\u8bcd\uff0cis\u4f1a\u8fdb\u5165\u5012\u6392\u7d22\u5f15\uff0c\u7528is\u6765\u641c\u7d22\u662f\u53ef\u4ee5\u641c\u7d22\u5230\u7684"),(0,r.kt)("p",null,"title_en\u5339\u914d\u5230\u4e86dynamic\u6a21\u677f\uff0c\u5c31\u662fenglish\u5206\u8bcd\u5668\uff0c\u4f1a\u8fc7\u6ee4\u505c\u7528\u8bcd\uff0cis\u8fd9\u79cd\u505c\u7528\u8bcd\u5c31\u4f1a\u88ab\u8fc7\u6ee4\u6389\uff0c\u7528is\u6765\u641c\u7d22\u5c31\u641c\u7d22\u4e0d\u5230\u4e86"),(0,r.kt)("h4",{id:"\u6a21\u677f\u5199\u6cd5"},"\u6a21\u677f\u5199\u6cd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT my_index\n{\n  "mappings": {\n    "dynamic_templates": [\n      {\n        "integers": {\n          "match_mapping_type": "long",\n          "mapping": {\n            "type": "integer"\n          }\n        }\n      },\n      {\n        "strings": {\n          "match_mapping_type": "string",\n          "mapping": {\n            "type": "text",\n            "fields": {\n              "raw": {\n                "type":  "keyword",\n                "ignore_above": 256\n              }\n            }\n          }\n        }\n      }\n    ]\n  }\n}\n')),(0,r.kt)("p",null,"\u6a21\u677f\u53c2\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},'"match":   "long_*",\n"unmatch": "*_text",\n"match_mapping_type": "string",\n"path_match":   "name.*",\n"path_unmatch": "*.middle",\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'"match_pattern": "regex",\n"match": "^profit_\\d+$"\n')),(0,r.kt)("h4",{id:"\u573a\u666f"},"\u573a\u666f"),(0,r.kt)("p",null,"1\u7ed3\u6784\u5316\u641c\u7d22"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0celasticsearch\u5c06\u5b57\u7b26\u4e32\u5b57\u6bb5\u6620\u5c04\u4e3a\u5e26\u6709\u5b50\u5173\u952e\u5b57\u5b57\u6bb5\u7684\u6587\u672c\u5b57\u6bb5\u3002\u4f46\u662f\uff0c\u5982\u679c\u53ea\u5bf9\u7ed3\u6784\u5316\u5185\u5bb9\u8fdb\u884c\u7d22\u5f15\uff0c\u800c\u5bf9\u5168\u6587\u641c\u7d22\u4e0d\u611f\u5174\u8da3\uff0c\u5219\u53ef\u4ee5\u4ec5\u5c06\u201c\u5b57\u6bb5\u201d\u6620\u5c04\u4e3a\u201c\u5173\u952e\u5b57\u201d\u3002\u8bf7\u6ce8\u610f\uff0c\u8fd9\u610f\u5473\u7740\u4e3a\u4e86\u641c\u7d22\u8fd9\u4e9b\u5b57\u6bb5\uff0c\u5fc5\u987b\u641c\u7d22\u7d22\u5f15\u6240\u7528\u7684\u5b8c\u5168\u76f8\u540c\u7684\u503c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "strings_as_keywords": {\n        "match_mapping_type": "string",\n        "mapping": {\n            "type": "keyword"\n        }\n    }\n}\n')),(0,r.kt)("p",null,"2\u4ec5\u641c\u7d22"),(0,r.kt)("p",null,"\u4e0e\u524d\u9762\u7684\u793a\u4f8b\u76f8\u53cd\uff0c\u5982\u679c\u60a8\u53ea\u5173\u5fc3\u5b57\u7b26\u4e32\u5b57\u6bb5\u7684\u5168\u6587\u641c\u7d22\uff0c\u5e76\u4e14\u4e0d\u6253\u7b97\u5bf9\u5b57\u7b26\u4e32\u5b57\u6bb5\u8fd0\u884c\u805a\u5408\u3001\u6392\u5e8f\u6216\u7cbe\u786e\u641c\u7d22\uff0c\u60a8\u53ef\u4ee5\u544a\u8bc9\u5f39\u6027\u641c\u7d22\u5c06\u5176\u4ec5\u6620\u5c04\u4e3a\u6587\u672c\u5b57\u6bb5\uff08\u8fd9\u662f5\u4e4b\u524d\u7684\u9ed8\u8ba4\u884c\u4e3a\uff09"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "strings_as_text": {\n        "match_mapping_type": "string",\n        "mapping": {\n            "type": "text"\n        }\n    }\n}\n')),(0,r.kt)("p",null,"3norms \u4e0d\u5173\u5fc3\u8bc4\u5206"),(0,r.kt)("p",null,"norms\u662f\u6307\u6807\u65f6\u95f4\u7684\u8bc4\u5206\u56e0\u7d20\u3002\u5982\u679c\u60a8\u4e0d\u5173\u5fc3\u8bc4\u5206\uff0c\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4ece\u4e0d\u6309\u8bc4\u5206\u5bf9\u6587\u6863\u8fdb\u884c\u6392\u5e8f\uff0c\u5219\u53ef\u4ee5\u5728\u7d22\u5f15\u4e2d\u7981\u7528\u8fd9\u4e9b\u8bc4\u5206\u56e0\u5b50\u7684\u5b58\u50a8\u5e76\u8282\u7701\u4e00\u4e9b\u7a7a\u95f4\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "strings_as_keywords": {\n        "match_mapping_type": "string",\n        "mapping": {\n            "type": "text",\n            "norms": false,\n            "fields": {\n                "keyword": {\n                    "type": "keyword",\n                    "ignore_above": 256\n                }\n            }\n        }\n    }\n}\n')),(0,r.kt)("h3",{id:"\u4e94\u96f6\u505c\u673a\u91cd\u5efa\u7d22\u5f15"},"\u4e94\u3001\u96f6\u505c\u673a\u91cd\u5efa\u7d22\u5f15"),(0,r.kt)("h4",{id:"1\u96f6\u505c\u673a\u91cd\u5efa\u7d22\u5f15"},"1\u3001\u96f6\u505c\u673a\u91cd\u5efa\u7d22\u5f15"),(0,r.kt)("p",null,"\u573a\u666f\uff1a"),(0,r.kt)("p",null,"\u4e00\u4e2afield\u7684\u8bbe\u7f6e\u662f\u4e0d\u80fd\u88ab\u4fee\u6539\u7684\uff0c\u5982\u679c\u8981\u4fee\u6539\u4e00\u4e2aField\uff0c\u90a3\u4e48\u5e94\u8be5\u91cd\u65b0\u6309\u7167\u65b0\u7684mapping\uff0c\u5efa\u7acb\u4e00\u4e2aindex\uff0c\u7136\u540e\u5c06\u6570\u636e\u6279\u91cf\u67e5\u8be2\u51fa\u6765\uff0c\u91cd\u65b0\u7528bulk api\u5199\u5165index\u4e2d\u3002"),(0,r.kt)("p",null,"\u6279\u91cf\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5efa\u8bae\u91c7\u7528scroll api\uff0c\u5e76\u4e14\u91c7\u7528\u591a\u7ebf\u7a0b\u5e76\u53d1\u7684\u65b9\u5f0f\u6765reindex\u6570\u636e\uff0c\u6bcf\u6b21scoll\u5c31\u67e5\u8be2\u6307\u5b9a\u65e5\u671f\u7684\u4e00\u6bb5\u6570\u636e\uff0c\u4ea4\u7ed9\u4e00\u4e2a\u7ebf\u7a0b\u5373\u53ef\u3002"),(0,r.kt)("p",null,"(1)\u4e00\u5f00\u59cb\uff0c\u4f9d\u9760dynamic mapping\uff0c\u63d2\u5165\u6570\u636e\uff0c\u4f46\u662f\u4e0d\u5c0f\u5fc3\u6709\u4e9b\u6570\u636e\u662f2019-09-10\u8fd9\u79cd\u65e5\u671f\u683c\u5f0f\u7684\uff0c\u6240\u4ee5title\u8fd9\u79cdfield\u88ab\u81ea\u52a8\u6620\u5c04\u4e3a\u4e86date\u7c7b\u578b\uff0c\u5b9e\u9645\u4e0a\u5b83\u5e94\u8be5\u662fstring\u7c7b\u578b\u7684"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index/_doc/1\n{\n  "title": "2019-09-10"\n}\n\nPUT /my_index/_doc/2\n{\n  "title": "2019-09-11"\n}\n')),(0,r.kt)("p",null,"\uff082\uff09\u5f53\u540e\u671f\u5411\u7d22\u5f15\u4e2d\u52a0\u5165string\u7c7b\u578b\u7684title\u503c\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u62a5\u9519"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index/_doc/3\n{\n  "title": "my first article"\n}\n')),(0,r.kt)("p",null,"\u62a5\u9519"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "error": {\n        "root_cause": [\n            {\n                "type": "mapper_parsing_exception",\n                "reason": "failed to parse [title]"\n            }\n        ],\n        "type": "mapper_parsing_exception",\n        "reason": "failed to parse [title]",\n        "caused_by": {\n            "type": "illegal_argument_exception",\n            "reason": "Invalid format: \\"my first article\\""\n        }\n    },\n    "status": 400\n}\n')),(0,r.kt)("p",null,"\uff083\uff09\u5982\u679c\u6b64\u65f6\u60f3\u4fee\u6539title\u7684\u7c7b\u578b\uff0c\u662f\u4e0d\u53ef\u80fd\u7684"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index/_mapping\n{\n  "properties": {\n    "title": {\n      "type": "text"\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u62a5\u9519"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "error": {\n        "root_cause": [\n            {\n                "type": "illegal_argument_exception",\n                "reason": "mapper [title] of different type, current_type [date], merged_type [text]"\n            }\n        ],\n        "type": "illegal_argument_exception",\n        "reason": "mapper [title] of different type, current_type [date], merged_type [text]"\n    },\n    "status": 400\n}\n')),(0,r.kt)("p",null,"\uff084\uff09\u6b64\u65f6\uff0c\u552f\u4e00\u7684\u529e\u6cd5\uff0c\u5c31\u662f\u8fdb\u884creindex\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u91cd\u65b0\u5efa\u7acb\u4e00\u4e2a\u7d22\u5f15\uff0c\u5c06\u65e7\u7d22\u5f15\u7684\u6570\u636e\u67e5\u8be2\u51fa\u6765\uff0c\u518d\u5bfc\u5165\u65b0\u7d22\u5f15\u3002"),(0,r.kt)("p",null,"\uff085\uff09\u5982\u679c\u8bf4\u65e7\u7d22\u5f15\u7684\u540d\u5b57\uff0c\u662fold_index\uff0c\u65b0\u7d22\u5f15\u7684\u540d\u5b57\u662fnew_index\uff0c\u7ec8\u7aefjava\u5e94\u7528\uff0c\u5df2\u7ecf\u5728\u4f7f\u7528old_index\u5728\u64cd\u4f5c\u4e86\uff0c\u96be\u9053\u8fd8\u8981\u53bb\u505c\u6b62java\u5e94\u7528\uff0c\u4fee\u6539\u4f7f\u7528\u7684index\u4e3anew_index\uff0c\u624d\u91cd\u65b0\u542f\u52a8java\u5e94\u7528\u5417\uff1f\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5c31\u4f1a\u5bfc\u81f4java\u5e94\u7528\u505c\u673a\uff0c\u53ef\u7528\u6027\u964d\u4f4e\u3002"),(0,r.kt)("p",null,"\uff086\uff09\u6240\u4ee5\u8bf4\uff0c\u7ed9java\u5e94\u7528\u4e00\u4e2a\u522b\u540d\uff0c\u8fd9\u4e2a\u522b\u540d\u662f\u6307\u5411\u65e7\u7d22\u5f15\u7684\uff0cjava\u5e94\u7528\u5148\u7528\u7740\uff0cjava\u5e94\u7528\u5148\u7528prod_index alias\u6765\u64cd\u4f5c\uff0c\u6b64\u65f6\u5b9e\u9645\u6307\u5411\u7684\u662f\u65e7\u7684my_index"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"PUT /my_index/_alias/prod_index\n")),(0,r.kt)("p",null,"\uff087\uff09\u65b0\u5efa\u4e00\u4e2aindex\uff0c\u8c03\u6574\u5176title\u7684\u7c7b\u578b\u4e3astring"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /my_index_new\n{\n  "mappings": {\n    "properties": {\n        "title": {\n         "type": "text"\n        }\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\uff088\uff09\u4f7f\u7528scroll api\u5c06\u6570\u636e\u6279\u91cf\u67e5\u8be2\u51fa\u6765"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'GET /my_index/_search?scroll=1m\n{\n    "query": {\n        "match_all": {}\n    },    \n    "size":  1\n}\n')),(0,r.kt)("p",null,"\u8fd4\u56de"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "_scroll_id": "DnF1ZXJ5VGhlbkZldGNoBQAAAAAAADpAFjRvbnNUWVZaVGpHdklqOV9zcFd6MncAAAAAAAA6QRY0b25zVFlWWlRqR3ZJajlfc3BXejJ3AAAAAAAAOkIWNG9uc1RZVlpUakd2SWo5X3NwV3oydwAAAAAAADpDFjRvbnNUWVZaVGpHdklqOV9zcFd6MncAAAAAAAA6RBY0b25zVFlWWlRqR3ZJajlfc3BXejJ3",\n    "took": 1,\n    "timed_out": false,\n    "_shards": {\n        "total": 5,\n        "successful": 5,\n        "failed": 0\n    },\n    "hits": {\n        "total": 3,\n        "max_score": null,\n        "hits": [\n            {\n                "_index": "my_index",\n                "_type": "my_type",\n                "_id": "1",\n                "_score": null,\n                "_source": {\n                    "title": "2019-01-02"\n                },\n                "sort": [\n                    0\n                ]\n            }\n        ]\n    }\n}\n')),(0,r.kt)("p",null,"\uff089\uff09\u91c7\u7528bulk api\u5c06scoll\u67e5\u51fa\u6765\u7684\u4e00\u6279\u6570\u636e\uff0c\u6279\u91cf\u5199\u5165\u65b0\u7d22\u5f15"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'POST /_bulk\n{ "index":  { "_index": "my_index_new", "_id": "1" }}\n{ "title":    "2019-09-10" }\n')),(0,r.kt)("p",null,"\uff0810\uff09\u53cd\u590d\u5faa\u73af8~9\uff0c\u67e5\u8be2\u4e00\u6279\u53c8\u4e00\u6279\u7684\u6570\u636e\u51fa\u6765\uff0c\u91c7\u53d6bulk api\u5c06\u6bcf\u4e00\u6279\u6570\u636e\u6279\u91cf\u5199\u5165\u65b0\u7d22\u5f15"),(0,r.kt)("p",null,"\uff0811\uff09\u5c06prod_index alias\u5207\u6362\u5230my_index_new\u4e0a\u53bb\uff0cjava\u5e94\u7528\u4f1a\u76f4\u63a5\u901a\u8fc7index\u522b\u540d\u4f7f\u7528\u65b0\u7684\u7d22\u5f15\u4e2d\u7684\u6570\u636e\uff0cjava\u5e94\u7528\u7a0b\u5e8f\u4e0d\u9700\u8981\u505c\u673a\uff0c\u96f6\u63d0\u4ea4\uff0c\u9ad8\u53ef\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'POST /_aliases\n{\n    "actions": [\n        { "remove": { "index": "my_index", "alias": "prod_index" }},\n        { "add":    { "index": "my_index_new", "alias": "prod_index" }}\n    ]\n}\n')),(0,r.kt)("p",null,"\uff0812\uff09\u76f4\u63a5\u901a\u8fc7prod_index\u522b\u540d\u6765\u67e5\u8be2\uff0c\u662f\u5426ok"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"GET /prod_index/_search\n")),(0,r.kt)("h4",{id:"2\u751f\u4ea7\u5b9e\u8df5\u57fa\u4e8ealias\u5bf9client\u900f\u660e\u5207\u6362index"},"2\u3001\u751f\u4ea7\u5b9e\u8df5\uff1a\u57fa\u4e8ealias\u5bf9client\u900f\u660e\u5207\u6362index"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"PUT /my_index_v1/_alias/my_index\n")),(0,r.kt)("p",null,"client\u5bf9my_index\u8fdb\u884c\u64cd\u4f5c"),(0,r.kt)("p",null,"reindex\u64cd\u4f5c\uff0c\u5b8c\u6210\u4e4b\u540e\uff0c\u5207\u6362v1\u5230v2"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'POST /_aliases\n{\n    "actions": [\n        { "remove": { "index": "my_index_v1", "alias": "my_index" }},\n        { "add":    { "index": "my_index_v2", "alias": "my_index" }}\n    ]\n}\n')),(0,r.kt)("h2",{id:"\u7b2c\u5341\u4e8c\u7ae0-\u4e2d\u6587\u5206\u8bcd\u5668-ik\u5206\u8bcd\u5668"},"\u7b2c\u5341\u4e8c\u7ae0 \u4e2d\u6587\u5206\u8bcd\u5668 IK\u5206\u8bcd\u5668"),(0,r.kt)("h3",{id:"\u4e00ik\u5206\u8bcd\u5668\u5b89\u88c5\u4f7f\u7528"},"\u4e00\u3001Ik\u5206\u8bcd\u5668\u5b89\u88c5\u4f7f\u7528"),(0,r.kt)("h4",{id:"1\u4e2d\u6587\u5206\u8bcd\u5668"},"1\u3001\u4e2d\u6587\u5206\u8bcd\u5668"),(0,r.kt)("p",null,"standard \u5206\u8bcd\u5668\uff0c\u4ec5\u9002\u7528\u4e8e\u82f1\u6587\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /_analyze\n{\n  "analyzer": "standard",\n  "text": "\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u4eba\u6c11\u5927\u4f1a\u5802"\n}\n')),(0,r.kt)("p",null,"\u6211\u4eec\u60f3\u8981\u7684\u6548\u679c\u662f\u4ec0\u4e48\uff1a\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\uff0c\u4eba\u6c11\u5927\u4f1a\u5802"),(0,r.kt)("p",null,"IK\u5206\u8bcd\u5668\u5c31\u662f\u76ee\u524d\u6700\u6d41\u884c\u7684es\u4e2d\u6587\u5206\u8bcd\u5668"),(0,r.kt)("h4",{id:"2\u5b89\u88c5"},"2\u3001\u5b89\u88c5"),(0,r.kt)("p",null,"\u5b98\u7f51\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://github.com/medcl/elasticsearch-analysis-ik"},"https://github.com/medcl/elasticsearch-analysis-ikopen in new window")),(0,r.kt)("p",null,"\u4e0b\u8f7d\u5730\u5740\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://github.com/medcl/elasticsearch-analysis-ik/releases"},"https://github.com/medcl/elasticsearch-analysis-ik/releasesopen in new window")),(0,r.kt)("p",null,"\u6839\u636ees\u7248\u672c\u4e0b\u8f7d\u76f8\u5e94\u7248\u672c\u5305\u3002"),(0,r.kt)("p",null,"\u89e3\u538b\u5230 es/plugins/ik\u4e2d\u3002"),(0,r.kt)("p",null,"\u91cd\u542fes"),(0,r.kt)("h4",{id:"3ik\u5206\u8bcd\u5668\u57fa\u7840\u77e5\u8bc6"},"3\u3001ik\u5206\u8bcd\u5668\u57fa\u7840\u77e5\u8bc6"),(0,r.kt)("p",null,"ik_max_word: \u4f1a\u5c06\u6587\u672c\u505a\u6700\u7ec6\u7c92\u5ea6\u7684\u62c6\u5206\uff0c\u6bd4\u5982\u4f1a\u5c06\u201c\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u4eba\u6c11\u5927\u4f1a\u5802\u201d\u62c6\u5206\u4e3a\u201c\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\uff0c\u4e2d\u534e\u4eba\u6c11\uff0c\u4e2d\u534e\uff0c\u534e\u4eba\uff0c\u4eba\u6c11\u5171\u548c\u56fd\uff0c\u4eba\u6c11\u5927\u4f1a\u5802\uff0c\u4eba\u6c11\u5927\u4f1a\uff0c\u5927\u4f1a\u5802\u201d\uff0c\u4f1a\u7a77\u5c3d\u5404\u79cd\u53ef\u80fd\u7684\u7ec4\u5408\uff1b"),(0,r.kt)("p",null,"ik_smart: \u4f1a\u505a\u6700\u7c97\u7c92\u5ea6\u7684\u62c6\u5206\uff0c\u6bd4\u5982\u4f1a\u5c06\u201c\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u4eba\u6c11\u5927\u4f1a\u5802\u201d\u62c6\u5206\u4e3a\u201c\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\uff0c\u4eba\u6c11\u5927\u4f1a\u5802\u201d\u3002"),(0,r.kt)("h4",{id:"4ik\u5206\u8bcd\u5668\u7684\u4f7f\u7528"},"4\u3001ik\u5206\u8bcd\u5668\u7684\u4f7f\u7528"),(0,r.kt)("p",null,"\u5b58\u50a8\u65f6\uff0c\u4f7f\u7528ik_max_word\uff0c\u641c\u7d22\u65f6\uff0c\u4f7f\u7528ik_smart"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'PUT /my_index \n{\n  "mappings": {\n      "properties": {\n        "text": {\n          "type": "text",\n          "analyzer": "ik_max_word",\n          "search_analyzer": "ik_smart"\n        }\n      }\n  }\n}\n')),(0,r.kt)("p",null,"\u641c\u7d22"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"GET /my_index/_search?q=\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u4eba\u6c11\u5927\u4f1a\u5802\n")),(0,r.kt)("h3",{id:"\u4e8c-ik\u914d\u7f6e\u6587\u4ef6"},"\u4e8c\u3001 ik\u914d\u7f6e\u6587\u4ef6"),(0,r.kt)("h4",{id:"1-ik\u914d\u7f6e\u6587\u4ef6"},"1\u3001 ik\u914d\u7f6e\u6587\u4ef6"),(0,r.kt)("p",null,"ik\u914d\u7f6e\u6587\u4ef6\u5730\u5740\uff1aes/plugins/ik/config\u76ee\u5f55"),(0,r.kt)("p",null,"IKAnalyzer.cfg.xml\uff1a\u7528\u6765\u914d\u7f6e\u81ea\u5b9a\u4e49\u8bcd\u5e93"),(0,r.kt)("p",null,"main.dic\uff1aik\u539f\u751f\u5185\u7f6e\u7684\u4e2d\u6587\u8bcd\u5e93\uff0c\u603b\u5171\u670927\u4e07\u591a\u6761\uff0c\u53ea\u8981\u662f\u8fd9\u4e9b\u5355\u8bcd\uff0c\u90fd\u4f1a\u88ab\u5206\u5728\u4e00\u8d77"),(0,r.kt)("p",null,"preposition.dic: \u4ecb\u8bcd"),(0,r.kt)("p",null,"quantifier.dic\uff1a\u653e\u4e86\u4e00\u4e9b\u5355\u4f4d\u76f8\u5173\u7684\u8bcd\uff0c\u91cf\u8bcd"),(0,r.kt)("p",null,"suffix.dic\uff1a\u653e\u4e86\u4e00\u4e9b\u540e\u7f00"),(0,r.kt)("p",null,"surname.dic\uff1a\u4e2d\u56fd\u7684\u59d3\u6c0f"),(0,r.kt)("p",null,"stopword.dic\uff1a\u82f1\u6587\u505c\u7528\u8bcd"),(0,r.kt)("p",null,"ik\u539f\u751f\u6700\u91cd\u8981\u7684\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6"),(0,r.kt)("p",null,"main.dic\uff1a\u5305\u542b\u4e86\u539f\u751f\u7684\u4e2d\u6587\u8bcd\u8bed\uff0c\u4f1a\u6309\u7167\u8fd9\u4e2a\u91cc\u9762\u7684\u8bcd\u8bed\u53bb\u5206\u8bcd"),(0,r.kt)("p",null,"stopword.dic\uff1a\u5305\u542b\u4e86\u82f1\u6587\u7684\u505c\u7528\u8bcd"),(0,r.kt)("p",null,"\u505c\u7528\u8bcd\uff0cstopword"),(0,r.kt)("p",null,"a the and at but"),(0,r.kt)("p",null,"\u4e00\u822c\uff0c\u50cf\u505c\u7528\u8bcd\uff0c\u4f1a\u5728\u5206\u8bcd\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u88ab\u5e72\u6389\uff0c\u4e0d\u4f1a\u5efa\u7acb\u5728\u5012\u6392\u7d22\u5f15\u4e2d"),(0,r.kt)("h4",{id:"2\u81ea\u5b9a\u4e49\u8bcd\u5e93"},"2\u3001\u81ea\u5b9a\u4e49\u8bcd\u5e93"),(0,r.kt)("p",null,"\uff081\uff09\u81ea\u5df1\u5efa\u7acb\u8bcd\u5e93\uff1a\u6bcf\u5e74\u90fd\u4f1a\u6d8c\u73b0\u4e00\u4e9b\u7279\u6b8a\u7684\u6d41\u884c\u8bcd\uff0c\u7f51\u7ea2\uff0c\u84dd\u7626\u9999\u83c7\uff0c\u558a\u9ea6\uff0c\u9b3c\u755c\uff0c\u4e00\u822c\u4e0d\u4f1a\u5728ik\u7684\u539f\u751f\u8bcd\u5178\u91cc"),(0,r.kt)("p",null,"\u81ea\u5df1\u8865\u5145\u81ea\u5df1\u7684\u6700\u65b0\u7684\u8bcd\u8bed\uff0c\u5230ik\u7684\u8bcd\u5e93\u91cc\u9762"),(0,r.kt)("p",null,"IKAnalyzer.cfg.xml\uff1aext_dict\uff0c\u521b\u5efamydict.dic\u3002"),(0,r.kt)("p",null,"\u8865\u5145\u81ea\u5df1\u7684\u8bcd\u8bed\uff0c\u7136\u540e\u9700\u8981\u91cd\u542fes\uff0c\u624d\u80fd\u751f\u6548"),(0,r.kt)("p",null,"\uff082\uff09\u81ea\u5df1\u5efa\u7acb\u505c\u7528\u8bcd\u5e93\uff1a\u6bd4\u5982\u4e86\uff0c\u7684\uff0c\u5565\uff0c\u4e48\uff0c\u6211\u4eec\u53ef\u80fd\u5e76\u4e0d\u60f3\u53bb\u5efa\u7acb\u7d22\u5f15\uff0c\u8ba9\u4eba\u5bb6\u641c\u7d22"),(0,r.kt)("p",null,"custom/ext_stopword.dic\uff0c\u5df2\u7ecf\u6709\u4e86\u5e38\u7528\u7684\u4e2d\u6587\u505c\u7528\u8bcd\uff0c\u53ef\u4ee5\u8865\u5145\u81ea\u5df1\u7684\u505c\u7528\u8bcd\uff0c\u7136\u540e\u91cd\u542fes"),(0,r.kt)("h3",{id:"\u4e09\u4f7f\u7528mysql\u70ed\u66f4\u65b0-\u8bcd\u5e93"},"\u4e09\u3001\u4f7f\u7528mysql\u70ed\u66f4\u65b0 \u8bcd\u5e93"),(0,r.kt)("h4",{id:"1\u70ed\u66f4\u65b0"},"1\u3001\u70ed\u66f4\u65b0"),(0,r.kt)("p",null,"\u6bcf\u6b21\u90fd\u662f\u5728es\u7684\u6269\u5c55\u8bcd\u5178\u4e2d\uff0c\u624b\u52a8\u6dfb\u52a0\u65b0\u8bcd\u8bed\uff0c\u5f88\u5751"),(0,r.kt)("p",null,"\uff081\uff09\u6bcf\u6b21\u6dfb\u52a0\u5b8c\uff0c\u90fd\u8981\u91cd\u542fes\u624d\u80fd\u751f\u6548\uff0c\u975e\u5e38\u9ebb\u70e6"),(0,r.kt)("p",null,"\uff082\uff09es\u662f\u5206\u5e03\u5f0f\u7684\uff0c\u53ef\u80fd\u6709\u6570\u767e\u4e2a\u8282\u70b9\uff0c\u4f60\u4e0d\u80fd\u6bcf\u6b21\u90fd\u4e00\u4e2a\u4e00\u4e2a\u8282\u70b9\u4e0a\u9762\u53bb\u4fee\u6539"),(0,r.kt)("p",null,"es\u4e0d\u505c\u673a\uff0c\u76f4\u63a5\u6211\u4eec\u5728\u5916\u90e8\u67d0\u4e2a\u5730\u65b9\u6dfb\u52a0\u65b0\u7684\u8bcd\u8bed\uff0ces\u4e2d\u7acb\u5373\u70ed\u52a0\u8f7d\u5230\u8fd9\u4e9b\u65b0\u8bcd\u8bed"),(0,r.kt)("p",null,"\u70ed\u66f4\u65b0\u7684\u65b9\u6848"),(0,r.kt)("p",null,"\uff081\uff09\u57fa\u4e8eik\u5206\u8bcd\u5668\u539f\u751f\u652f\u6301\u7684\u70ed\u66f4\u65b0\u65b9\u6848\uff0c\u90e8\u7f72\u4e00\u4e2aweb\u670d\u52a1\u5668\uff0c\u63d0\u4f9b\u4e00\u4e2ahttp\u63a5\u53e3\uff0c\u901a\u8fc7modified\u548ctag\u4e24\u4e2ahttp\u54cd\u5e94\u5934\uff0c\u6765\u63d0\u4f9b\u8bcd\u8bed\u7684\u70ed\u66f4\u65b0"),(0,r.kt)("p",null,"\uff082\uff09\u4fee\u6539ik\u5206\u8bcd\u5668\u6e90\u7801\uff0c\u7136\u540e\u624b\u52a8\u652f\u6301\u4ecemysql\u4e2d\u6bcf\u9694\u4e00\u5b9a\u65f6\u95f4\uff0c\u81ea\u52a8\u52a0\u8f7d\u65b0\u7684\u8bcd\u5e93"),(0,r.kt)("p",null,"\u7528\u7b2c\u4e8c\u79cd\u65b9\u6848\uff0c\u7b2c\u4e00\u79cd\uff0cik git\u793e\u533a\u5b98\u65b9\u90fd\u4e0d\u5efa\u8bae\u91c7\u7528\uff0c\u89c9\u5f97\u4e0d\u592a\u7a33\u5b9a"),(0,r.kt)("h4",{id:"2\u6b65\u9aa4"},"2\u3001\u6b65\u9aa4"),(0,r.kt)("p",null,"1\u3001\u4e0b\u8f7d\u6e90\u7801"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/medcl/elasticsearch-analysis-ik/releases"},"https://github.com/medcl/elasticsearch-analysis-ik/releasesopen in new window")),(0,r.kt)("p",null,"ik\u5206\u8bcd\u5668\uff0c\u662f\u4e2a\u6807\u51c6\u7684java maven\u5de5\u7a0b\uff0c\u76f4\u63a5\u5bfc\u5165eclipse\u5c31\u53ef\u4ee5\u770b\u5230\u6e90\u7801"),(0,r.kt)("p",null,"2\u3001\u4fee\u6539\u6e90"),(0,r.kt)("p",null,"org.wltea.analyzer.dic.Dictionary\u7c7b\uff0c160\u884cDictionary\u5355\u4f8b\u7c7b\u7684\u521d\u59cb\u5316\u65b9\u6cd5\uff0c\u5728\u8fd9\u91cc\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u7ebf\u7a0b\uff0c\u5e76\u4e14\u542f\u52a8\u5b83"),(0,r.kt)("p",null,"org.wltea.analyzer.dic.HotDictReloadThread\u7c7b\uff1a\u5c31\u662f\u6b7b\u5faa\u73af\uff0c\u4e0d\u65ad\u8c03\u7528Dictionary.getSingleton().reLoadMainDict()\uff0c\u53bb\u91cd\u65b0\u52a0\u8f7d\u8bcd\u5178"),(0,r.kt)("p",null,"Dictionary\u7c7b\uff0c399\u884c\uff1athis.loadMySQLExtDict(); \u52a0\u8f7dmymsql\u5b57\u5178\u3002"),(0,r.kt)("p",null,"Dictionary\u7c7b\uff0c609\u884c\uff1athis.loadMySQLStopwordDict();\u52a0\u8f7dmysql\u505c\u7528\u8bcd"),(0,r.kt)("p",null,"config\u4e0bjdbc-reload.properties\u3002mysql\u914d\u7f6e\u6587\u4ef6"),(0,r.kt)("p",null,"3\u3001mvn package\u6253\u5305\u4ee3\u7801"),(0,r.kt)("p",null,"target\\releases\\elasticsearch-analysis-ik-7.3.0.zip"),(0,r.kt)("p",null,"4\u3001\u89e3\u538b\u7f29ik\u538b\u7f29\u5305"),(0,r.kt)("p",null,"\u5c06mysql\u9a71\u52a8jar\uff0c\u653e\u5165ik\u7684\u76ee\u5f55\u4e0b"),(0,r.kt)("p",null,"5\u3001\u4fee\u6539jdbc\u76f8\u5173\u914d\u7f6e"),(0,r.kt)("p",null,"6\u3001\u91cd\u542fes"),(0,r.kt)("p",null,"\u89c2\u5bdf\u65e5\u5fd7\uff0c\u65e5\u5fd7\u4e2d\u5c31\u4f1a\u663e\u793a\u6211\u4eec\u6253\u5370\u7684\u90a3\u4e9b\u4e1c\u897f\uff0c\u6bd4\u5982\u52a0\u8f7d\u4e86\u4ec0\u4e48\u914d\u7f6e\uff0c\u52a0\u8f7d\u4e86\u4ec0\u4e48\u8bcd\u8bed\uff0c\u4ec0\u4e48\u505c\u7528\u8bcd"),(0,r.kt)("p",null,"7\u3001\u5728mysql\u4e2d\u6dfb\u52a0\u8bcd\u5e93\u4e0e\u505c\u7528\u8bcd"),(0,r.kt)("p",null,"8\u3001\u5206\u8bcd\u5b9e\u9a8c\uff0c\u9a8c\u8bc1\u70ed\u66f4\u65b0\u751f\u6548"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /_analyze\n{\n  "analyzer": "ik_smart",\n  "text": "\u4f20\u667a\u64ad\u5ba2"\n}\n')),(0,r.kt)("h2",{id:"\u7b2c\u5341\u4e09\u7ae0-java-api-\u5b9e\u73b0\u7d22\u5f15\u7ba1\u7406"},"\u7b2c\u5341\u4e09\u7ae0 java api \u5b9e\u73b0\u7d22\u5f15\u7ba1\u7406"),(0,r.kt)("p",null,"\u4ee3\u7801"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@SpringBootTest\n@RunWith(SpringRunner.class)\npublic class TestIndex {\n\n    @Autowired\n    RestHighLevelClient client;\n\n    //    @Autowired\n    //    RestClient restClient;\n    //\u521b\u5efa\u7d22\u5f15\n    @Test\n    public void testCreateIndex() throws IOException {\n        //\u521b\u5efa\u7d22\u5f15\u5bf9\u8c61\n        CreateIndexRequest createIndexRequest = new CreateIndexRequest("ydlclass_book");\n        //\u8bbe\u7f6e\u53c2\u6570\n        createIndexRequest.settings(Settings.builder().put("number_of_shards", "1").put("number_of_replicas", "0"));\n        //\u6307\u5b9a\u6620\u5c041\n        createIndexRequest.mapping(" {\\n" +\n                                   " \\t\\"properties\\": {\\n" +\n                                   "            \\"name\\":{\\n" +\n                                   "             \\"type\\":\\"keyword\\"\\n" +\n                                   "           },\\n" +\n                                   "           \\"description\\": {\\n" +\n                                   "              \\"type\\": \\"text\\"\\n" +\n                                   "           },\\n" +\n                                   "            \\"price\\":{\\n" +\n                                   "             \\"type\\":\\"long\\"\\n" +\n                                   "           },\\n" +\n                                   "           \\"pic\\":{\\n" +\n                                   "             \\"type\\":\\"text\\",\\n" +\n                                   "             \\"index\\":false\\n" +\n                                   "           }\\n" +\n                                   " \\t}\\n" +\n                                   "}", XContentType.JSON);\n\n        //\u6307\u5b9a\u6620\u5c042\n\n\n        //        Map<String, Object> message = new HashMap<>();\n        //        message.put("type", "text");\n        //        Map<String, Object> properties = new HashMap<>();\n        //        properties.put("message", message);\n        //        Map<String, Object> mapping = new HashMap<>();\n        //        mapping.put("properties", properties);\n        //        createIndexRequest.mapping(mapping);\n\n        //\u6307\u5b9a\u6620\u5c043\n\n\n        //        XContentBuilder builder = XContentFactory.jsonBuilder();\n        //        builder.startObject();\n        //        {\n        //            builder.startObject("properties");\n        //            {\n        //                builder.startObject("message");\n        //                {\n        //                    builder.field("type", "text");\n        //                }\n        //                builder.endObject();\n        //            }\n        //            builder.endObject();\n        //        }\n        //        builder.endObject();\n        //        createIndexRequest.mapping(builder);\n\n\n        //\u8bbe\u7f6e\u522b\u540d\n        createIndexRequest.alias(new Alias("ydlclass_index_new"));\n\n        // \u989d\u5916\u53c2\u6570\n        //\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\n        createIndexRequest.setTimeout(TimeValue.timeValueMinutes(2));\n        //\u8bbe\u7f6e\u4e3b\u8282\u70b9\u8d85\u65f6\u65f6\u95f4\n        createIndexRequest.setMasterTimeout(TimeValue.timeValueMinutes(1));\n        //\u5728\u521b\u5efa\u7d22\u5f15API\u8fd4\u56de\u54cd\u5e94\u4e4b\u524d\u7b49\u5f85\u7684\u6d3b\u52a8\u5206\u7247\u526f\u672c\u7684\u6570\u91cf\uff0c\u4ee5int\u5f62\u5f0f\u8868\u793a\n        createIndexRequest.waitForActiveShards(ActiveShardCount.from(2));\n        createIndexRequest.waitForActiveShards(ActiveShardCount.DEFAULT);\n\n        //\u64cd\u4f5c\u7d22\u5f15\u7684\u5ba2\u6237\u7aef\n        IndicesClient indices = client.indices();\n        //\u6267\u884c\u521b\u5efa\u7d22\u5f15\u5e93\n        CreateIndexResponse createIndexResponse = indices.create(createIndexRequest, RequestOptions.DEFAULT);\n\n        //\u5f97\u5230\u54cd\u5e94\uff08\u5168\u90e8\uff09\n        boolean acknowledged = createIndexResponse.isAcknowledged();\n        //\u5f97\u5230\u54cd\u5e94 \u6307\u793a\u662f\u5426\u5728\u8d85\u65f6\u524d\u4e3a\u7d22\u5f15\u4e2d\u7684\u6bcf\u4e2a\u5206\u7247\u542f\u52a8\u4e86\u6240\u9700\u6570\u91cf\u7684\u788e\u7247\u526f\u672c\n        boolean shardsAcknowledged = createIndexResponse.isShardsAcknowledged();\n\n        System.out.println("!!!!!!!!!!!!!!!!!!!!!!!!!!!" + acknowledged);\n        System.out.println(shardsAcknowledged);\n\n    }\n\n\n    //\u5f02\u6b65\u65b0\u589e\u7d22\u5f15\n    @Test\n    public void testCreateIndexAsync() throws IOException {\n        //\u521b\u5efa\u7d22\u5f15\u5bf9\u8c61\n        CreateIndexRequest createIndexRequest = new CreateIndexRequest("ydlclass_book2");\n        //\u8bbe\u7f6e\u53c2\u6570\n        createIndexRequest.settings(Settings.builder().put("number_of_shards", "1").put("number_of_replicas", "0"));\n        //\u6307\u5b9a\u6620\u5c041\n        createIndexRequest.mapping(" {\\n" +\n                                   " \\t\\"properties\\": {\\n" +\n                                   "            \\"name\\":{\\n" +\n                                   "             \\"type\\":\\"keyword\\"\\n" +\n                                   "           },\\n" +\n                                   "           \\"description\\": {\\n" +\n                                   "              \\"type\\": \\"text\\"\\n" +\n                                   "           },\\n" +\n                                   "            \\"price\\":{\\n" +\n                                   "             \\"type\\":\\"long\\"\\n" +\n                                   "           },\\n" +\n                                   "           \\"pic\\":{\\n" +\n                                   "             \\"type\\":\\"text\\",\\n" +\n                                   "             \\"index\\":false\\n" +\n                                   "           }\\n" +\n                                   " \\t}\\n" +\n                                   "}", XContentType.JSON);\n\n        //\u76d1\u542c\u65b9\u6cd5\n        ActionListener<CreateIndexResponse> listener =\n            new ActionListener<CreateIndexResponse>() {\n\n            @Override\n            public void onResponse(CreateIndexResponse createIndexResponse) {\n                System.out.println("!!!!!!!!\u521b\u5efa\u7d22\u5f15\u6210\u529f");\n                System.out.println(createIndexResponse.toString());\n            }\n\n            @Override\n            public void onFailure(Exception e) {\n                System.out.println("!!!!!!!!\u521b\u5efa\u7d22\u5f15\u5931\u8d25");\n                e.printStackTrace();\n            }\n        };\n\n        //\u64cd\u4f5c\u7d22\u5f15\u7684\u5ba2\u6237\u7aef\n        IndicesClient indices = client.indices();\n        //\u6267\u884c\u521b\u5efa\u7d22\u5f15\u5e93\n        indices.createAsync(createIndexRequest, RequestOptions.DEFAULT, listener);\n\n        try {\n            Thread.sleep(5000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n\n\n\n    //\u5220\u9664\u7d22\u5f15\u5e93\n    @Test\n    public void testDeleteIndex() throws IOException {\n        //\u5220\u9664\u7d22\u5f15\u5bf9\u8c61\n        DeleteIndexRequest deleteIndexRequest = new DeleteIndexRequest("ydlclass_book2");\n        //\u64cd\u4f5c\u7d22\u5f15\u7684\u5ba2\u6237\u7aef\n        IndicesClient indices = client.indices();\n        //\u6267\u884c\u5220\u9664\u7d22\u5f15\n        AcknowledgedResponse delete = indices.delete(deleteIndexRequest, RequestOptions.DEFAULT);\n        //\u5f97\u5230\u54cd\u5e94\n        boolean acknowledged = delete.isAcknowledged();\n        System.out.println(acknowledged);\n\n    }\n\n    //\u5f02\u6b65\u5220\u9664\u7d22\u5f15\u5e93\n    @Test\n    public void testDeleteIndexAsync() throws IOException {\n        //\u5220\u9664\u7d22\u5f15\u5bf9\u8c61\n        DeleteIndexRequest deleteIndexRequest = new DeleteIndexRequest("ydlclass_book2");\n        //\u64cd\u4f5c\u7d22\u5f15\u7684\u5ba2\u6237\u7aef\n        IndicesClient indices = client.indices();\n\n        //\u76d1\u542c\u65b9\u6cd5\n        ActionListener<AcknowledgedResponse> listener =\n            new ActionListener<AcknowledgedResponse>() {\n            @Override\n            public void onResponse(AcknowledgedResponse deleteIndexResponse) {\n                System.out.println("!!!!!!!!\u5220\u9664\u7d22\u5f15\u6210\u529f");\n                System.out.println(deleteIndexResponse.toString());\n            }\n\n            @Override\n            public void onFailure(Exception e) {\n                System.out.println("!!!!!!!!\u5220\u9664\u7d22\u5f15\u5931\u8d25");\n                e.printStackTrace();\n            }\n        };\n        //\u6267\u884c\u5220\u9664\u7d22\u5f15\n        indices.deleteAsync(deleteIndexRequest, RequestOptions.DEFAULT, listener);\n\n        try {\n            Thread.sleep(5000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n\n    }\n\n    // Indices Exists API\n    @Test\n    public void testExistIndex() throws IOException {\n        GetIndexRequest request = new GetIndexRequest("ydlclass_book");\n        request.local(false);//\u4ece\u4e3b\u8282\u70b9\u8fd4\u56de\u672c\u5730\u4fe1\u606f\u6216\u68c0\u7d22\u72b6\u6001\n        request.humanReadable(true);//\u4ee5\u9002\u5408\u4eba\u7c7b\u7684\u683c\u5f0f\u8fd4\u56de\u7ed3\u679c\n        request.includeDefaults(false);//\u662f\u5426\u8fd4\u56de\u6bcf\u4e2a\u7d22\u5f15\u7684\u6240\u6709\u9ed8\u8ba4\u8bbe\u7f6e\n\n        boolean exists = client.indices().exists(request, RequestOptions.DEFAULT);\n        System.out.println(exists);\n    }\n\n\n    // Indices Open API\n    @Test\n    public void testOpenIndex() throws IOException {\n        OpenIndexRequest request = new OpenIndexRequest("ydlclass_book");\n\n        OpenIndexResponse openIndexResponse = client.indices().open(request, RequestOptions.DEFAULT);\n        boolean acknowledged = openIndexResponse.isAcknowledged();\n        System.out.println("!!!!!!!!!"+acknowledged);\n    }\n\n    // Indices Close API\n    @Test\n    public void testCloseIndex() throws IOException {\n        CloseIndexRequest request = new CloseIndexRequest("index");\n        AcknowledgedResponse closeIndexResponse = client.indices().close(request, RequestOptions.DEFAULT);\n        boolean acknowledged = closeIndexResponse.isAcknowledged();\n        System.out.println("!!!!!!!!!"+acknowledged);\n\n    }\n}\n')),(0,r.kt)("h2",{id:"\u7b2c\u5341\u56db\u7ae0-search\u641c\u7d22\u5165\u95e8"},"\u7b2c\u5341\u56db\u7ae0 search\u641c\u7d22\u5165\u95e8"),(0,r.kt)("h3",{id:"\u4e00\u641c\u7d22\u8bed\u6cd5\u5165\u95e8"},"\u4e00\u3001\u641c\u7d22\u8bed\u6cd5\u5165\u95e8"),(0,r.kt)("h4",{id:"1query-string-search"},"1\u3001query string search"),(0,r.kt)("p",null,"\u65e0\u6761\u4ef6\u641c\u7d22\u6240\u6709"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"GET /book/_search\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "took" : 969,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : {\n      "value" : 3,\n      "relation" : "eq"\n    },\n    "max_score" : 1.0,\n    "hits" : [\n      {\n        "_index" : "book",\n        "_type" : "_doc",\n        "_id" : "1",\n        "_score" : 1.0,\n        "_source" : {\n          "name" : "Bootstrap\u5f00\u53d1",\n          "description" : "Bootstrap\u662f\u7531Twitter\u63a8\u51fa\u7684\u4e00\u4e2a\u524d\u53f0\u9875\u9762\u5f00\u53d1css\u6846\u67b6\uff0c\u662f\u4e00\u4e2a\u975e\u5e38\u6d41\u884c\u7684\u5f00\u53d1\u6846\u67b6\uff0c\u6b64\u6846\u67b6\u96c6\u6210\u4e86\u591a\u79cd\u9875\u9762\u6548\u679c\u3002\u6b64\u5f00\u53d1\u6846\u67b6\u5305\u542b\u4e86\u5927\u91cf\u7684CSS\u3001JS\u7a0b\u5e8f\u4ee3\u7801\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u8005\uff08\u5c24\u5176\u662f\u4e0d\u64c5\u957fcss\u9875\u9762\u5f00\u53d1\u7684\u7a0b\u5e8f\u4eba\u5458\uff09\u8f7b\u677e\u7684\u5b9e\u73b0\u4e00\u4e2acss\uff0c\u4e0d\u53d7\u6d4f\u89c8\u5668\u9650\u5236\u7684\u7cbe\u7f8e\u754c\u9762css\u6548\u679c\u3002",\n          "studymodel" : "201002",\n          "price" : 38.6,\n          "timestamp" : "2019-08-25 19:11:35",\n          "pic" : "group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg",\n          "tags" : [\n            "bootstrap",\n            "dev"\n          ]\n        }\n      },\n      {\n        "_index" : "book",\n        "_type" : "_doc",\n        "_id" : "2",\n        "_score" : 1.0,\n        "_source" : {\n          "name" : "java\u7f16\u7a0b\u601d\u60f3",\n          "description" : "java\u8bed\u8a00\u662f\u4e16\u754c\u7b2c\u4e00\u7f16\u7a0b\u8bed\u8a00\uff0c\u5728\u8f6f\u4ef6\u5f00\u53d1\u9886\u57df\u4f7f\u7528\u4eba\u6570\u6700\u591a\u3002",\n          "studymodel" : "201001",\n          "price" : 68.6,\n          "timestamp" : "2019-08-25 19:11:35",\n          "pic" : "group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg",\n          "tags" : [\n            "java",\n            "dev"\n          ]\n        }\n      },\n      {\n        "_index" : "book",\n        "_type" : "_doc",\n        "_id" : "3",\n        "_score" : 1.0,\n        "_source" : {\n          "name" : "spring\u5f00\u53d1\u57fa\u7840",\n          "description" : "spring \u5728java\u9886\u57df\u975e\u5e38\u6d41\u884c\uff0cjava\u7a0b\u5e8f\u5458\u90fd\u5728\u7528\u3002",\n          "studymodel" : "201001",\n          "price" : 88.6,\n          "timestamp" : "2019-08-24 19:11:35",\n          "pic" : "group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg",\n          "tags" : [\n            "spring",\n            "java"\n          ]\n        }\n      }\n    ]\n  }\n}\n')),(0,r.kt)("p",null,"\u89e3\u91ca"),(0,r.kt)("p",null,"took\uff1a\u8017\u8d39\u4e86\u51e0\u6beb\u79d2"),(0,r.kt)("p",null,"timed_out\uff1a\u662f\u5426\u8d85\u65f6\uff0c\u8fd9\u91cc\u662f\u6ca1\u6709"),(0,r.kt)("p",null,"_shards\uff1a\u5230\u51e0\u4e2a\u5206\u7247\u641c\u7d22\uff0c\u6210\u529f\u51e0\u4e2a\uff0c\u8df3\u8fc7\u51e0\u4e2a\uff0c\u5931\u8d25\u51e0\u4e2a\u3002"),(0,r.kt)("p",null,"hits.total\uff1a\u67e5\u8be2\u7ed3\u679c\u7684\u6570\u91cf\uff0c3\u4e2adocument"),(0,r.kt)("p",null,"hits.max_score\uff1ascore\u7684\u542b\u4e49\uff0c\u5c31\u662fdocument\u5bf9\u4e8e\u4e00\u4e2asearch\u7684\u76f8\u5173\u5ea6\u7684\u5339\u914d\u5206\u6570\uff0c\u8d8a\u76f8\u5173\uff0c\u5c31\u8d8a\u5339\u914d\uff0c\u5206\u6570\u4e5f\u9ad8"),(0,r.kt)("p",null,"hits.hits\uff1a\u5305\u542b\u4e86\u5339\u914d\u641c\u7d22\u7684document\u7684\u6240\u6709\u8be6\u7ec6\u6570\u636e"),(0,r.kt)("h4",{id:"2\u4f20\u53c2"},"2\u3001\u4f20\u53c2"),(0,r.kt)("p",null,"\u4e0ehttp\u8bf7\u6c42\u4f20\u53c2\u7c7b\u4f3c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"GET /book/_search?q=name:java&sort=price:desc\n")),(0,r.kt)("p",null,"\u7c7b\u6bd4sql: select * from book where name like \u2019 %java%\u2019 order by price desc"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "took" : 2,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : {\n      "value" : 1,\n      "relation" : "eq"\n    },\n    "max_score" : null,\n    "hits" : [\n      {\n        "_index" : "book",\n        "_type" : "_doc",\n        "_id" : "2",\n        "_score" : null,\n        "_source" : {\n          "name" : "java\u7f16\u7a0b\u601d\u60f3",\n          "description" : "java\u8bed\u8a00\u662f\u4e16\u754c\u7b2c\u4e00\u7f16\u7a0b\u8bed\u8a00\uff0c\u5728\u8f6f\u4ef6\u5f00\u53d1\u9886\u57df\u4f7f\u7528\u4eba\u6570\u6700\u591a\u3002",\n          "studymodel" : "201001",\n          "price" : 68.6,\n          "timestamp" : "2019-08-25 19:11:35",\n          "pic" : "group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg",\n          "tags" : [\n            "java",\n            "dev"\n          ]\n        },\n        "sort" : [\n          68.6\n        ]\n      }\n    ]\n  }\n}\n')),(0,r.kt)("h4",{id:"3\u56fe\u89e3timeout"},"3\u3001\u56fe\u89e3timeout"),(0,r.kt)("p",null,"GET /book/_search?timeout=10ms"),(0,r.kt)("p",null,"\u5168\u5c40\u8bbe\u7f6e\uff1a\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e search.default_search_timeout\uff1a100ms\u3002\u9ed8\u8ba4\u4e0d\u8d85\u65f6\u3002"),(0,r.kt)("h3",{id:"\u4e8cmulti-index-\u591a\u7d22\u5f15\u641c\u7d22"},"\u4e8c\u3001multi-index \u591a\u7d22\u5f15\u641c\u7d22"),(0,r.kt)("h4",{id:"1multi-index\u641c\u7d22\u6a21\u5f0f"},"1\u3001multi-index\u641c\u7d22\u6a21\u5f0f"),(0,r.kt)("p",null,"\u544a\u8bc9\u4f60\u5982\u4f55\u4e00\u6b21\u6027\u641c\u7d22\u591a\u4e2aindex\u548c\u591a\u4e2atype\u4e0b\u7684\u6570\u636e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"/_search\uff1a\u6240\u6709\u7d22\u5f15\u4e0b\u7684\u6240\u6709\u6570\u636e\u90fd\u641c\u7d22\u51fa\u6765\n/index1/_search\uff1a\u6307\u5b9a\u4e00\u4e2aindex\uff0c\u641c\u7d22\u5176\u4e0b\u6240\u6709\u7684\u6570\u636e\n/index1,index2/_search\uff1a\u540c\u65f6\u641c\u7d22\u4e24\u4e2aindex\u4e0b\u7684\u6570\u636e\n/index*/_search\uff1a\u6309\u7167\u901a\u914d\u7b26\u53bb\u5339\u914d\u591a\u4e2a\u7d22\u5f15\n")),(0,r.kt)("p",null,"\u5e94\u7528\u573a\u666f\uff1a\u751f\u4ea7\u73af\u5883log\u7d22\u5f15\u53ef\u4ee5\u6309\u7167\u65e5\u671f\u5206\u5f00\u3002"),(0,r.kt)("p",null,"log_to_es_20190910"),(0,r.kt)("p",null,"log_to_es_20190911"),(0,r.kt)("p",null,"log_to_es_20180910"),(0,r.kt)("h4",{id:"2\u521d\u6b65\u56fe\u89e3\u4e00\u4e0b\u7b80\u5355\u7684\u641c\u7d22\u539f\u7406"},"2\u3001\u521d\u6b65\u56fe\u89e3\u4e00\u4e0b\u7b80\u5355\u7684\u641c\u7d22\u539f\u7406"),(0,r.kt)("p",null,"\u641c\u7d22\u539f\u7406\u521d\u6b65\u56fe\u89e3"),(0,r.kt)("h3",{id:"\u4e09\u5206\u9875\u641c\u7d22"},"\u4e09\u3001\u5206\u9875\u641c\u7d22"),(0,r.kt)("h4",{id:"1\u5206\u9875\u641c\u7d22\u7684\u8bed\u6cd5"},"1\u3001\u5206\u9875\u641c\u7d22\u7684\u8bed\u6cd5"),(0,r.kt)("p",null,"sql: select * from book limit 1,5"),(0,r.kt)("p",null,"size\uff0cfrom"),(0,r.kt)("p",null,"GET /book/_search?size=10"),(0,r.kt)("p",null,"GET /book/_search?size=10&from=0"),(0,r.kt)("p",null,"GET /book/_search?size=10&from=20"),(0,r.kt)("p",null,"GET /book_search?from=0&size=3"),(0,r.kt)("h4",{id:"2deep-paging"},"2\u3001deep paging"),(0,r.kt)("h5",{id:"\u4ec0\u4e48\u662fdeep-paging"},"\u4ec0\u4e48\u662fdeep paging"),(0,r.kt)("p",null,"\u6839\u636e\u76f8\u5173\u5ea6\u8bc4\u5206\u5012\u6392\u5e8f\uff0c\u6240\u4ee5\u5206\u9875\u8fc7\u6df1\uff0c\u534f\u8c03\u8282\u70b9\u4f1a\u5c06\u5927\u91cf\u6570\u636e\u805a\u5408\u5206\u6790\u3002"),(0,r.kt)("h5",{id:"deep-paging-\u6027\u80fd\u95ee\u9898"},"deep paging \u6027\u80fd\u95ee\u9898"),(0,r.kt)("p",null,"1\u6d88\u8017\u7f51\u7edc\u5e26\u5bbd\uff0c\u56e0\u4e3a\u6240\u641c\u8fc7\u6df1\u7684\u8bdd\uff0c\u5404 shard \u8981\u628a\u6570\u636e\u4f20\u9012\u7ed9 coordinate node\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u6709\u5927\u91cf\u6570\u636e\u4f20\u9012\u7684\uff0c\u6d88\u8017\u7f51\u7edc\u3002"),(0,r.kt)("p",null,"2\u6d88\u8017\u5185\u5b58\uff0c\u5404 shard \u8981\u628a\u6570\u636e\u4f20\u9001\u7ed9 coordinate node\uff0c\u8fd9\u4e2a\u4f20\u9012\u56de\u6765\u7684\u6570\u636e\uff0c\u662f\u88ab coordinate node \u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u8fd9\u6837\u4f1a\u5927\u91cf\u6d88\u8017\u5185\u5b58\u3002"),(0,r.kt)("p",null,"3\u6d88\u8017cup\uff0ccoordinate node \u8981\u628a\u4f20\u56de\u6765\u7684\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u8fd9\u4e2a\u6392\u5e8f\u8fc7\u7a0b\u5f88\u6d88\u8017cpu\u3002 \u6240\u4ee5\uff1a\u9274\u4e8edeep paging\u7684\u6027\u80fd\u95ee\u9898\uff0c\u6240\u6709\u5e94\u5c3d\u91cf\u51cf\u5c11\u4f7f\u7528\u3002"),(0,r.kt)("h3",{id:"\u56db-query-string\u57fa\u7840\u8bed\u6cd5"},"\u56db\u3001 query string\u57fa\u7840\u8bed\u6cd5"),(0,r.kt)("h4",{id:"1query-string\u57fa\u7840\u8bed\u6cd5"},"1\u3001query string\u57fa\u7840\u8bed\u6cd5"),(0,r.kt)("p",null,"GET /book/_search?q=name:java"),(0,r.kt)("p",null,"GET /book/_search?q=+name:java"),(0,r.kt)("p",null,"GET /book/_search?q=-name:java"),(0,r.kt)("p",null,"\u4e00\u4e2a\u662f\u638c\u63e1q=field:search content\u7684\u8bed\u6cd5\uff0c\u8fd8\u6709\u4e00\u4e2a\u662f\u638c\u63e1+\u548c-\u7684\u542b\u4e49"),(0,r.kt)("h4",{id:"2_all-metadata\u7684\u539f\u7406\u548c\u4f5c\u7528"},"2\u3001_all metadata\u7684\u539f\u7406\u548c\u4f5c\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"GET /book/_search?q=java\n")),(0,r.kt)("p",null,"\u76f4\u63a5\u53ef\u4ee5\u641c\u7d22\u6240\u6709\u7684field\uff0c\u4efb\u610f\u4e00\u4e2afield\u5305\u542b\u6307\u5b9a\u7684\u5173\u952e\u5b57\u5c31\u53ef\u4ee5\u641c\u7d22\u51fa\u6765\u3002\u6211\u4eec\u5728\u8fdb\u884c\u4e2d\u641c\u7d22\u7684\u65f6\u5019\uff0c\u96be\u9053\u662f\u5bf9document\u4e2d\u7684\u6bcf\u4e00\u4e2afield\u90fd\u8fdb\u884c\u4e00\u6b21\u641c\u7d22\u5417\uff1f\u4e0d\u662f\u7684\u3002"),(0,r.kt)("p",null,"es\u4e2d_all\u5143\u6570\u636e\u3002\u5efa\u7acb\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u63d2\u5165\u4e00\u6761docunment\uff0ces\u4f1a\u5c06\u6240\u6709\u7684field\u503c\u7ecf\u884c\u5168\u91cf\u5206\u8bcd\uff0c\u628a\u8fd9\u4e9b\u5206\u8bcd\uff0c\u653e\u5230_all field\u4e2d\u3002\u5728\u641c\u7d22\u7684\u65f6\u5019\uff0c\u6ca1\u6709\u6307\u5b9afield\uff0c\u5c31\u5728_all\u641c\u7d22\u3002"),(0,r.kt)("p",null,"\u4e3e\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"{\n    name:jack\n    email:123@qq.com\n    address:beijing\n}\n")),(0,r.kt)("p",null,"_all : ",(0,r.kt)("a",{parentName:"p",href:"mailto:jack,123@qq.com"},"jack,123@qq.com"),",beijing"),(0,r.kt)("h3",{id:"\u4e94query-dsl\u5165\u95e8"},"\u4e94\u3001query DSL\u5165\u95e8"),(0,r.kt)("h4",{id:"1dsl"},"1\u3001DSL"),(0,r.kt)("p",null,"query string \u540e\u8fb9\u7684\u53c2\u6570\u539f\u6765\u8d8a\u591a\uff0c\u641c\u7d22\u6761\u4ef6\u8d8a\u6765\u8d8a\u590d\u6742\uff0c\u4e0d\u80fd\u6ee1\u8db3\u9700\u6c42\u3002"),(0,r.kt)("p",null,"GET /book/_search?q=name:java&size=10&from=0&sort=price:desc"),(0,r.kt)("p",null,"DSL:Domain Specified Language\uff0c\u7279\u5b9a\u9886\u57df\u7684\u8bed\u8a00"),(0,r.kt)("p",null,"es\u7279\u6709\u7684\u641c\u7d22\u8bed\u8a00\uff0c\u53ef\u5728\u8bf7\u6c42\u4f53\u4e2d\u643a\u5e26\u641c\u7d22\u6761\u4ef6\uff0c\u529f\u80fd\u5f3a\u5927\u3002"),(0,r.kt)("p",null,"\u67e5\u8be2\u5168\u90e8 GET /book/_search"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'GET /book/_search\n{\n  "query": { "match_all": {} }\n}\n')),(0,r.kt)("p",null,"\u6392\u5e8f GET /book/_search?sort=price:desc"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'GET /book/_search \n{\n    "query" : {\n        "match" : {\n            "name" : " java"\n        }\n    },\n    "sort": [\n        { "price": "desc" }\n    ]\n}\n')),(0,r.kt)("p",null,"\u5206\u9875\u67e5\u8be2 GET /book/_search?size=10&from=0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'GET  /book/_search \n{\n  "query": { "match_all": {} },\n  "from": 0,\n  "size": 1\n}\n')),(0,r.kt)("p",null,"\u6307\u5b9a\u8fd4\u56de\u5b57\u6bb5 GET /book/ _search? _source=name,studymodel"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'GET /book/_search \n{\n  "query": { "match_all": {} },\n  "_source": ["name", "studymodel"]\n}\n')),(0,r.kt)("p",null,"\u901a\u8fc7\u7ec4\u5408\u4ee5\u4e0a\u5404\u79cd\u7c7b\u578b\u67e5\u8be2\uff0c\u5b9e\u73b0\u590d\u6742\u67e5\u8be2\u3002"),(0,r.kt)("h4",{id:"2-query-dsl\u8bed\u6cd5"},"2\u3001 Query DSL\u8bed\u6cd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"{\n    QUERY_NAME: {\n        ARGUMENT: VALUE,\n        ARGUMENT: VALUE,...\n    }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},"{\n    QUERY_NAME: {\n        FIELD_NAME: {\n            ARGUMENT: VALUE,\n            ARGUMENT: VALUE,...\n        }\n    }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'GET /test_index/_search \n{\n  "query": {\n    "match": {\n      "test_field": "test"\n    }\n  }\n}\n')),(0,r.kt)("h4",{id:"3\u7ec4\u5408\u591a\u4e2a\u641c\u7d22\u6761\u4ef6"},"3\u3001\u7ec4\u5408\u591a\u4e2a\u641c\u7d22\u6761\u4ef6"),(0,r.kt)("p",null,"\u641c\u7d22\u9700\u6c42\uff1atitle\u5fc5\u987b\u5305\u542belasticsearch\uff0ccontent\u53ef\u4ee5\u5305\u542belasticsearch\u4e5f\u53ef\u4ee5\u4e0d\u5305\u542b\uff0cauthor_id\u5fc5\u987b\u4e0d\u4e3a111"),(0,r.kt)("p",null,"sql where and or !="),(0,r.kt)("p",null,"\u521d\u59cb\u6570\u636e\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'POST /website/_doc/1\n{\n          "title": "my hadoop article",\n          "content": "hadoop is very bad",\n          "author_id": 111\n}\n\nPOST /website/_doc/2\n{\n          "title": "my elasticsearch  article",\n          "content": "es is very bad",\n          "author_id": 112\n}\nPOST /website/_doc/3\n{\n          "title": "my elasticsearch article",\n          "content": "es is very goods",\n          "author_id": 111\n}\n')),(0,r.kt)("p",null,"\u641c\u7d22\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'GET /website/_doc/_search\n{\n  "query": {\n    "bool": {\n      "must": [\n        {\n          "match": {\n            "title": "elasticsearch"\n          }\n        }\n      ],\n      "should": [\n        {\n          "match": {\n            "content": "elasticsearch"\n          }\n        }\n      ],\n      "must_not": [\n        {\n          "match": {\n            "author_id": 111\n          }\n        }\n      ]\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u8fd4\u56de\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "took" : 488,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : {\n      "value" : 1,\n      "relation" : "eq"\n    },\n    "max_score" : 0.47000363,\n    "hits" : [\n      {\n        "_index" : "website",\n        "_type" : "_doc",\n        "_id" : "2",\n        "_score" : 0.47000363,\n        "_source" : {\n          "title" : "my elasticsearch  article",\n          "content" : "es is very bad",\n          "author_id" : 112\n        }\n      }\n    ]\n  }\n}\n')),(0,r.kt)("p",null,"\u66f4\u590d\u6742\u7684\u641c\u7d22\u9700\u6c42\uff1a"),(0,r.kt)("p",null,"select * from test_index where name='tom' or (hired =true and (personality ='good' and rude != true ))"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'GET /test_index/_search\n{\n    "query": {\n            "bool": {\n                "must": { "match":{ "name": "tom" }},\n                "should": [\n                    { "match":{ "hired": true }},\n                    { "bool": {\n                        "must":{ "match": { "personality": "good" }},\n                        "must_not": { "match": { "rude": true }}\n                    }}\n                ],\n                "minimum_should_match": 1\n            }\n    }\n}\n')),(0,r.kt)("h3",{id:"\u516dfull-text-search-\u5168\u6587\u68c0\u7d22"},"\u516d\u3001full-text search \u5168\u6587\u68c0\u7d22"),(0,r.kt)("h4",{id:"1\u5168\u6587\u68c0\u7d22"},"1\u3001\u5168\u6587\u68c0\u7d22"),(0,r.kt)("p",null,"\u91cd\u65b0\u521b\u5efabook\u7d22\u5f15"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /book/\n{\n  "settings": {\n    "number_of_shards": 1,\n    "number_of_replicas": 0\n  },\n  "mappings": {\n    "properties": {\n      "name":{\n        "type": "text",\n        "analyzer": "ik_max_word",\n        "search_analyzer": "ik_smart"\n      },\n      "description":{\n        "type": "text",\n        "analyzer": "ik_max_word",\n        "search_analyzer": "ik_smart"\n      },\n      "studymodel":{\n        "type": "keyword"\n      },\n      "price":{\n        "type": "double"\n      },\n      "timestamp": {\n         "type": "date",\n         "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"\n      },\n      "pic":{\n        "type":"text",\n        "index":false\n      }\n    }\n  }\n}\u63d2\u5165\u6570\u636e\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-http"},'PUT /book/_doc/1\n{\n"name": "Bootstrap\u5f00\u53d1",\n"description": "Bootstrap\u662f\u7531Twitter\u63a8\u51fa\u7684\u4e00\u4e2a\u524d\u53f0\u9875\u9762\u5f00\u53d1css\u6846\u67b6\uff0c\u662f\u4e00\u4e2a\u975e\u5e38\u6d41\u884c\u7684\u5f00\u53d1\u6846\u67b6\uff0c\u6b64\u6846\u67b6\u96c6\u6210\u4e86\u591a\u79cd\u9875\u9762\u6548\u679c\u3002\u6b64\u5f00\u53d1\u6846\u67b6\u5305\u542b\u4e86\u5927\u91cf\u7684CSS\u3001JS\u7a0b\u5e8f\u4ee3\u7801\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u8005\uff08\u5c24\u5176\u662f\u4e0d\u64c5\u957fcss\u9875\u9762\u5f00\u53d1\u7684\u7a0b\u5e8f\u4eba\u5458\uff09\u8f7b\u677e\u7684\u5b9e\u73b0\u4e00\u4e2acss\uff0c\u4e0d\u53d7\u6d4f\u89c8\u5668\u9650\u5236\u7684\u7cbe\u7f8e\u754c\u9762css\u6548\u679c\u3002",\n"studymodel": "201002",\n"price":38.6,\n"timestamp":"2019-08-25 19:11:35",\n"pic":"group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg",\n"tags": [ "bootstrap", "dev"]\n}\n\nPUT /book/_doc/2\n{\n"name": "java\u7f16\u7a0b\u601d\u60f3",\n"description": "java\u8bed\u8a00\u662f\u4e16\u754c\u7b2c\u4e00\u7f16\u7a0b\u8bed\u8a00\uff0c\u5728\u8f6f\u4ef6\u5f00\u53d1\u9886\u57df\u4f7f\u7528\u4eba\u6570\u6700\u591a\u3002",\n"studymodel": "201001",\n"price":68.6,\n"timestamp":"2019-08-25 19:11:35",\n"pic":"group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg",\n"tags": [ "java", "dev"]\n}\n\nPUT /book/_doc/3\n{\n"name": "spring\u5f00\u53d1\u57fa\u7840",\n"description": "spring \u5728java\u9886\u57df\u975e\u5e38\u6d41\u884c\uff0cjava\u7a0b\u5e8f\u5458\u90fd\u5728\u7528\u3002",\n"studymodel": "201001",\n"price":88.6,\n"timestamp":"2019-08-24 19:11:35",\n"pic":"group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg",\n"tags": [ "spring", "java"]\n}\n')),(0,r.kt)("p",null,"\u641c\u7d22"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET  /book/_search \n{\n    "query" : {\n        "match" : {\n            "description" : "java\u7a0b\u5e8f\u5458"\n        }\n    }\n}\n')),(0,r.kt)("h4",{id:"2_score\u521d\u63a2"},"2\u3001_score\u521d\u63a2"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'{\n  "took" : 1,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : {\n      "value" : 2,\n      "relation" : "eq"\n    },\n    "max_score" : 2.137549,\n    "hits" : [\n      {\n        "_index" : "book",\n        "_type" : "_doc",\n        "_id" : "3",\n        "_score" : 2.137549,\n        "_source" : {\n          "name" : "spring\u5f00\u53d1\u57fa\u7840",\n          "description" : "spring \u5728java\u9886\u57df\u975e\u5e38\u6d41\u884c\uff0cjava\u7a0b\u5e8f\u5458\u90fd\u5728\u7528\u3002",\n          "studymodel" : "201001",\n          "price" : 88.6,\n          "timestamp" : "2019-08-24 19:11:35",\n          "pic" : "group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg",\n          "tags" : [\n            "spring",\n            "java"\n          ]\n        }\n      },\n      {\n        "_index" : "book",\n        "_type" : "_doc",\n        "_id" : "2",\n        "_score" : 0.57961315,\n        "_source" : {\n          "name" : "java\u7f16\u7a0b\u601d\u60f3",\n          "description" : "java\u8bed\u8a00\u662f\u4e16\u754c\u7b2c\u4e00\u7f16\u7a0b\u8bed\u8a00\uff0c\u5728\u8f6f\u4ef6\u5f00\u53d1\u9886\u57df\u4f7f\u7528\u4eba\u6570\u6700\u591a\u3002",\n          "studymodel" : "201001",\n          "price" : 68.6,\n          "timestamp" : "2019-08-25 19:11:35",\n          "pic" : "group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg",\n          "tags" : [\n            "java",\n            "dev"\n          ]\n        }\n      }\n    ]\n  }\n}\n')),(0,r.kt)("p",null,"\u7ed3\u679c\u5206\u6790"),(0,r.kt)("p",null,"1\u3001\u5efa\u7acb\u7d22\u5f15\u65f6, description\u5b57\u6bb5 term\u5012\u6392\u7d22\u5f15"),(0,r.kt)("p",null,"java 2,3"),(0,r.kt)("p",null,"\u7a0b\u5e8f\u5458 3"),(0,r.kt)("p",null,"2\u3001\u641c\u7d22\u65f6\uff0c\u76f4\u63a5\u627edescription\u4e2d\u542b\u6709java\u7684\u6587\u6863 2,3\uff0c\u5e76\u4e143\u53f7\u6587\u6863\u542b\u6709\u4e24\u4e2ajava\u5b57\u6bb5\uff0c\u4e00\u4e2a\u7a0b\u5e8f\u5458\uff0c\u6240\u4ee5\u5f97\u5206\u9ad8\uff0c\u6392\u5728\u524d\u9762\u30022\u53f7\u6587\u6863\u542b\u6709\u4e00\u4e2ajava\uff0c\u6392\u5728\u540e\u9762\u3002"),(0,r.kt)("h3",{id:"\u4e03dsl-\u8bed\u6cd5\u7ec3\u4e60"},"\u4e03\u3001DSL \u8bed\u6cd5\u7ec3\u4e60"),(0,r.kt)("h4",{id:"1match_all"},"1\u3001match_all"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n    "query": {\n        "match_all": {}\n    }\n}\n')),(0,r.kt)("h4",{id:"2match"},"2\u3001match"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n    "query": { \n        "match": { \n            "description": "java\u7a0b\u5e8f\u5458"\n        }\n    }\n}\n')),(0,r.kt)("h4",{id:"3multi_match"},"3\u3001multi_match"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n  "query": {\n    "multi_match": {\n      "query": "java\u7a0b\u5e8f\u5458",\n      "fields": ["name", "description"]\n    }\n  }\n}\n')),(0,r.kt)("h4",{id:"4range-query-\u8303\u56f4\u67e5\u8be2"},"4\u3001range query \u8303\u56f4\u67e5\u8be2"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n  "query": {\n    "range": {\n      "price": {\n        "gte": 80,\n        "lte": 90\n      }\n    }\n  }\n}\n')),(0,r.kt)("h4",{id:"5term-query"},"5\u3001term query"),(0,r.kt)("p",null,"\u5b57\u6bb5\u4e3akeyword\u65f6\uff0c\u5b58\u50a8\u548c\u641c\u7d22\u90fd\u4e0d\u5206\u8bcd"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n  "query": {\n    "term": {\n      "description": "java\u7a0b\u5e8f\u5458"\n    }\n  }\n}\n')),(0,r.kt)("h4",{id:"6terms-query"},"6\u3001terms query"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n    "query": { "terms": { "tag": [ "search", "full_text", "nosql" ] }}\n}\n')),(0,r.kt)("h4",{id:"7exist-query-\u67e5\u8be2\u6709\u67d0\u4e9b\u5b57\u6bb5\u503c\u7684\u6587\u6863"},"7\u3001exist query \u67e5\u8be2\u6709\u67d0\u4e9b\u5b57\u6bb5\u503c\u7684\u6587\u6863"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /_search\n{\n    "query": {\n        "exists": {\n            "field": "join_date"\n        }\n    }\n}\n')),(0,r.kt)("h4",{id:"8fuzzy-query"},"8\u3001Fuzzy query"),(0,r.kt)("p",null,"\u8fd4\u56de\u5305\u542b\u4e0e\u641c\u7d22\u8bcd\u7c7b\u4f3c\u7684\u8bcd\u7684\u6587\u6863\uff0c\u8be5\u8bcd\u7531Levenshtein\u7f16\u8f91\u8ddd\u79bb\u5ea6\u91cf\u3002"),(0,r.kt)("p",null,"\u5305\u62ec\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u66f4\u6539\u89d2\u8272\uff08box\u2192fox\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u5220\u9664\u5b57\u7b26\uff08aple\u2192apple\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u63d2\u5165\u5b57\u7b26\uff08sick\u2192sic\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u8c03\u6362\u4e24\u4e2a\u76f8\u90bb\u5b57\u7b26\uff08ACT\u2192CAT\uff09")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n    "query": {\n        "fuzzy": {\n            "description": {\n                "value": "jave"\n            }\n        }\n    }\n}\n')),(0,r.kt)("h4",{id:"9ids"},"9\u3001IDs"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n    "query": {\n        "ids" : {\n            "values" : ["1", "4", "100"]\n        }\n    }\n}\n')),(0,r.kt)("h4",{id:"10prefix-\u524d\u7f00\u67e5\u8be2"},"10\u3001prefix \u524d\u7f00\u67e5\u8be2"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n    "query": {\n        "prefix": {\n            "description": {\n                "value": "spring"\n            }\n        }\n    }\n}\n')),(0,r.kt)("h4",{id:"11regexp-query-\u6b63\u5219\u67e5\u8be2"},"11\u3001regexp query \u6b63\u5219\u67e5\u8be2"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n    "query": {\n        "regexp": {\n            "description": {\n                "value": "j.*a",\n                "flags" : "ALL",\n                "max_determinized_states": 10000,\n                "rewrite": "constant_score"\n            }\n        }\n    }\n}\n')),(0,r.kt)("h3",{id:"\u516b-filter"},"\u516b\u3001 Filter"),(0,r.kt)("h4",{id:"1-filter\u4e0equery\u793a\u4f8b"},"1\u3001 filter\u4e0equery\u793a\u4f8b"),(0,r.kt)("p",null,'\u9700\u6c42\uff1a\u7528\u6237\u67e5\u8be2description\u4e2d\u6709"java\u7a0b\u5e8f\u5458"\uff0c\u5e76\u4e14\u4ef7\u683c\u5927\u4e8e80\u5c0f\u4e8e90\u7684\u6570\u636e\u3002'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n  "query": {\n    "bool": {\n      "must": [\n        {\n          "match": {\n            "description": "java\u7a0b\u5e8f\u5458"\n          }\n        },\n        {\n          "range": {\n            "price": {\n              "gte": 80,\n              "lte": 90\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u4f7f\u7528filter:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n  "query": {\n    "bool": {\n      "must": [\n        {\n          "match": {\n            "description": "java\u7a0b\u5e8f\u5458"\n          }\n        }\n      ],\n      "filter": {\n        "range": {\n          "price": {\n            "gte": 80,\n             "lte": 90\n          }\n        }\n      }\n    }\n  }\n}\n')),(0,r.kt)("h4",{id:"2filter\u4e0equery\u5bf9\u6bd4"},"2\u3001filter\u4e0equery\u5bf9\u6bd4"),(0,r.kt)("p",null,"filter\uff0c\u4ec5\u4ec5\u53ea\u662f\u6309\u7167\u641c\u7d22\u6761\u4ef6\u8fc7\u6ee4\u51fa\u9700\u8981\u7684\u6570\u636e\u800c\u5df2\uff0c\u4e0d\u8ba1\u7b97\u4efb\u4f55\u76f8\u5173\u5ea6\u5206\u6570\uff0c\u5bf9\u76f8\u5173\u5ea6\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\u3002"),(0,r.kt)("p",null,"query\uff0c\u4f1a\u53bb\u8ba1\u7b97\u6bcf\u4e2adocument\u76f8\u5bf9\u4e8e\u641c\u7d22\u6761\u4ef6\u7684\u76f8\u5173\u5ea6\uff0c\u5e76\u6309\u7167\u76f8\u5173\u5ea6\u8fdb\u884c\u6392\u5e8f\u3002"),(0,r.kt)("p",null,"\u5e94\u7528\u573a\u666f\uff1a"),(0,r.kt)("p",null,"\u4e00\u822c\u6765\u8bf4\uff0c\u5982\u679c\u4f60\u662f\u5728\u8fdb\u884c\u641c\u7d22\uff0c\u9700\u8981\u5c06\u6700\u5339\u914d\u641c\u7d22\u6761\u4ef6\u7684\u6570\u636e\u5148\u8fd4\u56de\uff0c\u90a3\u4e48\u7528query \u5982\u679c\u4f60\u53ea\u662f\u8981\u6839\u636e\u4e00\u4e9b\u6761\u4ef6\u7b5b\u9009\u51fa\u4e00\u90e8\u5206\u6570\u636e\uff0c\u4e0d\u5173\u6ce8\u5176\u6392\u5e8f\uff0c\u90a3\u4e48\u7528filter"),(0,r.kt)("h4",{id:"3filter\u4e0equery\u6027\u80fd"},"3\u3001filter\u4e0equery\u6027\u80fd"),(0,r.kt)("p",null,"filter\uff0c\u4e0d\u9700\u8981\u8ba1\u7b97\u76f8\u5173\u5ea6\u5206\u6570\uff0c\u4e0d\u9700\u8981\u6309\u7167\u76f8\u5173\u5ea6\u5206\u6570\u8fdb\u884c\u6392\u5e8f\uff0c\u540c\u65f6\u8fd8\u6709\u5185\u7f6e\u7684\u81ea\u52a8cache\u6700\u5e38\u4f7f\u7528filter\u7684\u6570\u636e"),(0,r.kt)("p",null,"query\uff0c\u76f8\u53cd\uff0c\u8981\u8ba1\u7b97\u76f8\u5173\u5ea6\u5206\u6570\uff0c\u6309\u7167\u5206\u6570\u8fdb\u884c\u6392\u5e8f\uff0c\u800c\u4e14\u65e0\u6cd5cache\u7ed3\u679c"),(0,r.kt)("h3",{id:"\u4e5d\u5b9a\u4f4d\u9519\u8bef\u8bed\u6cd5"},"\u4e5d\u3001\u5b9a\u4f4d\u9519\u8bef\u8bed\u6cd5"),(0,r.kt)("p",null,"\u9a8c\u8bc1\u9519\u8bef\u8bed\u53e5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_validate/query?explain\n{\n  "query": {\n    "mach": {\n      "description": "java\u7a0b\u5e8f\u5458"\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u8fd4\u56de\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'{\n  "valid" : false,\n  "error" : "org.elasticsearch.common.ParsingException: no [query] registered for [mach]"\n}\n')),(0,r.kt)("p",null,"\u6b63\u786e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_validate/query?explain\n{\n  "query": {\n    "match": {\n      "description": "java\u7a0b\u5e8f\u5458"\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u8fd4\u56de"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'{\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "failed" : 0\n  },\n  "valid" : true,\n  "explanations" : [\n    {\n      "index" : "book",\n      "valid" : true,\n      "explanation" : "description:java description:\u7a0b\u5e8f\u5458"\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"\u4e00\u822c\u7528\u5728\u90a3\u79cd\u7279\u522b\u590d\u6742\u5e9e\u5927\u7684\u641c\u7d22\u4e0b\uff0c\u6bd4\u5982\u4f60\u4e00\u4e0b\u5b50\u5199\u4e86\u4e0a\u767e\u884c\u7684\u641c\u7d22\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u5148\u7528validate api\u53bb\u9a8c\u8bc1\u4e00\u4e0b\uff0c\u641c\u7d22\u662f\u5426\u5408\u6cd5\u3002"),(0,r.kt)("p",null,"\u5408\u6cd5\u4ee5\u540e\uff0cexplain\u5c31\u50cfmysql\u7684\u6267\u884c\u8ba1\u5212\uff0c\u53ef\u4ee5\u770b\u5230\u641c\u7d22\u7684\u76ee\u6807\u7b49\u4fe1\u606f\u3002"),(0,r.kt)("h3",{id:"\u5341\u5b9a\u5236\u6392\u5e8f\u89c4\u5219"},"\u5341\u3001\u5b9a\u5236\u6392\u5e8f\u89c4\u5219"),(0,r.kt)("h4",{id:"1\u9ed8\u8ba4\u6392\u5e8f\u89c4\u5219"},"1\u3001\u9ed8\u8ba4\u6392\u5e8f\u89c4\u5219"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u662f\u6309\u7167_score\u964d\u5e8f\u6392\u5e8f\u7684"),(0,r.kt)("p",null,"\u7136\u800c\uff0c\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u6ca1\u6709\u6709\u7528\u7684_score\uff0c\u6bd4\u5982\u8bf4filter"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET book/_search\n{\n  "query": {\n    "bool": {\n      "must": [\n        {\n          "match": {\n            "description": "java\u7a0b\u5e8f\u5458"\n          }\n        }\n      ]\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u662fconstant_score"),(0,r.kt)("h4",{id:"2\u5b9a\u5236\u6392\u5e8f\u89c4\u5219"},"2\u3001\u5b9a\u5236\u6392\u5e8f\u89c4\u5219"),(0,r.kt)("p",null,"\u76f8\u5f53\u4e8esql\u4e2dorder by ?sort=sprice:desc"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search \n{\n  "query": {\n    "constant_score": {\n      "filter" : {\n            "term" : {\n                "studymodel" : "201001"\n            }\n        }\n    }\n  },\n  "sort": [\n    {\n      "price": {\n        "order": "asc"\n      }\n    }\n  ]\n}\n')),(0,r.kt)("h3",{id:"\u5341\u4e00-text\u5b57\u6bb5\u6392\u5e8f\u95ee\u9898"},"\u5341\u4e00\u3001 Text\u5b57\u6bb5\u6392\u5e8f\u95ee\u9898"),(0,r.kt)("p",null,"\u5982\u679c\u5bf9\u4e00\u4e2atext field\u8fdb\u884c\u6392\u5e8f\uff0c\u7ed3\u679c\u5f80\u5f80\u4e0d\u51c6\u786e\uff0c\u56e0\u4e3a\u5206\u8bcd\u540e\u662f\u591a\u4e2a\u5355\u8bcd\uff0c\u518d\u6392\u5e8f\u5c31\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u7ed3\u679c\u4e86\u3002"),(0,r.kt)("p",null,"\u901a\u5e38\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u5c06\u4e00\u4e2atext field\u5efa\u7acb\u4e24\u6b21\u7d22\u5f15\uff0c\u4e00\u4e2a\u5206\u8bcd\uff0c\u7528\u6765\u8fdb\u884c\u641c\u7d22\uff1b\u4e00\u4e2a\u4e0d\u5206\u8bcd\uff0c\u7528\u6765\u8fdb\u884c\u6392\u5e8f\u3002"),(0,r.kt)("p",null,"fielddate:true"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'PUT /website \n{\n  "mappings": {\n  "properties": {\n    "title": {\n      "type": "text",\n      "fields": {\n        "keyword": {\n          "type": "keyword"\n        }        \n      }      \n    },\n    "content": {\n      "type": "text"\n    },\n    "post_date": {\n      "type": "date"\n    },\n    "author_id": {\n      "type": "long"\n    }\n  }\n }\n}\n')),(0,r.kt)("p",null,"\u63d2\u5165\u6570\u636e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'PUT /website/_doc/1\n{\n  "title": "first article",\n  "content": "this is my second article",\n  "post_date": "2019-01-01",\n  "author_id": 110\n}\n\nPUT /website/_doc/2\n{\n    "title": "second article",\n    "content": "this is my second article",\n     "post_date": "2019-01-01",\n    "author_id": 110\n}\n\nPUT /website/_doc/3\n{\n     "title": "third article",\n     "content": "this is my third article",\n     "post_date": "2019-01-02",\n     "author_id": 110\n}\n')),(0,r.kt)("p",null,"\u641c\u7d22"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /website/_search\n{\n  "query": {\n    "match_all": {}\n  },\n  "sort": [\n    {\n      "title.keyword": {\n        "order": "desc"\n      }\n    }\n  ]\n}\n')),(0,r.kt)("h3",{id:"\u5341\u4e8cscroll\u5206\u6279\u67e5\u8be2"},"\u5341\u4e8c\u3001Scroll\u5206\u6279\u67e5\u8be2"),(0,r.kt)("p",null,"\u573a\u666f\uff1a\u4e0b\u8f7d\u67d0\u4e00\u4e2a\u7d22\u5f15\u4e2d1\u4ebf\u6761\u6570\u636e\uff0c\u5230\u6587\u4ef6\u6216\u662f\u6570\u636e\u5e93\u3002"),(0,r.kt)("p",null,"\u4e0d\u80fd\u4e00\u4e0b\u5168\u67e5\u51fa\u6765\uff0c\u7cfb\u7edf\u5185\u5b58\u6ea2\u51fa\u3002\u6240\u4ee5\u4f7f\u7528scoll\u6eda\u52a8\u641c\u7d22\u6280\u672f\uff0c\u4e00\u6279\u4e00\u6279\u67e5\u8be2\u3002"),(0,r.kt)("p",null,"scoll\u641c\u7d22\u4f1a\u5728\u7b2c\u4e00\u6b21\u641c\u7d22\u7684\u65f6\u5019\uff0c\u4fdd\u5b58\u4e00\u4e2a\u5f53\u65f6\u7684\u89c6\u56fe\u5feb\u7167\uff0c\u4e4b\u540e\u53ea\u4f1a\u57fa\u4e8e\u8be5\u65e7\u7684\u89c6\u56fe\u5feb\u7167\u63d0\u4f9b\u6570\u636e\u641c\u7d22\uff0c\u5982\u679c\u8fd9\u4e2a\u671f\u95f4\u6570\u636e\u53d8\u66f4\uff0c\u662f\u4e0d\u4f1a\u8ba9\u7528\u6237\u770b\u5230\u7684"),(0,r.kt)("p",null,"\u6bcf\u6b21\u53d1\u9001scroll\u8bf7\u6c42\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u6307\u5b9a\u4e00\u4e2ascoll\u53c2\u6570\uff0c\u6307\u5b9a\u4e00\u4e2a\u65f6\u95f4\u7a97\u53e3\uff0c\u6bcf\u6b21\u641c\u7d22\u8bf7\u6c42\u53ea\u8981\u5728\u8fd9\u4e2a\u65f6\u95f4\u7a97\u53e3\u5185\u80fd\u5b8c\u6210\u5c31\u53ef\u4ee5\u4e86\u3002"),(0,r.kt)("p",null,"\u641c\u7d22"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search?scroll=1m\n{\n  "query": {\n    "match_all": {}\n  },\n  "size": 3\n}\n')),(0,r.kt)("p",null,"\u8fd4\u56de"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'{\n  "_scroll_id" : "DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAMOkWTURBNDUtcjZTVUdKMFp5cXloVElOQQ==",\n  "took" : 3,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : {\n      "value" : 3,\n      "relation" : "eq"\n    },\n    "max_score" : 1.0,\n    "hits" : [\n     \n    ]\n  }\n}\n')),(0,r.kt)("p",null,"\u83b7\u5f97\u7684\u7ed3\u679c\u4f1a\u6709\u4e00\u4e2ascoll_id\uff0c\u4e0b\u4e00\u6b21\u518d\u53d1\u9001scoll\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5fc5\u987b\u5e26\u4e0a\u8fd9\u4e2ascoll_id"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /_search/scroll\n{\n    "scroll": "1m", \n    "scroll_id" : "DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAMOkWTURBNDUtcjZTVUdKMFp5cXloVElOQQ=="\n}\n')),(0,r.kt)("p",null,"\u4e0e\u5206\u9875\u533a\u522b\uff1a"),(0,r.kt)("p",null,"\u5206\u9875\u7ed9\u7528\u6237\u770b\u7684 deep paging"),(0,r.kt)("p",null,"scroll\u662f\u7528\u6237\u7cfb\u7edf\u5185\u90e8\u64cd\u4f5c\uff0c\u5982\u4e0b\u8f7d\u6279\u91cf\u6570\u636e\uff0c\u6570\u636e\u8f6c\u79fb\u3002\u96f6\u505c\u673a\u6539\u53d8\u7d22\u5f15\u6620\u5c04\u3002"),(0,r.kt)("h2",{id:"\u7b2c\u5341\u4e94\u7ae0-java-api\u5b9e\u73b0\u641c\u7d22"},"\u7b2c\u5341\u4e94\u7ae0 java api\u5b9e\u73b0\u641c\u7d22"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'package com.itheima.es;\n\nimport org.elasticsearch.action.search.SearchRequest;\nimport org.elasticsearch.action.search.SearchResponse;\nimport org.elasticsearch.client.RequestOptions;\nimport org.elasticsearch.client.RestHighLevelClient;\nimport org.elasticsearch.index.query.*;\nimport org.elasticsearch.search.SearchHit;\nimport org.elasticsearch.search.SearchHits;\nimport org.elasticsearch.search.builder.SearchSourceBuilder;\nimport org.elasticsearch.search.sort.SortOrder;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.context.junit4.SpringRunner;\n\nimport java.io.IOException;\nimport java.util.Map;\n\n/**\n * creste by itheima.itcast\n */\n@SpringBootTest\n@RunWith(SpringRunner.class)\npublic class TestSearch {\n    @Autowired\n    RestHighLevelClient client;\n\n    //\u641c\u7d22\u5168\u90e8\u8bb0\u5f55\n    @Test\n    public void testSearchAll() throws IOException {\n\n//        GET book/_search\n//        {\n//            "query": {\n//                "match_all": {}\n//             }\n//        }\n        //1\u6784\u5efa\u641c\u7d22\u8bf7\u6c42\n        SearchRequest searchRequest = new SearchRequest("book");\n\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n        searchSourceBuilder.query(QueryBuilders.matchAllQuery());\n\n        //\u83b7\u53d6\u67d0\u4e9b\u5b57\u6bb5\n        searchSourceBuilder.fetchSource(new String[]{"name"}, new String[]{});\n\n        searchRequest.source(searchSourceBuilder);\n\n        //2\u6267\u884c\u641c\u7d22\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3\u83b7\u53d6\u7ed3\u679c\n        SearchHits hits = searchResponse.getHits();\n\n        //\u6570\u636e\u6570\u636e\n        SearchHit[] searchHits = hits.getHits();\n        System.out.println("--------------------------");\n        for (SearchHit hit : searchHits) {\n            String id = hit.getId();\n            float score = hit.getScore();\n            Map<String, Object> sourceAsMap = hit.getSourceAsMap();\n            String name = (String) sourceAsMap.get("name");\n            String description = (String) sourceAsMap.get("description");\n            Double price = (Double) sourceAsMap.get("price");\n            System.out.println("name:" + name);\n            System.out.println("description:" + description);\n            System.out.println("price:" + price);\n            System.out.println("==========================");\n\n        }\n    }\n\n\n\n    //\u641c\u7d22\u5206\u9875\n    @Test\n    public void testSearchPage() throws IOException {\n//    GET book/_search\n//    {\n//        "query": {\n//          "match_all": {}\n//       },\n//        "from": 0,\n//        "size": 2\n//    }\n        //1\u6784\u5efa\u641c\u7d22\u8bf7\u6c42\n        SearchRequest searchRequest = new SearchRequest("book");\n\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n        searchSourceBuilder.query(QueryBuilders.matchAllQuery());\n\n\n        //\u7b2c\u51e0\u9875\n        int page=1;\n        //\u6bcf\u9875\u51e0\u4e2a\n        int size=2;\n        //\u4e0b\u6807\u8ba1\u7b97\n        int from=(page-1)*size;\n\n\n        searchSourceBuilder.from(from);\n        searchSourceBuilder.size(size);\n\n\n        searchRequest.source(searchSourceBuilder);\n\n        //2\u6267\u884c\u641c\u7d22\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3\u83b7\u53d6\u7ed3\u679c\n        SearchHits hits = searchResponse.getHits();\n\n        //\u6570\u636e\u6570\u636e\n        SearchHit[] searchHits = hits.getHits();\n        System.out.println("--------------------------");\n        for (SearchHit hit : searchHits) {\n            String id = hit.getId();\n            float score = hit.getScore();\n            Map<String, Object> sourceAsMap = hit.getSourceAsMap();\n            String name = (String) sourceAsMap.get("name");\n            String description = (String) sourceAsMap.get("description");\n            Double price = (Double) sourceAsMap.get("price");\n            System.out.println("id:" + id);\n            System.out.println("name:" + name);\n            System.out.println("description:" + description);\n            System.out.println("price:" + price);\n            System.out.println("==========================");\n\n        }\n    }\n\n\n\n    //ids\u641c\u7d22\n    @Test\n    public void testSearchIds() throws IOException {\n//    GET /book/_search\n//    {\n//        "query": {\n//           "ids" : {\n//             "values" : ["1", "4", "100"]\n//          }\n//     }\n//    }\n        //1\u6784\u5efa\u641c\u7d22\u8bf7\u6c42\n        SearchRequest searchRequest = new SearchRequest("book");\n\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n        searchSourceBuilder.query(QueryBuilders.idsQuery().addIds("1","4","100"));\n\n\n\n\n        searchRequest.source(searchSourceBuilder);\n\n        //2\u6267\u884c\u641c\u7d22\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3\u83b7\u53d6\u7ed3\u679c\n        SearchHits hits = searchResponse.getHits();\n\n        //\u6570\u636e\u6570\u636e\n        SearchHit[] searchHits = hits.getHits();\n        System.out.println("--------------------------");\n        for (SearchHit hit : searchHits) {\n            String id = hit.getId();\n            float score = hit.getScore();\n            Map<String, Object> sourceAsMap = hit.getSourceAsMap();\n            String name = (String) sourceAsMap.get("name");\n            String description = (String) sourceAsMap.get("description");\n            Double price = (Double) sourceAsMap.get("price");\n            System.out.println("id:" + id);\n            System.out.println("name:" + name);\n            System.out.println("description:" + description);\n            System.out.println("price:" + price);\n            System.out.println("==========================");\n\n        }\n    }\n\n\n    //match\u641c\u7d22\n    @Test\n    public void testSearchMatch() throws IOException {\n//\n//    GET /book/_search\n//    {\n//        "query": {\n//           "match": {\n//            "description": "java\u7a0b\u5e8f\u5458"\n//        }\n//      }\n//    }\n        //1\u6784\u5efa\u641c\u7d22\u8bf7\u6c42\n        SearchRequest searchRequest = new SearchRequest("book");\n\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n        searchSourceBuilder.query(QueryBuilders.matchQuery("description", "java\u7a0b\u5e8f\u5458"));\n\n\n\n\n        searchRequest.source(searchSourceBuilder);\n\n        //2\u6267\u884c\u641c\u7d22\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3\u83b7\u53d6\u7ed3\u679c\n        SearchHits hits = searchResponse.getHits();\n\n        //\u6570\u636e\u6570\u636e\n        SearchHit[] searchHits = hits.getHits();\n        System.out.println("--------------------------");\n        for (SearchHit hit : searchHits) {\n            String id = hit.getId();\n            float score = hit.getScore();\n            Map<String, Object> sourceAsMap = hit.getSourceAsMap();\n            String name = (String) sourceAsMap.get("name");\n            String description = (String) sourceAsMap.get("description");\n            Double price = (Double) sourceAsMap.get("price");\n            System.out.println("id:" + id);\n            System.out.println("name:" + name);\n            System.out.println("description:" + description);\n            System.out.println("price:" + price);\n            System.out.println("==========================");\n\n        }\n    }\n\n    //term \u641c\u7d22\n    @Test\n    public void testSearchTerm() throws IOException {\n//\n//    GET /book/_search\n//    {\n//        "query": {\n//           "term": {\n//            "description": "java\u7a0b\u5e8f\u5458"\n//        }\n//      }\n//    }\n        //1\u6784\u5efa\u641c\u7d22\u8bf7\u6c42\n        SearchRequest searchRequest = new SearchRequest("book");\n\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n        searchSourceBuilder.query(QueryBuilders.termQuery("description", "java\u7a0b\u5e8f\u5458"));\n\n\n\n\n        searchRequest.source(searchSourceBuilder);\n\n        //2\u6267\u884c\u641c\u7d22\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3\u83b7\u53d6\u7ed3\u679c\n        SearchHits hits = searchResponse.getHits();\n\n        //\u6570\u636e\u6570\u636e\n        SearchHit[] searchHits = hits.getHits();\n        System.out.println("--------------------------");\n        for (SearchHit hit : searchHits) {\n            String id = hit.getId();\n            float score = hit.getScore();\n            Map<String, Object> sourceAsMap = hit.getSourceAsMap();\n            String name = (String) sourceAsMap.get("name");\n            String description = (String) sourceAsMap.get("description");\n            Double price = (Double) sourceAsMap.get("price");\n            System.out.println("id:" + id);\n            System.out.println("name:" + name);\n            System.out.println("description:" + description);\n            System.out.println("price:" + price);\n            System.out.println("==========================");\n\n        }\n    }\n\n\n    //multi_match\u641c\u7d22\n    @Test\n    public void testSearchMultiMatch() throws IOException {\n//    GET /book/_search\n//    {\n//        "query": {\n//          "multi_match": {\n//            "query": "java\u7a0b\u5e8f\u5458",\n//            "fields": ["name", "description"]\n//        }\n//      }\n//    }\n        //1\u6784\u5efa\u641c\u7d22\u8bf7\u6c42\n        SearchRequest searchRequest = new SearchRequest("book");\n\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n        searchSourceBuilder.query(QueryBuilders.multiMatchQuery("java\u7a0b\u5e8f\u5458","name","description"));\n\n\n\n\n        searchRequest.source(searchSourceBuilder);\n\n        //2\u6267\u884c\u641c\u7d22\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3\u83b7\u53d6\u7ed3\u679c\n        SearchHits hits = searchResponse.getHits();\n\n        //\u6570\u636e\u6570\u636e\n        SearchHit[] searchHits = hits.getHits();\n        System.out.println("--------------------------");\n        for (SearchHit hit : searchHits) {\n            String id = hit.getId();\n            float score = hit.getScore();\n            Map<String, Object> sourceAsMap = hit.getSourceAsMap();\n            String name = (String) sourceAsMap.get("name");\n            String description = (String) sourceAsMap.get("description");\n            Double price = (Double) sourceAsMap.get("price");\n            System.out.println("id:" + id);\n            System.out.println("name:" + name);\n            System.out.println("description:" + description);\n            System.out.println("price:" + price);\n            System.out.println("==========================");\n\n        }\n    }\n//    GET /book/_search\n//    {\n//        "query": {\n//        "bool": {\n//            "must": [\n//            {\n//                "multi_match": {\n//                "query": "java\u7a0b\u5e8f\u5458",\n//                        "fields": ["name","description"]\n//            }\n//            }\n//      ],\n//            "should": [\n//            {\n//                "match": {\n//                "studymodel": "201001"\n//            }\n//            }\n//      ]\n//        }\n//    }\n//    }\n\n    //bool\u641c\u7d22\n    @Test\n    public void testSearchBool() throws IOException {\n//    GET /book/_search\n//    {\n//        "query": {\n//          "bool": {\n//            "must": [\n//            {\n//                "multi_match": {\n//                  "query": "java\u7a0b\u5e8f\u5458",\n//                  "fields": ["name","description"]\n//            }\n//            }\n//      ],\n//            "should": [\n//            {\n//                "match": {\n//                "studymodel": "201001"\n//            }\n//            }\n//      ]\n//        }\n//    }\n//    }\n        //1\u6784\u5efa\u641c\u7d22\u8bf7\u6c42\n        SearchRequest searchRequest = new SearchRequest("book");\n\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n\n        //\u6784\u5efamultiMatch\u8bf7\u6c42\n        MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery("java\u7a0b\u5e8f\u5458", "name", "description");\n        //\u6784\u5efamatch\u8bf7\u6c42\n        MatchQueryBuilder matchQueryBuilder = QueryBuilders.matchQuery("studymodel", "201001");\n\n        BoolQueryBuilder boolQueryBuilder=QueryBuilders.boolQuery();\n        boolQueryBuilder.must(multiMatchQueryBuilder);\n        boolQueryBuilder.should(matchQueryBuilder);\n\n        searchSourceBuilder.query(boolQueryBuilder);\n\n\n\n\n        searchRequest.source(searchSourceBuilder);\n\n        //2\u6267\u884c\u641c\u7d22\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3\u83b7\u53d6\u7ed3\u679c\n        SearchHits hits = searchResponse.getHits();\n\n        //\u6570\u636e\u6570\u636e\n        SearchHit[] searchHits = hits.getHits();\n        System.out.println("--------------------------");\n        for (SearchHit hit : searchHits) {\n            String id = hit.getId();\n            float score = hit.getScore();\n            Map<String, Object> sourceAsMap = hit.getSourceAsMap();\n            String name = (String) sourceAsMap.get("name");\n            String description = (String) sourceAsMap.get("description");\n            Double price = (Double) sourceAsMap.get("price");\n            System.out.println("id:" + id);\n            System.out.println("name:" + name);\n            System.out.println("description:" + description);\n            System.out.println("price:" + price);\n            System.out.println("==========================");\n\n        }\n    }\n\n//    GET /book/_search\n//    {\n//        "query": {\n//          "bool": {\n//            "must": [\n//            {\n//                "multi_match": {\n//                "query": "java\u7a0b\u5e8f\u5458",\n//                        "fields": ["name","description"]\n//            }\n//            }\n//      ],\n//            "should": [\n//            {\n//                "match": {\n//                "studymodel": "201001"\n//            }\n//            }\n//      ],\n//            "filter": {\n//                "range": {\n//                    "price": {\n//                        "gte": 50,\n//                                "lte": 90\n//                    }\n//                }\n//\n//            }\n//        }\n//    }\n//    }\n\n    //filter\u641c\u7d22\n    @Test\n    public void testSearchFilter() throws IOException {\n//    GET /book/_search\n//    {\n//        "query": {\n//          "bool": {\n//            "must": [\n//            {\n//                "multi_match": {\n//                "query": "java\u7a0b\u5e8f\u5458",\n//                        "fields": ["name","description"]\n//            }\n//            }\n//      ],\n//            "should": [\n//            {\n//                "match": {\n//                "studymodel": "201001"\n//            }\n//            }\n//          ],\n//            "filter": {\n//                "range": {\n//                    "price": {\n//                        "gte": 50,\n//                         "lte": 90\n//                    }\n//                }\n//\n//            }\n//        }\n//    }\n//    }\n        //1\u6784\u5efa\u641c\u7d22\u8bf7\u6c42\n        SearchRequest searchRequest = new SearchRequest("book");\n\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n\n        //\u6784\u5efamultiMatch\u8bf7\u6c42\n        MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery("java\u7a0b\u5e8f\u5458", "name", "description");\n        //\u6784\u5efamatch\u8bf7\u6c42\n        MatchQueryBuilder matchQueryBuilder = QueryBuilders.matchQuery("studymodel", "201001");\n\n        BoolQueryBuilder boolQueryBuilder=QueryBuilders.boolQuery();\n        boolQueryBuilder.must(multiMatchQueryBuilder);\n        boolQueryBuilder.should(matchQueryBuilder);\n\n        boolQueryBuilder.filter(QueryBuilders.rangeQuery("price").gte(50).lte(90));\n\n        searchSourceBuilder.query(boolQueryBuilder);\n\n\n        searchRequest.source(searchSourceBuilder);\n\n        //2\u6267\u884c\u641c\u7d22\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3\u83b7\u53d6\u7ed3\u679c\n        SearchHits hits = searchResponse.getHits();\n\n        //\u6570\u636e\u6570\u636e\n        SearchHit[] searchHits = hits.getHits();\n        System.out.println("--------------------------");\n        for (SearchHit hit : searchHits) {\n            String id = hit.getId();\n            float score = hit.getScore();\n            Map<String, Object> sourceAsMap = hit.getSourceAsMap();\n            String name = (String) sourceAsMap.get("name");\n            String description = (String) sourceAsMap.get("description");\n            Double price = (Double) sourceAsMap.get("price");\n            System.out.println("id:" + id);\n            System.out.println("name:" + name);\n            System.out.println("description:" + description);\n            System.out.println("price:" + price);\n            System.out.println("==========================");\n\n        }\n    }\n\n\n\n\n    //sort\u641c\u7d22\n    @Test\n    public void testSearchSort() throws IOException {\n//    GET /book/_search\n//    {\n//        "query": {\n//        "bool": {\n//            "must": [\n//            {\n//                "multi_match": {\n//                "query": "java\u7a0b\u5e8f\u5458",\n//                        "fields": ["name","description"]\n//            }\n//            }\n//      ],\n//            "should": [\n//            {\n//                "match": {\n//                "studymodel": "201001"\n//            }\n//            }\n//      ],\n//            "filter": {\n//                "range": {\n//                    "price": {\n//                        "gte": 50,\n//                                "lte": 90\n//                    }\n//                }\n//\n//            }\n//        }\n//    },\n//        "sort": [\n//        {\n//            "price": {\n//            "order": "asc"\n//        }\n//        }\n//  ]\n//    }\n        //1\u6784\u5efa\u641c\u7d22\u8bf7\u6c42\n        SearchRequest searchRequest = new SearchRequest("book");\n\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n\n        //\u6784\u5efamultiMatch\u8bf7\u6c42\n        MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery("java\u7a0b\u5e8f\u5458", "name", "description");\n        //\u6784\u5efamatch\u8bf7\u6c42\n        MatchQueryBuilder matchQueryBuilder = QueryBuilders.matchQuery("studymodel", "201001");\n\n        BoolQueryBuilder boolQueryBuilder=QueryBuilders.boolQuery();\n        boolQueryBuilder.must(multiMatchQueryBuilder);\n        boolQueryBuilder.should(matchQueryBuilder);\n\n        boolQueryBuilder.filter(QueryBuilders.rangeQuery("price").gte(50).lte(90));\n\n        searchSourceBuilder.query(boolQueryBuilder);\n\n        //\u6309\u7167\u4ef7\u683c\u5347\u5e8f\n        searchSourceBuilder.sort("price", SortOrder.ASC);\n\n\n        searchRequest.source(searchSourceBuilder);\n\n        //2\u6267\u884c\u641c\u7d22\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3\u83b7\u53d6\u7ed3\u679c\n        SearchHits hits = searchResponse.getHits();\n\n        //\u6570\u636e\u6570\u636e\n        SearchHit[] searchHits = hits.getHits();\n        System.out.println("--------------------------");\n        for (SearchHit hit : searchHits) {\n            String id = hit.getId();\n            float score = hit.getScore();\n            Map<String, Object> sourceAsMap = hit.getSourceAsMap();\n            String name = (String) sourceAsMap.get("name");\n            String description = (String) sourceAsMap.get("description");\n            Double price = (Double) sourceAsMap.get("price");\n            System.out.println("id:" + id);\n            System.out.println("name:" + name);\n            System.out.println("description:" + description);\n            System.out.println("price:" + price);\n            System.out.println("==========================");\n        }\n    }\n\n}\n')),(0,r.kt)("h2",{id:"\u7b2c\u5341\u516d\u7ae0-\u8bc4\u5206\u673a\u5236\u8be6\u89e3"},"\u7b2c\u5341\u516d\u7ae0 \u8bc4\u5206\u673a\u5236\u8be6\u89e3"),(0,r.kt)("h3",{id:"\u4e00\u8bc4\u5206\u673a\u5236-tfidf"},"\u4e00\u3001\u8bc4\u5206\u673a\u5236 TF\\IDF"),(0,r.kt)("h4",{id:"1\u7b97\u6cd5\u4ecb\u7ecd"},"1\u3001\u7b97\u6cd5\u4ecb\u7ecd"),(0,r.kt)("p",null,"relevance score\u7b97\u6cd5\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u8ba1\u7b97\u51fa\uff0c\u4e00\u4e2a\u7d22\u5f15\u4e2d\u7684\u6587\u672c\uff0c\u4e0e\u641c\u7d22\u6587\u672c\uff0c\u4ed6\u4eec\u4e4b\u95f4\u7684\u5173\u8054\u5339\u914d\u7a0b\u5ea6\u3002"),(0,r.kt)("p",null,"Elasticsearch\u4f7f\u7528\u7684\u662f term frequency/inverse document frequency\u7b97\u6cd5\uff0c\u7b80\u79f0\u4e3aTF/IDF\u7b97\u6cd5\u3002TF\u8bcd\u9891(Term Frequency)\uff0cIDF\u9006\u5411\u6587\u4ef6\u9891\u7387(Inverse Document Frequency)"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Term frequency"),"\uff1a\u641c\u7d22\u6587\u672c\u4e2d\u7684\u5404\u4e2a\u8bcd\u6761\u5728field\u6587\u672c\u4e2d\u51fa\u73b0\u4e86\u591a\u5c11\u6b21\uff0c\u51fa\u73b0\u6b21\u6570\u8d8a\u591a\uff0c\u5c31\u8d8a\u76f8\u5173\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/1571494142950-c13777bd.png",alt:"1571494142950"}),"1571494142950"),(0,r.kt)("p",null,"\u4e3e\u4f8b\uff1a\u641c\u7d22\u8bf7\u6c42\uff1ahello world"),(0,r.kt)("p",null,"doc1 : hello you and me,and world is very good."),(0,r.kt)("p",null,"doc2 : hello,how are you"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Inverse document frequency"),"\uff1a\u641c\u7d22\u6587\u672c\u4e2d\u7684\u5404\u4e2a\u8bcd\u6761\u5728\u6574\u4e2a\u7d22\u5f15\u7684\u6240\u6709\u6587\u6863\u4e2d\u51fa\u73b0\u4e86\u591a\u5c11\u6b21\uff0c\u51fa\u73b0\u7684\u6b21\u6570\u8d8a\u591a\uff0c\u5c31\u8d8a\u4e0d\u76f8\u5173."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/1571494159465-ae0d7678.png",alt:"1571494159465"}),"1571494159465"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/1571494176760-350e0734.png",alt:"1571494176760"}),"1571494176760"),(0,r.kt)("p",null,"\u4e3e\u4f8b\uff1a\u641c\u7d22\u8bf7\u6c42\uff1ahello world"),(0,r.kt)("p",null,"doc1 : hello ,today is very good"),(0,r.kt)("p",null,"doc2 : hi world ,how are you"),(0,r.kt)("p",null,"\u6574\u4e2aindex\u4e2d1\u4ebf\u6761\u6570\u636e\u3002hello\u7684document 1000\u4e2a\uff0c\u6709world\u7684document \u6709100\u4e2a\u3002"),(0,r.kt)("p",null,"doc2 \u66f4\u76f8\u5173"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Field-length norm"),"\uff1afield\u957f\u5ea6\uff0cfield\u8d8a\u957f\uff0c\u76f8\u5173\u5ea6\u8d8a\u5f31"),(0,r.kt)("p",null,"\u4e3e\u4f8b\uff1a\u641c\u7d22\u8bf7\u6c42\uff1ahello world"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'doc1 : {"title":"hello article","content ":"balabalabal 1\u4e07\u4e2a"}\ndoc2 : {"title":"my article","content ":"balabalabal 1\u4e07\u4e2a,world"}\n')),(0,r.kt)("h4",{id:"2_score\u662f\u5982\u4f55\u88ab\u8ba1\u7b97\u51fa\u6765\u7684"},"2\u3001_score\u662f\u5982\u4f55\u88ab\u8ba1\u7b97\u51fa\u6765\u7684"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search?explain=true\n{\n  "query": {\n    "match": {\n      "description": "java\u7a0b\u5e8f\u5458"\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u8fd4\u56de"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'{\n  "took" : 5,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : {\n      "value" : 2,\n      "relation" : "eq"\n    },\n    "max_score" : 2.137549,\n    "hits" : [\n      {\n        "_shard" : "[book][0]",\n        "_node" : "MDA45-r6SUGJ0ZyqyhTINA",\n        "_index" : "book",\n        "_type" : "_doc",\n        "_id" : "3",\n        "_score" : 2.137549,\n        "_source" : {\n          "name" : "spring\u5f00\u53d1\u57fa\u7840",\n          "description" : "spring \u5728java\u9886\u57df\u975e\u5e38\u6d41\u884c\uff0cjava\u7a0b\u5e8f\u5458\u90fd\u5728\u7528\u3002",\n          "studymodel" : "201001",\n          "price" : 88.6,\n          "timestamp" : "2019-08-24 19:11:35",\n          "pic" : "group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg",\n          "tags" : [\n            "spring",\n            "java"\n          ]\n        },\n        "_explanation" : {\n          "value" : 2.137549,\n          "description" : "sum of:",\n          "details" : [\n            {\n              "value" : 0.7936629,\n              "description" : "weight(description:java in 0) [PerFieldSimilarity], result of:",\n              "details" : [\n                {\n                  "value" : 0.7936629,\n                  "description" : "score(freq=2.0), product of:",\n                  "details" : [\n                    {\n                      "value" : 2.2,\n                      "description" : "boost",\n                      "details" : [ ]\n                    },\n                    {\n                      "value" : 0.47000363,\n                      "description" : "idf, computed as log(1 + (N - n + 0.5) / (n + 0.5)) from:",\n                      "details" : [\n                        {\n                          "value" : 2,\n                          "description" : "n, number of documents containing term",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 3,\n                          "description" : "N, total number of documents with field",\n                          "details" : [ ]\n                        }\n                      ]\n                    },\n                    {\n                      "value" : 0.7675597,\n                      "description" : "tf, computed as freq / (freq + k1 * (1 - b + b * dl / avgdl)) from:",\n                      "details" : [\n                        {\n                          "value" : 2.0,\n                          "description" : "freq, occurrences of term within document",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 1.2,\n                          "description" : "k1, term saturation parameter",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 0.75,\n                          "description" : "b, length normalization parameter",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 12.0,\n                          "description" : "dl, length of field",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 35.333332,\n                          "description" : "avgdl, average length of field",\n                          "details" : [ ]\n                        }\n                      ]\n                    }\n                  ]\n                }\n              ]\n            },\n            {\n              "value" : 1.3438859,\n              "description" : "weight(description:\u7a0b\u5e8f\u5458 in 0) [PerFieldSimilarity], result of:",\n              "details" : [\n                {\n                  "value" : 1.3438859,\n                  "description" : "score(freq=1.0), product of:",\n                  "details" : [\n                    {\n                      "value" : 2.2,\n                      "description" : "boost",\n                      "details" : [ ]\n                    },\n                    {\n                      "value" : 0.98082924,\n                      "description" : "idf, computed as log(1 + (N - n + 0.5) / (n + 0.5)) from:",\n                      "details" : [\n                        {\n                          "value" : 1,\n                          "description" : "n, number of documents containing term",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 3,\n                          "description" : "N, total number of documents with field",\n                          "details" : [ ]\n                        }\n                      ]\n                    },\n                    {\n                      "value" : 0.6227967,\n                      "description" : "tf, computed as freq / (freq + k1 * (1 - b + b * dl / avgdl)) from:",\n                      "details" : [\n                        {\n                          "value" : 1.0,\n                          "description" : "freq, occurrences of term within document",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 1.2,\n                          "description" : "k1, term saturation parameter",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 0.75,\n                          "description" : "b, length normalization parameter",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 12.0,\n                          "description" : "dl, length of field",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 35.333332,\n                          "description" : "avgdl, average length of field",\n                          "details" : [ ]\n                        }\n                      ]\n                    }\n                  ]\n                }\n              ]\n            }\n          ]\n        }\n      },\n      {\n        "_shard" : "[book][0]",\n        "_node" : "MDA45-r6SUGJ0ZyqyhTINA",\n        "_index" : "book",\n        "_type" : "_doc",\n        "_id" : "2",\n        "_score" : 0.57961315,\n        "_source" : {\n          "name" : "java\u7f16\u7a0b\u601d\u60f3",\n          "description" : "java\u8bed\u8a00\u662f\u4e16\u754c\u7b2c\u4e00\u7f16\u7a0b\u8bed\u8a00\uff0c\u5728\u8f6f\u4ef6\u5f00\u53d1\u9886\u57df\u4f7f\u7528\u4eba\u6570\u6700\u591a\u3002",\n          "studymodel" : "201001",\n          "price" : 68.6,\n          "timestamp" : "2019-08-25 19:11:35",\n          "pic" : "group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg",\n          "tags" : [\n            "java",\n            "dev"\n          ]\n        },\n        "_explanation" : {\n          "value" : 0.57961315,\n          "description" : "sum of:",\n          "details" : [\n            {\n              "value" : 0.57961315,\n              "description" : "weight(description:java in 0) [PerFieldSimilarity], result of:",\n              "details" : [\n                {\n                  "value" : 0.57961315,\n                  "description" : "score(freq=1.0), product of:",\n                  "details" : [\n                    {\n                      "value" : 2.2,\n                      "description" : "boost",\n                      "details" : [ ]\n                    },\n                    {\n                      "value" : 0.47000363,\n                      "description" : "idf, computed as log(1 + (N - n + 0.5) / (n + 0.5)) from:",\n                      "details" : [\n                        {\n                          "value" : 2,\n                          "description" : "n, number of documents containing term",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 3,\n                          "description" : "N, total number of documents with field",\n                          "details" : [ ]\n                        }\n                      ]\n                    },\n                    {\n                      "value" : 0.56055,\n                      "description" : "tf, computed as freq / (freq + k1 * (1 - b + b * dl / avgdl)) from:",\n                      "details" : [\n                        {\n                          "value" : 1.0,\n                          "description" : "freq, occurrences of term within document",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 1.2,\n                          "description" : "k1, term saturation parameter",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 0.75,\n                          "description" : "b, length normalization parameter",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 19.0,\n                          "description" : "dl, length of field",\n                          "details" : [ ]\n                        },\n                        {\n                          "value" : 35.333332,\n                          "description" : "avgdl, average length of field",\n                          "details" : [ ]\n                        }\n                      ]\n                    }\n                  ]\n                }\n              ]\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n')),(0,r.kt)("h4",{id:"3\u5206\u6790\u4e00\u4e2adocument\u662f\u5982\u4f55\u88ab\u5339\u914d\u4e0a\u7684"},"3\u3001\u5206\u6790\u4e00\u4e2adocument\u662f\u5982\u4f55\u88ab\u5339\u914d\u4e0a\u7684"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_explain/3\n{\n  "query": {\n    "match": {\n      "description": "java\u7a0b\u5e8f\u5458"\n    }\n  }\n}\n')),(0,r.kt)("h3",{id:"\u4e8cdoc-value"},"\u4e8c\u3001Doc value"),(0,r.kt)("p",null,"\u641c\u7d22\u7684\u65f6\u5019\uff0c\u8981\u4f9d\u9760\u5012\u6392\u7d22\u5f15\uff1b\u6392\u5e8f\u7684\u65f6\u5019\uff0c\u9700\u8981\u4f9d\u9760\u6b63\u6392\u7d22\u5f15\uff0c\u770b\u5230\u6bcf\u4e2adocument\u7684\u6bcf\u4e2afield\uff0c\u7136\u540e\u8fdb\u884c\u6392\u5e8f\uff0c\u6240\u8c13\u7684\u6b63\u6392\u7d22\u5f15\uff0c\u5176\u5b9e\u5c31\u662fdoc values"),(0,r.kt)("p",null,"\u5728\u5efa\u7acb\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u4e00\u65b9\u9762\u4f1a\u5efa\u7acb\u5012\u6392\u7d22\u5f15\uff0c\u4ee5\u4f9b\u641c\u7d22\u7528\uff1b\u4e00\u65b9\u9762\u4f1a\u5efa\u7acb\u6b63\u6392\u7d22\u5f15\uff0c\u4e5f\u5c31\u662fdoc values\uff0c\u4ee5\u4f9b\u6392\u5e8f\uff0c\u805a\u5408\uff0c\u8fc7\u6ee4\u7b49\u64cd\u4f5c\u4f7f\u7528"),(0,r.kt)("p",null,"doc values\u662f\u88ab\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a\u7684\uff0c\u6b64\u65f6\u5982\u679c\u5185\u5b58\u8db3\u591f\uff0cos\u4f1a\u81ea\u52a8\u5c06\u5176\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u6027\u80fd\u8fd8\u662f\u4f1a\u5f88\u9ad8\uff1b\u5982\u679c\u5185\u5b58\u4e0d\u8db3\u591f\uff0cos\u4f1a\u5c06\u5176\u5199\u5165\u78c1\u76d8\u4e0a"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u5012\u6392\u7d22\u5f15")),(0,r.kt)("p",null,"doc1: hello world you and me"),(0,r.kt)("p",null,"doc2: hi, world, how are you"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"term"),(0,r.kt)("th",{parentName:"tr",align:null},"doc1"),(0,r.kt)("th",{parentName:"tr",align:null},"doc2"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hello"),(0,r.kt)("td",{parentName:"tr",align:null},"*"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"world"),(0,r.kt)("td",{parentName:"tr",align:null},"*"),(0,r.kt)("td",{parentName:"tr",align:null},"*")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"you"),(0,r.kt)("td",{parentName:"tr",align:null},"*"),(0,r.kt)("td",{parentName:"tr",align:null},"*")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"and"),(0,r.kt)("td",{parentName:"tr",align:null},"*"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"me"),(0,r.kt)("td",{parentName:"tr",align:null},"*"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hi"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"*")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"how"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"*")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"are"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"*")))),(0,r.kt)("p",null,"\u641c\u7d22\u65f6\uff1a"),(0,r.kt)("p",null,"hello you --\x3e hello, you"),(0,r.kt)("p",null,"hello --\x3e doc1"),(0,r.kt)("p",null,"you --\x3e doc1,doc2"),(0,r.kt)("p",null,"doc1: hello world you and me"),(0,r.kt)("p",null,"doc2: hi, world, how are you"),(0,r.kt)("p",null,"sort by \u51fa\u73b0\u95ee\u9898"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6b63\u6392\u7d22\u5f15")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'doc1: { "name": "jack", "age": 27 }\ndoc2: { "name": "tom", "age": 30 }\n')),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"document"),(0,r.kt)("th",{parentName:"tr",align:null},"name"),(0,r.kt)("th",{parentName:"tr",align:null},"age"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"doc1"),(0,r.kt)("td",{parentName:"tr",align:null},"jack"),(0,r.kt)("td",{parentName:"tr",align:null},"27")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"doc2"),(0,r.kt)("td",{parentName:"tr",align:null},"tom"),(0,r.kt)("td",{parentName:"tr",align:null},"30")))),(0,r.kt)("h3",{id:"\u4e09query-phase"},"\u4e09\u3001query phase"),(0,r.kt)("h4",{id:"1query-phase"},"1\u3001query phase"),(0,r.kt)("p",null,"\uff081\uff09\u641c\u7d22\u8bf7\u6c42\u53d1\u9001\u5230\u67d0\u4e00\u4e2acoordinate node\uff0c\u6784\u6784\u5efa\u4e00\u4e2apriority queue\uff0c\u957f\u5ea6\u4ee5paging\u64cd\u4f5cfrom\u548csize\u4e3a\u51c6\uff0c\u9ed8\u8ba4\u4e3a10"),(0,r.kt)("p",null,"\uff082\uff09coordinate node\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u6240\u6709shard\uff0c\u6bcf\u4e2ashard\u672c\u5730\u641c\u7d22\uff0c\u5e76\u6784\u5efa\u4e00\u4e2a\u672c\u5730\u7684priority queue"),(0,r.kt)("p",null,"\uff083\uff09\u5404\u4e2ashard\u5c06\u81ea\u5df1\u7684priority queue\u8fd4\u56de\u7ed9coordinate node\uff0c\u5e76\u6784\u5efa\u4e00\u4e2a\u5168\u5c40\u7684priority queue"),(0,r.kt)("h4",{id:"2replica-shard\u5982\u4f55\u63d0\u5347\u641c\u7d22\u541e\u5410\u91cf"},"2\u3001replica shard\u5982\u4f55\u63d0\u5347\u641c\u7d22\u541e\u5410\u91cf"),(0,r.kt)("p",null,"\u4e00\u6b21\u8bf7\u6c42\u8981\u6253\u5230\u6240\u6709shard\u7684\u4e00\u4e2areplica/primary\u4e0a\u53bb\uff0c\u5982\u679c\u6bcf\u4e2ashard\u90fd\u6709\u591a\u4e2areplica\uff0c\u90a3\u4e48\u540c\u65f6\u5e76\u53d1\u8fc7\u6765\u7684\u641c\u7d22\u8bf7\u6c42\u53ef\u4ee5\u540c\u65f6\u6253\u5230\u5176\u4ed6\u7684replica\u4e0a\u53bb"),(0,r.kt)("h3",{id:"\u56db-fetch-phase"},"\u56db\u3001 fetch phase"),(0,r.kt)("h4",{id:"1fetch-phbase\u5de5\u4f5c\u6d41\u7a0b"},"1\u3001fetch phbase\u5de5\u4f5c\u6d41\u7a0b"),(0,r.kt)("p",null,"\uff081\uff09coordinate node\u6784\u5efa\u5b8cpriority queue\u4e4b\u540e\uff0c\u5c31\u53d1\u9001mget\u8bf7\u6c42\u53bb\u6240\u6709shard\u4e0a\u83b7\u53d6\u5bf9\u5e94\u7684document"),(0,r.kt)("p",null,"\uff082\uff09\u5404\u4e2ashard\u5c06document\u8fd4\u56de\u7ed9coordinate node"),(0,r.kt)("p",null,"\uff083\uff09coordinate node\u5c06\u5408\u5e76\u540e\u7684document\u7ed3\u679c\u8fd4\u56de\u7ed9client\u5ba2\u6237\u7aef"),(0,r.kt)("h4",{id:"2\u4e00\u822c\u641c\u7d22\u5982\u679c\u4e0d\u52a0from\u548csize\u5c31\u9ed8\u8ba4\u641c\u7d22\u524d10\u6761\u6309\u7167_score\u6392\u5e8f"},"2\u3001\u4e00\u822c\u641c\u7d22\uff0c\u5982\u679c\u4e0d\u52a0from\u548csize\uff0c\u5c31\u9ed8\u8ba4\u641c\u7d22\u524d10\u6761\uff0c\u6309\u7167_score\u6392\u5e8f"),(0,r.kt)("h3",{id:"\u4e94\u641c\u7d22\u53c2\u6570\u5c0f\u603b\u7ed3"},"\u4e94\u3001\u641c\u7d22\u53c2\u6570\u5c0f\u603b\u7ed3"),(0,r.kt)("h4",{id:"1preference"},"1\u3001preference"),(0,r.kt)("p",null,"\u51b3\u5b9a\u4e86\u54ea\u4e9bshard\u4f1a\u88ab\u7528\u6765\u6267\u884c\u641c\u7d22\u64cd\u4f5c"),(0,r.kt)("p",null,"_primary, _primary_first, _local, _only_node:xyz, _prefer_node:xyz, _shards:2,3"),(0,r.kt)("p",null,"bouncing results\u95ee\u9898\uff0c\u4e24\u4e2adocument\u6392\u5e8f\uff0cfield\u503c\u76f8\u540c\uff1b\u4e0d\u540c\u7684shard\u4e0a\uff0c\u53ef\u80fd\u6392\u5e8f\u4e0d\u540c\uff1b\u6bcf\u6b21\u8bf7\u6c42\u8f6e\u8be2\u6253\u5230\u4e0d\u540c\u7684replica shard\u4e0a\uff1b\u6bcf\u6b21\u9875\u9762\u4e0a\u770b\u5230\u7684\u641c\u7d22\u7ed3\u679c\u7684\u6392\u5e8f\u90fd\u4e0d\u4e00\u6837\u3002\u8fd9\u5c31\u662fbouncing result\uff0c\u4e5f\u5c31\u662f\u8df3\u8dc3\u7684\u7ed3\u679c\u3002"),(0,r.kt)("p",null,"\u641c\u7d22\u7684\u65f6\u5019\uff0c\u662f\u8f6e\u8be2\u5c06\u641c\u7d22\u8bf7\u6c42\u53d1\u9001\u5230\u6bcf\u4e00\u4e2areplica shard\uff08primary shard\uff09\uff0c\u4f46\u662f\u5728\u4e0d\u540c\u7684shard\u4e0a\uff0c\u53ef\u80fddocument\u7684\u6392\u5e8f\u4e0d\u540c"),(0,r.kt)("p",null,"\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u5c06preference\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6bd4\u5982\u8bf4user_id\uff0c\u8ba9\u6bcf\u4e2auser\u6bcf\u6b21\u641c\u7d22\u7684\u65f6\u5019\uff0c\u90fd\u4f7f\u7528\u540c\u4e00\u4e2areplica shard\u53bb\u6267\u884c\uff0c\u5c31\u4e0d\u4f1a\u770b\u5230bouncing results\u4e86"),(0,r.kt)("h4",{id:"2timeout"},"2\u3001timeout"),(0,r.kt)("p",null,"\u5df2\u7ecf\u8bb2\u89e3\u8fc7\u539f\u7406\u4e86\uff0c\u4e3b\u8981\u5c31\u662f\u9650\u5b9a\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\uff0c\u5c06\u90e8\u5206\u83b7\u53d6\u5230\u7684\u6570\u636e\u76f4\u63a5\u8fd4\u56de\uff0c\u907f\u514d\u67e5\u8be2\u8017\u65f6\u8fc7\u957f"),(0,r.kt)("h4",{id:"3routing"},"3\u3001routing"),(0,r.kt)("p",null,"document\u6587\u6863\u8def\u7531\uff0c_id\u8def\u7531\uff0crouting=user_id\uff0c\u8fd9\u6837\u7684\u8bdd\u53ef\u4ee5\u8ba9\u540c\u4e00\u4e2auser\u5bf9\u5e94\u7684\u6570\u636e\u5230\u4e00\u4e2ashard\u4e0a\u53bb"),(0,r.kt)("h4",{id:"4search_type"},"4\u3001search_type"),(0,r.kt)("p",null,"default\uff1aquery_then_fetch"),(0,r.kt)("p",null,"dfs_query_then_fetch\uff0c\u53ef\u4ee5\u63d0\u5347revelance sort\u7cbe\u51c6\u5ea6"),(0,r.kt)("h2",{id:"\u7b2c\u5341\u4e03\u7ae0-\u805a\u5408\u5165\u95e8"},"\u7b2c\u5341\u4e03\u7ae0 \u805a\u5408\u5165\u95e8"),(0,r.kt)("h3",{id:"\u4e00\u805a\u5408\u793a\u4f8b"},"\u4e00\u3001\u805a\u5408\u793a\u4f8b"),(0,r.kt)("h4",{id:"1\u9700\u6c42\u8ba1\u7b97\u6bcf\u4e2astudymodel\u4e0b\u7684\u5546\u54c1\u6570\u91cf"},"1\u3001\u9700\u6c42\uff1a\u8ba1\u7b97\u6bcf\u4e2astudymodel\u4e0b\u7684\u5546\u54c1\u6570\u91cf"),(0,r.kt)("p",null,"sql\u8bed\u53e5\uff1a select studymodel\uff0ccount(*) from book group by studymodel"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n  "size": 0, \n  "query": {\n    "match_all": {}\n  }, \n  "aggs": {\n    "group_by_model": {\n      "terms": { "field": "studymodel" }\n    }\n  }\n}\n')),(0,r.kt)("h4",{id:"2\u9700\u6c42\u8ba1\u7b97\u6bcf\u4e2atags\u4e0b\u7684\u5546\u54c1\u6570\u91cf"},"2\u3001\u9700\u6c42\uff1a\u8ba1\u7b97\u6bcf\u4e2atags\u4e0b\u7684\u5546\u54c1\u6570\u91cf"),(0,r.kt)("p",null,'\u8bbe\u7f6e\u5b57\u6bb5"fielddata": true'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'PUT /book/_mapping/\n{\n  "properties": {\n    "tags": {\n      "type": "text",\n      "fielddata": true\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u67e5\u8be2"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n  "size": 0, \n  "query": {\n    "match_all": {}\n  }, \n  "aggs": {\n    "group_by_tags": {\n      "terms": { "field": "tags" }\n    }\n  }\n}\n')),(0,r.kt)("h4",{id:"3\u9700\u6c42\u52a0\u4e0a\u641c\u7d22\u6761\u4ef6\u8ba1\u7b97\u6bcf\u4e2atags\u4e0b\u7684\u5546\u54c1\u6570\u91cf"},"3\u3001\u9700\u6c42\uff1a\u52a0\u4e0a\u641c\u7d22\u6761\u4ef6\uff0c\u8ba1\u7b97\u6bcf\u4e2atags\u4e0b\u7684\u5546\u54c1\u6570\u91cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n  "size": 0, \n  "query": {\n    "match": {\n      "description": "java\u7a0b\u5e8f\u5458"\n    }\n  }, \n  "aggs": {\n    "group_by_tags": {\n      "terms": { "field": "tags" }\n    }\n  }\n}\n')),(0,r.kt)("h4",{id:"4\u9700\u6c42\u5148\u5206\u7ec4\u518d\u7b97\u6bcf\u7ec4\u7684\u5e73\u5747\u503c\u8ba1\u7b97\u6bcf\u4e2atag\u4e0b\u7684\u5546\u54c1\u7684\u5e73\u5747\u4ef7\u683c"},"4\u3001\u9700\u6c42\uff1a\u5148\u5206\u7ec4\uff0c\u518d\u7b97\u6bcf\u7ec4\u7684\u5e73\u5747\u503c\uff0c\u8ba1\u7b97\u6bcf\u4e2atag\u4e0b\u7684\u5546\u54c1\u7684\u5e73\u5747\u4ef7\u683c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n    "size": 0,\n    "aggs" : {\n        "group_by_tags" : {\n            "terms" : { \n              "field" : "tags" \n            },\n            "aggs" : {\n                "avg_price" : {\n                    "avg" : { "field" : "price" }\n                }\n            }\n        }\n    }\n}\n')),(0,r.kt)("h4",{id:"5\u9700\u6c42\u8ba1\u7b97\u6bcf\u4e2atag\u4e0b\u7684\u5546\u54c1\u7684\u5e73\u5747\u4ef7\u683c\u5e76\u4e14\u6309\u7167\u5e73\u5747\u4ef7\u683c\u964d\u5e8f\u6392\u5e8f"},"5\u3001\u9700\u6c42\uff1a\u8ba1\u7b97\u6bcf\u4e2atag\u4e0b\u7684\u5546\u54c1\u7684\u5e73\u5747\u4ef7\u683c\uff0c\u5e76\u4e14\u6309\u7167\u5e73\u5747\u4ef7\u683c\u964d\u5e8f\u6392\u5e8f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n    "size": 0,\n    "aggs" : {\n        "group_by_tags" : {\n            "terms" : { \n              "field" : "tags",\n              "order": {\n                "avg_price": "desc"\n              }\n            },\n            "aggs" : {\n                "avg_price" : {\n                    "avg" : { "field" : "price" }\n                }\n            }\n        }\n    }\n}\n')),(0,r.kt)("h4",{id:"6\u9700\u6c42\u6309\u7167\u6307\u5b9a\u7684\u4ef7\u683c\u8303\u56f4\u533a\u95f4\u8fdb\u884c\u5206\u7ec4\u7136\u540e\u5728\u6bcf\u7ec4\u5185\u518d\u6309\u7167tag\u8fdb\u884c\u5206\u7ec4\u6700\u540e\u518d\u8ba1\u7b97\u6bcf\u7ec4\u7684\u5e73\u5747\u4ef7\u683c"},"6\u3001\u9700\u6c42\uff1a\u6309\u7167\u6307\u5b9a\u7684\u4ef7\u683c\u8303\u56f4\u533a\u95f4\u8fdb\u884c\u5206\u7ec4\uff0c\u7136\u540e\u5728\u6bcf\u7ec4\u5185\u518d\u6309\u7167tag\u8fdb\u884c\u5206\u7ec4\uff0c\u6700\u540e\u518d\u8ba1\u7b97\u6bcf\u7ec4\u7684\u5e73\u5747\u4ef7\u683c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /book/_search\n{\n  "size": 0,\n  "aggs": {\n    "group_by_price": {\n      "range": {\n        "field": "price",\n        "ranges": [\n          {\n            "from": 0,\n            "to": 40\n          },\n          {\n            "from": 40,\n            "to": 60\n          },\n          {\n            "from": 60,\n            "to": 80\n          }\n        ]\n      },\n      "aggs": {\n        "group_by_tags": {\n          "terms": {\n            "field": "tags"\n          },\n          "aggs": {\n            "average_price": {\n              "avg": {\n                "field": "price"\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n')),(0,r.kt)("h3",{id:"\u4e8c\u4e24\u4e2a\u6838\u5fc3\u6982\u5ff5bucket\u548cmetric"},"\u4e8c\u3001\u4e24\u4e2a\u6838\u5fc3\u6982\u5ff5\uff1abucket\u548cmetric"),(0,r.kt)("h4",{id:"1bucket\u4e00\u4e2a\u6570\u636e\u5206\u7ec4"},"1\u3001bucket\uff1a\u4e00\u4e2a\u6570\u636e\u5206\u7ec4"),(0,r.kt)("p",null,"city name \u5317\u4eac \u5f20\u4e09 \u5317\u4eac \u674e\u56db \u5929\u6d25 \u738b\u4e94 \u5929\u6d25 \u8d75\u516d"),(0,r.kt)("p",null,"\u5929\u6d25 \u738b\u9ebb\u5b50"),(0,r.kt)("p",null,"\u5212\u5206\u51fa\u6765\u4e24\u4e2abucket\uff0c\u4e00\u4e2a\u662f\u5317\u4eacbucket\uff0c\u4e00\u4e2a\u662f\u5929\u6d25bucket \u5317\u4eacbucket\uff1a\u5305\u542b\u4e862\u4e2a\u4eba\uff0c\u5f20\u4e09\uff0c\u674e\u56db \u4e0a\u6d77bucket\uff1a\u5305\u542b\u4e863\u4e2a\u4eba\uff0c\u738b\u4e94\uff0c\u8d75\u516d\uff0c\u738b\u9ebb\u5b50"),(0,r.kt)("h4",{id:"2metric\u5bf9\u4e00\u4e2a\u6570\u636e\u5206\u7ec4\u6267\u884c\u7684\u7edf\u8ba1"},"2\u3001metric\uff1a\u5bf9\u4e00\u4e2a\u6570\u636e\u5206\u7ec4\u6267\u884c\u7684\u7edf\u8ba1"),(0,r.kt)("p",null,"metric\uff0c\u5c31\u662f\u5bf9\u4e00\u4e2abucket\u6267\u884c\u7684\u67d0\u79cd\u805a\u5408\u5206\u6790\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u8bf4\u6c42\u5e73\u5747\u503c\uff0c\u6c42\u6700\u5927\u503c\uff0c\u6c42\u6700\u5c0f\u503c"),(0,r.kt)("p",null,"select count(*) from book group studymodel"),(0,r.kt)("p",null,"bucket\uff1agroup by studymodel --\x3e \u90a3\u4e9bstudymodel\u76f8\u540c\u7684\u6570\u636e\uff0c\u5c31\u4f1a\u88ab\u5212\u5206\u5230\u4e00\u4e2abucket\u4e2d metric\uff1acount(*)\uff0c\u5bf9\u6bcf\u4e2auser_id bucket\u4e2d\u6240\u6709\u7684\u6570\u636e\uff0c\u8ba1\u7b97\u4e00\u4e2a\u6570\u91cf\u3002\u8fd8\u6709avg()\uff0csum()\uff0cmax()\uff0cmin()"),(0,r.kt)("h4",{id:"3\u7535\u89c6\u6848\u4f8b"},"3\u3001\u7535\u89c6\u6848\u4f8b"),(0,r.kt)("p",null,"\u521b\u5efa\u7d22\u5f15\u53ca\u6620\u5c04"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'PUT /tvs\nPUT /tvs/_search\n{           \n            "properties": {\n                "price": {\n                    "type": "long"\n                },\n                "color": {\n                    "type": "keyword"\n                },\n                "brand": {\n                    "type": "keyword"\n                },\n                "sold_date": {\n                    "type": "date"\n                }\n            }\n}\n')),(0,r.kt)("p",null,"\u63d2\u5165\u6570\u636e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'POST /tvs/_bulk\n{ "index": {}}\n{ "price" : 1000, "color" : "\u7ea2\u8272", "brand" : "\u957f\u8679", "sold_date" : "2019-10-28" }\n{ "index": {}}\n{ "price" : 2000, "color" : "\u7ea2\u8272", "brand" : "\u957f\u8679", "sold_date" : "2019-11-05" }\n{ "index": {}}\n{ "price" : 3000, "color" : "\u7eff\u8272", "brand" : "\u5c0f\u7c73", "sold_date" : "2019-05-18" }\n{ "index": {}}\n{ "price" : 1500, "color" : "\u84dd\u8272", "brand" : "TCL", "sold_date" : "2019-07-02" }\n{ "index": {}}\n{ "price" : 1200, "color" : "\u7eff\u8272", "brand" : "TCL", "sold_date" : "2019-08-19" }\n{ "index": {}}\n{ "price" : 2000, "color" : "\u7ea2\u8272", "brand" : "\u957f\u8679", "sold_date" : "2019-11-05" }\n{ "index": {}}\n{ "price" : 8000, "color" : "\u7ea2\u8272", "brand" : "\u4e09\u661f", "sold_date" : "2020-01-01" }\n{ "index": {}}\n{ "price" : 2500, "color" : "\u84dd\u8272", "brand" : "\u5c0f\u7c73", "sold_date" : "2020-02-12" }\n')),(0,r.kt)("h5",{id:"\u9700\u6c421-\u7edf\u8ba1\u54ea\u79cd\u989c\u8272\u7684\u7535\u89c6\u9500\u91cf\u6700\u9ad8"},"\u9700\u6c421 \u7edf\u8ba1\u54ea\u79cd\u989c\u8272\u7684\u7535\u89c6\u9500\u91cf\u6700\u9ad8"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search\n{\n    "size" : 0,\n    "aggs" : { \n        "popular_colors" : { \n            "terms" : { \n              "field" : "color"\n            }\n        }\n    }\n}\n')),(0,r.kt)("p",null,"\u67e5\u8be2\u6761\u4ef6\u89e3\u6790"),(0,r.kt)("p",null,"size\uff1a\u53ea\u83b7\u53d6\u805a\u5408\u7ed3\u679c\uff0c\u800c\u4e0d\u8981\u6267\u884c\u805a\u5408\u7684\u539f\u59cb\u6570\u636e aggs\uff1a\u56fa\u5b9a\u8bed\u6cd5\uff0c\u8981\u5bf9\u4e00\u4efd\u6570\u636e\u6267\u884c\u5206\u7ec4\u805a\u5408\u64cd\u4f5c popular_colors\uff1a\u5c31\u662f\u5bf9\u6bcf\u4e2aaggs\uff0c\u90fd\u8981\u8d77\u4e00\u4e2a\u540d\u5b57\uff0c terms\uff1a\u6839\u636e\u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u5206\u7ec4 field\uff1a\u6839\u636e\u6307\u5b9a\u7684\u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u5206\u7ec4"),(0,r.kt)("p",null,"\u8fd4\u56de"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'{\n  "took" : 18,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : {\n      "value" : 8,\n      "relation" : "eq"\n    },\n    "max_score" : null,\n    "hits" : [ ]\n  },\n  "aggregations" : {\n    "popular_colors" : {\n      "doc_count_error_upper_bound" : 0,\n      "sum_other_doc_count" : 0,\n      "buckets" : [\n        {\n          "key" : "\u7ea2\u8272",\n          "doc_count" : 4\n        },\n        {\n          "key" : "\u7eff\u8272",\n          "doc_count" : 2\n        },\n        {\n          "key" : "\u84dd\u8272",\n          "doc_count" : 2\n        }\n      ]\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u8fd4\u56de\u7ed3\u679c\u89e3\u6790"),(0,r.kt)("p",null,"hits.hits\uff1a\u6211\u4eec\u6307\u5b9a\u4e86size\u662f0\uff0c\u6240\u4ee5hits.hits\u5c31\u662f\u7a7a\u7684 aggregations\uff1a\u805a\u5408\u7ed3\u679c popular_color\uff1a\u6211\u4eec\u6307\u5b9a\u7684\u67d0\u4e2a\u805a\u5408\u7684\u540d\u79f0 buckets\uff1a\u6839\u636e\u6211\u4eec\u6307\u5b9a\u7684field\u5212\u5206\u51fa\u7684buckets key\uff1a\u6bcf\u4e2abucket\u5bf9\u5e94\u7684\u90a3\u4e2a\u503c doc_count\uff1a\u8fd9\u4e2abucket\u5206\u7ec4\u5185\uff0c\u6709\u591a\u5c11\u4e2a\u6570\u636e \u6570\u91cf\uff0c\u5176\u5b9e\u5c31\u662f\u8fd9\u79cd\u989c\u8272\u7684\u9500\u91cf"),(0,r.kt)("p",null,"\u6bcf\u79cd\u989c\u8272\u5bf9\u5e94\u7684bucket\u4e2d\u7684\u6570\u636e\u7684\u9ed8\u8ba4\u7684\u6392\u5e8f\u89c4\u5219\uff1a\u6309\u7167doc_count\u964d\u5e8f\u6392\u5e8f"),(0,r.kt)("h5",{id:"\u9700\u6c422-\u7edf\u8ba1\u6bcf\u79cd\u989c\u8272\u7535\u89c6\u5e73\u5747\u4ef7\u683c"},"\u9700\u6c422 \u7edf\u8ba1\u6bcf\u79cd\u989c\u8272\u7535\u89c6\u5e73\u5747\u4ef7\u683c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search\n{\n   "size" : 0,\n   "aggs": {\n      "colors": {\n         "terms": {\n            "field": "color"\n         },\n         "aggs": { \n            "avg_price": { \n               "avg": {\n                  "field": "price" \n               }\n            }\n         }\n      }\n   }\n}\n')),(0,r.kt)("p",null,"\u5728\u4e00\u4e2aaggs\u6267\u884c\u7684bucket\u64cd\u4f5c\uff08terms\uff09\uff0c\u5e73\u7ea7\u7684json\u7ed3\u6784\u4e0b\uff0c\u518d\u52a0\u4e00\u4e2aaggs\uff0c\u8fd9\u4e2a\u7b2c\u4e8c\u4e2aaggs\u5185\u90e8\uff0c\u540c\u6837\u53d6\u4e2a\u540d\u5b57\uff0c\u6267\u884c\u4e00\u4e2ametric\u64cd\u4f5c\uff0cavg\uff0c\u5bf9\u4e4b\u524d\u7684\u6bcf\u4e2abucket\u4e2d\u7684\u6570\u636e\u7684\u6307\u5b9a\u7684field\uff0cprice field\uff0c\u6c42\u4e00\u4e2a\u5e73\u5747\u503c"),(0,r.kt)("p",null,"\u8fd4\u56de\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'{\n  "took" : 4,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : {\n      "value" : 8,\n      "relation" : "eq"\n    },\n    "max_score" : null,\n    "hits" : [ ]\n  },\n  "aggregations" : {\n    "colors" : {\n      "doc_count_error_upper_bound" : 0,\n      "sum_other_doc_count" : 0,\n      "buckets" : [\n        {\n          "key" : "\u7ea2\u8272",\n          "doc_count" : 4,\n          "avg_price" : {\n            "value" : 3250.0\n          }\n        },\n        {\n          "key" : "\u7eff\u8272",\n          "doc_count" : 2,\n          "avg_price" : {\n            "value" : 2100.0\n          }\n        },\n        {\n          "key" : "\u84dd\u8272",\n          "doc_count" : 2,\n          "avg_price" : {\n            "value" : 2000.0\n          }\n        }\n      ]\n    }\n  }\n}\n')),(0,r.kt)("p",null,"buckets\uff0c\u9664\u4e86key\u548cdoc_count avg_price\uff1a\u6211\u4eec\u81ea\u5df1\u53d6\u7684metric aggs\u7684\u540d\u5b57 value\uff1a\u6211\u4eec\u7684metric\u8ba1\u7b97\u7684\u7ed3\u679c\uff0c\u6bcf\u4e2abucket\u4e2d\u7684\u6570\u636e\u7684price\u5b57\u6bb5\u6c42\u5e73\u5747\u503c\u540e\u7684\u7ed3\u679c"),(0,r.kt)("p",null,"\u76f8\u5f53\u4e8esql: select avg(price) from tvs group by color"),(0,r.kt)("h5",{id:"\u9700\u6c423-\u7ee7\u7eed\u4e0b\u94bb\u5206\u6790"},"\u9700\u6c423 \u7ee7\u7eed\u4e0b\u94bb\u5206\u6790"),(0,r.kt)("p",null,"\u6bcf\u4e2a\u989c\u8272\u4e0b\uff0c\u5e73\u5747\u4ef7\u683c\u53ca\u6bcf\u4e2a\u989c\u8272\u4e0b\uff0c\u6bcf\u4e2a\u54c1\u724c\u7684\u5e73\u5747\u4ef7\u683c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search \n{\n  "size": 0,\n  "aggs": {\n    "group_by_color": {\n      "terms": {\n        "field": "color"\n      },\n      "aggs": {\n        "color_avg_price": {\n          "avg": {\n            "field": "price"\n          }\n        },\n        "group_by_brand": {\n          "terms": {\n            "field": "brand"\n          },\n          "aggs": {\n            "brand_avg_price": {\n              "avg": {\n                "field": "price"\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n')),(0,r.kt)("h5",{id:"\u9700\u6c424\u66f4\u591a\u7684metric"},"\u9700\u6c424\uff1a\u66f4\u591a\u7684metric"),(0,r.kt)("p",null,"count\uff1abucket\uff0cterms\uff0c\u81ea\u52a8\u5c31\u4f1a\u6709\u4e00\u4e2adoc_count\uff0c\u5c31\u76f8\u5f53\u4e8e\u662fcount avg\uff1aavg aggs\uff0c\u6c42\u5e73\u5747\u503c max\uff1a\u6c42\u4e00\u4e2abucket\u5185\uff0c\u6307\u5b9afield\u503c\u6700\u5927\u7684\u90a3\u4e2a\u6570\u636e min\uff1a\u6c42\u4e00\u4e2abucket\u5185\uff0c\u6307\u5b9afield\u503c\u6700\u5c0f\u7684\u90a3\u4e2a\u6570\u636e sum\uff1a\u6c42\u4e00\u4e2abucket\u5185\uff0c\u6307\u5b9afield\u503c\u7684\u603b\u548c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search\n{\n   "size" : 0,\n   "aggs": {\n      "colors": {\n         "terms": {\n            "field": "color"\n         },\n         "aggs": {\n            "avg_price": { "avg": { "field": "price" } },\n            "min_price" : { "min": { "field": "price"} }, \n            "max_price" : { "max": { "field": "price"} },\n            "sum_price" : { "sum": { "field": "price" } } \n         }\n      }\n   }\n}\n')),(0,r.kt)("h5",{id:"\u9700\u6c425\u5212\u5206\u8303\u56f4-histogram"},"\u9700\u6c425\uff1a\u5212\u5206\u8303\u56f4 histogram"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search\n{\n   "size" : 0,\n   "aggs":{\n      "price":{\n         "histogram":{ \n            "field": "price",\n            "interval": 2000\n         },\n         "aggs":{\n            "income": {\n               "sum": { \n                 "field" : "price"\n               }\n             }\n         }\n      }\n   }\n}\n')),(0,r.kt)("p",null,"histogram\uff1a\u7c7b\u4f3c\u4e8eterms\uff0c\u4e5f\u662f\u8fdb\u884cbucket\u5206\u7ec4\u64cd\u4f5c\uff0c\u63a5\u6536\u4e00\u4e2afield\uff0c\u6309\u7167\u8fd9\u4e2afield\u7684\u503c\u7684\u5404\u4e2a\u8303\u56f4\u533a\u95f4\uff0c\u8fdb\u884cbucket\u5206\u7ec4\u64cd\u4f5c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'"histogram":{ \n  "field": "price",\n  "interval": 2000\n}\n')),(0,r.kt)("p",null,"interval\uff1a2000\uff0c\u5212\u5206\u8303\u56f4\uff0c02000\uff0c20004000\uff0c40006000\uff0c60008000\uff0c8000~10000\uff0cbuckets"),(0,r.kt)("p",null,"bucket\u6709\u4e86\u4e4b\u540e\uff0c\u4e00\u6837\u7684\uff0c\u53bb\u5bf9\u6bcf\u4e2abucket\u6267\u884cavg\uff0ccount\uff0csum\uff0cmax\uff0cmin\uff0c\u7b49\u5404\u79cdmetric\u64cd\u4f5c\uff0c\u805a\u5408\u5206\u6790"),(0,r.kt)("h5",{id:"\u9700\u6c426\u6309\u7167\u65e5\u671f\u5206\u7ec4\u805a\u5408"},"\u9700\u6c426\uff1a\u6309\u7167\u65e5\u671f\u5206\u7ec4\u805a\u5408"),(0,r.kt)("p",null,"date_histogram\uff0c\u6309\u7167\u6211\u4eec\u6307\u5b9a\u7684\u67d0\u4e2adate\u7c7b\u578b\u7684\u65e5\u671ffield\uff0c\u4ee5\u53ca\u65e5\u671finterval\uff0c\u6309\u7167\u4e00\u5b9a\u7684\u65e5\u671f\u95f4\u9694\uff0c\u53bb\u5212\u5206bucket"),(0,r.kt)("p",null,"min_doc_count\uff1a\u5373\u4f7f\u67d0\u4e2a\u65e5\u671finterval\uff0c2017-01-01~2017-01-31\u4e2d\uff0c\u4e00\u6761\u6570\u636e\u90fd\u6ca1\u6709\uff0c\u90a3\u4e48\u8fd9\u4e2a\u533a\u95f4\u4e5f\u662f\u8981\u8fd4\u56de\u7684\uff0c\u4e0d\u7136\u9ed8\u8ba4\u662f\u4f1a\u8fc7\u6ee4\u6389\u8fd9\u4e2a\u533a\u95f4\u7684 extended_bounds\uff0cmin\uff0cmax\uff1a\u5212\u5206bucket\u7684\u65f6\u5019\uff0c\u4f1a\u9650\u5b9a\u5728\u8fd9\u4e2a\u8d77\u59cb\u65e5\u671f\uff0c\u548c\u622a\u6b62\u65e5\u671f\u5185"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search\n{\n   "size" : 0,\n   "aggs": {\n      "sales": {\n         "date_histogram": {\n            "field": "sold_date",\n            "interval": "month", \n            "format": "yyyy-MM-dd",\n            "min_doc_count" : 0, \n            "extended_bounds" : { \n                "min" : "2019-01-01",\n                "max" : "2020-12-31"\n            }\n         }\n      }\n   }\n}\n')),(0,r.kt)("h5",{id:"\u9700\u6c427-\u7edf\u8ba1\u6bcf\u5b63\u5ea6\u6bcf\u4e2a\u54c1\u724c\u7684\u9500\u552e\u989d"},"\u9700\u6c427 \u7edf\u8ba1\u6bcf\u5b63\u5ea6\u6bcf\u4e2a\u54c1\u724c\u7684\u9500\u552e\u989d"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search \n{\n  "size": 0,\n  "aggs": {\n    "group_by_sold_date": {\n      "date_histogram": {\n        "field": "sold_date",\n        "interval": "quarter",\n        "format": "yyyy-MM-dd",\n        "min_doc_count": 0,\n        "extended_bounds": {\n          "min": "2019-01-01",\n          "max": "2020-12-31"\n        }\n      },\n      "aggs": {\n        "group_by_brand": {\n          "terms": {\n            "field": "brand"\n          },\n          "aggs": {\n            "sum_price": {\n              "sum": {\n                "field": "price"\n              }\n            }\n          }\n        },\n        "total_sum_price": {\n          "sum": {\n            "field": "price"\n          }\n        }\n      }\n    }\n  }\n}\n')),(0,r.kt)("h5",{id:"\u9700\u6c428-\u641c\u7d22\u4e0e\u805a\u5408\u7ed3\u5408\u67e5\u8be2\u67d0\u4e2a\u54c1\u724c\u6309\u989c\u8272\u9500\u91cf"},"\u9700\u6c428 \uff1a\u641c\u7d22\u4e0e\u805a\u5408\u7ed3\u5408\uff0c\u67e5\u8be2\u67d0\u4e2a\u54c1\u724c\u6309\u989c\u8272\u9500\u91cf"),(0,r.kt)("p",null,"\u641c\u7d22\u4e0e\u805a\u5408\u53ef\u4ee5\u7ed3\u5408\u8d77\u6765\u3002"),(0,r.kt)("p",null,"sql select count(*)"),(0,r.kt)("p",null,"from tvs"),(0,r.kt)("p",null,'where brand like "%\u5c0f\u7c73%"'),(0,r.kt)("p",null,"group by color"),(0,r.kt)("p",null,"es aggregation\uff0cscope\uff0c\u4efb\u4f55\u7684\u805a\u5408\uff0c\u90fd\u5fc5\u987b\u5728\u641c\u7d22\u51fa\u6765\u7684\u7ed3\u679c\u6570\u636e\u4e2d\u4e4b\u884c\uff0c\u641c\u7d22\u7ed3\u679c\uff0c\u5c31\u662f\u805a\u5408\u5206\u6790\u64cd\u4f5c\u7684scope"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search \n{\n  "size": 0,\n  "query": {\n    "term": {\n      "brand": {\n        "value": "\u5c0f\u7c73"\n      }\n    }\n  },\n  "aggs": {\n    "group_by_color": {\n      "terms": {\n        "field": "color"\n      }\n    }\n  }\n}\n')),(0,r.kt)("h5",{id:"\u9700\u6c429-global-bucket\u5355\u4e2a\u54c1\u724c\u4e0e\u6240\u6709\u54c1\u724c\u9500\u91cf\u5bf9\u6bd4"},"\u9700\u6c429 global bucket\uff1a\u5355\u4e2a\u54c1\u724c\u4e0e\u6240\u6709\u54c1\u724c\u9500\u91cf\u5bf9\u6bd4"),(0,r.kt)("p",null,"aggregation\uff0cscope\uff0c\u4e00\u4e2a\u805a\u5408\u64cd\u4f5c\uff0c\u5fc5\u987b\u5728query\u7684\u641c\u7d22\u7ed3\u679c\u8303\u56f4\u5185\u6267\u884c"),(0,r.kt)("p",null,"\u51fa\u6765\u4e24\u4e2a\u7ed3\u679c\uff0c\u4e00\u4e2a\u7ed3\u679c\uff0c\u662f\u57fa\u4e8equery\u641c\u7d22\u7ed3\u679c\u6765\u805a\u5408\u7684; \u4e00\u4e2a\u7ed3\u679c\uff0c\u662f\u5bf9\u6240\u6709\u6570\u636e\u6267\u884c\u805a\u5408\u7684"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search \n{\n  "size": 0, \n  "query": {\n    "term": {\n      "brand": {\n        "value": "\u5c0f\u7c73"\n      }\n    }\n  },\n  "aggs": {\n    "single_brand_avg_price": {\n      "avg": {\n        "field": "price"\n      }\n    },\n    "all": {\n      "global": {},\n      "aggs": {\n        "all_brand_avg_price": {\n          "avg": {\n            "field": "price"\n          }\n        }\n      }\n    }\n  }\n}\n')),(0,r.kt)("h5",{id:"\u9700\u6c4210\u8fc7\u6ee4\u805a\u5408\u7edf\u8ba1\u4ef7\u683c\u5927\u4e8e1200\u7684\u7535\u89c6\u5e73\u5747\u4ef7\u683c"},"\u9700\u6c4210\uff1a\u8fc7\u6ee4+\u805a\u5408\uff1a\u7edf\u8ba1\u4ef7\u683c\u5927\u4e8e1200\u7684\u7535\u89c6\u5e73\u5747\u4ef7\u683c"),(0,r.kt)("p",null,"\u641c\u7d22+\u805a\u5408"),(0,r.kt)("p",null,"\u8fc7\u6ee4+\u805a\u5408"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search \n{\n  "size": 0,\n  "query": {\n    "constant_score": {\n      "filter": {\n        "range": {\n          "price": {\n            "gte": 1200\n          }\n        }\n      }\n    }\n  },\n  "aggs": {\n    "avg_price": {\n      "avg": {\n        "field": "price"\n      }\n    }\n  }\n}\n')),(0,r.kt)("h5",{id:"\u9700\u6c4211-bucket-filter\u7edf\u8ba1\u54c1\u724c\u6700\u8fd1\u4e00\u4e2a\u6708\u7684\u5e73\u5747\u4ef7\u683c"},"\u9700\u6c4211 bucket filter\uff1a\u7edf\u8ba1\u54c1\u724c\u6700\u8fd1\u4e00\u4e2a\u6708\u7684\u5e73\u5747\u4ef7\u683c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search \n{\n  "size": 0,\n  "query": {\n    "term": {\n      "brand": {\n        "value": "\u5c0f\u7c73"\n      }\n    }\n  },\n  "aggs": {\n    "recent_150d": {\n      "filter": {\n        "range": {\n          "sold_date": {\n            "gte": "now-150d"\n          }\n        }\n      },\n      "aggs": {\n        "recent_150d_avg_price": {\n          "avg": {\n            "field": "price"\n          }\n        }\n      }\n    },\n    "recent_140d": {\n      "filter": {\n        "range": {\n          "sold_date": {\n            "gte": "now-140d"\n          }\n        }\n      },\n      "aggs": {\n        "recent_140d_avg_price": {\n          "avg": {\n            "field": "price"\n          }\n        }\n      }\n    },\n    "recent_130d": {\n      "filter": {\n        "range": {\n          "sold_date": {\n            "gte": "now-130d"\n          }\n        }\n      },\n      "aggs": {\n        "recent_130d_avg_price": {\n          "avg": {\n            "field": "price"\n          }\n        }\n      }\n    }\n  }\n}\n')),(0,r.kt)("p",null,"aggs.filter\uff0c\u9488\u5bf9\u7684\u662f\u805a\u5408\u53bb\u505a\u7684"),(0,r.kt)("p",null,"\u5982\u679c\u653equery\u91cc\u9762\u7684filter\uff0c\u662f\u5168\u5c40\u7684\uff0c\u4f1a\u5bf9\u6240\u6709\u7684\u6570\u636e\u90fd\u6709\u5f71\u54cd"),(0,r.kt)("p",null,"\u4f46\u662f\uff0c\u5982\u679c\uff0c\u6bd4\u5982\u8bf4\uff0c\u4f60\u8981\u7edf\u8ba1\uff0c\u957f\u8679\u7535\u89c6\uff0c\u6700\u8fd11\u4e2a\u6708\u7684\u5e73\u5747\u503c; \u6700\u8fd13\u4e2a\u6708\u7684\u5e73\u5747\u503c; \u6700\u8fd16\u4e2a\u6708\u7684\u5e73\u5747\u503c"),(0,r.kt)("p",null,"bucket filter\uff1a\u5bf9\u4e0d\u540c\u7684bucket\u4e0b\u7684aggs\uff0c\u8fdb\u884cfilter"),(0,r.kt)("h5",{id:"\u9700\u6c4212-\u6392\u5e8f\u6309\u6bcf\u79cd\u989c\u8272\u7684\u5e73\u5747\u9500\u552e\u989d\u964d\u5e8f\u6392\u5e8f"},"\u9700\u6c4212 \u6392\u5e8f\uff1a\u6309\u6bcf\u79cd\u989c\u8272\u7684\u5e73\u5747\u9500\u552e\u989d\u964d\u5e8f\u6392\u5e8f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search \n{\n  "size": 0,\n  "aggs": {\n    "group_by_color": {\n      "terms": {\n        "field": "color",\n        "order": {\n          "avg_price": "asc"\n        }\n      },\n      "aggs": {\n        "avg_price": {\n          "avg": {\n            "field": "price"\n          }\n        }\n      }\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u76f8\u5f53\u4e8esql\u5b50\u8868\u6570\u636e\u5b57\u6bb5\u53ef\u4ee5\u7acb\u523b\u4f7f\u7528\u3002"),(0,r.kt)("h5",{id:"\u9700\u6c4213-\u6392\u5e8f\u6309\u6bcf\u79cd\u989c\u8272\u7684\u6bcf\u79cd\u54c1\u724c\u5e73\u5747\u9500\u552e\u989d\u964d\u5e8f\u6392\u5e8f"},"\u9700\u6c4213 \u6392\u5e8f\uff1a\u6309\u6bcf\u79cd\u989c\u8272\u7684\u6bcf\u79cd\u54c1\u724c\u5e73\u5747\u9500\u552e\u989d\u964d\u5e8f\u6392\u5e8f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'GET /tvs/_search  \n{\n  "size": 0,\n  "aggs": {\n    "group_by_color": {\n      "terms": {\n        "field": "color"\n      },\n      "aggs": {\n        "group_by_brand": {\n          "terms": {\n            "field": "brand",\n            "order": {\n              "avg_price": "desc"\n            }\n          },\n          "aggs": {\n            "avg_price": {\n              "avg": {\n                "field": "price"\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n')),(0,r.kt)("h2",{id:"\u7b2c\u5341\u516b\u7ae0-java-api\u5b9e\u73b0\u805a\u5408"},"\u7b2c\u5341\u516b\u7ae0 java api\u5b9e\u73b0\u805a\u5408"),(0,r.kt)("p",null,"\u7b80\u5355\u805a\u5408\uff0c\u591a\u79cd\u805a\u5408\uff0c\u8be6\u89c1\u4ee3\u7801\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.es;\n\nimport org.elasticsearch.action.search.SearchRequest;\nimport org.elasticsearch.action.search.SearchResponse;\nimport org.elasticsearch.client.RequestOptions;\nimport org.elasticsearch.client.RestHighLevelClient;\nimport org.elasticsearch.index.query.QueryBuilders;\nimport org.elasticsearch.search.aggregations.Aggregation;\nimport org.elasticsearch.search.aggregations.AggregationBuilders;\nimport org.elasticsearch.search.aggregations.Aggregations;\nimport org.elasticsearch.search.aggregations.bucket.histogram.*;\nimport org.elasticsearch.search.aggregations.bucket.terms.Terms;\nimport org.elasticsearch.search.aggregations.bucket.terms.TermsAggregationBuilder;\nimport org.elasticsearch.search.aggregations.metrics.*;\nimport org.elasticsearch.search.builder.SearchSourceBuilder;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.context.junit4.SpringRunner;\n\nimport java.io.IOException;\nimport java.util.List;\n\n/**\n * creste by ydlclass.ydl\n */\n@SpringBootTest\n@RunWith(SpringRunner.class)\npublic class TestAggs {\n    @Autowired\n    RestHighLevelClient client;\n\n    //\u9700\u6c42\u4e00\uff1a\u6309\u7167\u989c\u8272\u5206\u7ec4\uff0c\u8ba1\u7b97\u6bcf\u4e2a\u989c\u8272\u5356\u51fa\u7684\u4e2a\u6570\n    @Test\n    public void testAggs() throws IOException {\n        // GET /tvs/_search\n        // {\n        //     "size": 0,\n        //     "query": {"match_all": {}},\n        //     "aggs": {\n        //       "group_by_color": {\n        //         "terms": {\n        //             "field": "color"\n        //         }\n        //     }\n        // }\n        // }\n\n        //1 \u6784\u5efa\u8bf7\u6c42\n        SearchRequest searchRequest=new SearchRequest("tvs");\n\n        //\u8bf7\u6c42\u4f53\n        SearchSourceBuilder searchSourceBuilder=new SearchSourceBuilder();\n        searchSourceBuilder.size(0);\n        searchSourceBuilder.query(QueryBuilders.matchAllQuery());\n\n        TermsAggregationBuilder termsAggregationBuilder = AggregationBuilders.terms("group_by_color").field("color");\n        searchSourceBuilder.aggregation(termsAggregationBuilder);\n\n        //\u8bf7\u6c42\u4f53\u653e\u5165\u8bf7\u6c42\u5934\n        searchRequest.source(searchSourceBuilder);\n\n        //2 \u6267\u884c\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3 \u83b7\u53d6\u7ed3\u679c\n      //   "aggregations" : {\n      //       "group_by_color" : {\n      //           "doc_count_error_upper_bound" : 0,\n      //           "sum_other_doc_count" : 0,\n      //            "buckets" : [\n      //           {\n      //               "key" : "\u7ea2\u8272",\n      //               "doc_count" : 4\n      //           },\n      //           {\n      //               "key" : "\u7eff\u8272",\n      //                   "doc_count" : 2\n      //           },\n      //           {\n      //               "key" : "\u84dd\u8272",\n      //                   "doc_count" : 2\n      //           }\n      // ]\n      //       }\n        Aggregations aggregations = searchResponse.getAggregations();\n        Terms group_by_color = aggregations.get("group_by_color");\n        List<? extends Terms.Bucket> buckets = group_by_color.getBuckets();\n        for (Terms.Bucket bucket : buckets) {\n            String key = bucket.getKeyAsString();\n            System.out.println("key:"+key);\n\n            long docCount = bucket.getDocCount();\n            System.out.println("docCount:"+docCount);\n\n            System.out.println("=================================");\n        }\n    }\n\n    // #\u9700\u6c42\u4e8c\uff1a\u6309\u7167\u989c\u8272\u5206\u7ec4\uff0c\u8ba1\u7b97\u6bcf\u4e2a\u989c\u8272\u5356\u51fa\u7684\u4e2a\u6570\uff0c\u6bcf\u4e2a\u989c\u8272\u5356\u51fa\u7684\u5e73\u5747\u4ef7\u683c\n    @Test\n    public void testAggsAndAvg() throws IOException {\n        // GET /tvs/_search\n        // {\n        //     "size": 0,\n        //      "query": {"match_all": {}},\n        //     "aggs": {\n        //     "group_by_color": {\n        //         "terms": {\n        //             "field": "color"\n        //         },\n        //         "aggs": {\n        //             "avg_price": {\n        //                 "avg": {\n        //                     "field": "price"\n        //                 }\n        //             }\n        //         }\n        //     }\n        // }\n        // }\n\n        //1 \u6784\u5efa\u8bf7\u6c42\n        SearchRequest searchRequest=new SearchRequest("tvs");\n\n        //\u8bf7\u6c42\u4f53\n        SearchSourceBuilder searchSourceBuilder=new SearchSourceBuilder();\n        searchSourceBuilder.size(0);\n        searchSourceBuilder.query(QueryBuilders.matchAllQuery());\n\n        TermsAggregationBuilder termsAggregationBuilder = AggregationBuilders.terms("group_by_color").field("color");\n\n        //terms\u805a\u5408\u4e0b\u586b\u5145\u4e00\u4e2a\u5b50\u805a\u5408\n        AvgAggregationBuilder avgAggregationBuilder = AggregationBuilders.avg("avg_price").field("price");\n        termsAggregationBuilder.subAggregation(avgAggregationBuilder);\n\n        searchSourceBuilder.aggregation(termsAggregationBuilder);\n\n        //\u8bf7\u6c42\u4f53\u653e\u5165\u8bf7\u6c42\u5934\n        searchRequest.source(searchSourceBuilder);\n\n        //2 \u6267\u884c\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3 \u83b7\u53d6\u7ed3\u679c\n        // {\n        //     "key" : "\u7ea2\u8272",\n        //      "doc_count" : 4,\n        //      "avg_price" : {\n        //        "value" : 3250.0\n        //       }\n        // }\n        Aggregations aggregations = searchResponse.getAggregations();\n        Terms group_by_color = aggregations.get("group_by_color");\n        List<? extends Terms.Bucket> buckets = group_by_color.getBuckets();\n        for (Terms.Bucket bucket : buckets) {\n            String key = bucket.getKeyAsString();\n            System.out.println("key:"+key);\n\n            long docCount = bucket.getDocCount();\n            System.out.println("docCount:"+docCount);\n\n            Aggregations aggregations1 = bucket.getAggregations();\n            Avg avg_price = aggregations1.get("avg_price");\n            double value = avg_price.getValue();\n            System.out.println("value:"+value);\n\n            System.out.println("=================================");\n        }\n    }\n\n    // #\u9700\u6c42\u4e09\uff1a\u6309\u7167\u989c\u8272\u5206\u7ec4\uff0c\u8ba1\u7b97\u6bcf\u4e2a\u989c\u8272\u5356\u51fa\u7684\u4e2a\u6570\uff0c\u4ee5\u53ca\u6bcf\u4e2a\u989c\u8272\u5356\u51fa\u7684\u5e73\u5747\u503c\u3001\u6700\u5927\u503c\u3001\u6700\u5c0f\u503c\u3001\u603b\u548c\u3002\n    @Test\n    public void testAggsAndMore() throws IOException {\n        // GET /tvs/_search\n        // {\n        //     "size" : 0,\n        //     "aggs": {\n        //      "group_by_color": {\n        //         "terms": {\n        //             "field": "color"\n        //         },\n        //         "aggs": {\n        //             "avg_price": { "avg": { "field": "price" } },\n        //             "min_price" : { "min": { "field": "price"} },\n        //             "max_price" : { "max": { "field": "price"} },\n        //             "sum_price" : { "sum": { "field": "price" } }\n        //         }\n        //     }\n        // }\n        // }\n\n        //1 \u6784\u5efa\u8bf7\u6c42\n        SearchRequest searchRequest=new SearchRequest("tvs");\n\n        //\u8bf7\u6c42\u4f53\n        SearchSourceBuilder searchSourceBuilder=new SearchSourceBuilder();\n        searchSourceBuilder.size(0);\n        searchSourceBuilder.query(QueryBuilders.matchAllQuery());\n\n        TermsAggregationBuilder termsAggregationBuilder = AggregationBuilders.terms("group_by_color").field("color");\n\n\n        //termsAggregationBuilder\u91cc\u653e\u5165\u591a\u4e2a\u5b50\u805a\u5408\n        AvgAggregationBuilder avgAggregationBuilder = AggregationBuilders.avg("avg_price").field("price");\n        MinAggregationBuilder minAggregationBuilder = AggregationBuilders.min("min_price").field("price");\n        MaxAggregationBuilder maxAggregationBuilder = AggregationBuilders.max("max_price").field("price");\n        SumAggregationBuilder sumAggregationBuilder = AggregationBuilders.sum("sum_price").field("price");\n\n        termsAggregationBuilder.subAggregation(avgAggregationBuilder);\n        termsAggregationBuilder.subAggregation(minAggregationBuilder);\n        termsAggregationBuilder.subAggregation(maxAggregationBuilder);\n        termsAggregationBuilder.subAggregation(sumAggregationBuilder);\n\n\n        searchSourceBuilder.aggregation(termsAggregationBuilder);\n\n        //\u8bf7\u6c42\u4f53\u653e\u5165\u8bf7\u6c42\u5934\n        searchRequest.source(searchSourceBuilder);\n\n        //2 \u6267\u884c\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3 \u83b7\u53d6\u7ed3\u679c\n        // {\n        //     "key" : "\u7ea2\u8272",\n        //     "doc_count" : 4,\n        //     "max_price" : {\n        //          "value" : 8000.0\n        //     },\n        //     "min_price" : {\n        //          "value" : 1000.0\n        // },\n        //     "avg_price" : {\n        //         "value" : 3250.0\n        // },\n        //     "sum_price" : {\n        //         "value" : 13000.0\n        // }\n        // }\n        Aggregations aggregations = searchResponse.getAggregations();\n        Terms group_by_color = aggregations.get("group_by_color");\n        List<? extends Terms.Bucket> buckets = group_by_color.getBuckets();\n        for (Terms.Bucket bucket : buckets) {\n            String key = bucket.getKeyAsString();\n            System.out.println("key:"+key);\n\n            long docCount = bucket.getDocCount();\n            System.out.println("docCount:"+docCount);\n\n            Aggregations aggregations1 = bucket.getAggregations();\n\n            Max max_price = aggregations1.get("max_price");\n            double maxPriceValue = max_price.getValue();\n            System.out.println("maxPriceValue:"+maxPriceValue);\n\n            Min min_price = aggregations1.get("min_price");\n            double minPriceValue = min_price.getValue();\n            System.out.println("minPriceValue:"+minPriceValue);\n\n            Avg avg_price = aggregations1.get("avg_price");\n            double avgPriceValue = avg_price.getValue();\n            System.out.println("avgPriceValue:"+avgPriceValue);\n\n            Sum sum_price = aggregations1.get("sum_price");\n            double sumPriceValue = sum_price.getValue();\n            System.out.println("sumPriceValue:"+sumPriceValue);\n\n            System.out.println("=================================");\n        }\n    }\n\n    // #\u9700\u6c42\u56db\uff1a\u6309\u7167\u552e\u4ef7\u6bcf2000\u4ef7\u683c\u5212\u5206\u8303\u56f4\uff0c\u7b97\u51fa\u6bcf\u4e2a\u533a\u95f4\u7684\u9500\u552e\u603b\u989d histogram\n    @Test\n    public void testAggsAndHistogram() throws IOException {\n        // GET /tvs/_search\n        // {\n        //     "size" : 0,\n        //     "aggs":{\n        //      "by_histogram":{\n        //         "histogram":{\n        //             "field": "price",\n        //             "interval": 2000\n        //         },\n        //         "aggs":{\n        //             "income": {\n        //                 "sum": {\n        //                     "field" : "price"\n        //                 }\n        //             }\n        //         }\n        //     }\n        // }\n        // }\n\n        //1 \u6784\u5efa\u8bf7\u6c42\n        SearchRequest searchRequest=new SearchRequest("tvs");\n\n        //\u8bf7\u6c42\u4f53\n        SearchSourceBuilder searchSourceBuilder=new SearchSourceBuilder();\n        searchSourceBuilder.size(0);\n        searchSourceBuilder.query(QueryBuilders.matchAllQuery());\n\n        HistogramAggregationBuilder histogramAggregationBuilder = AggregationBuilders.histogram("by_histogram").field("price").interval(2000);\n\n        SumAggregationBuilder sumAggregationBuilder = AggregationBuilders.sum("income").field("price");\n        histogramAggregationBuilder.subAggregation(sumAggregationBuilder);\n        searchSourceBuilder.aggregation(histogramAggregationBuilder);\n\n        //\u8bf7\u6c42\u4f53\u653e\u5165\u8bf7\u6c42\u5934\n        searchRequest.source(searchSourceBuilder);\n\n        //2 \u6267\u884c\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3 \u83b7\u53d6\u7ed3\u679c\n        // {\n        //     "key" : 0.0,\n        //     "doc_count" : 3,\n        //      income" : {\n        //          "value" : 3700.0\n        //       }\n        // }\n        Aggregations aggregations = searchResponse.getAggregations();\n        Histogram group_by_color = aggregations.get("by_histogram");\n        List<? extends Histogram.Bucket> buckets = group_by_color.getBuckets();\n        for (Histogram.Bucket bucket : buckets) {\n            String keyAsString = bucket.getKeyAsString();\n            System.out.println("keyAsString:"+keyAsString);\n            long docCount = bucket.getDocCount();\n            System.out.println("docCount:"+docCount);\n\n            Aggregations aggregations1 = bucket.getAggregations();\n            Sum income = aggregations1.get("income");\n            double value = income.getValue();\n            System.out.println("value:"+value);\n\n            System.out.println("=================================");\n\n        }\n    }\n\n    // #\u9700\u6c42\u4e94\uff1a\u8ba1\u7b97\u6bcf\u4e2a\u5b63\u5ea6\u7684\u9500\u552e\u603b\u989d\n    @Test\n    public void testAggsAndDateHistogram() throws IOException {\n        // GET /tvs/_search\n        // {\n        //     "size" : 0,\n        //     "aggs": {\n        //     "sales": {\n        //         "date_histogram": {\n        //                      "field": "sold_date",\n        //                     "interval": "quarter",\n        //                     "format": "yyyy-MM-dd",\n        //                     "min_doc_count" : 0,\n        //                     "extended_bounds" : {\n        //                         "min" : "2019-01-01",\n        //                         "max" : "2020-12-31"\n        //             }\n        //         },\n        //         "aggs": {\n        //             "income": {\n        //                 "sum": {\n        //                     "field": "price"\n        //                 }\n        //             }\n        //         }\n        //     }\n        // }\n        // }\n\n        //1 \u6784\u5efa\u8bf7\u6c42\n        SearchRequest searchRequest=new SearchRequest("tvs");\n\n        //\u8bf7\u6c42\u4f53\n        SearchSourceBuilder searchSourceBuilder=new SearchSourceBuilder();\n        searchSourceBuilder.size(0);\n        searchSourceBuilder.query(QueryBuilders.matchAllQuery());\n\n        DateHistogramAggregationBuilder dateHistogramAggregationBuilder = AggregationBuilders.dateHistogram("date_histogram").field("sold_date").calendarInterval(DateHistogramInterval.QUARTER)\n                .format("yyyy-MM-dd").minDocCount(0).extendedBounds(new ExtendedBounds("2019-01-01", "2020-12-31"));\n        SumAggregationBuilder sumAggregationBuilder = AggregationBuilders.sum("income").field("price");\n        dateHistogramAggregationBuilder.subAggregation(sumAggregationBuilder);\n\n        searchSourceBuilder.aggregation(dateHistogramAggregationBuilder);\n        //\u8bf7\u6c42\u4f53\u653e\u5165\u8bf7\u6c42\u5934\n        searchRequest.source(searchSourceBuilder);\n\n        //2 \u6267\u884c\n        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);\n\n        //3 \u83b7\u53d6\u7ed3\u679c\n        // {\n        //     "key_as_string" : "2019-01-01",\n        //      "key" : 1546300800000,\n        //      "doc_count" : 0,\n        //      "income" : {\n        //         "value" : 0.0\n        //      }\n        // }\n        Aggregations aggregations = searchResponse.getAggregations();\n        ParsedDateHistogram date_histogram = aggregations.get("date_histogram");\n        List<? extends Histogram.Bucket> buckets = date_histogram.getBuckets();\n        for (Histogram.Bucket bucket : buckets) {\n            String keyAsString = bucket.getKeyAsString();\n            System.out.println("keyAsString:"+keyAsString);\n            long docCount = bucket.getDocCount();\n            System.out.println("docCount:"+docCount);\n\n            Aggregations aggregations1 = bucket.getAggregations();\n            Sum income = aggregations1.get("income");\n            double value = income.getValue();\n            System.out.println("value:"+value);\n\n            System.out.println("====================");\n        }\n\n    }\n\n}\n')),(0,r.kt)("h2",{id:"\u7b2c\u5341\u4e5d\u7ae0-es7-sql\u65b0\u7279\u6027"},"\u7b2c\u5341\u4e5d\u7ae0 es7 sql\u65b0\u7279\u6027"),(0,r.kt)("h3",{id:"\u4e00\u5feb\u901f\u5165\u95e8"},"\u4e00\u3001\u5feb\u901f\u5165\u95e8"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'POST /_sql?format=txt\n{\n    "query": "SELECT * FROM tvs "\n}\n')),(0,r.kt)("h3",{id:"\u4e8c\u542f\u52a8\u65b9\u5f0f"},"\u4e8c\u3001\u542f\u52a8\u65b9\u5f0f"),(0,r.kt)("p",null,"1\u3001http \u8bf7\u6c42"),(0,r.kt)("p",null,"2\u3001\u5ba2\u6237\u7aef\uff1aelasticsearch-sql-cli.bat"),(0,r.kt)("p",null,"3\u3001\u4ee3\u7801"),(0,r.kt)("h3",{id:"\u4e09\u663e\u793a\u65b9\u5f0f"},"\u4e09\u3001\u663e\u793a\u65b9\u5f0f"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/1573212830146-cecc6733.png",alt:"1573212830146"}),"1573212830146"),(0,r.kt)("h3",{id:"\u56dbsql-\u7ffb\u8bd1"},"\u56db\u3001sql \u7ffb\u8bd1"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'POST /_sql/translate\n{\n    "query": "SELECT * FROM tvs "\n}\n')),(0,r.kt)("p",null,"\u8fd4\u56de\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'{\n  "size" : 1000,\n  "_source" : false,\n  "stored_fields" : "_none_",\n  "docvalue_fields" : [\n    {\n      "field" : "brand"\n    },\n    {\n      "field" : "color"\n    },\n    {\n      "field" : "price"\n    },\n    {\n      "field" : "sold_date",\n      "format" : "epoch_millis"\n    }\n  ],\n  "sort" : [\n    {\n      "_doc" : {\n        "order" : "asc"\n      }\n    }\n  ]\n}\n')),(0,r.kt)("h3",{id:"\u4e94\u4e0e\u5176\u4ed6dsl\u7ed3\u5408"},"\u4e94\u3001\u4e0e\u5176\u4ed6DSL\u7ed3\u5408"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'POST /_sql?format=txt\n{\n    "query": "SELECT * FROM tvs",\n    "filter": {\n        "range": {\n            "price": {\n                "gte" : 1200,\n                "lte" : 2000\n            }\n        }\n    }\n}\n')),(0,r.kt)("h3",{id:"\u516d-java-\u4ee3\u7801\u5b9e\u73b0sql\u529f\u80fd"},"\u516d\u3001 java \u4ee3\u7801\u5b9e\u73b0sql\u529f\u80fd"),(0,r.kt)("p",null,"1\u3001\u524d\u63d0 es\u62e5\u6709\u767d\u91d1\u7248\u529f\u80fd"),(0,r.kt)("p",null,"kibana\u4e2d\u7ba1\u7406-\u300b\u8bb8\u53ef\u7ba1\u7406 \u5f00\u542f\u767d\u91d1\u7248\u8bd5\u7528"),(0,r.kt)("p",null,"2\u3001\u5bfc\u5165\u4f9d\u8d56"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    <dependency>\n        <groupId>org.elasticsearch.plugin</groupId>\n        <artifactId>x-pack-sql-jdbc</artifactId>\n        <version>7.3.0</version>\n    </dependency>\n    \n    <repositories>\n        <repository>\n            <id>elastic.co</id>\n            <url>https://artifacts.elastic.co/maven</url>\n        </repository>\n    </repositories>\n")),(0,r.kt)("p",null,"3\u3001\u4ee3\u7801"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'public static void main(String[] args) {\n        try  {\n            Connection connection = DriverManager.getConnection("jdbc:es://http://localhost:9200");\n            Statement statement = connection.createStatement();\n            ResultSet results = statement.executeQuery(\n                    "select * from tvs");\n            while(results.next()){\n                System.out.println(results.getString(1));\n                System.out.println(results.getString(2));\n                System.out.println(results.getString(3));\n                System.out.println(results.getString(4));\n                System.out.println("============================");\n            }\n        }catch (Exception e){\n            e.printStackTrace();\n        }\n')),(0,r.kt)("p",null,"\u5927\u578b\u4f01\u4e1a\u53ef\u4ee5\u8d2d\u4e70\u767d\u91d1\u7248\uff0c\u589e\u52a0Machine Learning\u3001\u9ad8\u7ea7\u5b89\u5168\u6027x-pack\u3002"),(0,r.kt)("h2",{id:"\u7b2c\u4e8c\u5341\u7ae0-logstash\u5b66\u4e60"},"\u7b2c\u4e8c\u5341\u7ae0 Logstash\u5b66\u4e60"),(0,r.kt)("h3",{id:"\u4e00logstash\u57fa\u672c\u8bed\u6cd5\u7ec4\u6210"},"\u4e00\u3001Logstash\u57fa\u672c\u8bed\u6cd5\u7ec4\u6210"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/1573291947262-0ca3aea7.png",alt:"1573291947262"}),"1573291947262"),(0,r.kt)("h4",{id:"1\u4ec0\u4e48\u662flogstash"},"1\u3001\u4ec0\u4e48\u662fLogstash"),(0,r.kt)("p",null,"logstash\u662f\u4e00\u4e2a\u6570\u636e\u62bd\u53d6\u5de5\u5177\uff0c\u5c06\u6570\u636e\u4ece\u4e00\u4e2a\u5730\u65b9\u8f6c\u79fb\u5230\u53e6\u4e00\u4e2a\u5730\u65b9\u3002\u5982hadoop\u751f\u6001\u5708\u7684sqoop\u7b49\u3002\u4e0b\u8f7d\u5730\u5740\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://www.elastic.co/cn/downloads/logstash"},"https://www.elastic.co/cn/downloads/logstashopen in new window")),(0,r.kt)("p",null,"logstash\u4e4b\u6240\u4ee5\u529f\u80fd\u5f3a\u5927\u548c\u6d41\u884c\uff0c\u8fd8\u4e0e\u5176\u4e30\u5bcc\u7684\u8fc7\u6ee4\u5668\u63d2\u4ef6\u662f\u5206\u4e0d\u5f00\u7684\uff0c\u8fc7\u6ee4\u5668\u63d0\u4f9b\u7684\u5e76\u4e0d\u5355\u5355\u662f\u8fc7\u6ee4\u7684\u529f\u80fd\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u8fdb\u5165\u8fc7\u6ee4\u5668\u7684\u539f\u59cb\u6570\u636e\u8fdb\u884c\u590d\u6742\u7684\u903b\u8f91\u5904\u7406\uff0c\u751a\u81f3\u6dfb\u52a0\u72ec\u7279\u7684\u4e8b\u4ef6\u5230\u540e\u7eed\u6d41\u7a0b\u4e2d\u3002 Logstash\u914d\u7f6e\u6587\u4ef6\u6709\u5982\u4e0b\u4e09\u90e8\u5206\u7ec4\u6210\uff0c\u5176\u4e2dinput\u3001output\u90e8\u5206\u662f\u5fc5\u987b\u914d\u7f6e\uff0cfilter\u90e8\u5206\u662f\u53ef\u9009\u914d\u7f6e\uff0c\u800cfilter\u5c31\u662f\u8fc7\u6ee4\u5668\u63d2\u4ef6\uff0c\u53ef\u4ee5\u5728\u8fd9\u90e8\u5206\u5b9e\u73b0\u5404\u79cd\u65e5\u5fd7\u8fc7\u6ee4\u529f\u80fd\u3002"),(0,r.kt)("h4",{id:"2\u914d\u7f6e\u6587\u4ef6"},"2\u3001\u914d\u7f6e\u6587\u4ef6\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"input {\n    #\u8f93\u5165\u63d2\u4ef6\n}\nfilter {\n    #\u8fc7\u6ee4\u5339\u914d\u63d2\u4ef6\n}\noutput {\n    #\u8f93\u51fa\u63d2\u4ef6\n}\n")),(0,r.kt)("h4",{id:"3\u542f\u52a8\u64cd\u4f5c"},"3\u3001\u542f\u52a8\u64cd\u4f5c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"logstash.bat -e 'input{stdin{}} output{stdout{}}'\n")),(0,r.kt)("p",null,"\u4e3a\u4e86\u597d\u7ef4\u62a4\uff0c\u5c06\u914d\u7f6e\u5199\u5165\u6587\u4ef6\uff0c\u542f\u52a8"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"logstash.bat -f ../config/test1.conf\n")),(0,r.kt)("h3",{id:"\u4e8clogstash\u8f93\u5165\u63d2\u4ef6input"},"\u4e8c\u3001Logstash\u8f93\u5165\u63d2\u4ef6\uff08input\uff09"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/logstash/current/input-plugins.html"},"https://www.elastic.co/guide/en/logstash/current/input-plugins.htmlopen in new window")),(0,r.kt)("h4",{id:"1\u6807\u51c6\u8f93\u5165stdin"},"1\u3001\u6807\u51c6\u8f93\u5165(Stdin)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"input{\n    stdin{\n       \n    }\n}\noutput {\n    stdout{\n        codec=>rubydebug    \n    }\n}\n")),(0,r.kt)("h4",{id:"2\u8bfb\u53d6\u6587\u4ef6file"},"2\u3001\u8bfb\u53d6\u6587\u4ef6(File)"),(0,r.kt)("p",null,"logstash\u4f7f\u7528\u4e00\u4e2a\u540d\u4e3afilewatch\u7684ruby gem\u5e93\u6765\u76d1\u542c\u6587\u4ef6\u53d8\u5316,\u5e76\u901a\u8fc7\u4e00\u4e2a\u53eb.sincedb\u7684\u6570\u636e\u5e93\u6587\u4ef6\u6765\u8bb0\u5f55\u88ab\u76d1\u542c\u7684\u65e5\u5fd7\u6587\u4ef6\u7684\u8bfb\u53d6\u8fdb\u5ea6\uff08\u65f6\u95f4\u6233\uff09\uff0c\u8fd9\u4e2asincedb\u6570\u636e\u6587\u4ef6\u7684\u9ed8\u8ba4\u8def\u5f84\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"<path.data>/plugins/inputs/file"),"\u4e0b\u9762\uff0c\u6587\u4ef6\u540d\u7c7b\u4f3c\u4e8e.sincedb_123456\uff0c\u800c",(0,r.kt)("inlineCode",{parentName:"p"},"<path.data>"),"\u8868\u793alogstash\u63d2\u4ef6\u5b58\u50a8\u76ee\u5f55\uff0c\u9ed8\u8ba4\u662fLOGSTASH_HOME/data\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'input {\n    file {\n        path => ["/var/*/*"]\n        start_position => "beginning"\n    }\n}\noutput {\n    stdout{\n        codec=>rubydebug    \n    }\n}\n')),(0,r.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0clogstash\u4f1a\u4ece\u6587\u4ef6\u7684\u7ed3\u675f\u4f4d\u7f6e\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bf4logstash\u8fdb\u7a0b\u4f1a\u4ee5\u7c7b\u4f3ctail -f\u547d\u4ee4\u7684\u5f62\u5f0f\u9010\u884c\u83b7\u53d6\u6570\u636e\u3002"),(0,r.kt)("h4",{id:"3\u8bfb\u53d6tcp\u7f51\u7edc\u6570\u636e"},"3\u3001\u8bfb\u53d6TCP\u7f51\u7edc\u6570\u636e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'input {\n  tcp {\n    port => "1234"\n  }\n}\n\nfilter {\n  grok {\n    match => { "message" => "%{SYSLOGLINE}" }\n  }\n}\n\noutput {\n    stdout{\n        codec=>rubydebug\n    }\n}\n')),(0,r.kt)("h3",{id:"\u4e09logstash\u8fc7\u6ee4\u5668\u63d2\u4ef6filter"},"\u4e09\u3001Logstash\u8fc7\u6ee4\u5668\u63d2\u4ef6(Filter)"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/logstash/current/filter-plugins.html"},"https://www.elastic.co/guide/en/logstash/current/filter-plugins.htmlopen in new window")),(0,r.kt)("h4",{id:"1grok-\u6b63\u5219\u6355\u83b7"},"1\u3001Grok \u6b63\u5219\u6355\u83b7"),(0,r.kt)("p",null,"grok\u662f\u4e00\u4e2a\u5341\u5206\u5f3a\u5927\u7684logstash filter\u63d2\u4ef6\uff0c\u4ed6\u53ef\u4ee5\u901a\u8fc7\u6b63\u5219\u89e3\u6790\u4efb\u610f\u6587\u672c\uff0c\u5c06\u975e\u7ed3\u6784\u5316\u65e5\u5fd7\u6570\u636e\u5f04\u6210\u7ed3\u6784\u5316\u548c\u65b9\u4fbf\u67e5\u8be2\u7684\u7ed3\u6784\u3002\u4ed6\u662f\u76ee\u524dlogstash \u4e2d\u89e3\u6790\u975e\u7ed3\u6784\u5316\u65e5\u5fd7\u6570\u636e\u6700\u597d\u7684\u65b9\u5f0f\u3002"),(0,r.kt)("p",null,"Grok \u7684\u8bed\u6cd5\u89c4\u5219\u662f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"%{\u8bed\u6cd5: \u8bed\u4e49}\n")),(0,r.kt)("p",null,"\u4f8b\u5982\u8f93\u5165\u7684\u5185\u5bb9\u4e3a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'172.16.213.132 [07/Feb/2019:16:24:19 +0800] "GET / HTTP/1.1" 403 5039\n')),(0,r.kt)("p",null,'%{IP:clientip}\u5339\u914d\u6a21\u5f0f\u5c06\u83b7\u5f97\u7684\u7ed3\u679c\u4e3a\uff1aclientip: 172.16.213.132 %{HTTPDATE:timestamp}\u5339\u914d\u6a21\u5f0f\u5c06\u83b7\u5f97\u7684\u7ed3\u679c\u4e3a\uff1atimestamp: 07/Feb/2018:16:24:19 +0800 \u800c%{QS:referrer}\u5339\u914d\u6a21\u5f0f\u5c06\u83b7\u5f97\u7684\u7ed3\u679c\u4e3a\uff1areferrer: "GET / HTTP/1.1"'),(0,r.kt)("p",null,"\u4e0b\u9762\u662f\u4e00\u4e2a\u7ec4\u5408\u5339\u914d\u6a21\u5f0f\uff0c\u5b83\u53ef\u4ee5\u83b7\u53d6\u4e0a\u9762\u8f93\u5165\u7684\u6240\u6709\u5185\u5bb9\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"%{IP:clientip}\\ \\[%{HTTPDATE:timestamp}\\]\\ %{QS:referrer}\\ %{NUMBER:response}\\ %{NUMBER:bytes}\n")),(0,r.kt)("p",null,"\u901a\u8fc7\u4e0a\u9762\u8fd9\u4e2a\u7ec4\u5408\u5339\u914d\u6a21\u5f0f\uff0c\u6211\u4eec\u5c06\u8f93\u5165\u7684\u5185\u5bb9\u5206\u6210\u4e86\u4e94\u4e2a\u90e8\u5206\uff0c\u5373\u4e94\u4e2a\u5b57\u6bb5\uff0c\u5c06\u8f93\u5165\u5185\u5bb9\u5206\u5272\u4e3a\u4e0d\u540c\u7684\u6570\u636e\u5b57\u6bb5\uff0c\u8fd9\u5bf9\u4e8e\u65e5\u540e\u89e3\u6790\u548c\u67e5\u8be2\u65e5\u5fd7\u6570\u636e\u975e\u5e38\u6709\u7528\uff0c\u8fd9\u6b63\u662f\u4f7f\u7528grok\u7684\u76ee\u7684\u3002"),(0,r.kt)("p",null,"\u4f8b\u5b50\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'input{\n    stdin{}\n}\nfilter{\n    grok{\n        match => ["message","%{IP:clientip}\\ \\[%{HTTPDATE:timestamp}\\]\\ %{QS:referrer}\\ %{NUMBER:response}\\ %{NUMBER:bytes}"]\n    }\n}\noutput{\n    stdout{\n        codec => "rubydebug"\n    }\n}\n')),(0,r.kt)("p",null,"\u8f93\u5165\u5185\u5bb9\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'172.16.213.132 [07/Feb/2019:16:24:19 +0800] "GET / HTTP/1.1" 403 5039\n')),(0,r.kt)("h4",{id:"2\u65f6\u95f4\u5904\u7406date"},"2\u3001\u65f6\u95f4\u5904\u7406(Date)"),(0,r.kt)("p",null,"date\u63d2\u4ef6\u662f\u5bf9\u4e8e\u6392\u5e8f\u4e8b\u4ef6\u548c\u56de\u586b\u65e7\u6570\u636e\u5c24\u5176\u91cd\u8981\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u8f6c\u6362\u65e5\u5fd7\u8bb0\u5f55\u4e2d\u7684\u65f6\u95f4\u5b57\u6bb5\uff0c\u53d8\u6210LogStash::Timestamp\u5bf9\u8c61\uff0c\u7136\u540e\u8f6c\u5b58\u5230@timestamp\u5b57\u6bb5\u91cc\uff0c\u8fd9\u5728\u4e4b\u524d\u5df2\u7ecf\u505a\u8fc7\u7b80\u5355\u7684\u4ecb\u7ecd\u3002 \u4e0b\u9762\u662fdate\u63d2\u4ef6\u7684\u4e00\u4e2a\u914d\u7f6e\u793a\u4f8b\uff08\u8fd9\u91cc\u4ec5\u4ec5\u5217\u51fafilter\u90e8\u5206\uff09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'filter {\n    grok {\n        match => ["message", "%{HTTPDATE:timestamp}"]\n    }\n    date {\n        match => ["timestamp", "dd/MMM/yyyy:HH:mm:ss Z"]\n    }\n}\n')),(0,r.kt)("h4",{id:"3\u6570\u636e\u4fee\u6539mutate"},"3\u3001\u6570\u636e\u4fee\u6539(Mutate)"),(0,r.kt)("h5",{id:"1\u6b63\u5219\u8868\u8fbe\u5f0f\u66ff\u6362\u5339\u914d\u5b57\u6bb5"},"\uff081\uff09\u6b63\u5219\u8868\u8fbe\u5f0f\u66ff\u6362\u5339\u914d\u5b57\u6bb5"),(0,r.kt)("p",null,"gsub\u53ef\u4ee5\u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u66ff\u6362\u5b57\u6bb5\u4e2d\u5339\u914d\u5230\u7684\u503c\uff0c\u53ea\u5bf9\u5b57\u7b26\u4e32\u5b57\u6bb5\u6709\u6548\uff0c\u4e0b\u9762\u662f\u4e00\u4e2a\u5173\u4e8emutate\u63d2\u4ef6\u4e2dgsub\u7684\u793a\u4f8b\uff08\u4ec5\u5217\u51fafilter\u90e8\u5206\uff09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'filter {\n    mutate {\n        gsub => ["filed_name_1", "/" , "_"]\n    }\n}\n')),(0,r.kt)("p",null,"\u8fd9\u4e2a\u793a\u4f8b\u8868\u793a\u5c06filed",(0,r.kt)("em",{parentName:"p"},'name_1\u5b57\u6bb5\u4e2d\u6240\u6709"/"\u5b57\u7b26\u66ff\u6362\u4e3a"'),'"\u3002'),(0,r.kt)("h5",{id:"2\u5206\u9694\u7b26\u5206\u5272\u5b57\u7b26\u4e32\u4e3a\u6570\u7ec4"},"\uff082\uff09\u5206\u9694\u7b26\u5206\u5272\u5b57\u7b26\u4e32\u4e3a\u6570\u7ec4"),(0,r.kt)("p",null,"split\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a\u7684\u5206\u9694\u7b26\u5206\u5272\u5b57\u6bb5\u4e2d\u7684\u5b57\u7b26\u4e32\u4e3a\u6570\u7ec4\uff0c\u4e0b\u9762\u662f\u4e00\u4e2a\u5173\u4e8emutate\u63d2\u4ef6\u4e2dsplit\u7684\u793a\u4f8b\uff08\u4ec5\u5217\u51fafilter\u90e8\u5206\uff09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'filter {\n    mutate {\n        split => ["filed_name_2", "|"]\n    }\n}\n')),(0,r.kt)("p",null,'\u8fd9\u4e2a\u793a\u4f8b\u8868\u793a\u5c06filed_name_2\u5b57\u6bb5\u4ee5"|"\u4e3a\u533a\u95f4\u5206\u9694\u4e3a\u6570\u7ec4\u3002'),(0,r.kt)("h5",{id:"3\u91cd\u547d\u540d\u5b57\u6bb5"},"\uff083\uff09\u91cd\u547d\u540d\u5b57\u6bb5"),(0,r.kt)("p",null,"rename\u53ef\u4ee5\u5b9e\u73b0\u91cd\u547d\u540d\u67d0\u4e2a\u5b57\u6bb5\u7684\u529f\u80fd\uff0c\u4e0b\u9762\u662f\u4e00\u4e2a\u5173\u4e8emutate\u63d2\u4ef6\u4e2drename\u7684\u793a\u4f8b\uff08\u4ec5\u5217\u51fafilter\u90e8\u5206\uff09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'filter {\n    mutate {\n        rename => { "old_field" => "new_field" }\n    }\n}\n')),(0,r.kt)("p",null,"\u8fd9\u4e2a\u793a\u4f8b\u8868\u793a\u5c06\u5b57\u6bb5old_field\u91cd\u547d\u540d\u4e3anew_field\u3002"),(0,r.kt)("h5",{id:"4\u5220\u9664\u5b57\u6bb5"},"\uff084\uff09\u5220\u9664\u5b57\u6bb5"),(0,r.kt)("p",null,"remove_field\u53ef\u4ee5\u5b9e\u73b0\u5220\u9664\u67d0\u4e2a\u5b57\u6bb5\u7684\u529f\u80fd\uff0c\u4e0b\u9762\u662f\u4e00\u4e2a\u5173\u4e8emutate\u63d2\u4ef6\u4e2dremove_field\u7684\u793a\u4f8b\uff08\u4ec5\u5217\u51fafilter\u90e8\u5206\uff09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'filter {\n    mutate {\n        remove_field  =>  ["timestamp"]\n    }\n}\n')),(0,r.kt)("p",null,"\u8fd9\u4e2a\u793a\u4f8b\u8868\u793a\u5c06\u5b57\u6bb5timestamp\u5220\u9664\u3002"),(0,r.kt)("h5",{id:"5geoip-\u5730\u5740\u67e5\u8be2\u5f52\u7c7b"},"\uff085\uff09GeoIP \u5730\u5740\u67e5\u8be2\u5f52\u7c7b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'filter {\n    geoip {\n        source => "ip_field"\n    }\n}\n')),(0,r.kt)("h5",{id:"\u7efc\u5408\u4f8b\u5b50"},"\u7efc\u5408\u4f8b\u5b50\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'input {\n    stdin {}\n}\nfilter {\n    grok {\n        match => { "message" => "%{IP:clientip}\\ \\[%{HTTPDATE:timestamp}\\]\\ %{QS:referrer}\\ %{NUMBER:response}\\ %{NUMBER:bytes}" }\n        remove_field => [ "message" ]\n   }\ndate {\n        match => ["timestamp", "dd/MMM/yyyy:HH:mm:ss Z"]\n    }\nmutate {\n          convert => [ "response","float" ]\n           rename => { "response" => "response_new" }   \n           gsub => ["referrer","\\"",""]          \n           split => ["clientip", "."]\n        }\n}\noutput {\n    stdout {\n        codec => "rubydebug"\n    }\n')),(0,r.kt)("h3",{id:"\u56dblogstash\u8f93\u51fa\u63d2\u4ef6output"},"\u56db\u3001Logstash\u8f93\u51fa\u63d2\u4ef6\uff08output\uff09"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/logstash/current/output-plugins.html"},"https://www.elastic.co/guide/en/logstash/current/output-plugins.htmlopen in new window")),(0,r.kt)("p",null,"output\u662fLogstash\u7684\u6700\u540e\u9636\u6bb5\uff0c\u4e00\u4e2a\u4e8b\u4ef6\u53ef\u4ee5\u7ecf\u8fc7\u591a\u4e2a\u8f93\u51fa\uff0c\u800c\u4e00\u65e6\u6240\u6709\u8f93\u51fa\u5904\u7406\u5b8c\u6210\uff0c\u6574\u4e2a\u4e8b\u4ef6\u5c31\u6267\u884c\u5b8c\u6210\u3002 \u4e00\u4e9b\u5e38\u7528\u7684\u8f93\u51fa\u5305\u62ec\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"file\uff1a \u8868\u793a\u5c06\u65e5\u5fd7\u6570\u636e\u5199\u5165\u78c1\u76d8\u4e0a\u7684\u6587\u4ef6\u3002"),(0,r.kt)("li",{parentName:"ul"},"elasticsearch\uff1a\u8868\u793a\u5c06\u65e5\u5fd7\u6570\u636e\u53d1\u9001\u7ed9Elasticsearch\u3002Elasticsearch\u53ef\u4ee5\u9ad8\u6548\u65b9\u4fbf\u548c\u6613\u4e8e\u67e5\u8be2\u7684\u4fdd\u5b58\u6570\u636e\u3002")),(0,r.kt)("p",null,"1\u3001\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa(stdout)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"output {\n    stdout {\n        codec => rubydebug\n    }\n}\n")),(0,r.kt)("p",null,"2\u3001\u4fdd\u5b58\u4e3a\u6587\u4ef6\uff08file\uff09"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'output {\n    file {\n        path => "/data/log/%{+yyyy-MM-dd}/%{host}_%{+HH}.log"\n    }\n}\n')),(0,r.kt)("p",null,"3\u3001\u8f93\u51fa\u5230elasticsearch"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'output {\n    elasticsearch {\n        host => ["192.168.1.1:9200","172.16.213.77:9200"]\n        index => "logstash-%{+YYYY.MM.dd}"       \n    }\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"host\uff1a\u662f\u4e00\u4e2a\u6570\u7ec4\u7c7b\u578b\u7684\u503c\uff0c\u540e\u9762\u8ddf\u7684\u503c\u662felasticsearch\u8282\u70b9\u7684\u5730\u5740\u4e0e\u7aef\u53e3\uff0c\u9ed8\u8ba4\u7aef\u53e3\u662f9200\u3002\u53ef\u6dfb\u52a0\u591a\u4e2a\u5730\u5740\u3002"),(0,r.kt)("li",{parentName:"ul"},"index\uff1a\u5199\u5165elasticsearch\u7684\u7d22\u5f15\u7684\u540d\u79f0\uff0c\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cf\u3002Logstash\u63d0\u4f9b\u4e86%{+YYYY.MM.dd}\u8fd9\u79cd\u5199\u6cd5\u3002\u5728\u8bed\u6cd5\u89e3\u6790\u7684\u65f6\u5019\uff0c\u770b\u5230\u4ee5+ \u53f7\u5f00\u5934\u7684\uff0c\u5c31\u4f1a\u81ea\u52a8\u8ba4\u4e3a\u540e\u9762\u662f\u65f6\u95f4\u683c\u5f0f\uff0c\u5c1d\u8bd5\u7528\u65f6\u95f4\u683c\u5f0f\u6765\u89e3\u6790\u540e\u7eed\u5b57\u7b26\u4e32\u3002\u8fd9\u79cd\u4ee5\u5929\u4e3a\u5355\u4f4d\u5206\u5272\u7684\u5199\u6cd5\uff0c\u53ef\u4ee5\u5f88\u5bb9\u6613\u7684\u5220\u9664\u8001\u7684\u6570\u636e\u6216\u8005\u641c\u7d22\u6307\u5b9a\u65f6\u95f4\u8303\u56f4\u5185\u7684\u6570\u636e\u3002\u6b64\u5916\uff0c\u6ce8\u610f\u7d22\u5f15\u540d\u4e2d\u4e0d\u80fd\u6709\u5927\u5199\u5b57\u6bcd\u3002"),(0,r.kt)("li",{parentName:"ul"},"manage_template:\u7528\u6765\u8bbe\u7f6e\u662f\u5426\u5f00\u542flogstash\u81ea\u52a8\u7ba1\u7406\u6a21\u677f\u529f\u80fd\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3afalse\u5c06\u5173\u95ed\u81ea\u52a8\u7ba1\u7406\u6a21\u677f\u529f\u80fd\u3002\u5982\u679c\u6211\u4eec\u81ea\u5b9a\u4e49\u4e86\u6a21\u677f\uff0c\u90a3\u4e48\u5e94\u8be5\u8bbe\u7f6e\u4e3afalse\u3002"),(0,r.kt)("li",{parentName:"ul"},"template_name:\u8fd9\u4e2a\u914d\u7f6e\u9879\u7528\u6765\u8bbe\u7f6e\u5728Elasticsearch\u4e2d\u6a21\u677f\u7684\u540d\u79f0\u3002")),(0,r.kt)("h3",{id:"\u4e94\u7efc\u5408\u6848\u4f8b"},"\u4e94\u3001\u7efc\u5408\u6848\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'input {\n    file {\n        path => ["D:/ES/logstash-7.3.0/nginx.log"]        \n        start_position => "beginning"\n    }\n}\n\nfilter {\n    grok {\n        match => { "message" => "%{IP:clientip}\\ \\[%{HTTPDATE:timestamp}\\]\\ %{QS:referrer}\\ %{NUMBER:response}\\ %{NUMBER:bytes}" }\n        remove_field => [ "message" ]\n   }\n    date {\n        match => ["timestamp", "dd/MMM/yyyy:HH:mm:ss Z"]\n    }\n    mutate {\n           rename => { "response" => "response_new" }\n           convert => [ "response","float" ]\n           gsub => ["referrer","\\"",""]\n           remove_field => ["timestamp"]\n           split => ["clientip", "."]\n        }\n}\n\noutput {\n    stdout {\n        codec => "rubydebug"\n    }\n\nelasticsearch {\n    host => ["localhost:9200"]\n    index => "logstash-%{+YYYY.MM.dd}"       \n}\n\n}\n')),(0,r.kt)("h2",{id:"\u7b2c\u4e8c\u5341\u4e00\u7ae0-kibana\u5b66\u4e60"},"\u7b2c\u4e8c\u5341\u4e00\u7ae0 kibana\u5b66\u4e60"),(0,r.kt)("h3",{id:"\u4e00\u57fa\u672c\u67e5\u8be2"},"\u4e00\u3001\u57fa\u672c\u67e5\u8be2"),(0,r.kt)("p",null,"1\u3001\u662f\u4ec0\u4e48\uff1aelk\u4e2d\u6570\u636e\u5c55\u73b0\u5de5\u5177\u3002"),(0,r.kt)("p",null,"2\u3001\u4e0b\u8f7d\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://www.elastic.co/cn/downloads/kibana"},"https://www.elastic.co/cn/downloads/kibanaopen in new window")),(0,r.kt)("p",null,"3\u3001\u4f7f\u7528\uff1a\u5efa\u7acb\u7d22\u5f15\u6a21\u5f0f\uff0cindex partten"),(0,r.kt)("p",null,"discover \u4e2d\u4f7f\u7528DSL\u641c\u7d22\u3002"),(0,r.kt)("h3",{id:"\u4e8c\u53ef\u89c6\u5316"},"\u4e8c\u3001\u53ef\u89c6\u5316"),(0,r.kt)("p",null,"\u7ed8\u5236\u56fe\u5f62"),(0,r.kt)("h3",{id:"\u4e09\u4eea\u8868\u76d8"},"\u4e09\u3001\u4eea\u8868\u76d8"),(0,r.kt)("p",null,"\u5c06\u5404\u79cd\u53ef\u89c6\u5316\u56fe\u5f62\u653e\u5165\uff0c\u5f62\u6210\u5927\u5c4f\u5e55\u3002"),(0,r.kt)("h3",{id:"\u56db\u4f7f\u7528\u6a21\u677f\u6570\u636e\u6307\u5bfc\u7ed8\u56fe"},"\u56db\u3001\u4f7f\u7528\u6a21\u677f\u6570\u636e\u6307\u5bfc\u7ed8\u56fe"),(0,r.kt)("p",null,"\u70b9\u51fb\u4e3b\u9875\u7684\u6dfb\u52a0\u6a21\u677f\u6570\u636e\uff0c\u53ef\u4ee5\u770b\u5230\u5f88\u591a\u6a21\u677f\u6570\u636e\u4ee5\u53ca\u7ed8\u56fe\u3002"),(0,r.kt)("h3",{id:"\u4e94\u5176\u4ed6\u529f\u80fd"},"\u4e94\u3001\u5176\u4ed6\u529f\u80fd"),(0,r.kt)("p",null,"\u76d1\u63a7\uff0c\u65e5\u5fd7\uff0cAPM\u7b49\u529f\u80fd\u975e\u5e38\u4e30\u5bcc\u3002"),(0,r.kt)("h2",{id:"\u7b2c\u4e8c\u5341\u4e8c\u7ae0-\u96c6\u7fa4\u90e8\u7f72"},"\u7b2c\u4e8c\u5341\u4e8c\u7ae0 \u96c6\u7fa4\u90e8\u7f72"),(0,r.kt)("p",null,"\u89c1\u90e8\u7f72\u56fe"),(0,r.kt)("h3",{id:"\u7ed3\u70b9\u7684\u4e09\u4e2a\u89d2\u8272"},"\u7ed3\u70b9\u7684\u4e09\u4e2a\u89d2\u8272"),(0,r.kt)("p",null,"\u4e3b\u7ed3\u70b9\uff1amaster\u8282\u70b9\u4e3b\u8981\u7528\u4e8e\u96c6\u7fa4\u7684\u7ba1\u7406\u53ca\u7d22\u5f15 \u6bd4\u5982\u65b0\u589e\u7ed3\u70b9\u3001\u5206\u7247\u5206\u914d\u3001\u7d22\u5f15\u7684\u65b0\u589e\u548c\u5220\u9664\u7b49\u3002 \u6570\u636e\u7ed3\u70b9\uff1adata \u8282\u70b9\u4e0a\u4fdd\u5b58\u4e86\u6570\u636e\u5206\u7247\uff0c\u5b83\u8d1f\u8d23\u7d22\u5f15\u548c\u641c\u7d22\u64cd\u4f5c\u3002 \u5ba2\u6237\u7aef\u7ed3\u70b9\uff1aclient \u8282\u70b9\u4ec5\u4f5c\u4e3a\u8bf7\u6c42\u5ba2\u6237\u7aef\u5b58\u5728\uff0cclient\u7684\u4f5c\u7528\u4e5f\u4f5c\u4e3a\u8d1f\u8f7d\u5747\u8861\u5668\uff0cclient \u8282\u70b9\u4e0d\u5b58\u6570\u636e\uff0c\u53ea\u662f\u5c06\u8bf7\u6c42\u5747\u8861\u8f6c\u53d1\u5230\u5176\u5b83\u7ed3\u70b9\u3002"),(0,r.kt)("p",null,"\u901a\u8fc7\u4e0b\u8fb9\u4e24\u9879\u53c2\u6570\u6765\u914d\u7f6e\u7ed3\u70b9\u7684\u529f\u80fd\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"node.master: #\u662f\u5426\u5141\u8bb8\u4e3a\u4e3b\u7ed3\u70b9\nnode.data: #\u5141\u8bb8\u5b58\u50a8\u6570\u636e\u4f5c\u4e3a\u6570\u636e\u7ed3\u70b9\nnode.ingest: #\u662f\u5426\u5141\u8bb8\u6210\u4e3a\u534f\u8c03\u8282\u70b9\n")),(0,r.kt)("p",null,"\u56db\u79cd\u7ec4\u5408\u65b9\u5f0f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"master=true\uff0cdata=true\uff1a\u5373\u662f\u4e3b\u7ed3\u70b9\u53c8\u662f\u6570\u636e\u7ed3\u70b9\nmaster=false\uff0cdata=true\uff1a\u4ec5\u662f\u6570\u636e\u7ed3\u70b9\nmaster=true\uff0cdata=false\uff1a\u4ec5\u662f\u4e3b\u7ed3\u70b9\uff0c\u4e0d\u5b58\u50a8\u6570\u636e\nmaster=false\uff0cdata=false\uff1a\u5373\u4e0d\u662f\u4e3b\u7ed3\u70b9\u4e5f\u4e0d\u662f\u6570\u636e\u7ed3\u70b9\uff0c\u6b64\u65f6\u53ef\u8bbe\u7f6eingest\u4e3atrue\u8868\u793a\u5b83\u662f\u4e00\u4e2a\u5ba2\u6237\u7aef\u3002\n")),(0,r.kt)("h2",{id:"\u7b2c\u4e8c\u5341\u4e09\u7ae0-\u9879\u76ee\u5b9e\u6218"},"\u7b2c\u4e8c\u5341\u4e09\u7ae0 \u9879\u76ee\u5b9e\u6218"),(0,r.kt)("h3",{id:"\u4e00\u9879\u76ee\u4e00elk\u7528\u4e8e\u65e5\u5fd7\u5206\u6790"},"\u4e00\u3001\u9879\u76ee\u4e00\uff1aELK\u7528\u4e8e\u65e5\u5fd7\u5206\u6790"),(0,r.kt)("p",null,"\u9700\u6c42\uff1a\u96c6\u4e2d\u6536\u96c6\u5206\u5e03\u5f0f\u670d\u52a1\u7684\u65e5\u5fd7"),(0,r.kt)("p",null,"1\u903b\u8f91\u6a21\u5757\u7a0b\u5e8f\u968f\u65f6\u8f93\u51fa\u65e5\u5fd7"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.es;\n\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.context.junit4.SpringRunner;\n\nimport java.util.Random;\n\n/**\n * creste by ydlclass.ydl\n */\n@SpringBootTest\n@RunWith(SpringRunner.class)\npublic class TestLog {\n    private static final Logger LOGGER= LoggerFactory.getLogger(TestLog.class);\n\n    @Test\n    public void testLog(){\n        Random random =new Random();\n\n        while (true){\n            int userid=random.nextInt(10);\n            LOGGER.info("userId:{},send:{}",userid,"hello world.I am "+userid);\n            try {\n                Thread.sleep(500);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n')),(0,r.kt)("p",null,"2logstash\u6536\u96c6\u65e5\u5fd7\u5230es"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"grok \u5185\u7f6e\u7c7b\u578b")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"USERNAME [a-zA-Z0-9._-]+\nUSER %{USERNAME}\nINT (?:[+-]?(?:[0-9]+))\nBASE10NUM (?<![0-9.+-])(?>[+-]?(?:(?:[0-9]+(?:\\.[0-9]+)?)|(?:\\.[0-9]+)))\nNUMBER (?:%{BASE10NUM})\nBASE16NUM (?<![0-9A-Fa-f])(?:[+-]?(?:0x)?(?:[0-9A-Fa-f]+))\nBASE16FLOAT \\b(?<![0-9A-Fa-f.])(?:[+-]?(?:0x)?(?:(?:[0-9A-Fa-f]+(?:\\.[0-9A-Fa-f]*)?)|(?:\\.[0-9A-Fa-f]+)))\\b\n\nPOSINT \\b(?:[1-9][0-9]*)\\b\nNONNEGINT \\b(?:[0-9]+)\\b\nWORD \\b\\w+\\b\nNOTSPACE \\S+\nSPACE \\s*\nDATA .*?\nGREEDYDATA .*\nQUOTEDSTRING (?>(?<!\\\\)(?>\"(?>\\\\.|[^\\\\\"]+)+\"|\"\"|(?>'(?>\\\\.|[^\\\\']+)+')|''|(?>`(?>\\\\.|[^\\\\`]+)+`)|``))\nUUID [A-Fa-f0-9]{8}-(?:[A-Fa-f0-9]{4}-){3}[A-Fa-f0-9]{12}\n\n# Networking\nMAC (?:%{CISCOMAC}|%{WINDOWSMAC}|%{COMMONMAC})\nCISCOMAC (?:(?:[A-Fa-f0-9]{4}\\.){2}[A-Fa-f0-9]{4})\nWINDOWSMAC (?:(?:[A-Fa-f0-9]{2}-){5}[A-Fa-f0-9]{2})\nCOMMONMAC (?:(?:[A-Fa-f0-9]{2}:){5}[A-Fa-f0-9]{2})\nIPV6 ((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\nIPV4 (?<![0-9])(?:(?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2})[.](?:25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{1,2}))(?![0-9])\nIP (?:%{IPV6}|%{IPV4})\nHOSTNAME \\b(?:[0-9A-Za-z][0-9A-Za-z-]{0,62})(?:\\.(?:[0-9A-Za-z][0-9A-Za-z-]{0,62}))*(\\.?|\\b)\nHOST %{HOSTNAME}\nIPORHOST (?:%{HOSTNAME}|%{IP})\nHOSTPORT %{IPORHOST}:%{POSINT}\n\n# paths\nPATH (?:%{UNIXPATH}|%{WINPATH})\nUNIXPATH (?>/(?>[\\w_%!$@:.,-]+|\\\\.)*)+\nTTY (?:/dev/(pts|tty([pq])?)(\\w+)?/?(?:[0-9]+))\nWINPATH (?>[A-Za-z]+:|\\\\)(?:\\\\[^\\\\?*]*)+\nURIPROTO [A-Za-z]+(\\+[A-Za-z+]+)?\nURIHOST %{IPORHOST}(?::%{POSINT:port})?\n# uripath comes loosely from RFC1738, but mostly from what Firefox\n# doesn't turn into %XX\nURIPATH (?:/[A-Za-z0-9$.+!*'(){},~:;=@#%_\\-]*)+\n#URIPARAM \\?(?:[A-Za-z0-9]+(?:=(?:[^&]*))?(?:&(?:[A-Za-z0-9]+(?:=(?:[^&]*))?)?)*)?\nURIPARAM \\?[A-Za-z0-9$.+!*'|(){},~@#%&/=:;_?\\-\\[\\]]*\nURIPATHPARAM %{URIPATH}(?:%{URIPARAM})?\nURI %{URIPROTO}://(?:%{USER}(?::[^@]*)?@)?(?:%{URIHOST})?(?:%{URIPATHPARAM})?\n\n# Months: January, Feb, 3, 03, 12, December\nMONTH \\b(?:Jan(?:uary)?|Feb(?:ruary)?|Mar(?:ch)?|Apr(?:il)?|May|Jun(?:e)?|Jul(?:y)?|Aug(?:ust)?|Sep(?:tember)?|Oct(?:ober)?|Nov(?:ember)?|Dec(?:ember)?)\\b\nMONTHNUM (?:0?[1-9]|1[0-2])\nMONTHNUM2 (?:0[1-9]|1[0-2])\nMONTHDAY (?:(?:0[1-9])|(?:[12][0-9])|(?:3[01])|[1-9])\n\n# Days: Monday, Tue, Thu, etc...\nDAY (?:Mon(?:day)?|Tue(?:sday)?|Wed(?:nesday)?|Thu(?:rsday)?|Fri(?:day)?|Sat(?:urday)?|Sun(?:day)?)\n\n# Years?\nYEAR (?>\\d\\d){1,2}\nHOUR (?:2[0123]|[01]?[0-9])\nMINUTE (?:[0-5][0-9])\n# '60' is a leap second in most time standards and thus is valid.\nSECOND (?:(?:[0-5]?[0-9]|60)(?:[:.,][0-9]+)?)\nTIME (?!<[0-9])%{HOUR}:%{MINUTE}(?::%{SECOND})(?![0-9])\n# datestamp is YYYY/MM/DD-HH:MM:SS.UUUU (or something like it)\nDATE_US %{MONTHNUM}[/-]%{MONTHDAY}[/-]%{YEAR}\nDATE_EU %{MONTHDAY}[./-]%{MONTHNUM}[./-]%{YEAR}\nISO8601_TIMEZONE (?:Z|[+-]%{HOUR}(?::?%{MINUTE}))\nISO8601_SECOND (?:%{SECOND}|60)\nTIMESTAMP_ISO8601 %{YEAR}-%{MONTHNUM}-%{MONTHDAY}[T ]%{HOUR}:?%{MINUTE}(?::?%{SECOND})?%{ISO8601_TIMEZONE}?\nDATE %{DATE_US}|%{DATE_EU}\nDATESTAMP %{DATE}[- ]%{TIME}\nTZ (?:[PMCE][SD]T|UTC)\nDATESTAMP_RFC822 %{DAY} %{MONTH} %{MONTHDAY} %{YEAR} %{TIME} %{TZ}\nDATESTAMP_RFC2822 %{DAY}, %{MONTHDAY} %{MONTH} %{YEAR} %{TIME} %{ISO8601_TIMEZONE}\nDATESTAMP_OTHER %{DAY} %{MONTH} %{MONTHDAY} %{TIME} %{TZ} %{YEAR}\nDATESTAMP_EVENTLOG %{YEAR}%{MONTHNUM2}%{MONTHDAY}%{HOUR}%{MINUTE}%{SECOND}\n\n# Syslog Dates: Month Day HH:MM:SS\nSYSLOGTIMESTAMP %{MONTH} +%{MONTHDAY} %{TIME}\nPROG (?:[\\w._/%-]+)\nSYSLOGPROG %{PROG:program}(?:\\[%{POSINT:pid}\\])?\nSYSLOGHOST %{IPORHOST}\nSYSLOGFACILITY <%{NONNEGINT:facility}.%{NONNEGINT:priority}>\nHTTPDATE %{MONTHDAY}/%{MONTH}/%{YEAR}:%{TIME} %{INT}\n\n# Shortcuts\nQS %{QUOTEDSTRING}\n\n# Log formats\nSYSLOGBASE %{SYSLOGTIMESTAMP:timestamp} (?:%{SYSLOGFACILITY} )?%{SYSLOGHOST:logsource} %{SYSLOGPROG}:\nCOMMONAPACHELOG %{IPORHOST:clientip} %{USER:ident} %{USER:auth} \\[%{HTTPDATE:timestamp}\\] \"(?:%{WORD:verb} %{NOTSPACE:request}(?: HTTP/%{NUMBER:httpversion})?|%{DATA:rawrequest})\" %{NUMBER:response} (?:%{NUMBER:bytes}|-)\nCOMBINEDAPACHELOG %{COMMONAPACHELOG} %{QS:referrer} %{QS:agent}\n\n# Log Levels\nLOGLEVEL ([Aa]lert|ALERT|[Tt]race|TRACE|[Dd]ebug|DEBUG|[Nn]otice|NOTICE|[Ii]nfo|INFO|[Ww]arn?(?:ing)?|WARN?(?:ING)?|[Ee]rr?(?:or)?|ERR?(?:OR)?|[Cc]rit?(?:ical)?|CRIT?(?:ICAL)?|[Ff]atal|FATAL|[Ss]evere|SEVERE|EMERG(?:ENCY)?|[Ee]merg(?:ency)?)\n")),(0,r.kt)("p",null,"\u5199logstash\u914d\u7f6e\u6587\u4ef6\u3002"),(0,r.kt)("p",null,"3kibana\u5c55\u73b0\u6570\u636e"),(0,r.kt)("h3",{id:"\u4e8c\u9879\u76ee\u4e8c\u5b66\u6210\u5728\u7ebf\u7ad9\u5185\u641c\u7d22\u6a21\u5757"},"\u4e8c\u3001\u9879\u76ee\u4e8c\uff1a\u5b66\u6210\u5728\u7ebf\u7ad9\u5185\u641c\u7d22\u6a21\u5757"),(0,r.kt)("h4",{id:"1mysql\u5bfc\u5165course_pub\u8868"},"1\u3001mysql\u5bfc\u5165course_pub\u8868"),(0,r.kt)("h4",{id:"2\u521b\u5efa\u7d22\u5f15xc_course"},"2\u3001\u521b\u5efa\u7d22\u5f15xc_course"),(0,r.kt)("h4",{id:"3\u521b\u5efa\u6620\u5c04"},"3\u3001\u521b\u5efa\u6620\u5c04"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'PUT /xc_course\n{\n  "settings": {\n    "number_of_shards": 1,\n    "number_of_replicas": 0\n  },\n  "mappings": {\n    "properties": {\n      "description" : {\n                "analyzer" : "ik_max_word",\n                "search_analyzer": "ik_smart",\n               "type" : "text"\n            },\n            "grade" : {\n               "type" : "keyword"\n            },\n            "id" : {\n               "type" : "keyword"\n            },\n            "mt" : {\n               "type" : "keyword"\n            },\n            "name" : {\n                "analyzer" : "ik_max_word",\n           "search_analyzer": "ik_smart",\n               "type" : "text"\n            },\n            "users" : {\n               "index" : false,\n               "type" : "text"\n            },\n            "charge" : {\n               "type" : "keyword"\n            },\n            "valid" : {\n               "type" : "keyword"\n            },\n            "pic" : {\n               "index" : false,\n               "type" : "keyword"\n            },\n            "qq" : {\n               "index" : false,\n               "type" : "keyword"\n            },\n            "price" : {\n               "type" : "float"\n            },\n            "price_old" : {\n               "type" : "float"\n            },\n            "st" : {\n               "type" : "keyword"\n            },\n            "status" : {\n               "type" : "keyword"\n            },\n            "studymodel" : {\n               "type" : "keyword"\n            },\n            "teachmode" : {\n               "type" : "keyword"\n            },\n            "teachplan" : {\n                "analyzer" : "ik_max_word",\n           "search_analyzer": "ik_smart",\n               "type" : "text"\n            },\n           "expires" : {\n               "type" : "date",\n            "format": "yyyy-MM-dd HH:mm:ss"\n            },\n            "pub_time" : {\n               "type" : "date",\n             "format": "yyyy-MM-dd HH:mm:ss"\n            },\n            "start_time" : {\n               "type" : "date",\n           "format": "yyyy-MM-dd HH:mm:ss"\n            },\n          "end_time" : {\n                 "type" : "date",\n           "format": "yyyy-MM-dd HH:mm:ss"\n            }\n    }\n  } \n}\n')),(0,r.kt)("h4",{id:"4logstash\u521b\u5efa\u6a21\u677f\u6587\u4ef6"},"4\u3001logstash\u521b\u5efa\u6a21\u677f\u6587\u4ef6"),(0,r.kt)("p",null,"Logstash\u7684\u5de5\u4f5c\u662f\u4eceMySQL\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u5411ES\u4e2d\u521b\u5efa\u7d22\u5f15\uff0c\u8fd9\u91cc\u9700\u8981\u63d0\u524d\u521b\u5efamapping\u7684\u6a21\u677f\u6587\u4ef6\u4ee5\u4fbflogstash\u4f7f\u7528\u3002"),(0,r.kt)("p",null,"\u5728logstach\u7684config\u76ee\u5f55\u521b\u5efaxc_course_template.json\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'{\n   "mappings" : {\n      "doc" : {\n         "properties" : {\n            "charge" : {\n               "type" : "keyword"\n            },\n            "description" : {\n               "analyzer" : "ik_max_word",\n               "search_analyzer" : "ik_smart",\n               "type" : "text"\n            },\n            "end_time" : {\n               "format" : "yyyy-MM-dd HH:mm:ss",\n               "type" : "date"\n            },\n            "expires" : {\n               "format" : "yyyy-MM-dd HH:mm:ss",\n               "type" : "date"\n            },\n            "grade" : {\n               "type" : "keyword"\n            },\n            "id" : {\n               "type" : "keyword"\n            },\n            "mt" : {\n               "type" : "keyword"\n            },\n            "name" : {\n               "analyzer" : "ik_max_word",\n               "search_analyzer" : "ik_smart",\n               "type" : "text"\n            },\n            "pic" : {\n               "index" : false,\n               "type" : "keyword"\n            },\n            "price" : {\n               "type" : "float"\n            },\n            "price_old" : {\n               "type" : "float"\n            },\n            "pub_time" : {\n               "format" : "yyyy-MM-dd HH:mm:ss",\n               "type" : "date"\n            },\n            "qq" : {\n               "index" : false,\n               "type" : "keyword"\n            },\n            "st" : {\n               "type" : "keyword"\n            },\n            "start_time" : {\n               "format" : "yyyy-MM-dd HH:mm:ss",\n               "type" : "date"\n            },\n            "status" : {\n               "type" : "keyword"\n            },\n            "studymodel" : {\n               "type" : "keyword"\n            },\n            "teachmode" : {\n               "type" : "keyword"\n            },\n            "teachplan" : {\n               "analyzer" : "ik_max_word",\n               "search_analyzer" : "ik_smart",\n               "type" : "text"\n            },\n            "users" : {\n               "index" : false,\n               "type" : "text"\n            },\n            "valid" : {\n               "type" : "keyword"\n            }\n         }\n      }\n   },\n   "template" : "xc_course"\n}\n')),(0,r.kt)("h4",{id:"5logstash\u914d\u7f6emysqlconf"},"5\u3001logstash\u914d\u7f6emysql.conf"),(0,r.kt)("p",null,"1\u3001ES\u91c7\u7528UTC\u65f6\u533a\u95ee\u9898"),(0,r.kt)("p",null,"ES\u91c7\u7528UTC \u65f6\u533a\uff0c\u6bd4\u5317\u4eac\u65f6\u95f4\u65e98\u5c0f\u65f6\uff0c\u6240\u4ee5ES\u8bfb\u53d6\u6570\u636e\u65f6\u8ba9\u6700\u540e\u66f4\u65b0\u65f6\u95f4\u52a08\u5c0f\u65f6"),(0,r.kt)("p",null,"where timestamp > date_add(:sql_last_value,INTERVAL 8 HOUR)"),(0,r.kt)("p",null,"2\u3001logstash\u6bcf\u4e2a\u6267\u884c\u5b8c\u6210\u4f1a\u5728/config/logstash_metadata\u8bb0\u5f55\u6267\u884c\u65f6\u95f4\u4e0b\u6b21\u4ee5\u6b64\u65f6\u95f4\u4e3a\u57fa\u51c6\u8fdb\u884c\u589e\u91cf\u540c\u6b65\u6570\u636e\u5230\u7d22\u5f15\u5e93\u3002"),(0,r.kt)("h4",{id:"6\u542f\u52a8"},"6\u3001\u542f\u52a8"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},".\\logstash.bat -f ..\\config\\mysql.conf\n")),(0,r.kt)("h4",{id:"7\u540e\u7aef\u4ee3\u7801"},"7\u3001\u540e\u7aef\u4ee3\u7801"),(0,r.kt)("p",null,"\uff081\uff09Controller"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\n@RequestMapping("/search/course")\npublic class EsCourseController  {\n    @Autowired\n    EsCourseService esCourseService;\n\n    @GetMapping(value="/list/{page}/{size}")\n    public QueryResponseResult<CoursePub> list(@PathVariable("page") int page, @PathVariable("size") int size, CourseSearchParam courseSearchParam) {\n        return esCourseService.list(page,size,courseSearchParam);\n    }\n\n}\n')),(0,r.kt)("p",null,"\uff082\uff09"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Service\npublic class EsCourseService {\n    @Value("${heima.course.source_field}")\n    private String source_field;\n\n    @Autowired\n    RestHighLevelClient restHighLevelClient;\n\n    //\u8bfe\u7a0b\u641c\u7d22\n    public QueryResponseResult<CoursePub> list(int page, int size, CourseSearchParam courseSearchParam) {\n        if (courseSearchParam == null) {\n            courseSearchParam = new CourseSearchParam();\n        }\n        //1\u521b\u5efa\u641c\u7d22\u8bf7\u6c42\u5bf9\u8c61\n        SearchRequest searchRequest = new SearchRequest("xc_course");\n\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n        //\u8fc7\u8651\u6e90\u5b57\u6bb5\n        String[] source_field_array = source_field.split(",");\n        searchSourceBuilder.fetchSource(source_field_array, new String[]{});\n        //\u521b\u5efa\u5e03\u5c14\u67e5\u8be2\u5bf9\u8c61\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n        //\u641c\u7d22\u6761\u4ef6\n        //\u6839\u636e\u5173\u952e\u5b57\u641c\u7d22\n        if (StringUtils.isNotEmpty(courseSearchParam.getKeyword())) {\n            MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(courseSearchParam.getKeyword(), "name", "description", "teachplan")\n                .minimumShouldMatch("70%")\n                .field("name", 10);\n            boolQueryBuilder.must(multiMatchQueryBuilder);\n        }\n        if (StringUtils.isNotEmpty(courseSearchParam.getMt())) {\n            //\u6839\u636e\u4e00\u7ea7\u5206\u7c7b\n            boolQueryBuilder.filter(QueryBuilders.termQuery("mt", courseSearchParam.getMt()));\n        }\n        if (StringUtils.isNotEmpty(courseSearchParam.getSt())) {\n            //\u6839\u636e\u4e8c\u7ea7\u5206\u7c7b\n            boolQueryBuilder.filter(QueryBuilders.termQuery("st", courseSearchParam.getSt()));\n        }\n        if (StringUtils.isNotEmpty(courseSearchParam.getGrade())) {\n            //\u6839\u636e\u96be\u5ea6\u7b49\u7ea7\n            boolQueryBuilder.filter(QueryBuilders.termQuery("grade", courseSearchParam.getGrade()));\n        }\n\n        //\u8bbe\u7f6eboolQueryBuilder\u5230searchSourceBuilder\n        searchSourceBuilder.query(boolQueryBuilder);\n        //\u8bbe\u7f6e\u5206\u9875\u53c2\u6570\n        if (page <= 0) {\n            page = 1;\n        }\n        if (size <= 0) {\n            size = 12;\n        }\n        //\u8d77\u59cb\u8bb0\u5f55\u4e0b\u6807\n        int from = (page - 1) * size;\n        searchSourceBuilder.from(from);\n        searchSourceBuilder.size(size);\n\n        //\u8bbe\u7f6e\u9ad8\u4eae\n        HighlightBuilder highlightBuilder = new HighlightBuilder();\n        highlightBuilder.preTags("<font class=\'eslight\'>");\n        highlightBuilder.postTags("</font>");\n        //\u8bbe\u7f6e\u9ad8\u4eae\u5b57\u6bb5\n        //        <font class=\'eslight\'>node</font>\u5b66\u4e60\n        highlightBuilder.fields().add(new HighlightBuilder.Field("name"));\n        searchSourceBuilder.highlighter(highlightBuilder);\n\n        searchRequest.source(searchSourceBuilder);\n\n        QueryResult<CoursePub> queryResult = new QueryResult();\n        List<CoursePub> list = new ArrayList<CoursePub>();\n        try {\n            //2\u6267\u884c\u641c\u7d22\n            SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);\n            //3\u83b7\u53d6\u54cd\u5e94\u7ed3\u679c\n            SearchHits hits = searchResponse.getHits();\n            long totalHits=hits.getTotalHits().value;\n            //\u5339\u914d\u7684\u603b\u8bb0\u5f55\u6570\n            //            long totalHits = hits.totalHits;\n            queryResult.setTotal(totalHits);\n            SearchHit[] searchHits = hits.getHits();\n            for (SearchHit hit : searchHits) {\n                CoursePub coursePub = new CoursePub();\n                //\u6e90\u6587\u6863\n                Map<String, Object> sourceAsMap = hit.getSourceAsMap();\n                //\u53d6\u51faid\n                String id = (String) sourceAsMap.get("id");\n                coursePub.setId(id);\n                //\u53d6\u51faname\n                String name = (String) sourceAsMap.get("name");\n                //\u53d6\u51fa\u9ad8\u4eae\u5b57\u6bb5name\n                Map<String, HighlightField> highlightFields = hit.getHighlightFields();\n                if (highlightFields != null) {\n                    HighlightField highlightFieldName = highlightFields.get("name");\n                    if (highlightFieldName != null) {\n                        Text[] fragments = highlightFieldName.fragments();\n                        StringBuffer stringBuffer = new StringBuffer();\n                        for (Text text : fragments) {\n                            stringBuffer.append(text);\n                        }\n                        name = stringBuffer.toString();\n                    }\n                }\n                coursePub.setName(name);\n                //\u56fe\u7247\n                String pic = (String) sourceAsMap.get("pic");\n                coursePub.setPic(pic);\n                //\u4ef7\u683c\n                Double price = null;\n                try {\n                    if (sourceAsMap.get("price") != null) {\n                        price = (Double) sourceAsMap.get("price");\n                    }\n\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n                coursePub.setPrice(price);\n                //\u65e7\u4ef7\u683c\n                Double price_old = null;\n                try {\n                    if (sourceAsMap.get("price_old") != null) {\n                        price_old = (Double) sourceAsMap.get("price_old");\n                    }\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n                coursePub.setPrice_old(price_old);\n                //\u5c06coursePub\u5bf9\u8c61\u653e\u5165list\n                list.add(coursePub);\n            }\n\n\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n\n        queryResult.setList(list);\n        QueryResponseResult<CoursePub> queryResponseResult = new QueryResponseResult<CoursePub>(CommonCode.SUCCESS, queryResult);\n\n        return queryResponseResult;\n    }\n\n\n}\n')))}p.isMDXComponent=!0}}]);