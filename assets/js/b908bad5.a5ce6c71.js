"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7530],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>g});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=r.createContext({}),p=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},u=function(e){var n=p(e.components);return r.createElement(o.Provider,{value:n},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(t),d=a,g=c["".concat(o,".").concat(d)]||c[d]||m[d]||i;return t?r.createElement(g,s(s({ref:n},u),{},{components:t})):r.createElement(g,s({ref:n},u))}));function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,s=new Array(i);s[0]=d;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l[c]="string"==typeof e?e:a,s[1]=l;for(var p=2;p<i;p++)s[p]=t[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},7729:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var r=t(7462),a=(t(7294),t(3905));const i={},s="8.SpringSecurity",l={unversionedId:"Java/\u6846\u67b6/SpringSecurity",id:"Java/\u6846\u67b6/SpringSecurity",title:"8.SpringSecurity",description:"\u8bfe\u7a0b\u6982\u8ff0",source:"@site/docs/Java/6.\u6846\u67b6/8.SpringSecurity.md",sourceDirName:"Java/6.\u6846\u67b6",slug:"/Java/\u6846\u67b6/SpringSecurity",permalink:"/docs/Java/\u6846\u67b6/SpringSecurity",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Java/6.\u6846\u67b6/8.SpringSecurity.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{},sidebar:"Java",previous:{title:"7.MyBatisPlus",permalink:"/docs/Java/\u6846\u67b6/MyBatisPlus"},next:{title:"9.SPRING-DATA-JPA",permalink:"/docs/Java/\u6846\u67b6/SPRING-DATA-JPA"}},o={},p=[{value:"\u8bfe\u7a0b\u6982\u8ff0",id:"\u8bfe\u7a0b\u6982\u8ff0",level:2},{value:"1\u3001\u4e3a\u4ec0\u4e48\u51fa\u8fd9\u95e8\u8bfe",id:"1\u4e3a\u4ec0\u4e48\u51fa\u8fd9\u95e8\u8bfe",level:3},{value:"\uff081\uff09\u6211\u7684\u540e\u671f\u9879\u76ee\u8bfe\uff0c\u90fd\u4f1a\u7528\u5230\u8fd9\u4e2a\u6280\u672f",id:"1\u6211\u7684\u540e\u671f\u9879\u76ee\u8bfe\u90fd\u4f1a\u7528\u5230\u8fd9\u4e2a\u6280\u672f",level:4},{value:"\uff082\uff09 B\u7ad9\u627e\u4e86\u4e00\u4e0b\uff0c\u6ca1\u6709\u6bd4\u8f83\u597d\u7684SpringSecurity\u8bfe\u7a0b",id:"2-b\u7ad9\u627e\u4e86\u4e00\u4e0b\u6ca1\u6709\u6bd4\u8f83\u597d\u7684springsecurity\u8bfe\u7a0b",level:4},{value:"2\u3001\u8bfe\u7a0b\u4eae\u70b9",id:"2\u8bfe\u7a0b\u4eae\u70b9",level:3},{value:"3\u3001\u8d44\u6599",id:"3\u8d44\u6599",level:3},{value:"\u7b2c\u4e00\u7ae0 \u7b80\u4ecb",id:"\u7b2c\u4e00\u7ae0-\u7b80\u4ecb",level:2},{value:"1\u3001\u6982\u5ff5",id:"1\u6982\u5ff5",level:3},{value:"2\u3001\u8ba4\u8bc1 \u9274\u6743",id:"2\u8ba4\u8bc1-\u9274\u6743",level:3},{value:"\u7b2c\u4e8c\u7ae0 \u5165\u95e8",id:"\u7b2c\u4e8c\u7ae0-\u5165\u95e8",level:2},{value:"1\u3001\u51c6\u5907web\u9879\u76ee",id:"1\u51c6\u5907web\u9879\u76ee",level:3},{value:"\uff081\uff09\u521b\u5efaspringboot web\u9879\u76ee",id:"1\u521b\u5efaspringboot-web\u9879\u76ee",level:4},{value:"2\u3001\u5f15\u5165SpringSecurity",id:"2\u5f15\u5165springsecurity",level:3},{value:"\uff081\uff09\u5f15\u5165\u4f9d\u8d56",id:"1\u5f15\u5165\u4f9d\u8d56",level:4},{value:"\uff082\uff09\u6d4b\u8bd5",id:"2\u6d4b\u8bd5",level:4},{value:"\uff083\uff09\u81ea\u5e26\u9000\u51fa",id:"3\u81ea\u5e26\u9000\u51fa",level:4},{value:"\u7b2c\u4e09\u7ae0 \u8ba4\u8bc1",id:"\u7b2c\u4e09\u7ae0-\u8ba4\u8bc1",level:2},{value:"1\u3001web\u767b\u9646\u6d41\u7a0b",id:"1web\u767b\u9646\u6d41\u7a0b",level:3},{value:"\u7f3a\u70b9\u53ef\u4ee5\u6539\u8fdb\uff1a",id:"\u7f3a\u70b9\u53ef\u4ee5\u6539\u8fdb",level:4},{value:"2\u3001\u770b\u6e90\u7801",id:"2\u770b\u6e90\u7801",level:3},{value:"\uff081\uff09springsecurity \u767b\u9646\u6d41\u7a0b",id:"1springsecurity-\u767b\u9646\u6d41\u7a0b",level:4},{value:"\uff082\uff09\u8ba4\u8bc1\u6d41\u7a0b \u518d\u7ec6\u5316\uff01 \u4e86\u89e3\uff0c\u540e\u671f\u56de\u5934\u770b",id:"2\u8ba4\u8bc1\u6d41\u7a0b-\u518d\u7ec6\u5316-\u4e86\u89e3\u540e\u671f\u56de\u5934\u770b",level:4},{value:"3\u3001\u81ea\u5b9a\u4e49\u767b\u5f55",id:"3\u81ea\u5b9a\u4e49\u767b\u5f55",level:3},{value:"\uff081\uff09\u601d\u8def",id:"1\u601d\u8def",level:4},{value:"\uff082\uff09 JWT\u7b80\u4ecb",id:"2-jwt\u7b80\u4ecb",level:4},{value:"a.\u6982\u5ff5",id:"a\u6982\u5ff5",level:5},{value:"b. JJWT\u7b7e\u53d1\u4e0e\u9a8c\u8bc1token",id:"b-jjwt\u7b7e\u53d1\u4e0e\u9a8c\u8bc1token",level:5},{value:"c. \u521b\u5efatoken",id:"c-\u521b\u5efatoken",level:5},{value:"d.\u89e3\u6790token",id:"d\u89e3\u6790token",level:5},{value:"e. \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4",id:"e-\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4",level:5},{value:"f.\u81ea\u5b9a\u4e49claims",id:"f\u81ea\u5b9a\u4e49claims",level:5},{value:"(3) \u51c6\u5907\u65b0\u9879\u76ee",id:"3-\u51c6\u5907\u65b0\u9879\u76ee",level:4},{value:"(4) \u5b9e\u73b0",id:"4-\u5b9e\u73b0",level:4},{value:"a. \u6570\u636e\u5e93\u6821\u9a8c\u7528\u6237",id:"a-\u6570\u636e\u5e93\u6821\u9a8c\u7528\u6237",level:5},{value:"b.\u5bc6\u7801\u52a0\u5bc6\u5b58\u50a8",id:"b\u5bc6\u7801\u52a0\u5bc6\u5b58\u50a8",level:5},{value:"c.\u81ea\u5b9a\u4e49\u767b\u9646\u63a5\u53e3",id:"c\u81ea\u5b9a\u4e49\u767b\u9646\u63a5\u53e3",level:5},{value:"d.\u8ba4\u8bc1\u8fc7\u6ee4\u5668",id:"d\u8ba4\u8bc1\u8fc7\u6ee4\u5668",level:5},{value:"e.\u9000\u51fa\u767b\u9646",id:"e\u9000\u51fa\u767b\u9646",level:5},{value:"\u7b2c\u56db\u7ae0 \u6388\u6743",id:"\u7b2c\u56db\u7ae0-\u6388\u6743",level:2},{value:"1\u3001\u6743\u9650\u7cfb\u7edf\u7684\u4f5c\u7528",id:"1\u6743\u9650\u7cfb\u7edf\u7684\u4f5c\u7528",level:3},{value:"2\u3001\u6388\u6743\u57fa\u672c\u6d41\u7a0b",id:"2\u6388\u6743\u57fa\u672c\u6d41\u7a0b",level:3},{value:"3\u3001\u6388\u6743\u5b9e\u73b0",id:"3\u6388\u6743\u5b9e\u73b0",level:3},{value:"\uff081\uff09\u9650\u5236\u8bbf\u95ee\u8d44\u6e90\u6240\u9700\u6743\u9650",id:"1\u9650\u5236\u8bbf\u95ee\u8d44\u6e90\u6240\u9700\u6743\u9650",level:4},{value:"\uff082\uff09 \u5c01\u88c5\u6743\u9650\u4fe1\u606f",id:"2-\u5c01\u88c5\u6743\u9650\u4fe1\u606f",level:4},{value:"\uff083\uff09\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u6743\u9650\u4fe1\u606f",id:"3\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u6743\u9650\u4fe1\u606f",level:4},{value:"a.RBAC\u6743\u9650\u6a21\u578b",id:"arbac\u6743\u9650\u6a21\u578b",level:5},{value:"b.\u51c6\u5907\u5de5\u4f5c",id:"b\u51c6\u5907\u5de5\u4f5c",level:5},{value:"c.\u4ee3\u7801\u5b9e\u73b0",id:"c\u4ee3\u7801\u5b9e\u73b0",level:5},{value:"\u7b2c\u4e94\u7ae0 \u81ea\u5b9a\u4e49\u5931\u8d25\u5904\u7406",id:"\u7b2c\u4e94\u7ae0-\u81ea\u5b9a\u4e49\u5931\u8d25\u5904\u7406",level:2},{value:"\u7b2c\u516d\u7ae0 \u8de8\u57df",id:"\u7b2c\u516d\u7ae0-\u8de8\u57df",level:2},{value:"1\u3001\u4ec0\u4e48\u662f\u8de8\u57df",id:"1\u4ec0\u4e48\u662f\u8de8\u57df",level:3},{value:"2\u3001CORS\u7b80\u4ecb",id:"2cors\u7b80\u4ecb",level:3},{value:"\u7b2c\u4e03\u7ae0 \u62d3\u5c55",id:"\u7b2c\u4e03\u7ae0-\u62d3\u5c55",level:2},{value:"1\u3001\u6240\u6709\u81ea\u5e26\u6743\u9650\u6821\u9a8c\u65b9\u6cd5",id:"1\u6240\u6709\u81ea\u5e26\u6743\u9650\u6821\u9a8c\u65b9\u6cd5",level:3},{value:"2\u3001\u81ea\u5b9a\u4e49\u6743\u9650\u6821\u9a8c\u65b9\u6cd5",id:"2\u81ea\u5b9a\u4e49\u6743\u9650\u6821\u9a8c\u65b9\u6cd5",level:3},{value:"3\u3001\u57fa\u4e8e\u914d\u7f6e\u7684\u6743\u9650\u63a7\u5236",id:"3\u57fa\u4e8e\u914d\u7f6e\u7684\u6743\u9650\u63a7\u5236",level:3},{value:"4\u3001CSRF",id:"4csrf",level:3},{value:"5\u3001\u8ba4\u8bc1\u6210\u529f\u5904\u7406\u5668",id:"5\u8ba4\u8bc1\u6210\u529f\u5904\u7406\u5668",level:3},{value:"6\u3001\u8ba4\u8bc1\u5931\u8d25\u5904\u7406\u5668",id:"6\u8ba4\u8bc1\u5931\u8d25\u5904\u7406\u5668",level:3},{value:"7\u3001\u767b\u51fa\u6210\u529f\u5904\u7406\u5668",id:"7\u767b\u51fa\u6210\u529f\u5904\u7406\u5668",level:3},{value:"\u7b2c\u516b\u7ae0 \u7559\u4e00\u540e\u624b",id:"\u7b2c\u516b\u7ae0-\u7559\u4e00\u540e\u624b",level:2}],u={toc:p};function c(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"8springsecurity"},"8.SpringSecurity"),(0,a.kt)("h2",{id:"\u8bfe\u7a0b\u6982\u8ff0"},"\u8bfe\u7a0b\u6982\u8ff0"),(0,a.kt)("h3",{id:"1\u4e3a\u4ec0\u4e48\u51fa\u8fd9\u95e8\u8bfe"},"1\u3001\u4e3a\u4ec0\u4e48\u51fa\u8fd9\u95e8\u8bfe"),(0,a.kt)("h4",{id:"1\u6211\u7684\u540e\u671f\u9879\u76ee\u8bfe\u90fd\u4f1a\u7528\u5230\u8fd9\u4e2a\u6280\u672f"},"\uff081\uff09\u6211\u7684\u540e\u671f\u9879\u76ee\u8bfe\uff0c\u90fd\u4f1a\u7528\u5230\u8fd9\u4e2a\u6280\u672f"),(0,a.kt)("h4",{id:"2-b\u7ad9\u627e\u4e86\u4e00\u4e0b\u6ca1\u6709\u6bd4\u8f83\u597d\u7684springsecurity\u8bfe\u7a0b"},"\uff082\uff09 B\u7ad9\u627e\u4e86\u4e00\u4e0b\uff0c\u6ca1\u6709\u6bd4\u8f83\u597d\u7684SpringSecurity\u8bfe\u7a0b"),(0,a.kt)("p",null," 1.2.1 \u8fc7\u4e8e\u7b80\u5355\u3002 java 1\u5468\u5165\u95e8\uff0c\u627e\u6253\u4e0d\u5230\u5de5\u4f5c\u3002 se ee \u6846\u67b6 \u5fae\u670d\u52a1 4-6\u4e2a\u6708\u3002\u627e\u5230\u5de5\u4f5c\u4e86\u3002"),(0,a.kt)("p",null," 1.2.2\u8fc7\u4e8e\u5197\u957f\u3002 se\uff0c900\u96c6\uff0c\u534a\u5e74\u65f6\u95f4\u3002\u4f7f\u7528\u4e8e\u5927\u4e00\u5f00\u59cb4\u5e74\u65f6\u95f4\u3002 \u77e5\u8bc6\u8fc7\u65f6\uff01"),(0,a.kt)("p",null," 1.2.3\u53ea\u662f\u4f1a\u7528\u3002 \u5feb\u901f\u4e0a\u624b\u89c6\u9891\u3002mycat\u5feb\u901f\u4e0a\u624b2\u5c0f\u65f6\u4e0a\u624b\u3002 \u5de5\u4f5c3\u5e74\u540e\uff0c\u5b66\u4e60\u65b0\u6280\u672f\u3002"),(0,a.kt)("p",null," 1.2.4\u672c\u672b\u5012\u7f6e\u3002\u5148\u8bf4\u6e90\u7801\uff0c\u518d\u8bf4\u600e\u4e48\u7528\u3002 \u5de5\u4f5c5\u5e74\u540e\uff0c\u76f8\u5f53\u67b6\u6784\u5e08\u3002"),(0,a.kt)("h3",{id:"2\u8bfe\u7a0b\u4eae\u70b9"},"2\u3001\u8bfe\u7a0b\u4eae\u70b9"),(0,a.kt)("p",null," 2.1\u9762\u5411\u4eba\u7fa4\uff1a\u5f00\u5b66\u5927\u56db\u4e86\uff0c\u9a6c\u4e0a\u9762\u4e34\u79cb\u62db \u6625\u62db\u3002 \u60f3\u8981\u505a\u4e2a\u5fae\u670d\u52a1\u9879\u76ee\u4e86\uff0c\u67e5\u6f0f\u8865\u7f3a\uff0c\u7f3aSpringSecurity\u6280\u672f\u524d\u7f6e\u8bfe\u7a0b\u3002"),(0,a.kt)("p",null," 2.2\u524d\u7f6e\uff1a ssm->boot"),(0,a.kt)("p",null," 2.3\u524d\u540e\u7aef\u5206\u79bb\u7684\u9879\u76ee\u6765\u5b66\u4e60\u3002"),(0,a.kt)("p",null," 2.4\u5e26\u7740\u5927\u5bb6\u4ece0\u5b66\u4e60SpringSecurity\u3002 \u6388\u4eba\u4ee5\u9c7c\u4e0d\u5982\u6388\u4eba\u4ee5\u6e14\u3002 \u5982\u4f55\u5b66\u4e60\uff0c\u5982\u4f55\u627ebug\uff01"),(0,a.kt)("p",null," 2.5\u5148\u4f1a\u4f7f\u7528\uff0c\u7136\u540e\u6211\u4eec\u5728\u770b\u6e90\u7801\u3002"),(0,a.kt)("h3",{id:"3\u8d44\u6599"},"3\u3001\u8d44\u6599"),(0,a.kt)("p",null,"\u4ee3\u7801\uff0cmd\u6587\u6863\u3002\u90fd\u4f1a\u5f00\u6e90\u5728\u6211\u4eec\u7684\u5b98\u7f51\u3002 ",(0,a.kt)("a",{parentName:"p",href:"http://www.ydlclass.com/"},"www.ydlclass.comopen in new window")),(0,a.kt)("h2",{id:"\u7b2c\u4e00\u7ae0-\u7b80\u4ecb"},"\u7b2c\u4e00\u7ae0 \u7b80\u4ecb"),(0,a.kt)("p",null,"SpringSecurity ",(0,a.kt)("a",{parentName:"p",href:"https://spring.io/projects/spring-security#overview"},"https://spring.io/projects/spring-security#overviewopen in new window")),(0,a.kt)("h3",{id:"1\u6982\u5ff5"},"1\u3001\u6982\u5ff5"),(0,a.kt)("p",null,"Spring\u5bb6\u65cf\u5f53\u4e2d\uff0c\u4e00\u4e2a\u5b89\u5168\u7ba1\u7406\u6846\u67b6\u3002"),(0,a.kt)("p",null,"Shiro\u4e5f\u662f\u4e00\u4e2a\u5b89\u5168\u6846\u67b6\uff0c\u63d0\u4f9b\u4e86\u5f88\u591a\u5b89\u5168\u529f\u80fd\u3002Shiro\u6bd4\u8f83\u8001\uff0c\u65e7\u7684\u9879\u76ee\u5f53\u4e2d\uff0c\u53ef\u80fd\u8fd8\u5728\u4f7f\u7528\u3002\u4e0a\u624b\u8fd8\u633a\u7b80\u5355\u3002"),(0,a.kt)("p",null,"\u5728\u65b0\u9879\u76ee\u5f53\u4e2d\uff0c\u4e00\u7ebf\u4e92\u8054\u7f51\u5927\u578b\u9879\u76ee\uff0c\u90fd\u662f\u4f7f\u7528SpringSecurity \u3002"),(0,a.kt)("h3",{id:"2\u8ba4\u8bc1-\u9274\u6743"},"2\u3001\u8ba4\u8bc1 \u9274\u6743"),(0,a.kt)("p",null,"\u4e00\u822c\u7684web\u9879\u76ee\u5f53\u4e2d\uff0c\u603b\u4f1a\u6709\u767b\u9646\u548c\u9274\u6743\u7684\u9700\u6c42\u3002\u4f46\u662f\u5927\u5bb6\u4e00\u5b9a\u8981\u533a\u5206\u5f00\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u8ba4\u8bc1"),"\uff1a\u9a8c\u8bc1\u5f53\u524d\u8bbf\u95ee\u7684\u7528\u6237\u662f\u4e0d\u662f\u672c\u7cfb\u7edf\u4e2d\u7684\u7528\u6237\u3002\u786e\u5b9a\u662f\u54ea\u4e00\u4e2a\u5177\u4f53\u7684\u7528\u6237\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"\u9274\u6743"),"\uff1a\u7ecf\u8fc7\u8ba4\u8bc1\uff0c\u5224\u65ad\u5f53\u524d\u767b\u9646\u7528\u6237\u6709\u6ca1\u6709\u6743\u9650\u6765\u6267\u884c\u67d0\u4e2a\u64cd\u4f5c\u3002")),(0,a.kt)("p",null,"\u6240\u4ee5\u8bf4\uff0c\u5b89\u5168\u6846\u67b6SpringSecurity \u5f53\u4e2d\uff0c\u5fc5\u5b9a\u4f1a\u6709\u8ba4\u8bc1\u548c\u9274\u6743\u7684\u4e24\u5927\u6838\u5fc3\u529f\u80fd\u3002"),(0,a.kt)("h2",{id:"\u7b2c\u4e8c\u7ae0-\u5165\u95e8"},"\u7b2c\u4e8c\u7ae0 \u5165\u95e8"),(0,a.kt)("h3",{id:"1\u51c6\u5907web\u9879\u76ee"},"1\u3001\u51c6\u5907web\u9879\u76ee"),(0,a.kt)("h4",{id:"1\u521b\u5efaspringboot-web\u9879\u76ee"},"\uff081\uff09\u521b\u5efaspringboot web\u9879\u76ee"),(0,a.kt)("p",null,"\u5feb\u901f\u6784\u5efa"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},"<dependencies>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-web</artifactId>\n    </dependency>\n\n    <dependency>\n        <groupId>org.projectlombok</groupId>\n        <artifactId>lombok</artifactId>\n        <version>1.18.22</version>\n    </dependency>\n\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-test</artifactId>\n        <scope>test</scope>\n    </dependency>\n</dependencies>\n")),(0,a.kt)("p",null,"\u521b\u5efacontroller"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'@RestController\n@RequestMapping("demo")\npublic class DemoController {\n\n    @GetMapping("hello")\n    public String hello(){\n        return "hello SpringSecurity.  ydlclass.com";\n    }\n}\n')),(0,a.kt)("p",null,"\u542f\u52a8 \u6d4b\u8bd5 \u8bbf\u95ee \uff1a",(0,a.kt)("a",{parentName:"p",href:"http://localhost:8080/demo/hello"},"http://localhost:8080/demo/helloopen in new window")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220820161603591-7a9326e1.png",alt:"image-20220820161603591"}),"image-20220820161603591"),(0,a.kt)("h3",{id:"2\u5f15\u5165springsecurity"},"2\u3001\u5f15\u5165SpringSecurity"),(0,a.kt)("h4",{id:"1\u5f15\u5165\u4f9d\u8d56"},"\uff081\uff09\u5f15\u5165\u4f9d\u8d56"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},"        \x3c!-- \u5f15\u5165security\u8d77\u6b65\u4f9d\u8d56 --\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-security</artifactId>\n        </dependency>\n")),(0,a.kt)("h4",{id:"2\u6d4b\u8bd5"},"\uff082\uff09\u6d4b\u8bd5"),(0,a.kt)("p",null,"\u8bbf\u95ee \uff1a ",(0,a.kt)("a",{parentName:"p",href:"http://localhost:8080/demo/hello"},"http://localhost:8080/demo/helloopen in new window")),(0,a.kt)("p",null,"Security \u81ea\u5e26\u7684\u767b\u9646\u9875\u9762"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220820161941164-cbb43a81.png",alt:"image-20220820161941164"}),"image-20220820161941164"),(0,a.kt)("p",null,"\u53ef\u4ee5\u8f93\u5165\u81ea\u5e26\u9ed8\u8ba4\u7528\u6237\u540d user \u548c \u5bc6\u7801(\u63a7\u5236\u53f0)"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220820162112307-c9cdee44.png",alt:"image-20220820162112307"}),"image-20220820162112307"),(0,a.kt)("p",null,"\u5c31\u80fd\u8bbf\u95ee\u5230\u6570\u636e\u4e86"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220820162139356-78857980.png",alt:"image-20220820162139356"}),"image-20220820162139356"),(0,a.kt)("h4",{id:"3\u81ea\u5e26\u9000\u51fa"},"\uff083\uff09\u81ea\u5e26\u9000\u51fa"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"http://localhost:8080/logout"},"http://localhost:8080/logoutopen in new window")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220820162224080-61bbcd0e.png",alt:"image-20220820162224080"}),"image-20220820162224080"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220820162245554-51886245.png",alt:"image-20220820162245554"}),"image-20220820162245554"),(0,a.kt)("h2",{id:"\u7b2c\u4e09\u7ae0-\u8ba4\u8bc1"},"\u7b2c\u4e09\u7ae0 \u8ba4\u8bc1"),(0,a.kt)("h3",{id:"1web\u767b\u9646\u6d41\u7a0b"},"1\u3001web\u767b\u9646\u6d41\u7a0b"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220820185333664-af9918b3.png",alt:"img"})),(0,a.kt)("h4",{id:"\u7f3a\u70b9\u53ef\u4ee5\u6539\u8fdb"},"\u7f3a\u70b9\u53ef\u4ee5\u6539\u8fdb\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u73b0\u5728\u4f7f\u7528\u7684\u662fsecurity\u81ea\u5e26\u7684\u767b\u9646\u9875\u9762\uff0c\u6bd4\u8f83\u4e11\u3002 \u60f3\u6362\u6210\u81ea\u5df1\u9879\u76ee\u7684\uff0c\u4f18\u5316\u7684\u767b\u5f55\u9875\u3002"),(0,a.kt)("li",{parentName:"ol"},"\u7528\u6237\u4f7f\u7528\u7684\u662fsecurity\u7ed9\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002 \u60f3\u771f\u5b9e\u5730\u53bb\u6570\u636e\u5e93\u91cc\uff0ctb_user\u83b7\u53d6\u771f\u5b9e\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002"),(0,a.kt)("li",{parentName:"ol"},"security\u81ea\u5e26\u7684cookie\\session\u6a21\u5f0f\u3002 \u60f3\u81ea\u5df1\u751f\u6210jwt\uff0c\u65e0\u72b6\u6001\u767b\u9646\u3002"),(0,a.kt)("li",{parentName:"ol"},"\u524d\u7aef\u9875\u9762\u600e\u4e48\u643a\u5e26jwt\u3002 \u60f3\u8bf7\u6c42\u5934\u91cc\u5e26\u4e0a\u3002"),(0,a.kt)("li",{parentName:"ol"},"\u9274\u6743\u64cd\u4f5c\u5b8c\u5168\u6ca1\u6709\u3002 \u60f3\u9274\u6743\u505a\u5b8c\u5584\u3002")),(0,a.kt)("p",null,"\u603b\u800c\u8a00\u4e4b\uff0c\u81ea\u5df1\u7684\u4e00\u4e9b\u7279\u5b9a\u9700\u6c42\uff0c\u90fd\u6ca1\u6709\u5b9e\u73b0\u3002"),(0,a.kt)("h3",{id:"2\u770b\u6e90\u7801"},"2\u3001\u770b\u6e90\u7801"),(0,a.kt)("p",null,"springsecurity \u5c31\u662f\u901a\u8fc7\u4e00\u4e9b\u8fc7\u6ee4\u5668\u3001\u62e6\u622a\u5668\uff0c\u5b9e\u73b0\u767b\u9646\u9274\u6743\u7684\u6d41\u7a0b\u7684\u3002"),(0,a.kt)("h4",{id:"1springsecurity-\u767b\u9646\u6d41\u7a0b"},"\uff081\uff09springsecurity \u767b\u9646\u6d41\u7a0b"),(0,a.kt)("p",null,"springsecurity\u5c31\u662f\u4e00\u4e2a\u8fc7\u6ee4\u5668\u94fe\uff0c\u5185\u7f6e\u4e86\u5173\u4e8espringsecurity\u768416\u7684\u8fc7\u6ee4\u5668\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220820193848980-53da0743.png",alt:"image-20220820193848980"}),"image-20220820193848980"),(0,a.kt)("p",null,"\u6ce8\u610f\uff1a\u6211\u53ea\u5199\u51fa\u4e86\u51e0\u4e2a\u6838\u5fc3\u8fc7\u6ee4\u5668\uff0c\u5176\u4ed6\u7684\u5982\u4e0b\u56fe\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"UsernamePasswordAuthenticationFilter"),"\uff1a\u5904\u7406\u6211\u4eec\u767b\u9646\u9875\u9762\u8f93\u5165\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u662f\u5426\u6b63\u786e\u7684\u8fc7\u6ee4\u5668\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"ExceptionTranslationFilter"),"\uff1a\u5904\u7406\u524d\u9762\u7684\u51e0\u4e2a\u8fc7\u6ee4\u5668\u4e2d\uff0c\u6709\u4e86\u95ee\u9898\uff0c\u629b\u51fa\u9519\u8bef\uff0c\u4e0d\u8ba9\u7528\u6237\u767b\u5f55\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"FilterSecurityInterceptor"),"\uff1a\u7ecf\u884c\u4e00\u4e2a\u6743\u9650\u6821\u9a8c\u7684\u62e6\u622a\u5668\u3002")),(0,a.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u627e\u5230\u5f53\u524dboot\u9879\u76ee\u4e2d\u7684\uff0c\u6240\u6709\u6709\u5173security\u7684\u8fc7\u6ee4\u5668\u94fe\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220820193032051-5e31fbca.png",alt:"image-20220820193032051"}),"image-20220820193032051"),(0,a.kt)("h4",{id:"2\u8ba4\u8bc1\u6d41\u7a0b-\u518d\u7ec6\u5316-\u4e86\u89e3\u540e\u671f\u56de\u5934\u770b"},"\uff082\uff09\u8ba4\u8bc1\u6d41\u7a0b \u518d\u7ec6\u5316\uff01 \u4e86\u89e3\uff0c\u540e\u671f\u56de\u5934\u770b"),(0,a.kt)("p",null,"\u770b\u6211\u5982\u4f55debug ",(0,a.kt)("strong",{parentName:"p"},"UsernamePasswordAuthenticationFilter")," \u8fd0\u884c\u673a\u5236"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220821175458416-57c8e429.png",alt:"image-20220821175458416"}),"image-20220821175458416"),(0,a.kt)("h3",{id:"3\u81ea\u5b9a\u4e49\u767b\u5f55"},"3\u3001\u81ea\u5b9a\u4e49\u767b\u5f55"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822014000886-f37aa999.png",alt:"image-20220822014000886"}),"image-20220822014000886"),(0,a.kt)("h4",{id:"1\u601d\u8def"},"\uff081\uff09\u601d\u8def"),(0,a.kt)("p",null,"\u767b\u9646\uff1a 1\u81ea\u5b9a\u4e49\u767b\u5f55\u63a5\u53e3"),(0,a.kt)("p",null," \u8c03\u7528prodivermanager auth\u65b9\u6cd5"),(0,a.kt)("p",null," \u767b\u9646\u6210\u529f\u751f\u6210jwt"),(0,a.kt)("p",null," \u5b58\u5165redis"),(0,a.kt)("p",null," 2\u81ea\u5b9a\u4e49userdetailsmanager\u5b9e\u73b0\u7c7b"),(0,a.kt)("p",null," \u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u7cfb\u7edf\u7528\u6237"),(0,a.kt)("p",null,"\u8bbf\u95ee\u8d44\u6e90\uff1a\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u8fc7\u6ee4\u5668"),(0,a.kt)("p",null," \u83b7\u53d6token"),(0,a.kt)("p",null," \u4ecetoken\u4e2d\u83b7\u53d6userid"),(0,a.kt)("p",null," \u4eceredis\u4e2d\u901a\u8fc7userid\u83b7\u53d6\u7528\u6237\u4fe1\u606f"),(0,a.kt)("p",null," \u5b58SecurityContextHolder"),(0,a.kt)("h4",{id:"2-jwt\u7b80\u4ecb"},"\uff082\uff09 JWT\u7b80\u4ecb"),(0,a.kt)("h5",{id:"a\u6982\u5ff5"},"a.\u6982\u5ff5"),(0,a.kt)("p",null,"JSON Web Token\uff08JWT\uff09\u662f\u4e00\u4e2a\u975e\u5e38\u8f7b\u5de7\u7684\u89c4\u8303\u3002\u8fd9\u4e2a\u89c4\u8303\u5141\u8bb8\u6211\u4eec\u4f7f\u7528JWT\u5728\u7528\u6237\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4f20\u9012\u5b89\u5168\u53ef\u9760\u7684\u4fe1\u606f\u3002\u65e0\u72b6\u6001\u3002"),(0,a.kt)("p",null,"\u597d\u5904\uff1a\u4e0d\u9700\u8981\u670d\u52a1\u5668\u7aef \u5b58session\u3002"),(0,a.kt)("p",null,"\u7279\u70b9\uff1a\u53ef\u4ee5\u5457\u770b\u5230\uff0c\u4f46\u662f\u4e0d\u80fd\u7be1\u6539\uff0c\u56e0\u4e3a\u7b2c\u4e09\u90e8\u5206\u7528\u4e86\u79d8\u94a5\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4e00\u4e2aJWT\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5b83\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff0c\u5934\u90e8\u3001\u8f7d\u8377\u4e0e\u7b7e\u540d\u3002")," asdf.asdf.asdf"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5934\u90e8\uff08Header\uff09")),(0,a.kt)("p",null,"\u5934\u90e8\u7528\u4e8e\u63cf\u8ff0\u5173\u4e8e\u8be5JWT\u7684\u6700\u57fa\u672c\u7684\u4fe1\u606f\uff0c\u4f8b\u5982\u5176\u7c7b\u578b\u4ee5\u53ca\u7b7e\u540d\u6240\u7528\u7684\u7b97\u6cd5\u7b49\u3002\u8fd9\u4e5f\u53ef\u4ee5\u88ab\u8868\u793a\u6210\u4e00\u4e2aJSON\u5bf9\u8c61\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},'{"typ":"JWT","alg":"HS256"}\n')),(0,a.kt)("p",null,"\u5728\u5934\u90e8\u6307\u660e\u4e86\u7b7e\u540d\u7b97\u6cd5\u662fHS256\u7b97\u6cd5\u3002 \u6211\u4eec\u8fdb\u884cBASE64\u7f16\u7801",(0,a.kt)("a",{parentName:"p",href:"https://base64.us/%EF%BC%8C%E7%BC%96%E7%A0%81%E5%90%8E%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A6%82%E4%B8%8B%EF%BC%9A"},"https://base64.us/\uff0c\u7f16\u7801\u540e\u7684\u5b57\u7b26\u4e32\u5982\u4e0b\uff1aopen in new window")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8f7d\u8377\uff08playload\uff09")),(0,a.kt)("p",null,"\u8f7d\u8377\u5c31\u662f\u5b58\u653e\u6709\u6548\u4fe1\u606f\u7684\u5730\u65b9\u3002"),(0,a.kt)("p",null,"\u5b9a\u4e49\u4e00\u4e2apayload:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},'{"sub":"1234567890","name":"itlils","admin":true,"age":18}\n')),(0,a.kt)("p",null,"\u7136\u540e\u5c06\u5176\u8fdb\u884cbase64\u52a0\u5bc6\uff0c\u5f97\u5230Jwt\u7684\u7b2c\u4e8c\u90e8\u5206\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6Iml0bGlscyIsImFkbWluIjp0cnVlLCJhZ2UiOjE4fQ==\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7b7e\u8bc1\uff08signature\uff09")),(0,a.kt)("p",null,"jwt\u7684\u7b2c\u4e09\u90e8\u5206\u662f\u4e00\u4e2a\u7b7e\u8bc1\u4fe1\u606f\uff0c\u8fd9\u4e2a\u7b7e\u8bc1\u4fe1\u606f\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"header (base64\u540e\u7684)"),(0,a.kt)("p",{parentName:"blockquote"},"payload (base64\u540e\u7684)"),(0,a.kt)("p",{parentName:"blockquote"},"secret")),(0,a.kt)("p",null,"\u8fd9\u4e2a\u90e8\u5206\u9700\u8981base64\u52a0\u5bc6\u540e\u7684header\u548cbase64\u52a0\u5bc6\u540e\u7684payload\u4f7f\u7528.\u8fde\u63a5\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u901a\u8fc7header\u4e2d\u58f0\u660e\u7684\u52a0\u5bc6\u65b9\u5f0f\u8fdb\u884c\u52a0\u76d0secret\u7ec4\u5408\u52a0\u5bc6\uff0c\u7136\u540e\u5c31\u6784\u6210\u4e86jwt\u7684\u7b2c\u4e09\u90e8\u5206\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},'hs256("eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6Iml0bGlscyIsImFkbWluIjp0cnVlLCJhZ2UiOjE4fQ==",secret)\n')),(0,a.kt)("p",null,"\u5c06\u8fd9\u4e09\u90e8\u5206\u7528.\u8fde\u63a5\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u5b57\u7b26\u4e32,\u6784\u6210\u4e86\u6700\u7ec8\u7684jwt:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"JTdCJTIydHlwJTIyJTNBJTIySldUJTIyJTJDJTIyYWxnJTIyJTNBJTIySFMyNTYlMjIlN0Q=.JTdCJTIyc3ViJTIyJTNBJTIyMTIzNDU2Nzg5MCUyMiUyQyUyMm5hbWUlMjIlM0ElMjJqYWNrJTIyJTJDJTIyYWRtaW4lMjIlM0F0cnVlJTdE.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ\n")),(0,a.kt)("h5",{id:"b-jjwt\u7b7e\u53d1\u4e0e\u9a8c\u8bc1token"},"b. JJWT\u7b7e\u53d1\u4e0e\u9a8c\u8bc1token"),(0,a.kt)("p",null,"JJWT\u662f\u4e00\u4e2a\u63d0\u4f9b\u7aef\u5230\u7aef\u7684JWT\u521b\u5efa\u548c\u9a8c\u8bc1\u7684Java\u5e93\u3002\u6c38\u8fdc\u514d\u8d39\u548c\u5f00\u6e90(Apache License\uff0c\u7248\u672c2.0)\uff0cJJWT\u5f88\u5bb9\u6613\u4f7f\u7528\u548c\u7406\u89e3\u3002\u5b83\u88ab\u8bbe\u8ba1\u6210\u4e00\u4e2a\u4ee5\u5efa\u7b51\u4e3a\u4e2d\u5fc3\u7684\u6d41\u7545\u754c\u9762\uff0c\u9690\u85cf\u4e86\u5b83\u7684\u5927\u90e8\u5206\u590d\u6742\u6027\u3002"),(0,a.kt)("p",null,"\u5b98\u65b9\u6587\u6863\uff1a"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/jwtk/jjwt"},"https://github.com/jwtk/jjwtopen in new window")),(0,a.kt)("h5",{id:"c-\u521b\u5efatoken"},"c. \u521b\u5efatoken"),(0,a.kt)("p",null,"\uff081\uff09\u65b0\u5efa\u9879\u76eejwtTest\u4e2d\u7684pom.xml\u4e2d\u6dfb\u52a0\u4f9d\u8d56\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>io.jsonwebtoken</groupId>\n    <artifactId>jjwt</artifactId>\n    <version>0.9.0</version>\n</dependency>\n")),(0,a.kt)("p",null,"(2) \u521b\u5efa\u6d4b\u8bd5\u7c7b\uff0c\u4ee3\u7801\u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'        public static void main(String[] args) {\n                JwtBuilder jwtBuilder = Jwts.builder()\n                        .setId("666")//\u8bbe\u7f6eid\n                        .setSubject("testJwt")//\u4e3b\u9898\n                        .setIssuedAt(new Date())//\u7b7e\u53d1\u65e5\u671f\n                        .signWith(SignatureAlgorithm.HS256, "itlils");\n                String jwt = jwtBuilder.compact();\n                System.out.println(jwt);\n        }\n')),(0,a.kt)("p",null,"\u8fd0\u884c\u6253\u5370\u7ed3\u679c\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI2NjYiLCJzdWIiOiJ0ZXN0Snd0IiwiaWF0IjoxNjYxMDc3MjIxfQ.MJBEuwatBTCUNRw8UslNRzCG1obGUly0rQKMXA0XvFA\n")),(0,a.kt)("p",null,"\u518d\u6b21\u8fd0\u884c\uff0c\u4f1a\u53d1\u73b0\u6bcf\u6b21\u8fd0\u884c\u7684\u7ed3\u679c\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u8f7d\u8377\u4e2d\u5305\u542b\u4e86\u65f6\u95f4\u3002"),(0,a.kt)("p",null,"\u9a8c\u8bc1base64 ",(0,a.kt)("a",{parentName:"p",href:"https://tool.oschina.net/encrypt?type=3"},"https://tool.oschina.net/encrypt?type=3open in new window")),(0,a.kt)("h5",{id:"d\u89e3\u6790token"},"d.\u89e3\u6790token"),(0,a.kt)("p",null,"\u6211\u4eec\u521a\u624d\u5df2\u7ecf\u521b\u5efa\u4e86token \uff0c\u5728web\u5e94\u7528\u4e2d\u8fd9\u4e2a\u64cd\u4f5c\u662f\u7531\u670d\u52a1\u7aef\u8fdb\u884c\u7136\u540e\u53d1\u7ed9\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u5728\u4e0b\u6b21\u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\u65f6\u9700\u8981\u643a\u5e26\u8fd9\u4e2atoken\uff08\u8fd9\u5c31\u597d\u50cf\u662f\u62ff\u7740\u4e00\u5f20\u95e8\u7968\u4e00\u6837\uff09\uff0c\u90a3\u670d\u52a1\u7aef\u63a5\u5230\u8fd9\u4e2atoken \u5e94\u8be5\u89e3\u6790\u51fatoken\u4e2d\u7684\u4fe1\u606f\uff08\u4f8b\u5982\u7528\u6237id\uff09,\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u67e5\u8be2\u6570\u636e\u5e93\u8fd4\u56de\u76f8\u5e94\u7684\u7ed3\u679c\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'String compactJwt="eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI2NjYiLCJzdWIiOiJ0ZXN0Snd0IiwiaWF0IjoxNjYxMDc3MjIxfQ.MJBEuwatBTCUNRw8UslNRzCG1obGUly0rQKMXA0XvFA";\n\nClaims claims = Jwts.parser().setSigningKey("itlils").parseClaimsJws(compactJwt).getBody();\n\nSystem.out.println(claims);\n')),(0,a.kt)("p",null,"\u8fd0\u884c\u6253\u5370\u6548\u679c\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"{jti=666, sub=testJwt, iat=1661077221}\n")),(0,a.kt)("p",null,"\u8bd5\u7740\u5c06token\u6216\u7b7e\u540d\u79d8\u94a5\u7be1\u6539\u4e00\u4e0b\uff0c\u4f1a\u53d1\u73b0\u8fd0\u884c\u65f6\u5c31\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u89e3\u6790token\u4e5f\u5c31\u662f\u9a8c\u8bc1token."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u6ce8\u610f"),"\uff1a\u8bbe\u7f6e\u7b7e\u540dkey\u5fc5\u987b\u548c\u751f\u6210\u65f6\u4e00\u81f4\u3002"),(0,a.kt)("h5",{id:"e-\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4"},"e. \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4"),(0,a.kt)("p",null,"\u6709\u5f88\u591a\u65f6\u5019\uff0c\u6211\u4eec\u5e76\u4e0d\u5e0c\u671b\u7b7e\u53d1\u7684token\u662f\u6c38\u4e45\u751f\u6548\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4e3atoken\u6dfb\u52a0\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\u3002"),(0,a.kt)("p",null,"\uff081\uff09\u521b\u5efatoken \u5e76\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'public static void main(String[] args) {\n\n                //\u5f53\u524d\u65f6\u95f4\n                long l = System.currentTimeMillis();\n                System.out.println(l);\n                Date date=new Date(l+10000);\n\n                JwtBuilder jwtBuilder = Jwts.builder()\n                        .setId("666")//\u8bbe\u7f6eid\n                        .setSubject("testJwt")//\u4e3b\u9898\n                        .setIssuedAt(new Date())//\u7b7e\u53d1\u65e5\u671f\n                        .setExpiration(date)//\u8fc7\u671f\u65f6\u95f4\n                        .signWith(SignatureAlgorithm.HS256, "itlils");\n                String jwt = jwtBuilder.compact();\n                System.out.println(jwt);\n\n                try {\n                        Thread.sleep(15000);\n                } catch (InterruptedException e) {\n                        throw new RuntimeException(e);\n                }\n\n                Claims itlils = Jwts.parser().setSigningKey("itlils").parseClaimsJws(jwt).getBody();\n                System.out.println(itlils);\n        }\n')),(0,a.kt)("p",null,"\u89e3\u91ca\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},".setExpiration(date)//\u7528\u4e8e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4 \uff0c\u53c2\u6570\u4e3aDate\u7c7b\u578b\u6570\u636e\n")),(0,a.kt)("p",null,"\u8fd0\u884c\uff0c\u6253\u5370\u6548\u679c\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI4ODgiLCJzdWIiOiLlsI_nmb0iLCJpYXQiOjE1NTc5MDUzMDgsImV4cCI6MTU1NzkwNTMwOH0.4q5AaTyBRf8SB9B3Tl-I53PrILGyicJC3fgR3gWbvUI\n")),(0,a.kt)("p",null,"\uff082\uff09\u89e3\u6790TOKEN"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'String compactJwt="eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI4ODgiLCJzdWIiOiLlsI_nmb0iLCJpYXQiOjE1NTc5MDUzMDgsImV4cCI6MTU1NzkwNTMwOH0.4q5AaTyBRf8SB9B3Tl-I53PrILGyicJC3fgR3gWbvUI";\n\nClaims claims = Jwts.parser().setSigningKey("ydlershe").parseClaimsJws(compactJwt).getBody();\n\nSystem.out.println(claims);\n')),(0,a.kt)("p",null,"\u6253\u5370\u6548\u679c\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220821182626287-32e4bd92.png",alt:"image-20220821182626287"}),"image-20220821182626287"),(0,a.kt)("p",null,"\u5f53\u524d\u65f6\u95f4\u8d85\u8fc7\u8fc7\u671f\u65f6\u95f4\uff0c\u5219\u4f1a\u62a5\u9519\u3002"),(0,a.kt)("h5",{id:"f\u81ea\u5b9a\u4e49claims"},"f.\u81ea\u5b9a\u4e49claims"),(0,a.kt)("p",null,"\u6211\u4eec\u521a\u624d\u7684\u4f8b\u5b50\u53ea\u662f\u5b58\u50a8\u4e86id\u548csubject\u4e24\u4e2a\u4fe1\u606f\uff0c\u5982\u679c\u4f60\u60f3\u5b58\u50a8\u66f4\u591a\u7684\u4fe1\u606f\uff08\u4f8b\u5982\u89d2\u8272\uff09\u53ef\u4ee5\u5b9a\u4e49\u81ea\u5b9a\u4e49claims\u3002"),(0,a.kt)("p",null,"\u521b\u5efa\u6d4b\u8bd5\u7c7b\uff0c\u5e76\u8bbe\u7f6e\u6d4b\u8bd5\u65b9\u6cd5\uff1a"),(0,a.kt)("p",null,"\u521b\u5efatoken:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'        public static void main(String[] args) {\n\n                //\u5f53\u524d\u65f6\u95f4\n                long l = System.currentTimeMillis();\n                System.out.println(l);\n                Date date=new Date(l+10000);\n\n                JwtBuilder jwtBuilder = Jwts.builder()\n                        .setId("666")//\u8bbe\u7f6eid\n                        .setSubject("testJwt")//\u4e3b\u9898\n                        .setIssuedAt(new Date())//\u7b7e\u53d1\u65e5\u671f\n                        .claim("userId","123")\n//                        .setExpiration(date)//\u8fc7\u671f\u65f6\u95f4\n                        .signWith(SignatureAlgorithm.HS256, "itlils");\n                String jwt = jwtBuilder.compact();\n                System.out.println(jwt);\n\n//                try {\n//                        Thread.sleep(15000);\n//                } catch (InterruptedException e) {\n//                        throw new RuntimeException(e);\n//                }\n\n                Claims itlils = Jwts.parser().setSigningKey("itlils").parseClaimsJws(jwt).getBody();\n                System.out.println(itlils);\n        }\n')),(0,a.kt)("p",null,"\u8fd0\u884c\u6548\u679c\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220821182904798-166f9580.png",alt:"image-20220821182904798"}),"image-20220821182904798"),(0,a.kt)("h4",{id:"3-\u51c6\u5907\u65b0\u9879\u76ee"},"(3) \u51c6\u5907\u65b0\u9879\u76ee"),(0,a.kt)("p",null,"AuthDemo"),(0,a.kt)("p",null,"\u2460\u6dfb\u52a0\u4f9d\u8d56"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},"        \x3c!--redis\u4f9d\u8d56--\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-redis</artifactId>\n        </dependency>\n        \x3c!--fastjson\u4f9d\u8d56--\x3e\n        <dependency>\n            <groupId>com.alibaba</groupId>\n            <artifactId>fastjson</artifactId>\n            <version>1.2.33</version>\n        </dependency>\n        \x3c!--jwt\u4f9d\u8d56--\x3e\n        <dependency>\n            <groupId>io.jsonwebtoken</groupId>\n            <artifactId>jjwt</artifactId>\n            <version>0.9.0</version>\n        </dependency>\n")),(0,a.kt)("p",null,"\u2461 \u6dfb\u52a0Redis\u76f8\u5173\u914d\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'import com.alibaba.fastjson.JSON;\nimport com.alibaba.fastjson.serializer.SerializerFeature;\nimport com.fasterxml.jackson.databind.JavaType;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.fasterxml.jackson.databind.type.TypeFactory;\nimport org.springframework.data.redis.serializer.RedisSerializer;\nimport org.springframework.data.redis.serializer.SerializationException;\nimport com.alibaba.fastjson.parser.ParserConfig;\nimport org.springframework.util.Assert;\nimport java.nio.charset.Charset;\n\n/**\n * Redis\u4f7f\u7528FastJson\u5e8f\u5217\u5316\n * \n * @author itlils\n */\npublic class FastJsonRedisSerializer<T> implements RedisSerializer<T>\n{\n\n    public static final Charset DEFAULT_CHARSET = Charset.forName("UTF-8");\n\n    private Class<T> clazz;\n\n    static\n    {\n        ParserConfig.getGlobalInstance().setAutoTypeSupport(true);\n    }\n\n    public FastJsonRedisSerializer(Class<T> clazz)\n    {\n        super();\n        this.clazz = clazz;\n    }\n\n    @Override\n    public byte[] serialize(T t) throws SerializationException\n    {\n        if (t == null)\n        {\n            return new byte[0];\n        }\n        return JSON.toJSONString(t, SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET);\n    }\n\n    @Override\n    public T deserialize(byte[] bytes) throws SerializationException\n    {\n        if (bytes == null || bytes.length <= 0)\n        {\n            return null;\n        }\n        String str = new String(bytes, DEFAULT_CHARSET);\n\n        return JSON.parseObject(str, clazz);\n    }\n\n\n    protected JavaType getJavaType(Class<?> clazz)\n    {\n        return TypeFactory.defaultInstance().constructType(clazz);\n    }\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'import org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\n@Configuration\npublic class RedisConfig {\n\n    @Bean\n    @SuppressWarnings(value = { "unchecked", "rawtypes" })\n    public RedisTemplate<Object, Object> redisTemplate(RedisConnectionFactory connectionFactory)\n    {\n        RedisTemplate<Object, Object> template = new RedisTemplate<>();\n        template.setConnectionFactory(connectionFactory);\n\n        FastJsonRedisSerializer serializer = new FastJsonRedisSerializer(Object.class);\n\n        // \u4f7f\u7528StringRedisSerializer\u6765\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316redis\u7684key\u503c\n        template.setKeySerializer(new StringRedisSerializer());\n        template.setValueSerializer(serializer);\n\n        // Hash\u7684key\u4e5f\u91c7\u7528StringRedisSerializer\u7684\u5e8f\u5217\u5316\u65b9\u5f0f\n        template.setHashKeySerializer(new StringRedisSerializer());\n        template.setHashValueSerializer(serializer);\n\n        template.afterPropertiesSet();\n        return template;\n    }\n}\n')),(0,a.kt)("p",null,"\u2462 \u54cd\u5e94\u7c7b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"import com.fasterxml.jackson.annotation.JsonInclude;\n\n\n@JsonInclude(JsonInclude.Include.NON_NULL)\npublic class ResponseResult<T> {\n    /**\n     * \u72b6\u6001\u7801\n     */\n    private Integer code;\n    /**\n     * \u63d0\u793a\u4fe1\u606f\uff0c\u5982\u679c\u6709\u9519\u8bef\u65f6\uff0c\u524d\u7aef\u53ef\u4ee5\u83b7\u53d6\u8be5\u5b57\u6bb5\u8fdb\u884c\u63d0\u793a\n     */\n    private String msg;\n    /**\n     * \u67e5\u8be2\u5230\u7684\u7ed3\u679c\u6570\u636e\uff0c\n     */\n    private T data;\n\n    public ResponseResult(Integer code, String msg) {\n        this.code = code;\n        this.msg = msg;\n    }\n\n    public ResponseResult(Integer code, T data) {\n        this.code = code;\n        this.data = data;\n    }\n\n    public Integer getCode() {\n        return code;\n    }\n\n    public void setCode(Integer code) {\n        this.code = code;\n    }\n\n    public String getMsg() {\n        return msg;\n    }\n\n    public void setMsg(String msg) {\n        this.msg = msg;\n    }\n\n    public T getData() {\n        return data;\n    }\n\n    public void setData(T data) {\n        this.data = data;\n    }\n\n    public ResponseResult(Integer code, String msg, T data) {\n        this.code = code;\n        this.msg = msg;\n        this.data = data;\n    }\n}\n")),(0,a.kt)("p",null,"\u2463\u5de5\u5177\u7c7b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'import io.jsonwebtoken.Claims;\nimport io.jsonwebtoken.JwtBuilder;\nimport io.jsonwebtoken.Jwts;\nimport io.jsonwebtoken.SignatureAlgorithm;\n\nimport javax.crypto.SecretKey;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.util.Base64;\nimport java.util.Date;\nimport java.util.UUID;\n\n/**\n * JWT\u5de5\u5177\u7c7b\n */\npublic class JwtUtil {\n\n    //\u6709\u6548\u671f\u4e3a\n    public static final Long JWT_TTL = 60 * 60 *1000L;// 60 * 60 *1000  \u4e00\u4e2a\u5c0f\u65f6\n    //\u8bbe\u7f6e\u79d8\u94a5\u660e\u6587\n    public static final String JWT_KEY = "itlils";\n\n    public static String getUUID(){\n        String token = UUID.randomUUID().toString().replaceAll("-", "");\n        return token;\n    }\n    \n    /**\n     * \u751f\u6210jtw\n     * @param subject token\u4e2d\u8981\u5b58\u653e\u7684\u6570\u636e\uff08json\u683c\u5f0f\uff09\n     * @return\n     */\n    public static String createJWT(String subject) {\n        JwtBuilder builder = getJwtBuilder(subject, null, getUUID());// \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\n        return builder.compact();\n    }\n\n    /**\n     * \u751f\u6210jtw\n     * @param subject token\u4e2d\u8981\u5b58\u653e\u7684\u6570\u636e\uff08json\u683c\u5f0f\uff09\n     * @param ttlMillis token\u8d85\u65f6\u65f6\u95f4\n     * @return\n     */\n    public static String createJWT(String subject, Long ttlMillis) {\n        JwtBuilder builder = getJwtBuilder(subject, ttlMillis, getUUID());// \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\n        return builder.compact();\n    }\n\n    private static JwtBuilder getJwtBuilder(String subject, Long ttlMillis, String uuid) {\n        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;\n        SecretKey secretKey = generalKey();\n        long nowMillis = System.currentTimeMillis();\n        Date now = new Date(nowMillis);\n        if(ttlMillis==null){\n            ttlMillis=JwtUtil.JWT_TTL;\n        }\n        long expMillis = nowMillis + ttlMillis;\n        Date expDate = new Date(expMillis);\n        return Jwts.builder()\n                .setId(uuid)              //\u552f\u4e00\u7684ID\n                .setSubject(subject)   // \u4e3b\u9898  \u53ef\u4ee5\u662fJSON\u6570\u636e\n                .setIssuer("ydlclass")     // \u7b7e\u53d1\u8005\n                .setIssuedAt(now)      // \u7b7e\u53d1\u65f6\u95f4\n                .signWith(signatureAlgorithm, secretKey) //\u4f7f\u7528HS256\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u7b7e\u540d, \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u79d8\u94a5\n                .setExpiration(expDate);\n    }\n\n    /**\n     * \u521b\u5efatoken\n     * @param id\n     * @param subject\n     * @param ttlMillis\n     * @return\n     */\n    public static String createJWT(String id, String subject, Long ttlMillis) {\n        JwtBuilder builder = getJwtBuilder(subject, ttlMillis, id);// \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\n        return builder.compact();\n    }\n\n\n    /**\n     * \u751f\u6210\u52a0\u5bc6\u540e\u7684\u79d8\u94a5 secretKey\n     * @return\n     */\n    public static SecretKey generalKey() {\n        byte[] encodedKey = Base64.getDecoder().decode(JwtUtil.JWT_KEY);\n        SecretKey key = new SecretKeySpec(encodedKey, 0, encodedKey.length, "AES");\n        return key;\n    }\n    \n    /**\n     * \u89e3\u6790\n     *\n     * @param jwt\n     * @return\n     * @throws Exception\n     */\n    public static Claims parseJWT(String jwt) throws Exception {\n        SecretKey secretKey = generalKey();\n        return Jwts.parser()\n                .setSigningKey(secretKey)\n                .parseClaimsJws(jwt)\n                .getBody();\n    }\n\n\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.utils;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.data.redis.core.BoundSetOperations;\nimport org.springframework.data.redis.core.HashOperations;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.ValueOperations;\nimport org.springframework.stereotype.Component;\n\nimport java.util.*;\nimport java.util.concurrent.TimeUnit;\n\n@SuppressWarnings(value = { "unchecked", "rawtypes" })\n@Component\npublic class RedisCache\n{\n    @Autowired\n    public RedisTemplate redisTemplate;\n\n    /**\n     * \u7f13\u5b58\u57fa\u672c\u7684\u5bf9\u8c61\uff0cInteger\u3001String\u3001\u5b9e\u4f53\u7c7b\u7b49\n     *\n     * @param key \u7f13\u5b58\u7684\u952e\u503c\n     * @param value \u7f13\u5b58\u7684\u503c\n     */\n    public <T> void setCacheObject(final String key, final T value)\n    {\n        redisTemplate.opsForValue().set(key, value);\n    }\n\n    /**\n     * \u7f13\u5b58\u57fa\u672c\u7684\u5bf9\u8c61\uff0cInteger\u3001String\u3001\u5b9e\u4f53\u7c7b\u7b49\n     *\n     * @param key \u7f13\u5b58\u7684\u952e\u503c\n     * @param value \u7f13\u5b58\u7684\u503c\n     * @param timeout \u65f6\u95f4\n     * @param timeUnit \u65f6\u95f4\u9897\u7c92\u5ea6\n     */\n    public <T> void setCacheObject(final String key, final T value, final Integer timeout, final TimeUnit timeUnit)\n    {\n        redisTemplate.opsForValue().set(key, value, timeout, timeUnit);\n    }\n\n    /**\n     * \u8bbe\u7f6e\u6709\u6548\u65f6\u95f4\n     *\n     * @param key Redis\u952e\n     * @param timeout \u8d85\u65f6\u65f6\u95f4\n     * @return true=\u8bbe\u7f6e\u6210\u529f\uff1bfalse=\u8bbe\u7f6e\u5931\u8d25\n     */\n    public boolean expire(final String key, final long timeout)\n    {\n        return expire(key, timeout, TimeUnit.SECONDS);\n    }\n\n    /**\n     * \u8bbe\u7f6e\u6709\u6548\u65f6\u95f4\n     *\n     * @param key Redis\u952e\n     * @param timeout \u8d85\u65f6\u65f6\u95f4\n     * @param unit \u65f6\u95f4\u5355\u4f4d\n     * @return true=\u8bbe\u7f6e\u6210\u529f\uff1bfalse=\u8bbe\u7f6e\u5931\u8d25\n     */\n    public boolean expire(final String key, final long timeout, final TimeUnit unit)\n    {\n        return redisTemplate.expire(key, timeout, unit);\n    }\n\n    /**\n     * \u83b7\u5f97\u7f13\u5b58\u7684\u57fa\u672c\u5bf9\u8c61\u3002\n     *\n     * @param key \u7f13\u5b58\u952e\u503c\n     * @return \u7f13\u5b58\u952e\u503c\u5bf9\u5e94\u7684\u6570\u636e\n     */\n    public <T> T getCacheObject(final String key)\n    {\n        ValueOperations<String, T> operation = redisTemplate.opsForValue();\n        return operation.get(key);\n    }\n\n    /**\n     * \u5220\u9664\u5355\u4e2a\u5bf9\u8c61\n     *\n     * @param key\n     */\n    public boolean deleteObject(final String key)\n    {\n        return redisTemplate.delete(key);\n    }\n\n    /**\n     * \u5220\u9664\u96c6\u5408\u5bf9\u8c61\n     *\n     * @param collection \u591a\u4e2a\u5bf9\u8c61\n     * @return\n     */\n    public long deleteObject(final Collection collection)\n    {\n        return redisTemplate.delete(collection);\n    }\n\n    /**\n     * \u7f13\u5b58List\u6570\u636e\n     *\n     * @param key \u7f13\u5b58\u7684\u952e\u503c\n     * @param dataList \u5f85\u7f13\u5b58\u7684List\u6570\u636e\n     * @return \u7f13\u5b58\u7684\u5bf9\u8c61\n     */\n    public <T> long setCacheList(final String key, final List<T> dataList)\n    {\n        Long count = redisTemplate.opsForList().rightPushAll(key, dataList);\n        return count == null ? 0 : count;\n    }\n\n    /**\n     * \u83b7\u5f97\u7f13\u5b58\u7684list\u5bf9\u8c61\n     *\n     * @param key \u7f13\u5b58\u7684\u952e\u503c\n     * @return \u7f13\u5b58\u952e\u503c\u5bf9\u5e94\u7684\u6570\u636e\n     */\n    public <T> List<T> getCacheList(final String key)\n    {\n        return redisTemplate.opsForList().range(key, 0, -1);\n    }\n\n    /**\n     * \u7f13\u5b58Set\n     *\n     * @param key \u7f13\u5b58\u952e\u503c\n     * @param dataSet \u7f13\u5b58\u7684\u6570\u636e\n     * @return \u7f13\u5b58\u6570\u636e\u7684\u5bf9\u8c61\n     */\n    public <T> BoundSetOperations<String, T> setCacheSet(final String key, final Set<T> dataSet)\n    {\n        BoundSetOperations<String, T> setOperation = redisTemplate.boundSetOps(key);\n        Iterator<T> it = dataSet.iterator();\n        while (it.hasNext())\n        {\n            setOperation.add(it.next());\n        }\n        return setOperation;\n    }\n\n    /**\n     * \u83b7\u5f97\u7f13\u5b58\u7684set\n     *\n     * @param key\n     * @return\n     */\n    public <T> Set<T> getCacheSet(final String key)\n    {\n        return redisTemplate.opsForSet().members(key);\n    }\n\n    /**\n     * \u7f13\u5b58Map\n     *\n     * @param key\n     * @param dataMap\n     */\n    public <T> void setCacheMap(final String key, final Map<String, T> dataMap)\n    {\n        if (dataMap != null) {\n            redisTemplate.opsForHash().putAll(key, dataMap);\n        }\n    }\n\n    /**\n     * \u83b7\u5f97\u7f13\u5b58\u7684Map\n     *\n     * @param key\n     * @return\n     */\n    public <T> Map<String, T> getCacheMap(final String key)\n    {\n        return redisTemplate.opsForHash().entries(key);\n    }\n\n    /**\n     * \u5f80Hash\u4e2d\u5b58\u5165\u6570\u636e\n     *\n     * @param key Redis\u952e\n     * @param hKey Hash\u952e\n     * @param value \u503c\n     */\n    public <T> void setCacheMapValue(final String key, final String hKey, final T value)\n    {\n        redisTemplate.opsForHash().put(key, hKey, value);\n    }\n\n    /**\n     * \u83b7\u53d6Hash\u4e2d\u7684\u6570\u636e\n     *\n     * @param key Redis\u952e\n     * @param hKey Hash\u952e\n     * @return Hash\u4e2d\u7684\u5bf9\u8c61\n     */\n    public <T> T getCacheMapValue(final String key, final String hKey)\n    {\n        HashOperations<String, String, T> opsForHash = redisTemplate.opsForHash();\n        return opsForHash.get(key, hKey);\n    }\n\n    /**\n     * \u5220\u9664Hash\u4e2d\u7684\u6570\u636e\n     * \n     * @param key\n     * @param hkey\n     */\n    public void delCacheMapValue(final String key, final String hkey)\n    {\n        HashOperations hashOperations = redisTemplate.opsForHash();\n        hashOperations.delete(key, hkey);\n    }\n\n    /**\n     * \u83b7\u53d6\u591a\u4e2aHash\u4e2d\u7684\u6570\u636e\n     *\n     * @param key Redis\u952e\n     * @param hKeys Hash\u952e\u96c6\u5408\n     * @return Hash\u5bf9\u8c61\u96c6\u5408\n     */\n    public <T> List<T> getMultiCacheMapValue(final String key, final Collection<Object> hKeys)\n    {\n        return redisTemplate.opsForHash().multiGet(key, hKeys);\n    }\n\n    /**\n     * \u83b7\u5f97\u7f13\u5b58\u7684\u57fa\u672c\u5bf9\u8c61\u5217\u8868\n     *\n     * @param pattern \u5b57\u7b26\u4e32\u524d\u7f00\n     * @return \u5bf9\u8c61\u5217\u8868\n     */\n    public Collection<String> keys(final String pattern)\n    {\n        return redisTemplate.keys(pattern);\n    }\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.utils;\n\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\n\npublic class WebUtils {\n    /**\n     * \u5c06\u5b57\u7b26\u4e32\u6e32\u67d3\u5230\u5ba2\u6237\u7aef\n     *\n     * @param response \u6e32\u67d3\u5bf9\u8c61\n     * @param string   \u5f85\u6e32\u67d3\u7684\u5b57\u7b26\u4e32\n     * @return null\n     */\n    public static String renderString(HttpServletResponse response, String string) {\n        try {\n            response.setStatus(200);\n            response.setContentType("application/json");\n            response.setCharacterEncoding("utf-8");\n            response.getWriter().print(string);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n}\n')),(0,a.kt)("p",null,"\u2464\u5b9e\u4f53\u7c7b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"import java.io.Serializable;\nimport java.util.Date;\n\n\n\n@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class User implements Serializable {\n    private static final long serialVersionUID = 1L;\n    \n    /**\n    * \u4e3b\u952e\n    */\n    private Long id;\n    /**\n    * \u7528\u6237\u540d\n    */\n    private String userName;\n    /**\n    * \u6635\u79f0\n    */\n    private String nickName;\n    /**\n    * \u5bc6\u7801\n    */\n    private String password;\n    /**\n    * \u8d26\u53f7\u72b6\u6001\uff080\u6b63\u5e38 1\u505c\u7528\uff09\n    */\n    private String status;\n    /**\n    * \u90ae\u7bb1\n    */\n    private String email;\n    /**\n    * \u624b\u673a\u53f7\n    */\n    private String phonenumber;\n    /**\n    * \u7528\u6237\u6027\u522b\uff080\u7537\uff0c1\u5973\uff0c2\u672a\u77e5\uff09\n    */\n    private String sex;\n    /**\n    * \u5934\u50cf\n    */\n    private String avatar;\n    /**\n    * \u7528\u6237\u7c7b\u578b\uff080\u7ba1\u7406\u5458\uff0c1\u666e\u901a\u7528\u6237\uff09\n    */\n    private String userType;\n    /**\n    * \u521b\u5efa\u4eba\u7684\u7528\u6237id\n    */\n    private Long createBy;\n    /**\n    * \u521b\u5efa\u65f6\u95f4\n    */\n    private Date createTime;\n    /**\n    * \u66f4\u65b0\u4eba\n    */\n    private Long updateBy;\n    /**\n    * \u66f4\u65b0\u65f6\u95f4\n    */\n    private Date updateTime;\n    /**\n    * \u5220\u9664\u6807\u5fd7\uff080\u4ee3\u8868\u672a\u5220\u9664\uff0c1\u4ee3\u8868\u5df2\u5220\u9664\uff09\n    */\n    private Integer delFlag;\n}\n")),(0,a.kt)("h4",{id:"4-\u5b9e\u73b0"},"(4) \u5b9e\u73b0"),(0,a.kt)("h5",{id:"a-\u6570\u636e\u5e93\u6821\u9a8c\u7528\u6237"},"a. \u6570\u636e\u5e93\u6821\u9a8c\u7528\u6237"),(0,a.kt)("p",null,"\u81ea\u5b9a\u4e49\u4e00\u4e2aUserDetailsService\u7684\u5b9e\u73b0\u7c7b,\u8ba9SpringSecurity\u4f7f\u7528\u6211\u4eec\u7684\u5b9e\u73b0\u7c7b\u3002\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002"),(0,a.kt)("p",null,"\u51c6\u5907\u5de5\u4f5c"),(0,a.kt)("p",null,"ydl_security\u5e93\u4e2d\u3002\u6211\u4eec\u5148\u521b\u5efa\u4e00\u4e2a\u7cfb\u7edf\u7684\u7528\u6237\u8868\uff0c \u5efa\u8868\u8bed\u53e5\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"DROP TABLE IF EXISTS `sys_user`;\nCREATE TABLE `sys_user` (\n  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952e',\n  `user_name` varchar(64) NOT NULL DEFAULT 'NULL' COMMENT '\u7528\u6237\u540d',\n  `nick_name` varchar(64) NOT NULL DEFAULT 'NULL' COMMENT '\u6635\u79f0',\n  `password` varchar(64) NOT NULL DEFAULT 'NULL' COMMENT '\u5bc6\u7801',\n  `status` char(1) DEFAULT '0' COMMENT '\u8d26\u53f7\u72b6\u6001\uff080\u6b63\u5e38 1\u505c\u7528\uff09',\n  `email` varchar(64) DEFAULT NULL COMMENT '\u90ae\u7bb1',\n  `phonenumber` varchar(32) DEFAULT NULL COMMENT '\u624b\u673a\u53f7',\n  `sex` char(1) DEFAULT NULL COMMENT '\u7528\u6237\u6027\u522b\uff080\u7537\uff0c1\u5973\uff0c2\u672a\u77e5\uff09',\n  `avatar` varchar(128) DEFAULT NULL COMMENT '\u5934\u50cf',\n  `user_type` char(1) NOT NULL DEFAULT '1' COMMENT '\u7528\u6237\u7c7b\u578b\uff080\u7ba1\u7406\u5458\uff0c1\u666e\u901a\u7528\u6237\uff09',\n  `create_by` bigint DEFAULT NULL COMMENT '\u521b\u5efa\u4eba\u7684\u7528\u6237id',\n  `create_time` datetime DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4',\n  `update_by` bigint DEFAULT NULL COMMENT '\u66f4\u65b0\u4eba',\n  `update_time` datetime DEFAULT NULL COMMENT '\u66f4\u65b0\u65f6\u95f4',\n  `del_flag` int DEFAULT '0' COMMENT '\u5220\u9664\u6807\u5fd7\uff080\u4ee3\u8868\u672a\u5220\u9664\uff0c1\u4ee3\u8868\u5df2\u5220\u9664\uff09',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='\u7528\u6237\u8868';\n\n-- ----------------------------\n-- Records of sys_user\n-- ----------------------------\nINSERT INTO `sys_user` VALUES ('1', 'itlils', 'IT\u674e\u8001\u5e08', '$2a$10$UNfN3sUdNmka5cxCmrWHf.EZs6yRTztTvwoLJWXGf6VjRz/ABJ9y2', '0', '123@qq.com', '13012345678', '0', 'a', '1', '1', '2022-08-20 18:52:41', '1', '2022-08-21 18:52:49', '0');\n")),(0,a.kt)("p",null,"\u5f15\u5165MybatisPuls\u548cmysql\u9a71\u52a8\u7684\u4f9d\u8d56"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},"    <dependency>\n        <groupId>com.baomidou</groupId>\n        <artifactId>mybatis-plus-boot-starter</artifactId>\n        <version>3.4.3</version>\n    </dependency>\n    <dependency>\n        <groupId>mysql</groupId>\n        <artifactId>mysql-connector-java</artifactId>\n    </dependency>\n")),(0,a.kt)("p",null,"\u914d\u7f6e\u6570\u636e\u5e93\u4fe1\u606f"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"spring:\n  datasource:\n    url: jdbc:mysql://localhost:3306/ydl_security?characterEncoding=utf-8&serverTimezone=UTC\n    username: root\n    password: ydlclass666\n    driver-class-name: com.mysql.cj.jdbc.Driver\n")),(0,a.kt)("p",null,"\u5b9a\u4e49Mapper\u63a5\u53e3"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"public interface UserMapper extends BaseMapper<User> {\n}\n")),(0,a.kt)("p",null,"\u4fee\u6539User\u5b9e\u4f53\u7c7b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},'\u7c7b\u540d\u4e0a\u52a0@TableName(value = "sys_user") ,id\u5b57\u6bb5\u4e0a\u52a0 @TableId\n')),(0,a.kt)("p",null,"\u542f\u52a8\u7c7b\u914d\u7f6eMapper\u626b\u63cf"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'@MapperScan("com.ydlclass.authdemo.dao")\n')),(0,a.kt)("p",null,"\u6d4b\u8bd5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"@SpringBootTest\nclass AuthDemoApplicationTests {\n    @Autowired\n    UserMapper userMapper;\n\n    @Test\n    void contextLoads() {\n        List<User> users = userMapper.selectList(null);\n        System.out.println(users.get(0));\n\n    }\n\n}\n")),(0,a.kt)("p",null,"\u7ed3\u679c"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220821223919369-e9454d90.png",alt:"image-20220821223919369"}),"image-20220821223919369"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u91cd\u8981\uff01"),"\u5b9e\u73b0\u771f\u5b9e\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u7cfb\u7edf\u7528\u6237\u4fe1\u606f"),(0,a.kt)("p",null,"\u521b\u5efaUserDetailsService\u5b9e\u73b0\u7c7b\uff0c\u91cd\u5199\u5176\u4e2d\u7684\u65b9\u6cd5\u3002\u7528\u6237\u540d\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u7528\u6237\u4fe1\u606f\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'@Service\npublic class UserDetailsServiceImpl implements UserDetailsService {\n\n    @Autowired\n    private UserMapper userMapper;\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        //\u6839\u636e\u7528\u6237\u540d\u67e5\u8be2\u7528\u6237\u4fe1\u606f\n        LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<>();\n        wrapper.eq(User::getUserName,username);\n        User user = userMapper.selectOne(wrapper);\n        //\u5982\u679c\u67e5\u8be2\u4e0d\u5230\u6570\u636e\u5c31\u901a\u8fc7\u629b\u51fa\u5f02\u5e38\u6765\u7ed9\u51fa\u63d0\u793a\n        if(Objects.isNull(user)){\n            throw new RuntimeException("\u7528\u6237\u540d\u9519\u8bef");\n        }\n        //TODO \u6839\u636e\u7528\u6237\u67e5\u8be2\u6743\u9650\u4fe1\u606f \u6dfb\u52a0\u5230LoginUser\u4e2d\n        \n        \n        //\u5c01\u88c5\u6210UserDetails\u5bf9\u8c61\u8fd4\u56de \n        return new LoginUser(user);\n    }\n}\n')),(0,a.kt)("p",null,"\u56e0\u4e3aUserDetailsService\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u662fUserDetails\u7c7b\u578b\uff0c\u6240\u4ee5\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u5b9e\u73b0\u8be5\u63a5\u53e3\uff0c\u628a\u7528\u6237\u4fe1\u606f\u5c01\u88c5\u5728\u5176\u4e2d\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class LoginUser implements UserDetails {\n\n    private User user;\n\n\n    @Override\n    public Collection<? extends GrantedAuthority> getAuthorities() {\n        return null;\n    }\n\n    @Override\n    public String getPassword() {\n        return user.getPassword();\n    }\n\n    @Override\n    public String getUsername() {\n        return user.getUserName();\n    }\n\n    @Override\n    public boolean isAccountNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isAccountNonLocked() {\n        return true;\n    }\n\n    @Override\n    public boolean isCredentialsNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isEnabled() {\n        return true;\n    }\n}\n")),(0,a.kt)("p",null,"\u6ce8\u610f\uff1a\u5982\u679c\u8981\u6d4b\u8bd5\uff0c\u9700\u8981\u5f80\u7528\u6237\u8868\u4e2d\u5199\u5165\u7528\u6237\u6570\u636e\uff0c\u5e76\u4e14\u5982\u679c\u4f60\u60f3\u8ba9\u7528\u6237\u7684\u5bc6\u7801\u662f\u660e\u6587\u5b58\u50a8\uff0c\u9700\u8981\u5728\u5bc6\u7801\u524d\u52a0{noop}\u3002\u4f8b\u5982"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN8AAAA8CAYAAADmKW8AAAAIbElEQVR4nO2cT2gbdxbHP7MbMHvKKdfiVaVocVNwwKggs6GQOLGUUnvBiX1KvGssBxUiQ+oW03UO6y0m602RAmtiG++6PtmOIW1Zj5w6huBiQYTBhjimymi1pj0tuURHs4fZg2akmZEs/9nU4zrvA3PQ773fb94M89V774c0yqtXr3QEQTh0fuF2AILwpiLiEwSXEPEJgkuc+M9/f+V2DILwRiKZTxBcQsQnCC4h4hMElxDxCYJLiPgEwSVEfGVkmQzV4L+14HYgwjFHxCcILiHiEwSXEPEJgkvYxLd8qwZ/6B5buXu0n6rBbx5l/Y/RFxV9oizb7Avctsy/vbS7rXjuSvE4x6zxOGMtO19pneX7vy34WNdcitrm+m+pe7tzgvB/Up75Vvu49BHceblN5uU2mafD1E+12B74rftfwN8M+8vn9DdM0F18oBe4faqFzOBzw77NBW1327lwF6w+4EnOPMsCj6dwjGXJbUJ7uLnwcSmK/70+/NPbxfUyT4fJdNTQfj9bdl3d2mcFn+RNas35HRO0W+aP08fQ6uu5uYJQjQplZxfj5sMJ4LnJncEATH1TzG61N0bo9JgOXjo/7oLV7/kBIPeCDOD3eYsrnrthrFfNdv5D2kmT+7dhWPqGGQLUN6RJfmsIKaeSXA3g+TXAArc7JqgffM6fzlvCN+JdH/jCkY27GL/bbPlcef65u8/pb6hyxwThNVEuvobf8JZjqNb3LvCMXK40tnzLUqp1TJQMnjChBpjpKC8Zq9po5sI1mFELGXZLewbXPuNOS4D1r1W2gK1vH7DecIX3PVQUcrV4y66rynxBOAwOsOFS6Nm6p7oYN0u96S6L3Utn0ihXV/u4ZOuxqtngLV8ANl+wRZYnX6dpDzdTe/EK9UZW/UFLU98SLmVlQfgZU6HnM8pHC8vqBJgZxygH+5+OcM6wb2nPylf23GTGFOZqH39f2t1WENoDniypJFe7uHAeI1tO8HhpgcdTAUIXjUzlOY0fyGiO3q4Yz7t4PGUmSww7zc+Sk55POAQqZL4Juq27iUtRuqeg/WNLH2jtzXL3+HQgXfLP3eO2c7MDo0+rZgNDaGly6vesX/vQELeX91sCzPz1czLmFwAAzfxhMMD6wDv23c2lKJcG0rRPl74cKlMoc9cHfs+krZxuYabqPEF4PZwoG2kYZtz3Of5TLcWh9unt0qbE+REeDT7jUkdN4SFtGObRdBeXOgy75yYXtBr8p8zZAfqffmds0FSzgSm0oYEJ2qdHiuevvXiF+oE+GPyHreSsvfEdGV8UvxlLcc1ty5o7c+7uNuPU0P1eDUPFa31O/+Y7xc+C8FOhZF5uF99etnyrhu7NYR5ZdzsFQfhJkF+4CIJLiPgEwSVEfILgEraeTxCEw0MynyC4xIlf5n90OwZBeCNR9LwuZacguICUnYLgEiI+QXAJEZ8guISITxBcQsQnCC4h4gMgS6JJQYkliyPJmILSlKD834KV2a+/IJSLb7EH5aRC48jRfoyyI40oJxV6Ft2ORBAOhkN8WRJ/GSM4pLESPdrvNvFGV9DnIoy19ZDc3V0QjhwO8WlspuHMz+WlQm/XEXQ7BkE4ILv0fKVeyCzzCkeFbJNL0Fi0KzuXhHvwK/ZPTt9Y9Ry3U99VNm6U1qV156vfhtJK9FjnVe3xjHu34z2zr2W/B9VswnFhbxsuk2Gu8yV6XkfPq0QYI2wVwmIPytlezszpho+OvhZno83RO+7VDyDdi68HvrT4BSfDVQUY+iAC6Vnmra8MJMlXkxD5JIbXjKFtjIglBpVeetOV17TFfjLMxpBWin0U5ncQRnZkGEbNc2jEA2OEi2JN0uNYq1Xbi004Vuh5XS8ecxEdgnp8zRzT9HgAnUBc1yx+2lBQh4iu5nVdz6t6BPTgkKbb1jqwn66rndg+7+RnrhmZs8drO8dcZA8xGNfZqRbH1E7rdZfbnYfdv8JhjWMtrgdtcVuOajY5jtVRynyLPShtoOZXiDlfPlR3mh27wNwLNqjcJ3p9Z4ANXuT24WcSqMO3q1+I0bwKbWZp5uXy74KkHs4bmcLcQOojtEusVcnNM5uGyAehfU1LxixlZ9tYyeC5zNUAjLVVKF2r2YRjRUl8TaPocxCu1M8dWQolGnM6o02FEW/zVYJm6ZmbZzYd5GrzYW8gFXq28GQE1SxR5yIWu5fYolFKp3vx2frHajbhOGHv+ZpaiTgz0G54TnMG2Kjw8tqstgGc4bRnH34m6U00h1/yn2MQuMpl0y/3gg0itDZZ47nM1UCK2YUs2YVZUlb/HWMo7PIe5BorsvgVYwSJr41i5srCNTrXjbFiCjPdy/DiHm3CsaDChkuKzX/tZ4kQfUNBUv0++67cYg++/hSROfMB3KufSfmmTti6cbIjXmKfREg9HGb4YcrhH6K1E1L910lYvmCSsTBjFVbayzXuvBNpuY+5BNf7UyVTLkFP2Y8YgtS9vYtNOFaUvzT3AHijK+i+HpQ2xfIQB4mv6bb+ca9+AATiqP4/o5wMF4cilvKyKk2tRNrCjBFBdfiHEjoqCuGzCr3FdTXim77i5z1fY6eKnqh0/lG0oQ18pm8gjjYXwddm2D0xWjMKyklzQpD4mtlrV7MJxwnHP9nLeyg3SMYUwptxtMVdslwuQePZTf6Yd2bNLIkmH711Knpif5skgnBYOMpOH3WBffQ2LlPo6cp3Rc2NlnhMhCccXRxlp5fYaJzZsz4aOdq/78yONOLrh/haeXZMJnpJdaqsSKkmHGHKez5PjJV8zIVQ9oc3uoIetY8VBJkq9FiLkvWEo428vUwQXEL+TCsILnEir+fdjkEQ3kgUXZeyUxDcQMpOQXAJEZ8guISITxBcQsQnCC4h4hMEl/gftYbRhpP9yqoAAAAASUVORK5CYII=",alt:"image-20220821224611161"}),"image-20220821224611161"),(0,a.kt)("p",null,"\u8fd9\u6837\u767b\u9646\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u7528sg\u4f5c\u4e3a\u7528\u6237\u540d\uff0cydlclass\u4f5c\u4e3a\u5bc6\u7801\u6765\u767b\u9646\u4e86\u3002"),(0,a.kt)("h5",{id:"b\u5bc6\u7801\u52a0\u5bc6\u5b58\u50a8"},"b.\u5bc6\u7801\u52a0\u5bc6\u5b58\u50a8"),(0,a.kt)("p",null," 1 \u5b9e\u9645\u9879\u76ee\u4e2d\u6211\u4eec\u4e0d\u4f1a\u628a\u5bc6\u7801\u660e\u6587\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d"),(0,a.kt)("p",null," 2 \u9ed8\u8ba4\u4f7f\u7528\u7684PasswordEncoder\u8981\u6c42\u6570\u636e\u5e93\u4e2d\u7684\u5bc6\u7801\u683c\u5f0f\u4e3a\uff1a{id}password \u3002\u5b83\u4f1a\u6839\u636eid\u53bb\u5224\u65ad\u5bc6\u7801\u7684\u52a0\u5bc6\u65b9\u5f0f\u3002\u4f46\u662f\u6211\u4eec\u4e00\u822c\u4e0d\u4f1a\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u3002\u6240\u4ee5\u5c31\u9700\u8981\u66ff\u6362PasswordEncoder\u3002"),(0,a.kt)("p",null," \u6211\u4eec\u4e00\u822c\u4f7f\u7528SpringSecurity\u4e3a\u6211\u4eec\u63d0\u4f9b\u7684BCryptPasswordEncoder\u3002"),(0,a.kt)("p",null," \u6211\u4eec\u53ea\u9700\u8981\u4f7f\u7528\u628aBCryptPasswordEncoder\u5bf9\u8c61\u6ce8\u5165Spring\u5bb9\u5668\u4e2d\uff0cSpringSecurity\u5c31\u4f1a\u4f7f\u7528\u8be5PasswordEncoder\u6765\u8fdb\u884c\u5bc6\u7801\u6821\u9a8c\u3002"),(0,a.kt)("p",null," \u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2aSpringSecurity\u7684\u914d\u7f6e\u7c7b\uff0cSpringSecurity\u8981\u6c42\u8fd9\u4e2a\u914d\u7f6e\u7c7b\u8981\u7ee7\u627fWebSecurityConfigurerAdapter\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\npublic class SecurityConfig{\n\n    @Bean\n    public PasswordEncoder passwordEncoder(){\n        return new BCryptPasswordEncoder();\n    }\n\n}\n")),(0,a.kt)("p",null,"\u5bc6\u7801\u52a0\u5bc6\uff1a"),(0,a.kt)("p",null,"1 12345 md5 --\x3e asdfasdfasdfasdfa \u9ed8\u8ba4\u5bc6\u780112345"),(0,a.kt)("p",null,"2 12345 md5(12345|itlils)----\x3euiowertupouert \u52a0\u76d0"),(0,a.kt)("p",null,"3 BCryptPasswordEncoder \u81ea\u52a8\u52a0\u76d0"),(0,a.kt)("p",null,"\u8fc7\u65f6\u95ee\u9898\uff1a"),(0,a.kt)("p",null,"\u9996\u5148\uff0c\u8fc7\u65f6\u4e5f\u80fd\u7528\uff0c\u5982\u679c\u770b\u7740\u4e0d\u723d\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u65b9\u6cd5\u3002"),(0,a.kt)("p",null,"\u4ee5\u524d\u6211\u4eec\u81ea\u5b9a\u4e49\u7c7b\u7ee7\u627f\u81ea WebSecurityConfigurerAdapter \u6765\u914d\u7f6e\u6211\u4eec\u7684 Spring Security\uff0c\u6211\u4eec\u4e3b\u8981\u662f\u914d\u7f6e\u4e24\u4e2a\u4e1c\u897f\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"configure(HttpSecurity)"),(0,a.kt)("li",{parentName:"ul"},"configure(WebSecurity)")),(0,a.kt)("p",null,"\u524d\u8005\u4e3b\u8981\u662f\u914d\u7f6e Spring Security \u4e2d\u7684\u8fc7\u6ee4\u5668\u94fe\uff0c\u540e\u8005\u5219\u4e3b\u8981\u662f\u914d\u7f6e\u4e00\u4e9b\u8def\u5f84\u653e\u884c\u89c4\u5219\u3002"),(0,a.kt)("p",null,"\u73b0\u5728\u5728 WebSecurityConfigurerAdapter \u7684\u6ce8\u91ca\u4e2d\uff0c\u4eba\u5bb6\u5df2\u7ecf\u628a\u610f\u601d\u8bf4\u7684\u5f88\u660e\u767d\u4e86\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4ee5\u540e\u5982\u679c\u60f3\u8981\u914d\u7f6e\u8fc7\u6ee4\u5668\u94fe\uff0c\u53ef\u4ee5\u901a\u8fc7\u81ea\u5b9a\u4e49 SecurityFilterChainBean\u6765\u5b9e\u73b0\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u4ee5\u540e\u5982\u679c\u60f3\u8981\u914d\u7f6e WebSecurity\uff0c\u53ef\u4ee5\u901a\u8fc7 WebSecurityCustomizerBean\u6765\u5b9e\u73b0\u3002")),(0,a.kt)("p",null,"\u5982"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'     @Bean\n     public WebSecurityCustomizer webSecurityCustomizer() {\n         return (web) -> web.ignoring().antMatchers("/images/**", "/js/**", "/webjars/**");\n     }\n\n    @Bean\n    public  SecurityFilterChain securityFilterChain() {\n        List&lt;Filter&gt; filters = new ArrayList&lt;&gt;();\n        return new DefaultSecurityFilterChain(new AntPathRequestMatcher("/**"), filters);\n    }\n\n    //\u5982\u679c\u60f3\u597d\u770b\n     @Bean\n     public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n         http.authorizeRequests().antMatchers("/login").permitAll()\n                 .antMatchers("/users/**", "/settings/**").hasAuthority("Admin")\n                 .hasAnyAuthority("Admin", "Editor", "Salesperson")\n                 .hasAnyAuthority("Admin", "Editor", "Salesperson", "Shipper")\n                 .anyRequest().authenticated()\n                 .and().formLogin()\n                 .loginPage("/login")\n                 .usernameParameter("email")\n                 .permitAll()\n                 .and()\n                 .rememberMe().key("AbcdEfghIjklmNopQrsTuvXyz_0123456789")\n                 .and()\n                 .logout().permitAll();\n  \n         http.headers().frameOptions().sameOrigin();\n  \n         return http.build();\n     }}   \n')),(0,a.kt)("h5",{id:"c\u81ea\u5b9a\u4e49\u767b\u9646\u63a5\u53e3"},"c.\u81ea\u5b9a\u4e49\u767b\u9646\u63a5\u53e3"),(0,a.kt)("p",null,"\u5206\u6790\u9700\u6c42\uff1a"),(0,a.kt)("p",null,"1 \u81ea\u5b9a\u4e49\u4e00\u4e2acontroller\u767b\u9646\u63a5\u53e3"),(0,a.kt)("p",null,"2 \u653e\u884c\u81ea\u5b9a\u4e49\u767b\u9646\u63a5\u53e3"),(0,a.kt)("p",null,"3\u4f7f\u7528ProviderManager auth\u65b9\u6cd5\u8fdb\u884c\u9a8c\u8bc1"),(0,a.kt)("p",null,"4\u81ea\u5df1\u751f\u6210jwt\u7ed9\u524d\u7aef"),(0,a.kt)("p",null,"5\u7cfb\u7edf\u7528\u6237\u76f8\u5173\u6240\u6709\u4fe1\u606f\u653e\u5165redis"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.controller;\n\nimport com.ydlclass.authdemo.domain.ResponseResult;\nimport com.ydlclass.authdemo.domain.User;\nimport com.ydlclass.authdemo.service.LoginService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@RestController\npublic class LoginController {\n    @Autowired\n    LoginService loginService;\n\n    @PostMapping("/user/login")\n    public ResponseResult login(@RequestBody User user){\n\n        return loginService.login(user);\n    }\n\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.config;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.web.SecurityFilterChain;\n\n@Configuration\npublic class SecurityConfig {\n\n    @Bean\n    public PasswordEncoder passwordEncoder(){\n        return new BCryptPasswordEncoder();\n    }\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n                http\n                //\u5173\u95edcsrf\n                .csrf().disable()\n                //\u4e0d\u901a\u8fc7Session\u83b7\u53d6SecurityContext\n                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n                .and()\n                .authorizeRequests()\n                // \u5bf9\u4e8e\u767b\u5f55\u63a5\u53e3 \u5141\u8bb8\u533f\u540d\u8bbf\u95ee\n                .antMatchers("/user/login").anonymous()\n                // \u9664\u4e0a\u9762\u5916\u7684\u6240\u6709\u8bf7\u6c42\u5168\u90e8\u9700\u8981\u9274\u6743\u8ba4\u8bc1\n                .anyRequest().authenticated();\n\n        return http.build();\n    }\n\n    @Autowired\n    private AuthenticationConfiguration authenticationConfiguration;\n\n    @Bean\n    public AuthenticationManager authenticationManager() throws Exception{\n        AuthenticationManager authenticationManager = authenticationConfiguration.getAuthenticationManager();\n        return authenticationManager;\n    }\n\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.service.impl;\n\nimport com.ydlclass.authdemo.domain.LoginUser;\nimport com.ydlclass.authdemo.domain.ResponseResult;\nimport com.ydlclass.authdemo.domain.User;\nimport com.ydlclass.authdemo.service.LoginService;\nimport com.ydlclass.authdemo.utils.JwtUtil;\nimport com.ydlclass.authdemo.utils.RedisCache;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.authentication.ProviderManager;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;\nimport org.springframework.stereotype.Service;\n\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.Objects;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n * \u89c4\u77e9\uff1a\u7f3a\u5565\u8865\u5565  \u5e72\u5c31\u5b8c\u4e8b\u513f \u7167\u732b\u753b\u864e\n */\n@Service\npublic class LoginServiceImpl implements LoginService {\n\n    @Autowired\n    AuthenticationManager authenticationManager;\n\n    @Autowired\n    RedisCache redisCache;\n    @Override\n    public ResponseResult login(User user) {\n        //3\u4f7f\u7528ProviderManager auth\u65b9\u6cd5\u8fdb\u884c\u9a8c\u8bc1\n        UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken = new UsernamePasswordAuthenticationToken(user.getUserName(),user.getPassword());\n        Authentication authenticate = authenticationManager.authenticate(usernamePasswordAuthenticationToken);\n\n        //\u6821\u9a8c\u5931\u8d25\u4e86\n        if(Objects.isNull(authenticate)){\n            throw new RuntimeException("\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\uff01");\n        }\n\n        //4\u81ea\u5df1\u751f\u6210jwt\u7ed9\u524d\u7aef\n        LoginUser loginUser= (LoginUser)(authenticate.getPrincipal());\n        String userId = loginUser.getUser().getId().toString();\n        String jwt = JwtUtil.createJWT(userId);\n        Map<String,String> map=new HashMap();\n        map.put("token",jwt);\n        //5\u7cfb\u7edf\u7528\u6237\u76f8\u5173\u6240\u6709\u4fe1\u606f\u653e\u5165redis\n        redisCache.setCacheObject("login:"+userId,loginUser);\n\n        return new ResponseResult(200,"\u767b\u9646\u6210\u529f",map);\n    }\n}\n')),(0,a.kt)("h5",{id:"d\u8ba4\u8bc1\u8fc7\u6ee4\u5668"},"d.\u8ba4\u8bc1\u8fc7\u6ee4\u5668"),(0,a.kt)("p",null,"1.\u83b7\u53d6token"),(0,a.kt)("p",null,"2.\u89e3\u6790token"),(0,a.kt)("p",null,"3.\u83b7\u53d6userid"),(0,a.kt)("p",null,"4.\u5c01\u88c5Authentication"),(0,a.kt)("p",null,"5.\u5b58\u5165SecurityContextHolder"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.filter;\n\nimport com.ydlclass.authdemo.domain.LoginUser;\nimport com.ydlclass.authdemo.utils.JwtUtil;\nimport com.ydlclass.authdemo.utils.RedisCache;\nimport io.jsonwebtoken.Claims;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.stereotype.Component;\nimport org.springframework.util.StringUtils;\nimport org.springframework.web.filter.OncePerRequestFilter;\n\nimport javax.servlet.FilterChain;\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\nimport java.util.Objects;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n * OncePerRequestFilter \u53ea\u8d70\u4e00\u6b21\uff0c\u8bf7\u6c42\u524d\n */\n@Component\npublic class JwtAuthenticationTokenFilter extends OncePerRequestFilter {\n\n    @Autowired\n    RedisCache redisCache;\n\n    @Override\n    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {\n\n        //1\u83b7\u53d6token  header\u7684token\n        String token = request.getHeader("token");\n        if (!StringUtils.hasText(token)) {\n            //\u653e\u884c\uff0c\u8ba9\u540e\u9762\u7684\u8fc7\u6ee4\u5668\u6267\u884c\n            filterChain.doFilter(request, response);\n            return;\n        }\n        //2\u89e3\u6790token\n        String userId;\n        try {\n            Claims claims = JwtUtil.parseJWT(token);\n            userId = claims.getSubject();\n        } catch (Exception e) {\n            throw new RuntimeException("token\u4e0d\u5408\u6cd5\uff01");\n        }\n\n        //3\u83b7\u53d6userId, redis\u83b7\u53d6\u7528\u6237\u4fe1\u606f\n        LoginUser loginUser = redisCache.getCacheObject("login:" + userId);\n        if (Objects.isNull(loginUser)) {\n            throw new RuntimeException("\u5f53\u524d\u7528\u6237\u672a\u767b\u5f55\uff01");\n        }\n\n        //4\u5c01\u88c5Authentication\n        UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken\n                = new UsernamePasswordAuthenticationToken(loginUser, null, null);\n\n        //5\u5b58\u5165SecurityContextHolder\n        SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToken);\n\n        //\u653e\u884c\uff0c\u8ba9\u540e\u9762\u7684\u8fc7\u6ee4\u5668\u6267\u884c\n        filterChain.doFilter(request, response);\n    }\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.config;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;\n\n@Configuration\npublic class SecurityConfig {\n\n    @Bean\n    public PasswordEncoder passwordEncoder(){\n        return new BCryptPasswordEncoder();\n    }\n\n    @Autowired\n    JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter;\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n                http\n                //\u5173\u95edcsrf\n                .csrf().disable()\n                //\u4e0d\u901a\u8fc7Session\u83b7\u53d6SecurityContext\n                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n                .and()\n                .authorizeRequests()\n                // \u5bf9\u4e8e\u767b\u5f55\u63a5\u53e3 \u5141\u8bb8\u533f\u540d\u8bbf\u95ee\n                .antMatchers("/user/login").anonymous()\n                // \u9664\u4e0a\u9762\u5916\u7684\u6240\u6709\u8bf7\u6c42\u5168\u90e8\u9700\u8981\u9274\u6743\u8ba4\u8bc1\n                .anyRequest().authenticated();\n\n        //\u628atoken\u6821\u9a8c\u8fc7\u6ee4\u5668\u6dfb\u52a0\u5230\u8fc7\u6ee4\u5668\u94fe\u4e2d\n        http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);\n\n        return http.build();\n    }\n\n    @Autowired\n    private AuthenticationConfiguration authenticationConfiguration;\n\n    @Bean\n    public AuthenticationManager authenticationManager() throws Exception{\n        AuthenticationManager authenticationManager = authenticationConfiguration.getAuthenticationManager();\n        return authenticationManager;\n    }\n\n}\n')),(0,a.kt)("p",null,"\u6d4b\u8bd5\uff1a"),(0,a.kt)("p",null,"\u767b\u9646"),(0,a.kt)("p",null,"\u672a\u767b\u9646\u8bbf\u95ee\u8d44\u6e90\u7684\u8bdd"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822024122118-96f2759b.png",alt:"image-20220822024122118"}),"image-20220822024122118"),(0,a.kt)("p",null,"\u643a\u5e26token\u8bbf\u95ee"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822024036753-88642562.png",alt:"image-20220822024036753"}),"image-20220822024036753"),(0,a.kt)("h5",{id:"e\u9000\u51fa\u767b\u9646"},"e.\u9000\u51fa\u767b\u9646"),(0,a.kt)("p",null,"\u5199\u4e00\u4e2a\u9000\u51fa\u63a5\u53e3\uff0c\u5220\u9664reids\u91cc\u7684key"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.controller;\n\nimport com.ydlclass.authdemo.domain.ResponseResult;\nimport com.ydlclass.authdemo.domain.User;\nimport com.ydlclass.authdemo.service.LoginService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@RestController\npublic class LoginController {\n    @Autowired\n    LoginService loginService;\n\n    @PostMapping("/user/login")\n    public ResponseResult login(@RequestBody User user){\n        return loginService.login(user);\n    }\n\n    @PostMapping("/user/logout")\n    public ResponseResult logout(){\n        return loginService.logout();\n    }\n\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.service.impl;\n\nimport com.ydlclass.authdemo.domain.LoginUser;\nimport com.ydlclass.authdemo.domain.ResponseResult;\nimport com.ydlclass.authdemo.domain.User;\nimport com.ydlclass.authdemo.service.LoginService;\nimport com.ydlclass.authdemo.utils.JwtUtil;\nimport com.ydlclass.authdemo.utils.RedisCache;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.authentication.ProviderManager;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;\nimport org.springframework.stereotype.Service;\n\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.Objects;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n * \u89c4\u77e9\uff1a\u7f3a\u5565\u8865\u5565  \u5e72\u5c31\u5b8c\u4e8b\u513f \u7167\u732b\u753b\u864e\n */\n@Service\npublic class LoginServiceImpl implements LoginService {\n\n    @Autowired\n    AuthenticationManager authenticationManager;\n\n    @Autowired\n    RedisCache redisCache;\n    @Override\n    public ResponseResult login(User user) {\n        //3\u4f7f\u7528ProviderManager auth\u65b9\u6cd5\u8fdb\u884c\u9a8c\u8bc1\n        UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken = new UsernamePasswordAuthenticationToken(user.getUserName(),user.getPassword());\n        Authentication authenticate = authenticationManager.authenticate(usernamePasswordAuthenticationToken);\n\n        //\u6821\u9a8c\u5931\u8d25\u4e86\n        if(Objects.isNull(authenticate)){\n            throw new RuntimeException("\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\uff01");\n        }\n\n        //4\u81ea\u5df1\u751f\u6210jwt\u7ed9\u524d\u7aef\n        LoginUser loginUser= (LoginUser)(authenticate.getPrincipal());\n        String userId = loginUser.getUser().getId().toString();\n        String jwt = JwtUtil.createJWT(userId);\n        Map<String,String> map=new HashMap();\n        map.put("token",jwt);\n        //5\u7cfb\u7edf\u7528\u6237\u76f8\u5173\u6240\u6709\u4fe1\u606f\u653e\u5165redis\n        redisCache.setCacheObject("login:"+userId,loginUser);\n\n        return new ResponseResult(200,"\u767b\u9646\u6210\u529f",map);\n    }\n\n    @Override\n    public ResponseResult logout() {\n        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();\n        LoginUser loginUser = (LoginUser) authentication.getPrincipal();\n        Long userId = loginUser.getUser().getId();\n        redisCache.deleteObject("login:"+userId);\n\n        return new ResponseResult(200,"\u9000\u51fa\u6210\u529f\uff01");\n    }\n}\n')),(0,a.kt)("p",null,"\u6d4b\u8bd5"),(0,a.kt)("p",null,"\u767b\u9646\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822031306918-04a9d9fd.png",alt:"image-20220822031306918"}),"image-20220822031306918"),(0,a.kt)("p",null,"\u8bbf\u95ee\u8d44\u6e90\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822031335809-190ea849.png",alt:"image-20220822031335809"}),"image-20220822031335809"),(0,a.kt)("p",null,"\u9000\u51fa\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822031151323-a6ea73b1.png",alt:"image-20220822031151323"}),"image-20220822031151323"),(0,a.kt)("p",null,"\u8bbf\u95ee\u8d44\u6e90"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822031222868-32cf0665.png",alt:"image-20220822031222868"}),"image-20220822031222868"),(0,a.kt)("p",null,"security\u914d\u7f6e\u6587\u4ef6 \u8fde\u5f0f\u7f16\u7a0b"),(0,a.kt)("p",null,"\u672a\u767b\u5f55\u3001\u5df2\u767b\u5f55\u90fd\u80fd\u8bbf\u95eepermitAll()"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822032300261-051cb27e.png",alt:"image-20220822032300261"}),"image-20220822032300261"),(0,a.kt)("p",null,"\u53ea\u80fd\u672a\u767b\u5f55\u8bbf\u95ee anonymous()"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822032407738-e65b3beb.png",alt:"image-20220822032407738"}),"image-20220822032407738"),(0,a.kt)("h2",{id:"\u7b2c\u56db\u7ae0-\u6388\u6743"},"\u7b2c\u56db\u7ae0 \u6388\u6743"),(0,a.kt)("h3",{id:"1\u6743\u9650\u7cfb\u7edf\u7684\u4f5c\u7528"},"1\u3001\u6743\u9650\u7cfb\u7edf\u7684\u4f5c\u7528"),(0,a.kt)("p",null,"\u5546\u57ce\u7ba1\u7406\u7cfb\u7edf\uff0c\u666e\u901a\u7528\u6237\u767b\u5f55\u53ef\u4ee5\u521b\u5efa\u8ba2\u5355\u7b49\u64cd\u4f5c\uff0c\u4f46\u662f\u4e0d\u80fd\u5220\u9664\u5546\u54c1\u3002\u4f46\u662f\u7ba1\u7406\u5458\u53ef\u4ee5\u5220\u9664\u5546\u54c1\u4fe1\u606f\uff0c\u4fee\u6539\u4ef7\u683c\u7b49\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4e0d\u540c\u7684\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u529f\u80fd"),"\u3002\u8fd9\u5c31\u662f\u6743\u9650\u7cfb\u7edf\u8981\u53bb\u5b9e\u73b0\u7684\u6548\u679c\u3002"),(0,a.kt)("p",null,"\u6211\u4eec\u4e0d\u80fd\u53ea\u4f9d\u8d56\u524d\u7aef\u53bb\u5224\u65ad\u7528\u6237\u7684\u6743\u9650\u6765\u9009\u62e9\u663e\u793a\u54ea\u4e9b\u83dc\u5355\u54ea\u4e9b\u6309\u94ae\u3002\u56e0\u4e3a\u9ed1\u5ba2\u62ff\u5230\u9ad8\u6743\u9650\u63a5\u53e3url,\u6a21\u62df\u8bbf\u95ee\uff01"),(0,a.kt)("p",null,"\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u5728\u540e\u53f0\u8fdb\u884c\u7528\u6237\u6743\u9650\u7684\u5224\u65ad\uff0c\u5224\u65ad\u5f53\u524d\u7528\u6237\u662f\u5426\u6709\u76f8\u5e94\u7684\u6743\u9650\uff0c\u5fc5\u987b\u5177\u6709\u6240\u9700\u6743\u9650\u624d\u80fd\u8fdb\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\u3002"),(0,a.kt)("h3",{id:"2\u6388\u6743\u57fa\u672c\u6d41\u7a0b"},"2\u3001\u6388\u6743\u57fa\u672c\u6d41\u7a0b"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822033313015-1cf8d445.png",alt:"image-20220822033313015"}),"image-20220822033313015"),(0,a.kt)("p",null,"\u5728SpringSecurity\u4e2d\uff0c\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u7684FilterSecurityInterceptor\u6765\u8fdb\u884c\u6743\u9650\u6821\u9a8c\u3002"),(0,a.kt)("p",null,"\u5728FilterSecurityInterceptor\u4e2d\u4f1a\u4eceSecurityContextHolder\u83b7\u53d6\u5176\u4e2d\u7684Authentication\uff0c\u7136\u540e\u83b7\u53d6\u5176\u4e2d\u7684\u6743\u9650\u4fe1\u606f\u3002\u5f53\u524d\u7528\u6237\u662f\u5426\u62e5\u6709\u8bbf\u95ee\u5f53\u524d\u8d44\u6e90\u6240\u9700\u7684\u6743\u9650\u3002"),(0,a.kt)("p",null,"\u6240\u4ee5\u6211\u4eec\u9700\u8981\u505a\u4e24\u6b65"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"UserDetailServiceImpl\u7684loadUserByUsername \u67e5\u8be2\u6743\u9650\u4fe1\u606f"),(0,a.kt)("p",{parentName:"li"},"  ",(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822034353011-408ef45c.png",alt:"image-20220822034353011"}),"image-20220822034353011")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"JwtAuthenticationTokenFilter\u4e2d\u653e\u5165\u6743\u9650\u4fe1\u606f"),(0,a.kt)("p",{parentName:"li"},"  ",(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822034310201-58d5203d.png",alt:"image-20220822034310201"}),"image-20220822034310201"))),(0,a.kt)("h3",{id:"3\u6388\u6743\u5b9e\u73b0"},"3\u3001\u6388\u6743\u5b9e\u73b0"),(0,a.kt)("h4",{id:"1\u9650\u5236\u8bbf\u95ee\u8d44\u6e90\u6240\u9700\u6743\u9650"},"\uff081\uff09\u9650\u5236\u8bbf\u95ee\u8d44\u6e90\u6240\u9700\u6743\u9650"),(0,a.kt)("p",null," SpringSecurity\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u57fa\u4e8e\u6ce8\u89e3\u7684\u6743\u9650\u63a7\u5236\u65b9\u6848\uff0c\u8fd9\u4e5f\u662f\u6211\u4eec\u9879\u76ee\u4e2d\u4e3b\u8981\u91c7\u7528\u7684\u65b9\u5f0f\u3002"),(0,a.kt)("p",null," \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\u53bb\u6307\u5b9a\u8bbf\u95ee\u5bf9\u5e94\u7684\u8d44\u6e90\u6240\u9700\u7684\u6743\u9650\u3002"),(0,a.kt)("p",null," \u4f46\u662f\u8981\u4f7f\u7528\u5b83\u6211\u4eec\u9700\u8981\u5148\u5f00\u542f\u76f8\u5173\u914d\u7f6e\u3002\u914d\u7f6e\u7c7b\u4e2d\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"@EnableGlobalMethodSecurity(prePostEnabled = true)\n")),(0,a.kt)("p",null," \u7136\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528\u5bf9\u5e94\u7684\u6ce8\u89e3\u3002@PreAuthorize"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.controller;\n\nimport org.springframework.security.access.prepost.PreAuthorize;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@RestController\n@RequestMapping("demo")\npublic class DemoController {\n\n    @GetMapping("hello")\n    @PreAuthorize("hasAuthority(\'sayhello\')")\n    public String hello(){\n        return "hello security.ydlclass666";\n    }\n}\n')),(0,a.kt)("h4",{id:"2-\u5c01\u88c5\u6743\u9650\u4fe1\u606f"},"\uff082\uff09 \u5c01\u88c5\u6743\u9650\u4fe1\u606f"),(0,a.kt)("p",null," \u6211\u4eec\u524d\u9762\u5728\u5199UserDetailsServiceImpl\u7684\u65f6\u5019\u8bf4\u8fc7\uff0c\u5728\u67e5\u8be2\u51fa\u7528\u6237\u540e\u8fd8\u8981\u83b7\u53d6\u5bf9\u5e94\u7684\u6743\u9650\u4fe1\u606f\uff0c\u5c01\u88c5\u5230UserDetails\u4e2d\u8fd4\u56de\u3002"),(0,a.kt)("p",null," \u6211\u4eec\u5148\u76f4\u63a5\u628a\u6743\u9650\u4fe1\u606f\u5199\u6b7b\u5c01\u88c5\u5230UserDetails\u4e2d\u8fdb\u884c\u6d4b\u8bd5\u3002"),(0,a.kt)("p",null," \u6211\u4eec\u4e4b\u524d\u5b9a\u4e49\u4e86UserDetails\u7684\u5b9e\u73b0\u7c7bLoginUser\uff0c\u60f3\u8981\u8ba9\u5176\u80fd\u5c01\u88c5\u6743\u9650\u4fe1\u606f\u5c31\u8981\u5bf9\u5176\u8fdb\u884c\u4fee\u6539\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"package com.ydlclass.authdemo.domain;\n\nimport com.alibaba.fastjson.annotation.JSONField;\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.userdetails.UserDetails;\n\nimport java.util.ArrayList;\nimport java.util.Collection;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class LoginUser implements UserDetails {\n\n    private User user;\n\n    List<String> permissions;\n\n    public LoginUser(User user, List<String> permissions) {\n        this.user = user;\n        this.permissions = permissions;\n    }\n\n    @JSONField(serialize = false)\n    List<SimpleGrantedAuthority> authorities;\n\n    @Override\n    public Collection<? extends GrantedAuthority> getAuthorities() {\n        if (authorities!=null){\n            return authorities;\n        }\n\n        authorities = permissions.stream().map(SimpleGrantedAuthority::new).collect(Collectors.toList());\n        return authorities;\n    }\n\n    @Override\n    public String getPassword() {\n        return user.getPassword();\n    }\n\n    @Override\n    public String getUsername() {\n        return user.getUserName();\n    }\n\n    @Override\n    public boolean isAccountNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isAccountNonLocked() {\n        return true;\n    }\n\n    @Override\n    public boolean isCredentialsNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isEnabled() {\n        return true;\n    }\n}\n")),(0,a.kt)("p",null," LoginUser\u4fee\u6539\u5b8c\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5728UserDetailsServiceImpl\u4e2d\u53bb\u628a\u6743\u9650\u4fe1\u606f\u5c01\u88c5\u5230LoginUser\u4e2d\u4e86\u3002\u6211\u4eec\u5199\u6b7b\u6743\u9650\u8fdb\u884c\u6d4b\u8bd5\uff0c\u540e\u9762\u6211\u4eec\u518d\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u6743\u9650\u4fe1\u606f\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.service.impl;\n\nimport com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;\nimport com.ydlclass.authdemo.dao.UserMapper;\nimport com.ydlclass.authdemo.domain.LoginUser;\nimport com.ydlclass.authdemo.domain.User;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\nimport org.springframework.stereotype.Service;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.Objects;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@Service\npublic class UserDetailServiceImpl implements UserDetailsService {\n    @Autowired\n    UserMapper userMapper;\n\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        //1\u6839\u636e\u7528\u6237\u540d\u83b7\u53d6\u6570\u636e\u5e93\u4e2d\u7684\u7cfb\u7edf\u7528\u6237\n        LambdaQueryWrapper<User> lambdaQueryWrapper=new LambdaQueryWrapper<>();\n        lambdaQueryWrapper.eq(User::getUserName,username); //\u67e5\u8be2\u6761\u4ef6\n        User user = userMapper.selectOne(lambdaQueryWrapper);\n        if(Objects.isNull(user)){\n            throw new RuntimeException("\u7528\u6237\u540d\u9519\u8bef\uff01");\n        }\n        //TODO \u67e5\u8be2\u6743\u9650\u4fe1\u606f  \u4e00\u4f1a\u513f\u771f\u5b9e\u67e5\u6570\u636e\u5e93\uff0c\u73b0\u5728\u5148\u505a\u4e00\u4e2a\u5047\u7684\u6743\u9650\n        List<String> list=new ArrayList<>(Arrays.asList("sayhello","delgoods"));\n\n        //3\u8fd4\u56deUserDetails\n        return new LoginUser(user,list);\n    }\n}\n')),(0,a.kt)("p",null,"\u6d4b\u8bd5\uff1a"),(0,a.kt)("p",null,"\u5df2\u7ecf\u767b\u5f55\uff0c\u5e26\u4e0a\u6743\u9650\u4e86"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822043131659-fa48abe9.png",alt:"image-20220822043131659"}),"image-20220822043131659"),(0,a.kt)("p",null,"\u5373\u4f7f\u767b\u9646\u6210\u529f\uff0c\u4e5f\u4e0d\u80fd\u8bbf\u95ee"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822043226382-0cfb5262.png",alt:"image-20220822043226382"}),"image-20220822043226382"),(0,a.kt)("h4",{id:"3\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u6743\u9650\u4fe1\u606f"},"\uff083\uff09\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u6743\u9650\u4fe1\u606f"),(0,a.kt)("h5",{id:"arbac\u6743\u9650\u6a21\u578b"},"a.RBAC\u6743\u9650\u6a21\u578b"),(0,a.kt)("p",null," RBAC\u6743\u9650\u6a21\u578b\uff08Role-Based Access Control\uff09\u5373\uff1a\u57fa\u4e8e\u89d2\u8272\u7684\u6743\u9650\u63a7\u5236\u3002\u8fd9\u662f\u76ee\u524d\u6700\u5e38\u88ab\u5f00\u53d1\u8005\u4f7f\u7528\u4e5f\u662f\u76f8\u5bf9\u6613\u7528\u3001\u901a\u7528\u6743\u9650\u6a21\u578b\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822050940245-854bb6a9.png",alt:"image-20220822050940245"}),"image-20220822050940245"),(0,a.kt)("h5",{id:"b\u51c6\u5907\u5de5\u4f5c"},"b.\u51c6\u5907\u5de5\u4f5c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE /*!32312 IF NOT EXISTS*/`ydl_security` /*!40100 DEFAULT CHARACTER SET utf8mb4 */;\n\nUSE `ydl_security`;\n\n/*Table structure for table `sys_menu` */\n\nDROP TABLE IF EXISTS `sys_menu`;\n\nCREATE TABLE `sys_menu` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `menu_name` varchar(64) NOT NULL DEFAULT 'NULL' COMMENT '\u83dc\u5355\u540d',\n  `path` varchar(200) DEFAULT NULL COMMENT '\u8def\u7531\u5730\u5740',\n  `component` varchar(255) DEFAULT NULL COMMENT '\u7ec4\u4ef6\u8def\u5f84',\n  `visible` char(1) DEFAULT '0' COMMENT '\u83dc\u5355\u72b6\u6001\uff080\u663e\u793a 1\u9690\u85cf\uff09',\n  `status` char(1) DEFAULT '0' COMMENT '\u83dc\u5355\u72b6\u6001\uff080\u6b63\u5e38 1\u505c\u7528\uff09',\n  `perms` varchar(100) DEFAULT NULL COMMENT '\u6743\u9650\u6807\u8bc6',\n  `icon` varchar(100) DEFAULT '#' COMMENT '\u83dc\u5355\u56fe\u6807',\n  `create_by` bigint(20) DEFAULT NULL,\n  `create_time` datetime DEFAULT NULL,\n  `update_by` bigint(20) DEFAULT NULL,\n  `update_time` datetime DEFAULT NULL,\n  `del_flag` int(11) DEFAULT '0' COMMENT '\u662f\u5426\u5220\u9664\uff080\u672a\u5220\u9664 1\u5df2\u5220\u9664\uff09',\n  `remark` varchar(500) DEFAULT NULL COMMENT '\u5907\u6ce8',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT='\u83dc\u5355\u8868';\n\n/*Table structure for table `sys_role` */\n\nDROP TABLE IF EXISTS `sys_role`;\n\nCREATE TABLE `sys_role` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `name` varchar(128) DEFAULT NULL,\n  `role_key` varchar(100) DEFAULT NULL COMMENT '\u89d2\u8272\u6743\u9650\u5b57\u7b26\u4e32',\n  `status` char(1) DEFAULT '0' COMMENT '\u89d2\u8272\u72b6\u6001\uff080\u6b63\u5e38 1\u505c\u7528\uff09',\n  `del_flag` int(1) DEFAULT '0' COMMENT 'del_flag',\n  `create_by` bigint(200) DEFAULT NULL,\n  `create_time` datetime DEFAULT NULL,\n  `update_by` bigint(200) DEFAULT NULL,\n  `update_time` datetime DEFAULT NULL,\n  `remark` varchar(500) DEFAULT NULL COMMENT '\u5907\u6ce8',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COMMENT='\u89d2\u8272\u8868';\n\n/*Table structure for table `sys_role_menu` */\n\nDROP TABLE IF EXISTS `sys_role_menu`;\n\nCREATE TABLE `sys_role_menu` (\n  `role_id` bigint(200) NOT NULL AUTO_INCREMENT COMMENT '\u89d2\u8272ID',\n  `menu_id` bigint(200) NOT NULL DEFAULT '0' COMMENT '\u83dc\u5355id',\n  PRIMARY KEY (`role_id`,`menu_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4;\n\n/*Table structure for table `sys_user` */\n\nDROP TABLE IF EXISTS `sys_user`;\n\nCREATE TABLE `sys_user` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952e',\n  `user_name` varchar(64) NOT NULL DEFAULT 'NULL' COMMENT '\u7528\u6237\u540d',\n  `nick_name` varchar(64) NOT NULL DEFAULT 'NULL' COMMENT '\u6635\u79f0',\n  `password` varchar(64) NOT NULL DEFAULT 'NULL' COMMENT '\u5bc6\u7801',\n  `status` char(1) DEFAULT '0' COMMENT '\u8d26\u53f7\u72b6\u6001\uff080\u6b63\u5e38 1\u505c\u7528\uff09',\n  `email` varchar(64) DEFAULT NULL COMMENT '\u90ae\u7bb1',\n  `phonenumber` varchar(32) DEFAULT NULL COMMENT '\u624b\u673a\u53f7',\n  `sex` char(1) DEFAULT NULL COMMENT '\u7528\u6237\u6027\u522b\uff080\u7537\uff0c1\u5973\uff0c2\u672a\u77e5\uff09',\n  `avatar` varchar(128) DEFAULT NULL COMMENT '\u5934\u50cf',\n  `user_type` char(1) NOT NULL DEFAULT '1' COMMENT '\u7528\u6237\u7c7b\u578b\uff080\u7ba1\u7406\u5458\uff0c1\u666e\u901a\u7528\u6237\uff09',\n  `create_by` bigint(20) DEFAULT NULL COMMENT '\u521b\u5efa\u4eba\u7684\u7528\u6237id',\n  `create_time` datetime DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4',\n  `update_by` bigint(20) DEFAULT NULL COMMENT '\u66f4\u65b0\u4eba',\n  `update_time` datetime DEFAULT NULL COMMENT '\u66f4\u65b0\u65f6\u95f4',\n  `del_flag` int(11) DEFAULT '0' COMMENT '\u5220\u9664\u6807\u5fd7\uff080\u4ee3\u8868\u672a\u5220\u9664\uff0c1\u4ee3\u8868\u5df2\u5220\u9664\uff09',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COMMENT='\u7528\u6237\u8868';\n\n/*Table structure for table `sys_user_role` */\n\nDROP TABLE IF EXISTS `sys_user_role`;\n\nCREATE TABLE `sys_user_role` (\n  `user_id` bigint(200) NOT NULL AUTO_INCREMENT COMMENT '\u7528\u6237id',\n  `role_id` bigint(200) NOT NULL DEFAULT '0' COMMENT '\u89d2\u8272id',\n  PRIMARY KEY (`user_id`,`role_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mysql"},"SELECT DISTINCT perms from sys_menu where id in (\n    SELECT menu_id  from sys_role_menu where role_id in (\n        SELECT role_id from sys_user_role  where user_id=1\n    )\n) and status='0'\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.domain;\n\nimport com.baomidou.mybatisplus.annotation.TableId;\nimport com.baomidou.mybatisplus.annotation.TableName;\nimport com.fasterxml.jackson.annotation.JsonInclude;\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\nimport java.io.Serializable;\nimport java.util.Date;\n\n/**\n * \u83dc\u5355\u8868(Menu)\u5b9e\u4f53\u7c7b\n\n */\n@TableName(value="sys_menu")\n@Data\n@AllArgsConstructor\n@NoArgsConstructor\n@JsonInclude(JsonInclude.Include.NON_NULL)\npublic class Menu implements Serializable {\n    private static final long serialVersionUID = 1L;\n    \n    @TableId\n    private Long id;\n    /**\n    * \u83dc\u5355\u540d\n    */\n    private String menuName;\n    /**\n    * \u8def\u7531\u5730\u5740\n    */\n    private String path;\n    /**\n    * \u7ec4\u4ef6\u8def\u5f84\n    */\n    private String component;\n    /**\n    * \u83dc\u5355\u72b6\u6001\uff080\u663e\u793a 1\u9690\u85cf\uff09\n    */\n    private String visible;\n    /**\n    * \u83dc\u5355\u72b6\u6001\uff080\u6b63\u5e38 1\u505c\u7528\uff09\n    */\n    private String status;\n    /**\n    * \u6743\u9650\u6807\u8bc6\n    */\n    private String perms;\n    /**\n    * \u83dc\u5355\u56fe\u6807\n    */\n    private String icon;\n    \n    private Long createBy;\n    \n    private Date createTime;\n    \n    private Long updateBy;\n    \n    private Date updateTime;\n    /**\n    * \u662f\u5426\u5220\u9664\uff080\u672a\u5220\u9664 1\u5df2\u5220\u9664\uff09\n    */\n    private Integer delFlag;\n    /**\n    * \u5907\u6ce8\n    */\n    private String remark;\n}\n')),(0,a.kt)("h5",{id:"c\u4ee3\u7801\u5b9e\u73b0"},"c.\u4ee3\u7801\u5b9e\u73b0"),(0,a.kt)("p",null," \u6211\u4eec\u53ea\u9700\u8981\u6839\u636e\u7528\u6237id\u53bb\u67e5\u8be2\u5230\u5176\u6240\u5bf9\u5e94\u7684\u6743\u9650\u4fe1\u606f\u5373\u53ef\u3002"),(0,a.kt)("p",null," \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5148\u5b9a\u4e49\u4e2amapper\uff0c\u5176\u4e2d\u63d0\u4f9b\u4e00\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u6839\u636euserid\u67e5\u8be2\u6743\u9650\u4fe1\u606f\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"package com.ydlclass.authdemo.dao;\n\nimport com.baomidou.mybatisplus.core.mapper.BaseMapper;\nimport com.ydlclass.authdemo.domain.Menu;\n\nimport java.util.List;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\npublic interface MenuMapper extends BaseMapper<Menu> {\n\n    List<String> selectPermsByUserId(Long userId);\n    \n}\n")),(0,a.kt)("p",null," \u5c24\u5176\u662f\u81ea\u5b9a\u4e49\u65b9\u6cd5\uff0c\u6240\u4ee5\u9700\u8981\u521b\u5efa\u5bf9\u5e94\u7684mapper\u6587\u4ef6\uff0c\u5b9a\u4e49\u5bf9\u5e94\u7684sql\u8bed\u53e5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="UTF-8" ?>\n<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >\n<mapper namespace="com.ydlclass.authdemo.dao.MenuMapper">\n    <select id="selectPermsByUserId" parameterType="long" resultType="string">\n        SELECT DISTINCT perms from sys_menu where id in (\n            SELECT menu_id  from sys_role_menu where role_id in (\n                SELECT role_id from sys_user_role  where user_id=#{userId}\n            )\n        ) and status=\'0\'\n    </select>\n</mapper>\n')),(0,a.kt)("p",null," \u5728application.yml\u4e2d\u914d\u7f6emapperXML\u6587\u4ef6\u7684\u4f4d\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"spring:\n  datasource:\n    url: jdbc:mysql://localhost:3306/ydl_security?characterEncoding=utf-8&serverTimezone=UTC\n    username: root\n    password: ydlclass666\n    driver-class-name: com.mysql.cj.jdbc.Driver\nmybatis-plus:\n  mapper-locations: classpath*:/mapper/**/*.xml\n")),(0,a.kt)("p",null," \u7136\u540e\u6211\u4eec\u53ef\u4ee5\u5728UserDetailsServiceImpl\u4e2d\u53bb\u8c03\u7528\u8be5mapper\u7684\u65b9\u6cd5\u67e5\u8be2\u6743\u9650\u4fe1\u606f\u5c01\u88c5\u5230LoginUser\u5bf9\u8c61\u4e2d\u5373\u53ef\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.service.impl;\n\nimport com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;\nimport com.ydlclass.authdemo.dao.MenuMapper;\nimport com.ydlclass.authdemo.dao.UserMapper;\nimport com.ydlclass.authdemo.domain.LoginUser;\nimport com.ydlclass.authdemo.domain.User;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\nimport org.springframework.stereotype.Service;\n\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.Objects;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@Service\npublic class UserDetailServiceImpl implements UserDetailsService {\n    @Autowired\n    UserMapper userMapper;\n\n    @Autowired\n    MenuMapper menuMapper;\n\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        //1\u6839\u636e\u7528\u6237\u540d\u83b7\u53d6\u6570\u636e\u5e93\u4e2d\u7684\u7cfb\u7edf\u7528\u6237\n        LambdaQueryWrapper<User> lambdaQueryWrapper=new LambdaQueryWrapper<>();\n        lambdaQueryWrapper.eq(User::getUserName,username); //\u67e5\u8be2\u6761\u4ef6\n        User user = userMapper.selectOne(lambdaQueryWrapper);\n        if(Objects.isNull(user)){\n            throw new RuntimeException("\u7528\u6237\u540d\u9519\u8bef\uff01");\n        }\n//        //\u67e5\u8be2\u6743\u9650\u4fe1\u606f  \u4e00\u4f1a\u513f\u771f\u5b9e\u67e5\u6570\u636e\u5e93\uff0c\u73b0\u5728\u5148\u505a\u4e00\u4e2a\u5047\u7684\u6743\u9650\n//        List<String> list=new ArrayList<>(Arrays.asList("sayhello","delgoods"));\n\n        List<String> perms = menuMapper.selectPermsByUserId(user.getId());\n        //3\u8fd4\u56deUserDetails\n        return new LoginUser(user,perms);\n    }\n}\n')),(0,a.kt)("p",null,"\u6d4b\u8bd5\uff1a"),(0,a.kt)("p",null,"\u91cd\u65b0\u767b\u9646\uff0c\u8bbf\u95ee\u63a5\u53e3"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822053742709-13c24b40.png",alt:"image-20220822053742709"}),"image-20220822053742709"),(0,a.kt)("h2",{id:"\u7b2c\u4e94\u7ae0-\u81ea\u5b9a\u4e49\u5931\u8d25\u5904\u7406"},"\u7b2c\u4e94\u7ae0 \u81ea\u5b9a\u4e49\u5931\u8d25\u5904\u7406"),(0,a.kt)("p",null,"\u8ba4\u8bc1\u5931\u8d25\u65f6\uff0c\u73b0\u5728\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\uff0c\u4e0d\u53cb\u597d\u3002\u6211\u4eec\u60f3\u4e5f\u8ba9\u4ed6\u8fd4\u56de\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u8fd4\u56de\u503c\u5b9e\u4f53\u7c7b\u3002 @ControllerAdvise"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822055921042-98b69c53.png",alt:"image-20220822055921042"}),"image-20220822055921042"),(0,a.kt)("p",null,"\u6240\u4ee5\u9700\u8981\u77e5\u9053SpringSecurity\u7684\u5f02\u5e38\u5904\u7406\u673a\u5236\u3002"),(0,a.kt)("p",null,"ExceptionTranslationFilter\u6355\u83b7\uff0c\u5b83\u4f1a\u5224\u65ad\u662f\u8ba4\u8bc1\u5931\u8d25\u548c\u6388\u6743\u5931\u8d25\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822060056450-a68e39f0.png",alt:"image-20220822060056450"}),"image-20220822060056450"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u8ba4\u8bc1\u5931\u8d25\uff1a\u5b83\u4f1a\u5c01\u88c5AuthenticationException\uff0c\u7136\u540e\u8c03\u7528",(0,a.kt)("strong",{parentName:"li"},"AuthenticationEntryPoint"),"\u7684commence\u65b9\u6cd5\u5904\u7406"),(0,a.kt)("li",{parentName:"ul"},"\u6388\u6743\u5931\u8d25\uff1a\u5b83\u4f1a\u5c01\u88c5AccessDeniedException\uff0c\u7136\u540e\u8c03\u7528",(0,a.kt)("strong",{parentName:"li"},"AccessDeniedHandler"),"\u7684handle\u65b9\u6cd5\u5904\u7406")),(0,a.kt)("p",null,"\u6211\u4eec\u600e\u4e48\u529e\uff1f"),(0,a.kt)("p",null,"\u81ea\u5b9a\u4e49\u8fd9\u4e24\u4e2a\u7c7b\u7684\u5f02\u5e38\u5904\u7406\u673a\u5236\u7684\u5b9e\u73b0\u7c7b\uff0c\u914d\u7f6e\u5230SpringSecurity\u3002"),(0,a.kt)("p",null,"\u2460\u81ea\u5b9a\u4e49\u5b9e\u73b0\u7c7b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.handler;\n\nimport com.alibaba.fastjson.JSON;\nimport com.ydlclass.authdemo.domain.ResponseResult;\nimport com.ydlclass.authdemo.utils.WebUtils;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.security.core.AuthenticationException;\nimport org.springframework.security.web.AuthenticationEntryPoint;\nimport org.springframework.stereotype.Component;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@Component\npublic class AuthenticationEntryPointImpl implements AuthenticationEntryPoint {\n    @Override\n    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {\n        //\u7ed9\u524d\u7aefResponseResult \u7684json\n        ResponseResult responseResult = new ResponseResult(HttpStatus.UNAUTHORIZED.value(), "\u767b\u9646\u8ba4\u8bc1\u5931\u8d25\u4e86\uff0c\u8bf7\u91cd\u65b0\u767b\u9646\uff01");\n        String json = JSON.toJSONString(responseResult);\n        WebUtils.renderString(response,json);\n    }\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.handler;\n\nimport com.alibaba.fastjson.JSON;\nimport com.ydlclass.authdemo.domain.ResponseResult;\nimport com.ydlclass.authdemo.utils.WebUtils;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.security.access.AccessDeniedException;\nimport org.springframework.security.web.access.AccessDeniedHandler;\nimport org.springframework.stereotype.Component;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\n\n/**\n * @Created by IT\u674e\u8001\u5e08\n * \u516c\u4e3b\u53f7 \u201c\u5143\u52a8\u529b\u8bfe\u5802\u201d\n * \u4e2a\u4eba\u5fae itlils\n */\n@Component\npublic class AccessDeniedHandlerImpl implements AccessDeniedHandler {\n    @Override\n    public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) throws IOException, ServletException {\n        //\u7ed9\u524d\u7aefResponseResult \u7684json\n        ResponseResult responseResult = new ResponseResult(HttpStatus.FORBIDDEN.value(), "\u60a8\u6743\u9650\u4e0d\u8db3\uff01");\n        String json = JSON.toJSONString(responseResult);\n        WebUtils.renderString(response,json);\n    }\n}\n')),(0,a.kt)("p",null,"\u2461\u914d\u7f6e\u7ed9SpringSecurity"),(0,a.kt)("p",null," \u5148\u6ce8\u5165\u5bf9\u5e94\u7684\u5904\u7406\u5668"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"    @Autowired\n    AuthenticationEntryPointImpl authenticationEntryPoint;\n    @Autowired\n    AccessDeniedHandlerImpl accessDeniedHandler;\n")),(0,a.kt)("p",null," \u7136\u540e\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528HttpSecurity\u5bf9\u8c61\u7684\u65b9\u6cd5\u53bb\u914d\u7f6e\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"        //\u544a\u8bc9security\u5982\u4f55\u5904\u7406\u5f02\u5e38\n        http.exceptionHandling().authenticationEntryPoint(authenticationEntryPoint)\n                .accessDeniedHandler(accessDeniedHandler);\n")),(0,a.kt)("p",null,"\u6d4b\u8bd5\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822061236332-79b256bd.png",alt:"image-20220822061236332"}),"image-20220822061236332"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822061533781-2f1c9c2b.png",alt:"image-20220822061533781"}),"image-20220822061533781"),(0,a.kt)("h2",{id:"\u7b2c\u516d\u7ae0-\u8de8\u57df"},"\u7b2c\u516d\u7ae0 \u8de8\u57df"),(0,a.kt)("h3",{id:"1\u4ec0\u4e48\u662f\u8de8\u57df"},"1\u3001\u4ec0\u4e48\u662f\u8de8\u57df"),(0,a.kt)("p",null,"\u9762\u8bd5\uff1a"),(0,a.kt)("p",null,"1\u4ec0\u4e48\u662f\u8de8\u57df\u95ee\u9898\uff1a",(0,a.kt)("strong",{parentName:"p"},"\u6d4f\u89c8\u5668"),"\u7684",(0,a.kt)("strong",{parentName:"p"},"\u540c\u6e90\u7b56\u7565"),"\uff0c\u5bfc\u81f4\u4e0d\u80fd\u5411\u5176\u4ed6\u57df\u540d\u53d1\u9001",(0,a.kt)("strong",{parentName:"p"},"\u5f02\u6b65"),"\u8bf7\u6c42\u3002"),(0,a.kt)("p",null,"2\u540c\u6e90\u7b56\u7565\uff1a\u5177\u6709\u76f8\u540c\u7684\u534f\u8bae\uff08protocol\uff09\uff0c\u4e3b\u673a\uff08host\uff09\u548c\u7aef\u53e3\u53f7\uff08port\uff09"),(0,a.kt)("p",null,"\u9875\u9762\uff1a ",(0,a.kt)("a",{parentName:"p",href:"http://192.168.1.1:8080/search"},"http://192.168.1.1:8080/searchopen in new window")," \u5546\u54c1\u641c\u7d22\u9875\u9762"),(0,a.kt)("p",null," ",(0,a.kt)("a",{parentName:"p",href:"https://192.168.1.1:8080/search?name=%E6%89%8B%E8%A1%A8"},"https://192.168.1.1:8080/search?name=\u624b\u8868open in new window")," -----\x3eno"),(0,a.kt)("p",null," ",(0,a.kt)("a",{parentName:"p",href:"http://192.168.1.2:8080/search"},"http://192.168.1.2:8080/searchopen in new window")," -------------\x3eno"),(0,a.kt)("p",null," ",(0,a.kt)("a",{parentName:"p",href:"http://192.168.1.1:8081/goods/add"},"http://192.168.1.1:8081/goods/addopen in new window")," -------------\x3eno"),(0,a.kt)("p",null," ",(0,a.kt)("a",{parentName:"p",href:"http://192.168.1.1:8080/goods/add"},"http://192.168.1.1:8080/goods/addopen in new window")," -------------\x3e YES"),(0,a.kt)("p",null,"\u51fa\u4e8e\u6d4f\u89c8\u5668\u7684\u540c\u6e90\u7b56\u7565\u9650\u5236\u3002\u540c\u6e90\u7b56\u7565\uff08Sameoriginpolicy\uff09\u662f\u4e00\u79cd\u7ea6\u5b9a\uff0c\u5b83\u662f\u6d4f\u89c8\u5668\u6700\u6838\u5fc3\u4e5f\u6700\u57fa\u672c\u7684\u5b89\u5168\u529f\u80fd\uff0c\u5982\u679c\u7f3a\u5c11\u4e86\u540c\u6e90\u7b56\u7565\uff0c\u5219\u6d4f\u89c8\u5668\u7684\u6b63\u5e38\u529f\u80fd\u53ef\u80fd\u90fd\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u53ef\u4ee5\u8bf4Web\u662f\u6784\u5efa\u5728\u540c\u6e90\u7b56\u7565\u57fa\u7840\u4e4b\u4e0a\u7684\uff0c\u6d4f\u89c8\u5668\u53ea\u662f\u9488\u5bf9\u540c\u6e90\u7b56\u7565\u7684\u4e00\u79cd\u5b9e\u73b0\u3002\u540c\u6e90\u7b56\u7565\u4f1a\u963b\u6b62\u4e00\u4e2a\u57df\u7684javascript\u811a\u672c\u548c\u53e6\u5916\u4e00\u4e2a\u57df\u7684\u5185\u5bb9\u8fdb\u884c\u4ea4\u4e92\u3002\u6240\u8c13\u540c\u6e90\uff08\u5373\u6307\u5728\u540c\u4e00\u4e2a\u57df\uff09\u5c31\u662f\u4e24\u4e2a\u9875\u9762\u5177\u6709\u76f8\u540c\u7684\u534f\u8bae\uff08protocol\uff09\uff0c\u4e3b\u673a\uff08host\uff09\u548c\u7aef\u53e3\u53f7\uff08port\uff09"),(0,a.kt)("p",null,"\u8de8\u57df\u95ee\u9898\uff1a\u6d4f\u89c8\u5668\u7684\u540c\u6e90\u7b56\u7565\u9650\u5236\u3002\u4f1a\u62a5\u9519\u3002"),(0,a.kt)("p",null,"\u5982\u679c\u8de8\u57df\u8c03\u7528\uff0c\u4f1a\u51fa\u73b0\u5982\u4e0b\u9519\u8bef\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin '",(0,a.kt)("a",{parentName:"p",href:"http://localhost:9100/"},"http://localhost:9100open in new window"),"' is therefore not allowed access. The response had HTTP status code 400.")),(0,a.kt)("p",null,"\u7531\u4e8e\u6211\u4eec\u91c7\u7528\u7684\u662f\u524d\u540e\u7aef\u5206\u79bb\u7684\u7f16\u7a0b\u65b9\u5f0f\uff0c\u524d\u7aef\u548c\u540e\u7aef\u5fc5\u5b9a\u5b58\u5728\u8de8\u57df\u95ee\u9898\u3002\u89e3\u51b3\u8de8\u57df\u95ee\u9898\u53ef\u4ee5\u91c7\u7528CORS"),(0,a.kt)("h3",{id:"2cors\u7b80\u4ecb"},"2\u3001CORS\u7b80\u4ecb"),(0,a.kt)("p",null,"CORS:\u8de8\u57df\u8d44\u6e90\u5171\u4eab"),(0,a.kt)("p",null,"\u6761\u4ef6\uff1aIE10\u4ee5\u4e0a"),(0,a.kt)("p",null,"\u672c\u8d28\uff1a\u8bf7\u6c42\u5934\u589e\u52a0\u4e00\u4e2a\u53c2\u6570\uff0c\u5f00\u542f\u8de8\u57df\u8bf7\u6c42\u3002"),(0,a.kt)("p",null,'CORS \u662f\u4e00\u4e2a W3C \u6807\u51c6\uff0c\u5168\u79f0\u662f"\u8de8\u57df\u8d44\u6e90\u5171\u4eab"\uff08Cross-origin resource sharing\uff09\u3002CORS\u9700\u8981\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u540c\u65f6\u652f\u6301\u3002\u76ee\u524d\uff0c\u6240\u6709\u6d4f\u89c8\u5668\u90fd\u652f\u6301\u8be5\u529f\u80fd\uff0cIE \u6d4f\u89c8\u5668\u4e0d\u80fd\u4f4e\u4e8e IE10\u3002\u5b83\u5141\u8bb8\u6d4f\u89c8\u5668\u5411\u8de8\u6e90\u670d\u52a1\u5668\uff0c\u53d1\u51fa XMLHttpRequest \u8bf7\u6c42\uff0c\u4ece\u800c\u514b\u670d\u4e86 AJAX \u53ea\u80fd\u540c\u6e90\u4f7f\u7528\u7684\u9650\u5236\u3002\u6574\u4e2a CORS \u901a\u4fe1\u8fc7\u7a0b\uff0c\u90fd\u662f\u6d4f\u89c8\u5668\u81ea\u52a8\u5b8c\u6210\uff0c\u4e0d\u9700\u8981\u7528\u6237\u53c2\u4e0e\u3002\u5bf9\u4e8e\u5f00\u53d1\u8005\u6765\u8bf4\uff0cCORS \u901a\u4fe1\u4e0e\u540c\u6e90\u7684 AJAX \u901a\u4fe1\u6ca1\u6709\u5dee\u522b\uff0c\u4ee3\u7801\u5b8c\u5168\u4e00\u6837\u3002\u6d4f\u89c8\u5668\u4e00\u65e6\u53d1\u73b0 AJAX \u8bf7\u6c42\u8de8\u6e90\uff0c\u5c31\u4f1a\u81ea\u52a8\u6dfb\u52a0\u4e00\u4e9b\u9644\u52a0\u7684\u5934\u4fe1\u606f\uff0c\u6709\u65f6\u8fd8\u4f1a\u591a\u51fa\u4e00\u6b21\u9644\u52a0\u7684\u8bf7\u6c42\uff0c\u4f46\u7528\u6237\u4e0d\u4f1a\u6709\u611f\u89c9\u3002\u56e0\u6b64\uff0c\u5b9e\u73b0 CORS \u901a\u4fe1\u7684\u5173\u952e\u662f\u670d\u52a1\u5668\u3002\u53ea\u8981\u670d\u52a1\u5668\u5b9e\u73b0\u4e86 CORS \u63a5\u53e3\uff0c\u5c31\u53ef\u4ee5\u8de8\u6e90\u901a\u4fe1\u3002'),(0,a.kt)("p",null,"\u8bf7\u6c42\u8fc7\u7a0b\u5982\u4e0b\u56fe:"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20211012160627209.d53aaa3d-b863a5de.png",alt:"image-20211012160627209"}),"image-20211012160627209"),(0,a.kt)("p",null,"Preflight Request\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/2-6-1acd3a28.png",alt:"./img"}),"./img"),(0,a.kt)("p",null,"\u7136\u540e\u670d\u52a1\u5668\u7aef\u7ed9\u6211\u4eec\u8fd4\u56de\u4e00\u4e2aPreflightResponse"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/2-7-0991966f.png",alt:"./img"}),"./img"),(0,a.kt)("p",null,"@CrossOrigin"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8be6\u60c5\u641c\u7d22it\u6960\u8001\u5e08 \u8de8\u57df\u89c6\u9891\u3002")),(0,a.kt)("p",null,"1.\u5148\u5bf9SpringBoot\u914d\u7f6e\uff0c\u8fd0\u884c\u8de8\u57df\u8bf7\u6c42"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'package com.ydlclass.authdemo.config;\n\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.CorsRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n@Configuration\npublic class CorsConfig implements WebMvcConfigurer {\n\n    @Override\n    public void addCorsMappings(CorsRegistry registry) {\n      // \u8bbe\u7f6e\u5141\u8bb8\u8de8\u57df\u7684\u8def\u5f84\n        registry.addMapping("/**")\n                // \u8bbe\u7f6e\u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\u7684\u57df\u540d\n                .allowedOriginPatterns("*")\n                // \u662f\u5426\u5141\u8bb8cookie\n                .allowCredentials(true)\n                // \u8bbe\u7f6e\u5141\u8bb8\u7684\u8bf7\u6c42\u65b9\u5f0f\n                .allowedMethods("GET", "POST", "DELETE", "PUT")\n                // \u8bbe\u7f6e\u5141\u8bb8\u7684header\u5c5e\u6027\n                .allowedHeaders("*")\n                // \u8de8\u57df\u5141\u8bb8\u65f6\u95f4\n                .maxAge(3600);\n    }\n}\n')),(0,a.kt)("p",null,"2.\u5f00\u542fSpringSecurity\u7684\u8de8\u57df\u8bbf\u95ee"),(0,a.kt)("p",null,"\u7531\u4e8e\u6211\u4eec\u7684\u8d44\u6e90\u90fd\u4f1a\u6536\u5230SpringSecurity\u7684\u4fdd\u62a4\uff0c\u6240\u4ee5\u60f3\u8981\u8de8\u57df\u8bbf\u95ee\u8fd8\u8981\u8ba9SpringSecurity\u8fd0\u884c\u8de8\u57df\u8bbf\u95ee\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http\n                //\u5173\u95edcsrf\n                .csrf().disable()\n                //\u4e0d\u901a\u8fc7Session\u83b7\u53d6SecurityContext\n                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n                .and()\n                .authorizeRequests()\n                // \u5bf9\u4e8e\u767b\u5f55\u63a5\u53e3 \u5141\u8bb8\u533f\u540d\u8bbf\u95ee\n                .antMatchers("/user/login").anonymous()\n                // \u9664\u4e0a\u9762\u5916\u7684\u6240\u6709\u8bf7\u6c42\u5168\u90e8\u9700\u8981\u9274\u6743\u8ba4\u8bc1\n                .anyRequest().authenticated();\n\n\n        //\u628ajwt \u8fc7\u6ee4\u5668 \u653e\u5728user\u8fc7\u6ee4\u5668\u4e4b\u524d\n        http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);\n        //\u544a\u8bc9security\u5982\u4f55\u5904\u7406\u5f02\u5e38\n        http.exceptionHandling().authenticationEntryPoint(authenticationEntryPoint)\n                .accessDeniedHandler(accessDeniedHandler);\n\n        //\u5141\u8bb8\u8de8\u57df\n        http.cors();\n        return http.build();\n    }\n')),(0,a.kt)("h2",{id:"\u7b2c\u4e03\u7ae0-\u62d3\u5c55"},"\u7b2c\u4e03\u7ae0 \u62d3\u5c55"),(0,a.kt)("h3",{id:"1\u6240\u6709\u81ea\u5e26\u6743\u9650\u6821\u9a8c\u65b9\u6cd5"},"1\u3001\u6240\u6709\u81ea\u5e26\u6743\u9650\u6821\u9a8c\u65b9\u6cd5"),(0,a.kt)("p",null," \u6211\u4eec\u524d\u9762\u90fd\u662f\u4f7f\u7528@PreAuthorize\u6ce8\u89e3\uff0c\u7136\u540e\u5728\u5728\u5176\u4e2d\u4f7f\u7528\u7684\u662fhasAuthority\u65b9\u6cd5\u8fdb\u884c\u6821\u9a8c\u3002SpringSecurity\u8fd8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5176\u5b83\u65b9\u6cd5\u4f8b\u5982\uff1ahasAnyAuthority\uff0chasRole\uff0chasAnyRole\u7b49\u3002"),(0,a.kt)("p",null," debug\u770b\u4e00\u4e0b\u76f8\u5173\u5185\u90e8\u4ee3\u7801"),(0,a.kt)("p",null," 0 hasAuthority"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"    private boolean hasAnyAuthorityName(String prefix, String... roles) { //\u63a5\u53e3\u8981\u6c42\u7684\u6743\u9650 pull123\n        Set<String> roleSet = getAuthoritySet();    //\u83b7\u53d6\u767b\u5f55\u4eba\u7684\u6240\u6709\u6743\u9650 pull push\n        for (String role : roles) {\n            String defaultedRole = getRoleWithDefaultPrefix(prefix, role);\n            if (roleSet.contains(defaultedRole)) {\n                return true;\n            }\n        }\n        return false;\n    }\n")),(0,a.kt)("p",null," 1 hasAnyAuthority\u65b9\u6cd5\u53ef\u4ee5\u4f20\u5165\u591a\u4e2a\u6743\u9650\uff0c\u53ea\u6709\u7528\u6237\u6709\u5176\u4e2d\u4efb\u610f\u4e00\u4e2a\u6743\u9650\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5bf9\u5e94\u8d44\u6e90\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"    private boolean hasAnyAuthorityName(String prefix, String... roles) {\n        Set<String> roleSet = getAuthoritySet();\n        for (String role : roles) {\n            String defaultedRole = getRoleWithDefaultPrefix(prefix, role);\n            if (roleSet.contains(defaultedRole)) {\n                return true;\n            }\n        }\n        return false;\n    }\n")),(0,a.kt)("p",null," 2 hasRole\u8981\u6c42\u6709\u5bf9\u5e94\u7684\u89d2\u8272\u624d\u53ef\u4ee5\u8bbf\u95ee\uff0c\u4f46\u662f\u5b83\u5185\u90e8\u4f1a\u628a\u6211\u4eec\u4f20\u5165\u7684\u53c2\u6570\u62fc\u63a5\u4e0a ",(0,a.kt)("strong",{parentName:"p"},"ROLE_")," \u540e\u518d\u53bb\u6bd4\u8f83\u3002\u6240\u4ee5\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8981\u7528\u7528\u6237\u5bf9\u5e94\u7684\u6743\u9650\u4e5f\u8981\u6709 ",(0,a.kt)("strong",{parentName:"p"},"ROLE_")," \u8fd9\u4e2a\u524d\u7f00\u624d\u53ef\u4ee5\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"    private boolean hasAnyAuthorityName(String prefix, String... roles) {\n        Set<String> roleSet = getAuthoritySet();\n        for (String role : roles) {\n            String defaultedRole = getRoleWithDefaultPrefix(prefix, role);\n            if (roleSet.contains(defaultedRole)) {\n                return true;\n            }\n        }\n        return false;\n    }\n")),(0,a.kt)("p",null,"3 hasAnyRole \u6709\u4efb\u610f\u7684\u89d2\u8272\u5c31\u53ef\u4ee5\u8bbf\u95ee\u3002\u5b83\u5185\u90e8\u4e5f\u4f1a\u628a\u6211\u4eec\u4f20\u5165\u7684\u53c2\u6570\u62fc\u63a5\u4e0a ",(0,a.kt)("strong",{parentName:"p"},"ROLE_")," \u540e\u518d\u53bb\u6bd4\u8f83\u3002\u6240\u4ee5\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8981\u7528\u7528\u6237\u5bf9\u5e94\u7684\u6743\u9650\u4e5f\u8981\u6709 ",(0,a.kt)("strong",{parentName:"p"},"ROLE_")," \u8fd9\u4e2a\u524d\u7f00\u624d\u53ef\u4ee5\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"    private boolean hasAnyAuthorityName(String prefix, String... roles) {\n        Set<String> roleSet = getAuthoritySet();\n        for (String role : roles) {\n            String defaultedRole = getRoleWithDefaultPrefix(prefix, role);\n            if (roleSet.contains(defaultedRole)) {\n                return true;\n            }\n        }\n        return false;\n    }\n")),(0,a.kt)("h3",{id:"2\u81ea\u5b9a\u4e49\u6743\u9650\u6821\u9a8c\u65b9\u6cd5"},"2\u3001\u81ea\u5b9a\u4e49\u6743\u9650\u6821\u9a8c\u65b9\u6cd5"),(0,a.kt)("p",null," \u6211\u4eec\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u81ea\u5df1\u7684\u6743\u9650\u6821\u9a8c\u65b9\u6cd5\uff0c\u5728@PreAuthorize\u6ce8\u89e3\u4e2d\u4f7f\u7528\u6211\u4eec\u7684\u65b9\u6cd5\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'@Component("ex")\npublic class LLSExpressionRoot {\n\n    public boolean hasAuthority(String authority){\n        //\u83b7\u53d6\u5f53\u524d\u7528\u6237\u7684\u6743\u9650\n        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();\n        LoginUser loginUser = (LoginUser) authentication.getPrincipal();\n        List<String> permissions = loginUser.getPermissions();\n        //\u5224\u65ad\u7528\u6237\u6743\u9650\u96c6\u5408\u4e2d\u662f\u5426\u5b58\u5728authority\n        return permissions.contains(authority);\n    }\n}\n')),(0,a.kt)("p",null," \u5728SPEL\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528 @ex\u76f8\u5f53\u4e8e\u83b7\u53d6\u5bb9\u5668\u4e2dbean\u7684\u540d\u5b57\u672aex\u7684\u5bf9\u8c61\u3002\u7136\u540e\u518d\u8c03\u7528\u8fd9\u4e2a\u5bf9\u8c61\u7684hasAuthority\u65b9\u6cd5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'    @RequestMapping("/hello")\n    @PreAuthorize("@ex.hasAuthority(\'dev:code:pull\')")\n    public String hello(){\n        return "hello";\n    }\n')),(0,a.kt)("h3",{id:"3\u57fa\u4e8e\u914d\u7f6e\u7684\u6743\u9650\u63a7\u5236"},"3\u3001\u57fa\u4e8e\u914d\u7f6e\u7684\u6743\u9650\u63a7\u5236"),(0,a.kt)("p",null," \u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u914d\u7f6e\u7c7b\u4e2d\u4f7f\u7528\u4f7f\u7528\u914d\u7f6e\u7684\u65b9\u5f0f\u5bf9\u8d44\u6e90\u8fdb\u884c\u6743\u9650\u63a7\u5236\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http\n                //\u5173\u95edcsrf\n                .csrf().disable()\n                //\u4e0d\u901a\u8fc7Session\u83b7\u53d6SecurityContext\n                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n                .and()\n                .authorizeRequests()\n                // \u5bf9\u4e8e\u767b\u5f55\u63a5\u53e3 \u5141\u8bb8\u533f\u540d\u8bbf\u95ee\n                .antMatchers("/user/login").anonymous()\n                .antMatchers("/demo/hello").hasAuthority("admin")\n                // \u9664\u4e0a\u9762\u5916\u7684\u6240\u6709\u8bf7\u6c42\u5168\u90e8\u9700\u8981\u9274\u6743\u8ba4\u8bc1\n                .anyRequest().authenticated();\n\n\n        //\u628ajwt \u8fc7\u6ee4\u5668 \u653e\u5728user\u8fc7\u6ee4\u5668\u4e4b\u524d\n        http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);\n        //\u544a\u8bc9security\u5982\u4f55\u5904\u7406\u5f02\u5e38\n        http.exceptionHandling().authenticationEntryPoint(authenticationEntryPoint)\n                .accessDeniedHandler(accessDeniedHandler);\n\n        //\u5141\u8bb8\u8de8\u57df\n        http.cors();\n        return http.build();\n    }\n')),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822080627039-03b54a9e.png",alt:"image-20220822080627039"}),"image-20220822080627039"),(0,a.kt)("h3",{id:"4csrf"},"4\u3001CSRF"),(0,a.kt)("p",null," CSRF\u662f\u6307\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\uff08Cross-site request forgery\uff09\uff0c\u662fweb\u5e38\u89c1\u7684\u653b\u51fb\u4e4b\u4e00\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.ydlclass.com/doc21xnv/assets/image-20220822081610164-2581bc4b.png",alt:"image-20220822081610164"}),"image-20220822081610164"),(0,a.kt)("p",null," SpringSecurity\u53bb\u9632\u6b62CSRF\u653b\u51fb\u7684\u65b9\u5f0f\u5c31\u662f\u901a\u8fc7csrf_token\u3002\u540e\u7aef\u4f1a\u751f\u6210\u4e00\u4e2acsrf_token\uff0c\u524d\u7aef\u53d1\u8d77\u8bf7\u6c42\u7684\u65f6\u5019\u9700\u8981\u643a\u5e26\u8fd9\u4e2acsrf_token,\u540e\u7aef\u4f1a\u6709\u8fc7\u6ee4\u5668\u8fdb\u884c\u6821\u9a8c\uff0c\u5982\u679c\u6ca1\u6709\u643a\u5e26\u6216\u8005\u662f\u4f2a\u9020\u7684\u5c31\u4e0d\u5141\u8bb8\u8bbf\u95ee\u3002"),(0,a.kt)("p",null," \u6211\u4eec\u53ef\u4ee5\u53d1\u73b0CSRF\u653b\u51fb\u4f9d\u9760\u7684\u662fcookie\u4e2d\u6240\u643a\u5e26\u7684\u8ba4\u8bc1\u4fe1\u606f\u3002\u4f46\u662f\u5728\u524d\u540e\u7aef\u5206\u79bb\u7684\u9879\u76ee\u4e2d\u6211\u4eec\u7684\u8ba4\u8bc1\u4fe1\u606f\u5176\u5b9e\u662ftoken\uff0c\u800ctoken\u5e76\u4e0d\u662f\u5b58\u50a8\u4e2dcookie\u4e2d\uff0c\u5e76\u4e14\u9700\u8981\u524d\u7aef\u4ee3\u7801\u53bb\u628atoken\u8bbe\u7f6e\u5230\u8bf7\u6c42\u5934\u4e2d\u624d\u53ef\u4ee5\uff0c\u6240\u4ee5CSRF\u653b\u51fb\u4e5f\u5c31\u4e0d\u7528\u62c5\u5fc3\u4e86\u3002"),(0,a.kt)("h3",{id:"5\u8ba4\u8bc1\u6210\u529f\u5904\u7406\u5668"},"5\u3001\u8ba4\u8bc1\u6210\u529f\u5904\u7406\u5668"),(0,a.kt)("p",null," \u5b9e\u9645\u4e0a\u5728UsernamePasswordAuthenticationFilter\u8fdb\u884c\u767b\u5f55\u8ba4\u8bc1\u7684\u65f6\u5019\uff0c\u5982\u679c\u767b\u5f55\u6210\u529f\u4e86\u662f\u4f1a\u8c03\u7528AuthenticationSuccessHandler\u7684\u65b9\u6cd5\u8fdb\u884c\u8ba4\u8bc1\u6210\u529f\u540e\u7684\u5904\u7406\u7684\u3002AuthenticationSuccessHandler\u5c31\u662f\u767b\u5f55\u6210\u529f\u5904\u7406\u5668\u3002"),(0,a.kt)("p",null," \u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5df1\u53bb\u81ea\u5b9a\u4e49\u6210\u529f\u5904\u7406\u5668\u8fdb\u884c\u6210\u529f\u540e\u7684\u76f8\u5e94\u5904\u7406\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class LLSSuccessHandler implements AuthenticationSuccessHandler {\n\n    @Override\n    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {\n        System.out.println("\u8ba4\u8bc1\u6210\u529f\u4e86");\n    }\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\n\npublic class SecurityConfig {\n    @Autowired\n    private AuthenticationSuccessHandler successHandler;\n@Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n            \n        http.formLogin().successHandler(successHandler);\n        http.authorizeRequests().anyRequest().authenticated();\n        return http.build();\n    }\n}\n")),(0,a.kt)("h3",{id:"6\u8ba4\u8bc1\u5931\u8d25\u5904\u7406\u5668"},"6\u3001\u8ba4\u8bc1\u5931\u8d25\u5904\u7406\u5668"),(0,a.kt)("p",null," \u5b9e\u9645\u4e0a\u5728UsernamePasswordAuthenticationFilter\u8fdb\u884c\u767b\u5f55\u8ba4\u8bc1\u7684\u65f6\u5019\uff0c\u5982\u679c\u8ba4\u8bc1\u5931\u8d25\u4e86\u662f\u4f1a\u8c03\u7528AuthenticationFailureHandler\u7684\u65b9\u6cd5\u8fdb\u884c\u8ba4\u8bc1\u5931\u8d25\u540e\u7684\u5904\u7406\u7684\u3002AuthenticationFailureHandler\u5c31\u662f\u767b\u5f55\u5931\u8d25\u5904\u7406\u5668\u3002"),(0,a.kt)("p",null," \u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5df1\u53bb\u81ea\u5b9a\u4e49\u5931\u8d25\u5904\u7406\u5668\u8fdb\u884c\u5931\u8d25\u540e\u7684\u76f8\u5e94\u5904\u7406\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class LLSFailureHandler implements AuthenticationFailureHandler {\n    @Override\n    public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException, ServletException {\n        System.out.println("\u8ba4\u8bc1\u5931\u8d25\u4e86");\n    }\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\npublic class SecurityConfig {\n        @Autowired\n    private AuthenticationSuccessHandler successHandler;\n\n    @Autowired\n    private AuthenticationFailureHandler failureHandler;\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n            \n                http.formLogin()\n//                \u914d\u7f6e\u8ba4\u8bc1\u6210\u529f\u5904\u7406\u5668\n                .successHandler(successHandler)\n//                \u914d\u7f6e\u8ba4\u8bc1\u5931\u8d25\u5904\u7406\u5668\n                .failureHandler(failureHandler);\n        http.authorizeRequests().anyRequest().authenticated();\n        return http.build();\n    }\n}\n")),(0,a.kt)("h3",{id:"7\u767b\u51fa\u6210\u529f\u5904\u7406\u5668"},"7\u3001\u767b\u51fa\u6210\u529f\u5904\u7406\u5668"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'@Component\npublic class LLSLogoutSuccessHandler implements LogoutSuccessHandler {\n    @Override\n    public void onLogoutSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {\n        System.out.println("\u6ce8\u9500\u6210\u529f");\n    }\n}\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},"@Configuration\npublic class SecurityConfig {\n    @Autowired\n    private AuthenticationSuccessHandler successHandler;\n\n    @Autowired\n    private AuthenticationFailureHandler failureHandler;\n\n    @Autowired\n    private LogoutSuccessHandler logoutSuccessHandler;\n@Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n          http.formLogin()\n//                \u914d\u7f6e\u8ba4\u8bc1\u6210\u529f\u5904\u7406\u5668\n                .successHandler(successHandler)\n//                \u914d\u7f6e\u8ba4\u8bc1\u5931\u8d25\u5904\u7406\u5668\n                .failureHandler(failureHandler);\n\n        http.logout()\n                //\u914d\u7f6e\u6ce8\u9500\u6210\u529f\u5904\u7406\u5668\n                .logoutSuccessHandler(logoutSuccessHandler);\n\n        http.authorizeRequests().anyRequest().authenticated();\n    }\n}\n")),(0,a.kt)("p",null,"\u4f5c\u4e1a\uff1a\u60f3\u60f3\u5176\u4ed6\u6709\u4ec0\u4e48\u8ba4\u8bc1\u65b9\u6848\u3002\u6216\u8005\u81ea\u5df1\u80fd\u5199\u4e00\u5957\u8ba4\u8bc1\u7cfb\u7edf\u5417\uff1f"),(0,a.kt)("h2",{id:"\u7b2c\u516b\u7ae0-\u7559\u4e00\u540e\u624b"},"\u7b2c\u516b\u7ae0 \u7559\u4e00\u540e\u624b"),(0,a.kt)("p",null,"\u6b22\u8fce\u70b9\u8d5e"),(0,a.kt)("p",null,"1.\u81ea\u5b9a\u4e49\u767b\u5f55\u9875\u9762"),(0,a.kt)("p",null,"2.\u540e\u7eed\u4f1a\u51fa springSecurity+Oauth2\u89e3\u51b3\u65b9\u6848"))}c.isMDXComponent=!0}}]);